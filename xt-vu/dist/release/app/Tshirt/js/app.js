webpackJsonp([1],[function(e,t,i){(function(e,t){var a=i(35);a.loadDomainUrls();var o=i(26);o.getUserInfo();var r=i(7),n=i(11),s=i(13),d=i(21),l=d.extend(i(47));d.component("as-header",l);var c=d.extend(i(68));d.component("image-upload",c);var p=d.extend(i(61));d.component("size-chart",p);var h=d.extend(i(51));d.component("list-tab",h);var g=d.extend(i(46));d.component("handle",g);var m=d.extend(i(42));d.component("bar-panel",m);var u=d.extend(i(62));d.component("subbar-panel",u);var f=d.extend(i(55));d.component("photo-element",f);var v=d.extend(i(64));d.component("text-element",v);var x=d.extend(i(41));d.component("bg-layer",x);var w=d.extend(i(45));d.component("dashboard",w);var S=d.extend(i(48));d.component("image-crop",S);var y=d.extend(i(53));d.component("options-window",y);var I=d.extend(i(63));d.component("text-editor",I);var b=d.extend(i(52));d.component("measure-option",b);var P=d.extend(i(54));d.component("order-window",P);var j=d.extend(i(57));d.component("preview-header",j);var C=d.extend(i(43));d.component("contact-us-window",C);var T=d.extend(i(67));d.component("clone-window",T);var k=d.extend(i(58));d.component("preview-item-list",k);var L=d.extend(i(56));d.component("pop-up",L);var D=d.extend(i(60));d.component("screenshot",D);var B=d.extend(i(50));d.component("inner-preview",B);var z=d.extend(i(66));d.component("cart-choose-window",z);var F=d.extend(i(69));d.component("new-project-window",F);var R=d.extend(i(70));d.component("warntip-element",R);var U=new d({el:"#app",mixins:[i(32),i(33)],data:{privateStore:{},sharedStore:e,imageName:""},computed:{},methods:{init:function(){var t=i(36);t.loadLocalSpec();var a=this;a.sharedStore.domains;if(prj=a.sharedStore.projectSettings[e.currentSelectProjectIndex],user=a.sharedStore.userSettings,e.title=decodeURIComponent(n.getUrlParam("title")),e.projectId=n.getUrlParam("initGuid"),e.fromCart=n.getUrlParam("fromCart"),e.isPreview=n.getUrlParam("isPreview"),e.previewSource=n.getUrlParam("source"),e.isFromMyPhoto=n.getUrlParam("isFromMyPhoto"),""===e.projectId){e.isNewProject=!0;var o=i(20),d=o();d.product=n.getUrlParam("type"),d.color=n.getUrlParam("color"),d.size="14X16",d.measure=this.getDefaultMeasure(d.color,d.size),d.count=1,a.sharedStore.projectSettings.push(d)}(!e.isPreview&&""===user.userId||prj&&(""===prj.product||""===prj.size)&&""===e.projectId)&&(alert("Please log in!"),window.location="/"),e.projectId&&r.getAlbumId(),""!==user.userId&&""!==e.projectId&&(e.isPreview||s.getProjectOrderedState(this),i(7).getProjectInfo()),setInterval(function(){i(26).keepAlive()},24e4)},loadProjectXml:function(){var t=this;t.sharedStore.domains;prj=t.sharedStore.projectSettings[e.currentSelectProjectIndex],e.projectId?s.getOldProject():s.saveNewProject(t)},getDefaultMeasure:function(t,i){var a="M",o=["S","M","L","XL","XXL"];return e.disableOptions[t]&&(availableMeasures=o.filter(function(i){return e.disableOptions[t].options.indexOf(i)===-1}),availableMeasures.indexOf(a)===-1&&(a=availableMeasures[0])),a}},events:{},created:function(){var t=this;r.getTshirtDisableOptions(),t.$watch("sharedStore.watches.isDisableOptionLoaded",function(){t.init()}),t.$watch("sharedStore.watches.isSpecLoaded",function(){t.sharedStore.watches.isSpecLoaded&&t.loadProjectXml()}),t.$watch("sharedStore.watches.isProjectLoaded",function(){t.sharedStore.watches.isProjectLoaded&&(i(8)({ev:i(9).LoadComplete,isNewProject:e.isNewProject}),i(7).getTitle(),console.log("project xml is OK, notify paint canvas"),i(14).initCanvasData(),t.$broadcast("notifyPaint"),"true"==e.isFromMyPhoto&&s.getMyPhotoImages(t,e.userSettings.userId,!1),t.$broadcast("notifyResetProjectToDefault"))}),t.$watch("sharedStore.currentSelectProjectIndex",function(e,i){t.$broadcast("notifyRepaint",i)})}});e.vm=U,t(window).bind("beforeunload",function(){return e.isPopSave!==!0||e.isPreview?void(e.isPopSave=!0):"Unsaved changes(If any) will be discarded. Are you sure to exit?"})}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){var o=t.spec.specXml;e.exports={getVersion:function(){return a(o).find("product-spec").attr("version")},getDPI:function(){return parseInt(a(o).find("dpi").text())},getImageQualityBufferPercent:function(){return parseInt(a(o).find("imageQualityBufferPercent").text())},getOptions:function(e){for(var t=a(o).find("optionGroup[id="+e+"]").find("option"),i=[],r=0;r<t.length;r++){for(var n={},s=t.eq(r).get(0).attributes,d=0;d<s.length;d++)n[s[d].name]=s[d].value;var l=t.eq(r).find("title").text();""!=l&&(n.title=l),i.push(n)}return i},getOptionsMap:function(e,t){var i=a(o).find("configurableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),r=a(o).find("configurableOptionMap").find("optionMap[id="+e+"]").find("entry"),n=this.getIsPattern(i,r,t);return n?n.attr("value"):null},getOptionsMapDefaultValue:function(e,t){var i=a(o).find("configurableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),r=a(o).find("configurableOptionMap").find("optionMap[id="+e+"]").find("entry"),n=this.getIsPattern(i,r,t);return n?n.attr("defaultValue"):null},getParameter:function(e,t){var i=a(o).find("parameter[id="+e+"]").attr("keyPattern").toString(),r=a(o).find("parameter[id="+e+"]").find("entry"),n=this.getIsPattern(i,r,t);if(n){for(var s={},d=n.get(0).attributes,l=0;l<d.length;l++)s[d[l].name]=d[l].value;return s}return null},getVariable:function(e,t){var i=a(o).find("variable[id="+e+"]").attr("keyPattern").toString(),r=a(o).find("variable[id="+e+"]").find("entry"),n=this.getIsPattern(i,r,t);if(n){for(var s={},d=n.get(0).attributes,l=0;l<d.length;l++)s[d[l].name]=d[l].value;return s}return null},getIsPattern:function(e,t,i){for(var a=e.split("-"),o=0;o<t.length;o++){for(var r=t.eq(o).attr("key"),n=r.split("-"),s=t.eq(o),d=[],l=0;l<n.length;l++){var c=a[l],p=n[l];if("*"===p)d.push(!0);else for(var h=0;h<i.length;h++)if(i[h].key===c){var g=/\[/.test(p),m=i[h].value;if(g){var u=p.substr(1,p.length-2).split(","),f=u.map(function(e){return e.trim()});f.indexOf(m)!==-1&&d.push(!0)}else p===m&&d.push(!0)}}for(var v=!0,x=0;x<d.length;x++)d[x]===!1&&(v=!1);if(d.length===a.length&&v)return s}return null},getOptionIds:function(){for(var e=[],t=a(o).find("optionGroup"),i=0;i<t.length;i++)e.push(t.eq(i).attr("id"));return e},getOptionMapIds:function(){for(var e=[],t=a(o).find("configurableOptionMap").find("optionMap"),i=0;i<t.length;i++)e.push(t.eq(i).attr("id"));return e},getOptionMapById:function(e){return a(o).find("configurableOptionMap").find("optionMap[id="+e+"]").find("entry")},getCategoryByProduct:function(e){for(var t=this.getOptionMapById("product"),i=0;i<t.length;i++)for(var a=t.eq(i).attr("value"),o=a.split(","),r=0;r<o.length;r++)if(o[r]===e)return t.eq(i).attr("key");return"none"},getOptionMapKeyPatternById:function(e){return a(o).find("configurableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString()},getParameterIds:function(){for(var e=[],t=a(o).find("parameter"),i=0;i<t.length;i++)e.push(t.eq(i).attr("id"));return e},getParameterKeyPatternById:function(e){return a(o).find("parameter[id="+e+"]").attr("keyPattern").toString()},getVariableKeyPatternById:function(e){return a(o).find("variable[id="+e+"]").attr("keyPattern").toString()},getDisableOptionsMap:function(e,t){if(a(o).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern")){var i=a(o).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),r=a(o).find("disableOptionMap").find("optionMap[id="+e+"]").find("entry"),n=this.getIsPattern(i,r,t);return n?n.attr("value"):null}return null},getDisableOptionMapKeyPatternById:function(e){try{return a(o).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString()}catch(e){return""}},getDisableOptionIds:function(){for(var e=[],t=a(o).find("disableOptionMap").find("optionMap"),i=0;i<t.length;i++)e.push(t.eq(i).attr("id"));return e},getDisableOptionValues:function(e){for(var t=[],i=a(o).find("disableOptionMap").find("optionMap").find("entry"),r=0;r<i.length;r++)i.eq(r).attr("key").indexOf(e)!=-1&&t.push(i.eq(r).attr("value"));return t},getAllSize:function(){var e="size",t=(this.getOptionMapKeyPatternById(e).split("-"),[]),i={key:"product",value:"print"};return t.push(i),this.getOptionsMap(e,t).split(",")},getAllPaper:function(e){var i="paper",a=(this.getOptionMapKeyPatternById(i).split("-"),[]),o=(t.projectSettings[t.currentSelectProjectIndex],{key:"size",value:e});return a.push(o),this.getOptionsMap(i,a).split(",")},getElementById:function(e){return a(o).find("#"+e)},getOptionNameById:function(e,t){var i=this.getOptions(e),a="";return i.some(function(e){if(e.id===t)return a=e.name||e.title,!0}),a},getAvailableOptions:function(e,t,a){var o=i(17).getParamsList(a);return t=t||[],Array.isArray(t)||(t=[t]),o=o.map(function(e){var i=t.filter(function(t){return t.key===e.key});return i.length>0&&(e=i[0]),e}),this.getOptionsMap(e,o).split(",")},isDisableOptionShow:function(e,t,i){if(a(o).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern")){var r=a(o).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),n=a(o).find("disableOptionMap").find("optionMap[id="+e+"]").find("entry"),s=this.getIsPattern(r,n,t);if(s){var d=s.attr("value").split(",");return!(!d||d.indexOf(i)===-1)&&"true"===s.attr("isShow")}return!1}return!1},getOptionsMapDefaultValueWithoutDisableOption:function(e,t){var i=a(o).find("configurableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),r=a(o).find("configurableOptionMap").find("optionMap[id="+e+"]").find("entry"),n=this.getIsPattern(i,r,t);if(a(o).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern"))var s=a(o).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),d=a(o).find("disableOptionMap").find("optionMap[id="+e+"]").find("entry"),l=this.getIsPattern(s,d,t);if(l&&n&&n.attr("defaultValue")===l.attr("value")){var c=n.attr("value").split(",").filter(function(e){return e!==l.attr("value")});return c[0]}return n?n.attr("defaultValue"):null}}}).call(t,i(2),i(4))},function(e,t,i){var a=[],o=i(38),r=i(34);e.exports={isPreview:!1,isNewProject:!1,previewSource:"",operateMode:"idle",isLostFocus:!0,isInnerPreviewShow:!1,isChangePageShow:!1,isPopupShow:!1,isImageUploadShow:!1,isImageCropShow:!1,isOptionsViewShow:!1,isTextEditorShow:!1,isOrderViewShow:!1,isPrjSaved:!1,isPopSave:!0,isShowHelp:!1,isShowClone:!1,isEditLayerShow:!1,isShowContactUs:!1,cancelledUpload:[],currentUploadCount:0,successfullyUploaded:0,errorUploaded:0,currentSuccessUpload:0,currentErrorUpload:0,errorUploadedFiles:[],retryId:-1,cancelByX:!1,chooseTimes:0,uploadTimes:0,filesTotal:0,filesTotalInQueue:0,filesCountInQueue:0,saveImage:!1,isSizeChartShow:!1,projectSettings:a,spec:r,domains:o,cropImageRatio:1,selectedPageIdx:0,elementDragged:"",dragData:{imageId:"",sourceImageUrl:"",cursorX:0,cursorY:0,isFromList:!1},cropParams:{},projects:[],pages:[],oriImageIds:[],imageList:[],deleImagelist:[],fontList:[],ctrls:{tcResize:"",lastTranEvent:"",isDragStarted:!1},watches:{flagRepaint:!1,isSpecLoaded:!1,isProjectLoaded:!1,isRefreshImage:!1,isCropThisImage:!1,isChangeThisText:!1,isOnDrop:!1,isChangeDepthFront:!1,isRemoveElement:!1,isReplaceImage:!1,isDisableOptionLoaded:!1},watchData:{changeDepthIdx:"",cropImageIdx:"",removeElementType:"",removeElementIdx:""},dropData:{ev:"",newAdded:!1,isBg:!1,idx:"",ev:""},shouldNewImage:!1,warnMargin:{left:30,top:30,width:15,height:15,visible:!1,rate:30},warnSettings:{resizeLimit:30,resizeWarnMsg:"beyond resize limit!",warnImageWidth:10,warnImageHeight:10,visible:!1},uploadProgress:[],webClientId:1,currentSelectProjectIndex:0,userSettings:{},projectId:"",projectXml:"",title:"",itemListNum:0,fromCart:!1,colorOptionList:[{type:"White",title:"White",backgroundImage:"assets/img/White-0.png",normalColor:"assets/img/white-normal.png",pressColor:"assets/img/white-pressed.png"},{type:"Black",title:"Black",backgroundImage:"assets/img/Black-0.png",normalColor:"assets/img/black-normal.png",pressColor:"assets/img/black-pressed.png"},{type:"SportGrey",title:"Sport Grey",backgroundImage:"assets/img/SportGrey-0.png",normalColor:"assets/img/grey-normal.png",pressColor:"assets/img/grey-pressed.png"},{type:"NavyBlue",title:"Navy Blue",backgroundImage:"assets/img/NavyBlue-0.png",normalColor:"assets/img/navy-normal.png",pressColor:"assets/img/navy-pressed.png"},{type:"RoyalBlue",title:"Royal Blue",backgroundImage:"assets/img/RoyalBlue-0.png",normalColor:"assets/img/royal-normal.png",pressColor:"assets/img/royal-pressed.png"}],projectType:"CLO",orderType:"clothing",isFromMarketplace:!1,vm:null,projectInfo:{isOrdered:!1,isInCart:!1,isInMarket:!1},screenshotSize:{width:200,height:200},currentImage:"",uploadAcceptType:"image/jpeg,image/x-png,image/png",checkFailed:!1,warnTipLimit:200,warnTipMargin:5,warnTipBottom:5,warnTipLeft:5,disableOptions:[]}},function(e,t,i){(function(t){e.exports={xmlToString:function(e){return(new XMLSerializer).serializeToString(e)},stringToXml:function(e){var i=t.parseXML(e);return i}}}).call(t,i(4))},,function(e,t,i){(function(t){i(10);e.exports={getParamsValueByElement:function(e,i){void 0!=i&&null!=i?i:i=t.selectedPageIdx;var a=t.pages[i].canvas;if(void 0!=e&&null!=e){var o=a.trans[e].attrs.size.x*a.trans[e].attrs.scale.x,r=a.trans[e].attrs.size.y*a.trans[e].attrs.scale.y,n=o/a.ratio,s=r/a.ratio,d=(a.trans[e].attrs.x+a.trans[e].attrs.translate.x-(o-a.trans[e].attrs.size.x)/2)/a.ratio,l=(a.trans[e].attrs.y+a.trans[e].attrs.translate.y-(r-a.trans[e].attrs.size.y)/2)/a.ratio,c=a.trans[e].attrs.rotate;if(90===Math.abs(a.elements[e].imageRotate))var p=a.elements[e].imageHeight,h=a.elements[e].imageWidth;else var p=a.elements[e].imageWidth,h=a.elements[e].imageHeight;if("text"===a.elements[e].elType)var g=a.elements[e].fontSize*a.trans[e].attrs.scale.x;else var g=a.elements[e].fontSize;return{elType:a.elements[e].elType,url:a.elements[e].sourceImageUrl,text:a.elements[e].text,x:d,y:l,width:n,height:s,rotate:c,dep:a.elements[e].dep,imageId:a.elements[e].imageId,imageRotate:a.elements[e].imageRotate||0,cropPX:a.elements[e].cropX/p||0,cropPY:a.elements[e].cropY/h||0,cropPW:a.elements[e].cropW/p||1,cropPH:a.elements[e].cropH/h||1,fontFamily:a.elements[e].fontFamily||"",fontSize:parseFloat(g)||"",fontWeight:a.elements[e].fontWeight||"",textAlign:a.elements[e].textAlign||"",fontColor:a.elements[e].fontColor||""}}return""},getCropParamsByElement:function(e,i){void 0!=i&&null!=i?i:i=t.selectedPageIdx;var a=t.pages[i].canvas;if(void 0!=e&&null!=e){var o=a.trans[e].attrs.size.x*a.trans[e].attrs.scale.x,r=a.trans[e].attrs.size.y*a.trans[e].attrs.scale.y,n=o/a.ratio,s=r/a.ratio,d=(a.trans[e].attrs.x+a.trans[e].attrs.translate.x-(o-a.trans[e].attrs.size.x)/2)/a.ratio,l=(a.trans[e].attrs.y+a.trans[e].attrs.translate.y-(r-a.trans[e].attrs.size.y)/2)/a.ratio,c=a.trans[e].attrs.rotate;if(90===Math.abs(a.elements[e].imageRotate))var p=a.elements[e].imageHeight,h=a.elements[e].imageWidth;else var p=a.elements[e].imageWidth,h=a.elements[e].imageHeight;if("text"===a.elements[e].elType)var g=a.elements[e].fontSize*a.trans[e].attrs.scale.x;else var g=a.elements[e].fontSize;var m=a.elements[e].cropX/p,u=a.elements[e].cropY/h,f=a.elements[e].cropW/p,v=a.elements[e].cropH/h,x=n,w=s,S=m,y=m+f,I=u,b=u+v,P=w/x,j=p,C=h,T=S+(y-S)/2,k=I+(b-I)/2,L=T*j,D=k*C,B=(y-S)*j/x,z=(b-I)*C/w,F=x*B,R=w*z;F>j&&(F=j),R>C&&(R=C);var U,M,E,O;F*P>R?(O=R,E=R/P):(E=F,O=F*P),U=L-E/2,U=U>0?U:0,U+E>j&&(U-=U+E-j,U=U>0?U:0),M=D-O/2,M=M>0?M:0,M+O>C&&(M-=M+O-C,M=M>0?M:0);var H={elType:a.elements[e].elType,url:a.elements[e].sourceImageUrl,text:a.elements[e].text,x:d,y:l,width:n,height:s,rotate:c,dep:a.elements[e].dep,imageId:a.elements[e].imageId,imageRotate:a.elements[e].imageRotate||0,cropPX:U/j||0,cropPY:M/C||0,cropPW:E/j||1,cropPH:O/C||1,fontFamily:a.elements[e].fontFamily||"",fontSize:parseFloat(g)||"",fontWeight:a.elements[e].fontWeight||"",textAlign:a.elements[e].textAlign||"",fontColor:a.elements[e].fontColor||""};return H}return""},getCropImageUrl:function(e,a,o){void 0!=a&&null!=a?a:a=t.selectedPageIdx;var r=t.pages[a].canvas,n=o?o:r.ratio;if(void 0==e||null==e||"background"!==r.params[e].elType&&"image"!==r.params[e].elType&&"logo"!==r.params[e].elType&&"PhotoElement"!==r.params[e].elType)return"";var s="../../static/img/blank.png";if(""!==r.params[e].imageId){var d=r.params[e],l=Math.abs(d.cropPX.toFixed(8)),c=Math.abs(d.cropPY.toFixed(8)),p=Math.abs(d.cropPW.toFixed(8)),h=Math.abs(d.cropPH.toFixed(8)),g=d.width*n/p,m=d.height*n/h,u=d.style&&d.style.brightness?d.style.brightness:0,f=i(6),v=f.getEncImgId(r.params[e].imageId),x=f.getQueryString({encImgId:v,px:l,py:c,pw:p,ph:h,width:Math.ceil(g),height:Math.ceil(m),rotation:r.params[e].imageRotate,brightness:u});s="/imgservice/op/crop?"+x+i(11).getSecurityString()}return s},getCropDecorationUrl:function(e,i){void 0!=i&&null!=i?i:i=t.selectedPageIdx;var a=t.pages[i].canvas;if(void 0==e||null==e||"background"!==a.params[e].elType&&"decoration"!==a.params[e].elType&&"logo"!==a.params[e].elType&&"DecorationElement"!==a.params[e].elType)return"";var o="../../static/img/blank.png";if(""!==a.params[e].decorationid){var r=a.params[e].decorationid;o=t.domains.baseUrl+"/artwork/png/1000/"+r+".png"}return o},getFontImageUrl:function(){},getShiftValue:function(e,i){if(void 0!=i&&null!=i?i:i=t.selectedPageIdx,e=e||t.pages[i].canvas,"none"!==t.project2.matte)var a=-1*(e.boardInMatting.left+e.realBleedings.left),o=-1*(e.boardInMatting.top+e.realBleedings.top),r=-1*(e.boardInMatting.right+e.realBleedings.right),n=-1*(e.boardInMatting.bottom+e.realBleedings.bottom);else var a=-1*(e.boardInFrame.left+e.realBleedings.left),o=-1*(e.boardInFrame.top+e.realBleedings.top),r=-1*(e.boardInFrame.right+e.realBleedings.right),n=-1*(e.boardInFrame.bottom+e.realBleedings.bottom);return{x:a,y:o,xDot:r,yDot:n}},getShiftPosition:function(e,t,i,a,o,r){if(null!=e&&null!=t&&null!=i&&null!=a){o=o||0,r=r||0;var n=e+o,s=t+r;return{x:n,y:s,width:i,height:a}}return{x:0,y:0,width:0,height:0}},getUnshiftPosition:function(e){if(void 0!=e&&null!=e){var i,a,o,r,n=t.pages[t.selectedPageIdx].canvas,s=-1*this.getShiftValue().x,d=-1*this.getShiftValue().y,l=-1*this.getShiftValue().xDot,c=-1*this.getShiftValue().yDot,p=n.params[e].x||0,h=n.params[e].y||0,g=n.params[e].width||0,m=n.params[e].height||0,u=n.oriWidth||0,f=n.oriHeight||0;return p+=s,h+=d,i=p/(u+s+l),a=h/(f+d+c),o=g/(u+s+l),r=m/(f+d+c),i<0?i=0:i,i>1?i=1:i,a<0?a=0:a,a>1?a=1:a,o<0?o=0:o,o>1?o=1:o,r<0?r=0:r,r>1?r=1:r,{x:p,y:h,px:i,py:a,pw:o,ph:r}}return console.fail("idx is invalid in getUnshiftPosition() [ParamsManage]"),""},getIndexById:function(e,i){var i=i||t.selectedPageIdx;if(void 0!=e&&null!=e&&""!==e){for(var a=t.pages[i].canvas,o=0;o<a.params.length;o++)if(a.params[o].id===e)return o;return-1}return-1},getIndexByDep:function(e){for(var i=t.pages[t.selectedPageIdx].canvas,a=0;a<i.params.length;a++)if(i.params[a].dep===e)return a;return 0},getFrontElementIndex:function(){var e=t.pages[t.selectedPageIdx].canvas;return this.getIndexByDep(e.params.length-1)},getBorderHiddenSize:function(){var e=t.pages[t.selectedPageIdx].canvas,i=topLimit=rightLimit=bottomLimit=0;if(t.isCanvas)i=(e.canvasBordeThickness.left+e.realBleedings.left)*e.ratio,rightLimit=(e.canvasBordeThickness.right+e.realBleedings.right)*e.ratio,topLimit=(e.canvasBordeThickness.top+e.realBleedings.top)*e.ratio,bottomLimit=(e.canvasBordeThickness.bottom+e.realBleedings.bottom)*e.ratio;else{var a=e.frameBaseSize.width*e.ratio,o=e.frameBaseSize.height*e.ratio,r=Math.abs(e.x),n=Math.abs(e.y);e.width>a?t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?(i=r+e.boardInMatting.left*e.ratio,rightLimit=e.width-a-r+e.boardInMatting.right*e.ratio):(i=r+e.boardInFrame.left*e.ratio,rightLimit=e.width-a-r+e.boardInFrame.right*e.ratio):t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?(i=e.boardInMatting.left*e.ratio+e.realBleedings.left*e.ratio,rightLimit=e.boardInMatting.right*e.ratio+e.realBleedings.right*e.ratio):(i=e.boardInFrame.left*e.ratio+e.realBleedings.left*e.ratio,rightLimit=e.boardInFrame.right*e.ratio+e.realBleedings.right*e.ratio),e.height>o?t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?(topLimit=n+e.boardInMatting.top*e.ratio,bottomLimit=e.height-o-n+e.boardInMatting.bottom*e.ratio):(topLimit=n+e.boardInFrame.top*e.ratio,bottomLimit=e.height-o-n+e.boardInFrame.bottom*e.ratio):t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?(topLimit=e.boardInMatting.top*e.ratio+e.realBleedings.top*e.ratio,bottomLimit=e.boardInMatting.bottom*e.ratio+e.realBleedings.bottom*e.ratio):(topLimit=e.boardInFrame.top*e.ratio+e.realBleedings.top*e.ratio,bottomLimit=e.boardInFrame.bottom*e.ratio+e.realBleedings.bottom*e.ratio)}return{left:i,top:topLimit,right:rightLimit,bottom:bottomLimit}}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={getIsShowProjectInfoView:function(){var e=!1;return!t.checkFailed&&((t.projectInfo.isInCart||t.projectInfo.isOrdered||t.projectInfo.isInMarket)&&(e=!0),t.fromCart&&t.projectInfo.isInCart&&!t.projectInfo.isOrdered&&(e=!1),e)},getProjectInfoViewText:function(){return t.projectInfo.isInMarket?"This item was already posted to sale. You need to save your additional changes into a new project.":"Your current project was already ordered or added to cart. You need to save your additional changes into a new project."},getProjectOrderText:function(){if(!t.projectInfo.isOrdered)return"Please select at least one image before placing your order."},checkInvalid:function(e){return/^[a-zA-Z 0-9\d_\s\-]+$/.test(e)},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},getQueryString:function(e){var t="";for(var i in e){var a=e[i];t+=encodeURIComponent(i)+"="+encodeURIComponent(a)+"&"}return t.length>0&&(t=t.substring(0,t.length-1)),t},getEncImgId:function(e){return t.imageList.filter(function(t){return t.id===e})[0].encImgId},isIncludeDisableOption:function(){var e=i(1),a=t.projectSettings[t.currentSelectProjectIndex],o=a.product,r=e.getDisableOptionValues(o),n=[];r.forEach(function(e,t,i){n=n.concat(e.split(","))});for(var s in r)console.log(s);for(var d in a)if(n.indexOf(a[d])!=-1)return!0;return!1}}}).call(t,i(2))},function(e,t,i){(function(t,a){e.exports={loadLocalProject:function(){console.log("projectService"),t.ajax({url:"./assets/data/tshirt-project.1.0.xml",type:"get",dataType:"xml",async:!1}).done(function(e){a.xml=e})},insertProject:function(e,o){var r=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectType;a.projectXml=o;var n="",s=a.title,d=a.quantity?a.quantity:1,l=a.mainProjectUid?"cart":"";if("CV"!==a.projectType&&"FM"!==a.projectType&&"PHC"!==a.projectType&&"CLO"!==a.projectType&&"PR"!==a.projectType&&"flushMountPrint"!==a.projectType&&"PP"!==a.projectType&&"IPadCase"!==a.projectType||(n=this.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===a.projectType||"FM"===a.projectType){var c=a.projectSettings[a.currentSelectProjectIndex],p=c.product;r=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+p}t.ajax({url:r,type:"post",data:{mainProjectUid:a.mainProjectUid,crossSell:l,removeCart:a.fromCart,encodeimage:n,projectXml:o,requestKey:i(11).getRequestKey(),isFromMarketplace:a.isFromMarketplace,title:s,quantity:d}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(console.log("new project successfully"+i),a.projectId=t(i).find("guid").text()||"",a.projectXml=i,a.watches.isProjectLoaded=!0,a.isNewInsertProject=!0):(a.watches.isProjectLoaded=!0,"-3"===t(i).find("errorCode").text()&&e.$dispatch("dispatchShowProjectChooseWindow"))})},saveProject:function(e,o,r,n,s,d,l){var c=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectId+"/"+a.projectType,p="",h=a.title,g=a.quantity?a.quantity:1;if("CV"!==a.projectType&&"FM"!==a.projectType&&"PHC"!==a.projectType&&"CLO"!==a.projectType&&"PR"!==a.projectType&&"flushMountPrint"!==a.projectType&&"PP"!==a.projectType&&"CR"!==a.projectType&&"IPadCase"!==a.projectType||(p=this.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===a.projectType||"FM"===a.projectType){var m=a.projectSettings[a.currentSelectProjectIndex],u=m.product;c=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectId+"/"+u}t.ajax({url:c,type:"post",dataType:"xml",data:{removeCart:a.fromCart,encodeimage:p,projectXml:o,requestKey:i(11).getRequestKey(),isFromMarketplace:a.isFromMarketplace,thumbnailPX:r,thumbnailPY:n,thumbnailPW:s,thumbnailPH:d,title:h,quantity:g},error:function(e){a.vm.$dispatch("dispatchShowPopup",{type:"noInterenet",status:0})}}).done(function(o){o&&"success"===t(o).find("resultData").attr("state")?(a.projectXml=o,l&&"function"==typeof l?l():e.$dispatch("dispatchShowPopup",{type:"save",status:0}),i(8)({ev:i(9).SaveComplete}),a.isPrjSaved=!0):o&&"fail"===t(o).find("resultData").attr("state")?"201"===t(o).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-3}),a.vm.$broadcast("notifyCloseWindow")):"202"===t(o).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-4}),a.vm.$broadcast("notifyCloseWindow")):"205"===t(o).find("code").text()?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1})})},orderProject:function(e,o,r,n,s,d){if(a.projectId){var l=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectId+"/"+a.projectType,c="",p=a.title,h=a.quantity?a.quantity:1;if("CV"!==a.projectType&&"FM"!==a.projectType&&"PHC"!==a.projectType&&"CLO"!==a.projectType&&"PR"!==a.projectType&&"flushMountPrint"!==a.projectType&&"PP"!==a.projectType&&"CR"!==a.projectType&&"IPadCase"!==a.projectType||(c=this.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===a.projectType||"FM"===a.projectType){var g=a.projectSettings[a.currentSelectProjectIndex],m=g.product;l=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectId+"/"+m}t.ajax({url:l,type:"post",dataType:"xml",data:{removeCart:a.fromCart,encodeimage:c,projectXml:o,requestKey:i(11).getRequestKey(),isFromMarketplace:a.isFromMarketplace,thumbnailPX:r,thumbnailPY:n,thumbnailPW:s,thumbnailPH:d,title:p,quantity:h},error:function(e){a.vm.$dispatch("dispatchShowPopup",{type:"noInterenet",status:0})}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(console.log("save project successfully"+i),console.log("errorCode"+t(i).find("errorCode").text()),a.projectXml=i,a.isPrjSaved=!0,a.isPopSave=!1,window.location="/"+a.orderType+"/addShoppingCart.html?projectGUID="+a.projectId+"&quantity="+h):i&&"fail"===t(i).find("resultData").attr("state")?"201"===t(i).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-3}),a.vm.$broadcast("notifyCloseWindow")):"205"===t(i).find("code").text()?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch("dispatchShowPopup",{type:"order",status:-1}):e.$dispatch("dispatchShowPopup",{type:"order",status:-1})})}},getShareProject:function(){var e=this;t.ajax({url:a.domains.uploadUrl+"/upload/Preview/GetPhotobookXmlByProjectId?projectId="+encodeURIComponent(a.projectId),type:"get",dataType:"xml",data:"webClientId=1"}).done(function(o){if(o){a.encProjectId=a.projectId,a.projectXml=o,a.title=t(o).find("title").text(),a.projectId=t(o).find("guid").text(),a.projectSettings.length=0;for(var r=0;r<t(o).find("spec").length;r++){for(var n=t(o).find("spec").eq(r),s=i(20),d=s(),l=0;l<n.find("option").length;l++){var c=n.find("option").eq(l);d[c.attr("id")]=c.attr("value")}"categoryFrame"!==d.category&&"categoryCanvas"!==d.category&&"categoryWallarts"!==d.category||(d.metalType=d.metalType||"none",d.finish=d.finish||"none");for(var p=0;p<t(o).find("tshirtSetting").eq(r).find("setting").length;p++){var h=t(o).find("tshirtSetting").eq(r).find("setting").eq(p);d[h.attr("id")]=h.attr("value")}t(o).find("frameBoard")&&(d.rotated="true"===t(o).find("frameBoard").attr("rotated"),a.bgColor=parseInt(t(o).find("frameBoard").attr("canvasBorderColor"))),["FT","FD"].indexOf(t(o).find("project").attr("productType")!==-1)&&(a.cardId=t(o).find("card").attr("id"),a.deletedPhoto=t(o).find("deletedPhoto").text(),d.trim=d.trim||t(o).find("trim").attr("value")),console.log(d),a.projectSettings.push(d)}e.getAlbumId(),a.watches.isProjectLoaded=!0}})},getProject:function(){var e=this;t.ajax({url:a.domains.baseUrl+"/userid/"+a.userSettings.userId+"/project/"+a.projectId,type:"get",dataType:"xml",data:"webClientId=1&autoRandomNum="+i(10).getRandomNum()}).done(function(o){if(o){a.projectXml=o,a.title=t(o).find("title").text(),a.projectId=t(o).find("guid").text(),a.projectSettings.length=0;for(var r=0;r<t(o).find("spec").length;r++){for(var n=t(o).find("spec").eq(r),s=i(20),d=s(),l=0;l<n.find("option").length;l++){var c=n.find("option").eq(l);d[c.attr("id")]=c.attr("value"),"None"===d[c.attr("id")]&&(d[c.attr("id")]="none")}"categoryFrame"!==d.category&&"categoryCanvas"!==d.category&&"categoryWallarts"!==d.category||(d.metalType=d.metalType||"none","undefined"===d.metalType?d.metalType="none":d.metalType,d.finish=d.finish||"none","undefined"===d.finish?d.finish="none":d.finish);for(var p=0;p<t(o).find("tshirtSetting").eq(r).find("setting").length;p++){var h=t(o).find("tshirtSetting").eq(r).find("setting").eq(p);d[h.attr("id")]=h.attr("value")}t(o).find("frameBoard")&&(d.rotated="true"===t(o).find("frameBoard").attr("rotated"),a.bgColor=parseInt(t(o).find("frameBoard").attr("canvasBorderColor"))),["FT","FD"].indexOf(t(o).find("project").attr("productType")!==-1)&&(a.cardId=t(o).find("card").attr("id"),a.deletedPhoto=t(o).find("deletedPhoto").text(),d.trim=d.trim?d.trim:t(o).find("trim").attr("value")),console.log(d),a.projectSettings.push(d)}if("PR"==a.projectType)if(t(o).find("spec")&&t(o).find("spec").length>0){var g=t(o).find("spec").eq(0).find('option[id="size"]').attr("value"),m=t(o).find("spec").eq(0).find('option[id="paper"]').attr("value");a.baseProject.size=g,a.baseProject.paper=m}else a.baseProject.size="4X6",a.baseProject.paper="GP";if("flushMountPrint"==a.projectType)if(t(o).find("spec")&&t(o).find("spec").length>0){var g=t(o).find("spec").eq(0).find('option[id="size"]').attr("value"),m=t(o).find("spec").eq(0).find('option[id="paper"]').attr("value"),u=t(o).find("spec").eq(0).find('option[id="surfaceType"]').attr("value");a.baseProject.size=g,a.baseProject.paper=m,a.baseProject.surfaceType=u}else a.baseProject.size="4X6",a.baseProject.paper="GP",a.baseProject.surfaceType="SS";e.getAlbumId(),a.watches.isProjectLoaded=!0}})},getAlbumId:function(){var e=this;t.ajax({url:a.domains.baseUrl+"/userid/"+a.userSettings.userId+"/getAlbumId?projectId="+a.projectId,type:"get"}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?a.userSettings.albumId=t(i).find("albumId").text()||"":(a.userSettings.albumId="",e.addOrUpdateAlbum(a.title))})},addOrUpdateAlbum:function(e,o,r){var n=(new Date).valueOf();t.ajax({url:a.domains.baseUrl+"/userid/"+a.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+n+"&projectId="+a.projectId+"&albumName="+e+"&webClientId="+a.webClientId+"&autoRandomNum="+i(10).getRandomNum()}).done(function(e){e&&("success"==t(e).find("resultData").attr("state")?(a.userSettings.albumId=t(e).find("albumId").text()||"",o&&o.$dispatch(r,!1,"This title already exists, please try again.")):o&&o.$dispatch(r,!0,"This title already exists, please try again."))})},handledSaveProject:function(e,o,r,n,s,d,l){var c=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectId+"/"+a.projectType,p="",h=a.title,g=a.quantity?a.quantity:1;
if("CV"!==a.projectType&&"FM"!==a.projectType&&"PHC"!==a.projectType&&"CLO"!==a.projectType&&"PR"!==a.projectType&&"flushMountPrint"!==a.projectType&&"PP"!==a.projectType&&"CR"!==a.projectType&&"IPadCase"!==a.projectType||(p=this.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===a.projectType||"FM"===a.projectType){var m=a.projectSettings[a.currentSelectProjectIndex],u=m.product;c=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectId+"/"+u}t.ajax({url:c,type:"post",dataType:"xml",data:{removeCart:a.fromCart,encodeimage:p,projectXml:r,requestKey:i(11).getRequestKey(),thumbnailPX:n,thumbnailPY:s,thumbnailPW:d,thumbnailPH:l,title:h,quantity:g}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(console.log("save project successfully"+i),a.projectXml=i,a.isPrjSaved=!0,e.$dispatch(o,"success")):"205"===t(i).find("code").text()?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch(o,"failed")})},getProjectOrderedState:function(e){t.ajax({url:"/userid/"+a.userSettings.userId+"/getProjectOrderedState/"+a.projectId,type:"get",dataType:"xml",data:"webClientId=1&autoRandomNum="+i(10).getRandomNum()}).done(function(e){e&&(a.userSettings.ordered="true"==t(e).find("ordered").text(),a.checkFailed="true"==t(e).find("checkFailed").text(),a.watches.isProjectOrderedStateLoaded=!0,"true"==a.userSettings.ordered)})},sentContactUs:function(e,o,r,n,s,d){t.ajax({url:a.domains.baseUrl+"/userid/service/feedback",type:"post",dataType:"xml",data:{userId:a.userSettings.userId,userName:a.userSettings.userName,userEmail:a.userSettings.email,sku:"",projectName:a.title,projectId:a.projectId,autoRandomNum:i(10).getRandomNum(),webClientId:1,os:s,browser:d,question:o,featureRequest:r,bug:n}}).done(function(i){"success"==t(i).find("resultData").attr("state")?e.$dispatch("dispatchShowPopup",{type:"contact",status:0}):e.$dispatch("dispatchShowPopup",{type:"contact",status:-1})})},cloneProject:function(e,o,r,n,s,d,l,c){var p=this,h="",g=(new Date).valueOf(),m=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectType,u=a.title,f=a.quantity?a.quantity:1;if("CV"!==a.projectType&&"FM"!==a.projectType&&"PHC"!==a.projectType&&"IPadCase"!==a.projectType||(h=p.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===a.projectType||"FM"===a.projectType){var v=a.projectSettings[a.currentSelectProjectIndex],x=v.product;m=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+x}t.ajax({url:m,type:"post",data:{removeCart:a.fromCart,encodeimage:h,projectXml:n,requestKey:i(11).getRequestKey(),isFromMarketplace:a.isFromMarketplace,thumbnailPX:s,thumbnailPY:d,thumbnailPW:l,thumbnailPH:c,title:u,quantity:f}}).done(function(e){if(e&&"success"===t(e).find("resultData").attr("state")){a.projectId=t(e).find("guid").text()||"",a.projectXml=e,a.isPrjSaved=!0,a.vm.$broadcast("notifyHideCloneWindow"),i(7).getProjectInfo(),t.ajax({url:"/userid/"+a.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+g+"&projectId="+a.projectId+"&albumName="+r+"&webClientId="+a.webClientId+"&autoRandomNum="+i(10).getRandomNum()}).done(function(e){if(e)if("success"==t(e).find("resultData").attr("state"))a.userSettings.albumId=t(e).find("albumId").text()||"";else if("fail"==t(e).find("resultData").attr("state")){var i,r=t(e).find("errorCode").text();a.title=o,i="1"===r?"Title existed, please pick another one.":"2"===r?"Please input new project name":"Save project name failed. errorInfo："+t(e).find("errorInfo").text(),a.vm.$broadcast("notifyShowInvalidTitle",i)}})}else{var n="Clone failed";a.title=o,a.vm.$broadcast("notifyShowInvalidTitle",n)}})},getScreenshot:function(){return i(30).convertScreenshotToBase64()},getProjectInfo:function(){a.isPreview&&"factory"===a.source||t.ajax({url:a.domains.baseUrl+"/clientH5/projectInfo/"+a.projectId+"?"+(new Date).getTime(),type:"get",dataType:"json"}).done(function(e){e&&(a.projectInfo.isOrdered=1===e.order,a.projectInfo.isInCart=1===e.cart,1===e.market||2===e.market?a.projectInfo.isInMarket=!0:a.projectInfo.isInMarket=!1,"undefined"!=typeof e.market&&(a.isShowPostToSale=!0),a.watches.isProjectInfoLoaded=!0,a.vm.$dispatch("dispatchResetProjectInfo"))})},updateCheckStatus:function(e){t.ajax({url:"/userid/"+a.userSettings.userId+"/submitCheckFailProject/"+a.projectId+"?isParentBook=false&redirectParentBook=false",type:"get",dataType:"xml"}).done(function(e){if(e){var i=t(e).find("code").text();"200"===i?(a.checkFailed=!1,a.submitTitle?a.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Thank you for submitting your changes to this ordered "+a.submitTitle+" project. We will review this "+a.submitTitle+" project again. If no issue is found, we will proceed with your order processing."}):a.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Thank you for submitting your changes to this ordered frame project. We will review this frame project again. If no issue is found, we will proceed with your order processing."})):a.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"notifyShowInvalidTitle','Submit failed, please try again or contact us."})}})},getPhotoPrice:function(e,i,o){if(!a.isTopPriceShow){for(var r=!1,n=0;n<a.priceOptions.length;n++){var s=a.priceOptions[n].key,d=a.priceOptions[n].value;if(s&&s==i)if(r=!0,d)a.projectSettings[o].price=d;else{var l=a.priceOptions[n].idxs;l.indexOf(o)==-1&&a.priceOptions[n].idxs.push(o)}}if(!r){var c={key:i,value:"",idxs:[o]};a.priceOptions.push(c),t.ajax({url:a.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:i,timestamp:a.freshTimestamp||0},dataType:"json"}).done(function(e){if(console.log("getPhotoPrice",i),e){e.couponId?a.projectSettings[o].price=+e.sPrice:a.projectSettings[o].price=+e.oriPrice;for(var t=0;t<a.priceOptions.length;t++){var r=a.priceOptions[t].key;a.priceOptions[t].value;if(r&&r==i){for(var n=0;n<a.priceOptions[t].idxs.length;n++)a.projectSettings[a.priceOptions[t].idxs[n]].price=a.projectSettings[o].price;a.priceOptions[t].value=a.projectSettings[o].price,a.priceOptions[t].idxs=[]}}}else console.log(e.error)})}}},getNewPrintPrice:function(){var e=i(1).getOptionIds(),o=a.baseProject.product,r=[];if(a.isTopPriceShow){e.forEach(function(e){"product"!==e&&r.push(a.baseProject[e])}),r=r.filter(function(e){return e&&"none"!==e});t.ajax({url:a.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:o,options:r.join(","),timestamp:a.freshTimestamp||0},dataType:"json"}).done(function(e){console.log("getNewPrintPrice",r),e?(a.photoPrice.oriPrice=+e.oriPrice,a.photoPrice.sPrice=+e.sPrice,a.photoPrice.couponId=e.couponId||"",a.photoPrice.options=e.options||{},a.priceChange=!0):console.log(e.error)})}},getCanvasPrice:function(e,i,o){t.ajax({url:a.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:i,userId:o},dataType:"json"}).done(function(e){console.log(e),e?(a.photoPrice.oriPrice=(e.oriPrice-0).toFixed(2)-0,a.photoPrice.sPrice=(e.sPrice-0).toFixed(2)-0,a.photoPrice.couponId=e.couponId||"",a.photoPrice.options=e.options||{},a.priceChange=!0):console.log(e.error)})},getPadPrice:function(e,i,o){t.ajax({url:a.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:i,userId:o},dataType:"json"}).done(function(e){console.log(e),e?("undefined"!=typeof e.trialPrice?a.photoPrice.trialPrice=+e.trialPrice:e.sPrice>0&&(a.photoPrice.trialPrice=+e.sPrice),a.photoPrice.oriPrice=+e.oriPrice,a.priceChange=!0):console.log(e.error)})},getPosterPrice:function(e,i,o){t.ajax({url:a.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:i,userId:o},dataType:"json"}).done(function(e){console.log(e),e?(a.photoPrice.oriPrice=(e.oriPrice-0).toFixed(2)-0,a.photoPrice.sPrice=(e.sPrice-0).toFixed(2)-0,a.photoPrice.couponId=e.couponId||"",a.photoPrice.options=e.options||{},a.priceChange=!0):console.log(e.error)})},getCardsPrice:function(e,i,o,r,n){t.ajax({url:a.domains.baseUrl+"/clientH5/product/book/price",type:"get",data:{product:e,options:i},dataType:"json"}).done(function(e){if(e){var t=e.data.main,i=e.data.options;a.photoPrice.oriPrice=+t.oriPrice,a.photoPrice.sPrice=+t.sPrice,a.photoPrice.couponId=t.couponId||"",a.photoPrice.options=i||{},a.priceChange=!0}else console.log(e.error)})},getLMCPrice:function(e,i,o,r,n){t.ajax({url:a.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:r,userId:n},dataType:"json"}).done(function(e){e?(a.photoPrice.allSize.push({size:i,shape:o,oriPrice:e.oriPrice-0,sPrice:e.sPrice-0}),a.priceChange=!0):console.log(e)})},saveRemarkProject:function(e,o){var r=i(17).getRemarkProjectXml(),n=a.domains.portalBaseUrl+"/portal/h5-client/feedBackPrintsRemark.ep";t.ajax({url:n,type:"post",data:{projectId:a.projectId,remarkProjectXml:r,orderNumber:a.orderNumber,timestamp:a.timestamp,token:a.token,pUser:a.pUser}}).done(function(i){console.log(i),i&&"success"===t(i).find("resultData").attr("state")?(e&&e(),a.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Reprint successfully"})):(o&&o(),a.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Failed to reprint, please try again later."}))})},getPortalProject:function(){var e=this;t.ajax({url:a.domains.portalBaseUrl+"/portal/projectProcess/getProjectById.ep?projectId="+encodeURIComponent(a.projectId),type:"get",dataType:"xml"}).done(function(o){if(o){a.encProjectId=a.projectId,a.projectXml=o,a.title=t(o).find("title").text(),a.projectId=t(o).find("guid").text(),a.projectSettings.length=0;for(var r=0;r<t(o).find("spec").length;r++){for(var n=t(o).find("spec").eq(r),s=i(20),d=s(),l=0;l<n.find("option").length;l++){var c=n.find("option").eq(l);d[c.attr("id")]=c.attr("value"),"None"===d[c.attr("id")]&&(d[c.attr("id")]="none")}"categoryFrame"!==d.category&&"categoryCanvas"!==d.category&&"categoryWallarts"!==d.category||(d.metalType=d.metalType||"none","undefined"===d.metalType?d.metalType="none":d.metalType,d.finish=d.finish||"none","undefined"===d.finish?d.finish="none":d.finish);for(var p=0;p<t(o).find("tshirtSetting").eq(r).find("setting").length;p++){var h=t(o).find("tshirtSetting").eq(r).find("setting").eq(p);d[h.attr("id")]=h.attr("value")}t(o).find("frameBoard")&&(d.rotated="true"===t(o).find("frameBoard").attr("rotated"),a.bgColor=parseInt(t(o).find("frameBoard").attr("canvasBorderColor"))),console.log(d),a.projectSettings.push(d)}if("PR"==a.projectType)if(t(o).find("spec")&&t(o).find("spec").length>0){var g=t(o).find("spec").eq(0).find('option[id="size"]').attr("value"),m=t(o).find("spec").eq(0).find('option[id="paper"]').attr("value");a.baseProject.size=g,a.baseProject.paper=m}else a.baseProject.size="4X6",a.baseProject.paper="GP";if("flushMountPrint"==a.projectType)if(t(o).find("spec")&&t(o).find("spec").length>0){var g=t(o).find("spec").eq(0).find('option[id="size"]').attr("value"),m=t(o).find("spec").eq(0).find('option[id="paper"]').attr("value"),u=t(o).find("spec").eq(0).find('option[id="surfaceType"]').attr("value");a.baseProject.size=g,a.baseProject.paper=m,a.baseProject.surfaceType=u}else a.baseProject.size="4X6",a.baseProject.paper="GP",a.baseProject.surfaceType="SS";e.getAlbumId(),a.watches.isProjectLoaded=!0}})},getProjectIdByTitle:function(e){var i=a.userSettings.userId;t.ajax({url:a.domains.baseUrl+"/userid/getProjectUidByTitleAndCid.ep?customerId="+i+"&title="+encodeURIComponent(e),type:"get"}).done(function(e){e&&"success"===t(e).find("resultData").attr("state")&&(a.projectId=t(e).find("projectId").text()||"",a.vm.$dispatch("dispatchGetProjectIdByTitleSuccess"))})},createProject:function(e,o,r,n,s,d,l,c){var p="",h=(new Date).valueOf(),g=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectType,m=a.title,u=a.quantity?a.quantity:1;if("CV"===a.projectType||"FM"===a.projectType){var f=a.projectSettings[a.currentSelectProjectIndex],v=f.product;g=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+v}t.ajax({url:g,type:"post",data:{removeCart:a.fromCart,encodeimage:p,projectXml:n,requestKey:i(11).getRequestKey(),isFromMarketplace:a.isFromMarketplace,thumbnailPX:s,thumbnailPY:d,thumbnailPW:l,thumbnailPH:c,title:m,quantity:u}}).done(function(e){if(e&&"success"===t(e).find("resultData").attr("state")){a.projectId=t(e).find("guid").text()||"",a.projectXml=e,a.watches.isProjectLoaded=!0,a.vm.$broadcast("notifyHideNewProjectWindow"),t.ajax({url:"/userid/"+a.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+h+"&projectId="+a.projectId+"&albumName="+r+"&webClientId="+a.webClientId+"&autoRandomNum="+i(10).getRandomNum()}).done(function(e){if(e)if("success"==t(e).find("resultData").attr("state"))a.userSettings.albumId=t(e).find("albumId").text()||"";else if("fail"==t(e).find("resultData").attr("state")){var i=t(e).find("errorCode").text();a.errCode=!1;var r;a.title=o,r="1"===i?"Title existed, please pick another one.":"2"===i?"Please input new project name":"Save project name failed. errorInfo："+t(e).find("errorInfo").text(),a.vm.$broadcast("notifyShowNewProjectInvalidTitle",r)}}),i(7).getProjectInfo()}else{var n="Create failed";a.title=o,a.vm.$broadcast("notifyShowNewProjectInvalidTitle",n)}})},createProjectAddOrUpdateAlbum:function(e,o,r,n){var s=(new Date).valueOf();t.ajax({url:"/userid/"+a.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+s+"&projectId="+a.projectId+"&albumName="+e+"&webClientId="+a.webClientId+"&autoRandomNum="+i(10).getRandomNum()}).done(function(i){if(i)if("success"==t(i).find("resultData").attr("state"))a.userSettings.albumId=t(i).find("albumId").text()||"",r&&r(e);else if("fail"==t(i).find("resultData").attr("state")){var s,d=t(i).find("errorCode").text();a.title=o,s="1"===d?"Title existed, please pick another one.":"2"===d?"Please input new project name":"Save project name failed. errorInfo："+t(i).find("errorInfo").text(),a.vm.$broadcast("notifyShowNewProjectInvalidTitle",s),n&&n(e)}})},createProjectSuccess:function(e,o,r,n,s,d,l,c){var p="",h=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+a.projectType,g=a.title,m=a.quantity?a.quantity:1;if(a.errCode=!0,"CV"===a.projectType||"FM"===a.projectType){var u=a.projectSettings[a.currentSelectProjectIndex],f=u.product;h=a.domains.baseUrl+"/general/"+a.userSettings.userId+"/project/"+f}t.ajax({url:h,type:"post",data:{removeCart:a.fromCart,encodeimage:p,projectXml:n,requestKey:i(11).getRequestKey(),isFromMarketplace:a.isFromMarketplace,thumbnailPX:s,thumbnailPY:d,thumbnailPW:l,thumbnailPH:c,title:g,quantity:m}}).done(function(e){if(e)if(e&&"success"===t(e).find("resultData").attr("state")){a.projectId=t(e).find("guid").text()||"",a.projectXml=e,a.watches.isProjectLoaded=!0,a.vm.$broadcast("notifyHideNewProjectWindow"),i(7).getProjectInfo()}else{var r="Create failed";a.title=o,a.vm.$broadcast("notifyShowNewProjectInvalidTitle",r)}})},getTitle:function(){var e=this,o=a.domains.baseUrl+"/web-api/customerId/"+a.userSettings.userId+"/getProjectNameByProjectId";t.ajax({url:o,type:"get",data:"projectId="+a.projectId+"&autoRandomNum="+i(10).getRandomNum()}).done(function(t){t&&"200"===t.respCode&&(a.title=t.projectName,e.getAlbumId())})},changeProjectTitle:function(e,i,o){var r=a.domains.baseUrl+"/web-api/customerId/"+a.userSettings.userId+"/updateProjectAndAlbumTitle";t.ajax({url:r,type:"get",data:"projectId="+a.projectId+"&projectName="+e}).then(function(e){e&&("200"===e.respCode?i&&i.$dispatch(o,!1,"This title already exists, please try again."):i&&i.$dispatch(o,!0,"This title already exists, please try again."))})},savePortalCardProject:function(e,i,o){a.projectXml=i;var r=(new Date).valueOf(),n=a.domains.baseUrl+"/card-template/save.ep";t.ajax({url:n,type:"post",data:{projectXml:i,autoRandomNum:r,webClientId:1}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(a.projectId=t(i).find("guid").text()||"",a.projectXml=i,a.watches.isProjectLoaded=!0,o&&"function"==typeof o?o():e.$dispatch("dispatchShowPopup",{type:"save",status:0})):(a.watches.isProjectLoaded=!0,"300"===t(i).find("code").text()&&e.$dispatch("dispatchShowPopup",{type:"save",status:-5}))})},getCardPortalProject:function(){var e=this;t.ajax({url:a.domains.baseUrl+"/card-template/get.ep",type:"get",dataType:"xml",data:"initGuid="+a.projectId+"&webClientId=1&autoRandomNum="+i(10).getRandomNum()}).done(function(o){if(o){a.projectXml=o,a.title=t(o).find("title").text(),a.projectId=t(o).find("guid").text(),a.projectSettings.length=0;for(var r=0;r<t(o).find("spec").length;r++){for(var n=t(o).find("spec").eq(r),s=i(20),d=s(),l=0;l<n.find("option").length;l++){var c=n.find("option").eq(l);d[c.attr("id")]=c.attr("value"),"None"===d[c.attr("id")]&&(d[c.attr("id")]="none")}for(var p=0;p<t(o).find("tshirtSetting").eq(r).find("setting").length;p++){var h=t(o).find("tshirtSetting").eq(r).find("setting").eq(p);d[h.attr("id")]=h.attr("value")}["FT","FD"].indexOf(t(o).find("project").attr("productType")!==-1)&&(a.cardId=t(o).find("card").attr("id"),a.deletedPhoto=t(o).find("deletedPhoto").text(),d.trim=d.trim?d.trim:t(o).find("trim").attr("value")),a.projectSettings.push(d)}e.getAlbumId(),a.watches.isProjectLoaded=!0}})},submitPortalCardProject:function(e,o){var r=a.domains.baseUrl+"/card-template/submit.ep";t.ajax({url:r,type:"post",dataType:"xml",data:{encodeimage1:a.encodeImage1,encodeimage2:a.encodeImage2,projectXml:o,webClientId:1,autoRandomNum:i(10).getRandomNum()}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(a.projectXml=i,a.isPrjSaved=!0,a.vm.$dispatch("dispatchShowPopup",{type:"save",status:1})):i&&"fail"===t(i).find("resultData").attr("state")?"201"===t(i).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-3}),a.vm.$broadcast("notifyCloseWindow")):"202"===t(i).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-4}),a.vm.$broadcast("notifyCloseWindow")):"205"===t(i).find("code").text()?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1})})},getMainProject:function(e,o,r,n){var s=a.domains.baseUrl+"/clientH5/project/imageInfo";t.ajax({url:s,type:"get",dataType:"json",data:{projectId:o,autoRandomNum:i(10).getRandomNum()}}).done(function(o){if(o&&"1"===o.errorCode){var s="",d="",l="";try{s=JSON.parse(o.data)}catch(e){d=i(3).stringToXml(o.data)}if(d){var c=t(d).find("images").find("image").length;if(a.imageList=[],c>0)for(var p=0;p<c;p++){var h=t(d).find("images").find("image").eq(p).attr("id"),g=t(d).find("images").find("image").eq(p).attr("encImgId")||"";a.imageList.push({id:h,guid:t(d).find("images").find("image").eq(p).attr("guid")||"",encImgId:g,url:a.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+t(d).find("images").find("image").eq(p).attr("encImgId")+"&rendersize=fit"+i(11).getSecurityString(),name:decodeURIComponent(t(d).find("images").find("image").eq(p).attr("name"))||"",width:parseFloat(t(d).find("images").find("image").eq(p).attr("width"))||0,height:parseFloat(t(d).find("images").find("image").eq(p).attr("height"))||0,shotTime:t(d).find("images").find("image").eq(p).attr("shotTime")||"",usedCount:0}),r&&encodeURIComponent(r)===g&&(l=h)}}else if(s){var c=s.length;if(a.imageList=[],c>0)for(var p=0;p<c;p++)a.imageList.push({id:s[p].id.toString()||"",guid:s[p].guid||"",encImgId:s[p].encImgId||"",url:a.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+s[p].encImgId+"&rendersize=fit"+i(11).getSecurityString(),name:decodeURIComponent(s[p].name)||"",width:parseFloat(s[p].width)||0,height:parseFloat(s[p].height)||0,shotTime:s[p].shotTime||"",usedCount:0}),r&&encodeURIComponent(r)===s[p].encImgId&&(l=s[p].id.toString())}l?e.$dispatch("dispatchSingleImageUploadComplete",l):n&&a.vm.$broadcast("notifyAddMyPhotosIntoPages",a.imageList)}})},getMyPhotoImages:function(e,o,r){var n=a.domains.baseUrl+"/web-api/customer/getMyPhotosInfo";t.ajax({url:n,type:"post",dataType:"json",data:{customerId:o,autoRandomNum:i(10).getRandomNum()}}).done(function(e){if(e&&"1"===e.errorCode&&e.data){var t=JSON.parse(e.data),o=[];a.maxPageNum&&t.length>a.maxPageNum&&(t.length=a.maxPageNum),t.forEach(function(e){var t={id:String(e.id),guid:e.guid,encImgId:e.encImgId,url:a.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+e.encImgId+"&rendersize=fit"+i(11).getSecurityString(),name:e.name,width:e.width,height:e.height,shotTime:e.shotTime,usedCount:0};o.push(t),a.imageList.push(t)}),r&&a.vm.$broadcast("notifyAddMyPhotosIntoPages",o)}})},getTshirtDisableOptions:function(){var e=a.domains.baseUrl+"/clientH5/getTshirtOffLine",o=a.userSettings.userId;t.ajax({url:e,type:"get",dataType:"json",data:{customerId:o,autoRandomNum:i(10).getRandomNum()}}).done(function(e){if(e){var t=e.disable,i={},o=["S","M","L","XL","XXL"];t.forEach(function(e){var t=e.color,a=e.measure;i[t]||(i[t]=new Object,i[t].options=new Array,i[t].isAllDisabled=!1),i[t].options.push(a),i[t].options.length>=o.length&&(i[t].isAllDisabled=!0)}),a.disableOptions=i}a.watches.isDisableOptionLoaded=!0})},getLocalTshirtDisableOptions:function(){var e="./assets/data/disableTshirt.json",o=a.userSettings.userId;t.ajax({url:e,type:"get",dataType:"json",data:{customerId:o,autoRandomNum:i(10).getRandomNum()}}).done(function(e){if(e){var t=e.disable,i={},o=["S","M","L","XL","XXL"];t.forEach(function(e){var t=e.color,a=e.measure;i[t]||(i[t]=new Object,i[t].options=new Array,i[t].isAllDisabled=!1),i[t].options.push(a),i[t].options.length>=o.length&&(i[t].isAllDisabled=!0)}),a.disableOptions=i,a.watches.isDisableOptionLoaded=!0}})},deleteImageList:function(e){var i=a.userSettings.albumId,o=a.domains.baseUrl+"/web-api/album/deleteImages";a.deleImagelist&&a.deleImagelist.length>0?t.ajax({url:o,type:"post",dataType:"json",data:{data:JSON.stringify({albumId:i,images:a.deleImagelist})}}).done(function(t){a.deleImagelist=[],e&&e()}):e&&e()}}}).call(t,i(4),i(2))},function(e,t,i){(function(t,a){e.exports=function(e){var o=0,r=0,n=t.projectSettings[t.currentSelectProjectIndex],s=n&&n.product;if("undefined"==typeof s)switch(t.projectType){case"PR":s="print";break;case"flushMountPrint":s="flushMountPrint";break;default:s=t.projectType}var d="H5_"+s+","+t.projectId+",";for(var l in e)r++;for(var l in e)d+="ev"===l?e[l]:l+"="+e[l],o++<r-1&&(d+=",");var c=i(39);c.go(a.trim(d,","))}}).call(t,i(2),i(4))},function(e,t){e.exports={AddText:"AddText",LoadComplete:"LoadComplete",CompleteTextEdit:"CompleteTextEdit",ClickToForm:"ClickToForm",ClickChangeAll:"ClickChangeAll",ClickEditPrint:"ClickEditPrint",ClickDeletePrint:"ClickDeletePrint",ClickDuplicatePrint:"ClickDuplicatePrint",ClickReplacePrint:"ClickReplacePrint",ChangeSize:"ChangeSize",ChangePaper:"ChangePaper",ChangeTrimStyle:"ChangeTrimStyle",ChangeiPadmodel:"ChangeiPadmodel",ClickSave:"ClickSave",ClickExit:"ClickExit",ClickOrder:"ClickOrder",ClickPreview:"ClickPreview",ClickCropImage:"ClickCropImage",ClickRotateImage:"ClickRotateImage",ClickRemoveImage:"ClickRemoveImage",ClickMoveTextToCenter:"ClickMoveTextToCenter",ClickMoveImageToCenter:"ClickMoveImageToCenter",ClickReset:"ClickReset",ClickRemove:"ClickRemove",ClickAddText:"ClickAddText",ClickResetConfirm:"ClickResetConfirm",ClickFrontCover:"ClickFrontCover",ClickBackCover:"ClickBackCover",ClickPreviousPage:"ClickPreviousPage",ClickNextPage:"ClickNextPage",ClickOptionTab:"ClickOptionTab",ClickImagesTab:"ClickImagesTab",ClickLayoutTab:"ClickLayoutTab",ClickDecorationTab:"ClickDecorationTab",ClickFormTab:"ClickFormTab",SwitchSide:"SwitchSide",SwitchSideInPreview:"SwitchSideInPreview",SwitchOrientation:"SwitchOrientation",ImageLoadFail:"ImageLoadFail",DragPhotoToPage:"DragPhotoToPage",ChangeSort:"ChangeSort",ChangeHideUsed:"ChangeHideUsed",CheckPrice:"CheckPrice",SaveComplete:"SaveComplete",SwitchBlocks:"SwitchBlocks",SwitchBlocksInPreview:"SwitchBlocksInPreview",RemoveBlock:"RemoveBlock",SwitchBlocksByNav:"SwitchBlocksByNav",AddBlock:"AddBlock",ClickAddPhotos:"ClickAddPhotos",ClickDeleteCanvas:"ClickDeleteCanvas",SwitchSize:"SwitchSize",StartUploadEachPhoto:"StartUploadEachPhoto",CompleteUploadEachPhoto:"CompleteUploadEachPhoto",AddPhotos:"AddPhotos",ClickCloudUploadImage:"ClickCloudUploadImage",FinishPhotoSelect:"FinishPhotoSelect",AddMorePhotos:"AddMorePhotos",StartUpload:"StartUpload",UploadComplete:"UploadComplete",CloseMonitor:"CloseMonitor",CancelSingleFile:"CancelSingleFile",CancelAllFilesClicked:"CancelAllFilesClicked",CancelAllFilesByXClicked:"CancelAllFilesByXClicked",CheckIncompleteFields:"CheckIncompleteFields",CheckIncompleteFieldsContinue:"CheckIncompleteFieldsContinue",CheckIncompleteFieldsCancel:"CheckIncompleteFieldsCancel",ModifyPhotoFrame:"ModifyPhotoFrame",ModifyTextFrame:"ModifyTextFrame",RemovePhotoFrame:"RemovePhotoFrame",RemoveTextFrame:"RemoveTextFrame",UpgradeOption:"UpgradeOption"}},function(e,t,i){(function(t){e.exports={getRandomNum:function(){return Math.round(1e13*Math.random())},getInchByPx:function(e){return e=parseFloat(e)||0,e/300},getPxByInch:function(e){return e=parseFloat(e)||0,300*e},getInchByMM:function(e){e=parseFloat(e)||0;var t=parseFloat(30*e/2.54);return(t/300).toFixed(7)},getPtByPx:function(e){return e=parseFloat(e)||0,e/300*72},getPxByPt:function(e){return e=parseFloat(e)||0,300*e/72},getPxByMM:function(e){return e=parseFloat(e)||0,30*e/2.54},hexToDec:function(e){return parseInt(e.replace("#",""),16)},decToHex:function(e){for(var t=e.toString(16);t.length<6;)t="0"+t;return"#"+t},rgbToHsl:function(e,t,i){e/=255,t/=255,i/=255;var a,o,r=Math.max(e,t,i),n=Math.min(e,t,i),s=(r+n)/2;if(r==n)a=o=0;else{var d=r-n;switch(o=s>.5?d/(2-r-n):d/(r+n),r){case e:a=(t-i)/d+(t<i?6:0);break;case t:a=(i-e)/d+2;break;case i:a=(e-t)/d+4}a/=6}return[a,o,s]},getTextViewFontSize:function(e){if(e&&e>0){var i=t.pages[t.selectedPageIdx].canvas.ratio,a=parseFloat(e)*i;return a}return 0},toFixed:function(e,t){const i=String(e),a=i.indexOf(".");return a!==-1?i.substr(0,a+t+1):i},round:function(e,t){if(isNaN(e))return 0;const i=Math.pow(10,2),a=Math.round(e*i)/i;return parseFloat(this.toFixed(a,t))}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={getUrlParam:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):""},getRequestKey:function(){var e=new Date;return"web-h5|1|XML|"+e.getTime()},getJSONRequestKey:function(){var e=new Date;return"web-h5|1|JSON|"+e.getTime()},getSecurityString:function(){var e=t.userSettings.userId||"",i=t.userSettings.token,a=t.userSettings.uploadTimestamp,o=t.encProjectId||"";return"-1"==e&&(e=""),"&customerId="+e+"&token="+i+"&timestamp="+a+"&encProjectId="+encodeURIComponent(o)}}}).call(t,i(2))},function(e,t,i){(function(t,i){e.exports={setPopWindowPosition:function(e){if(e&&e.width&&e.height&&e.selector){var i=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,o=(i-e.width)/2>0?(i-e.width)/2:0,r=(a-e.height)/2>0?(a-e.height)/2:0;t(e.selector).css("left",o).css("top",r)}},initImageListSize:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),a=i-208;a=a<200?200:a,t(e.selector).css("height",a)}},initImageListSizeWithCards:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),a=i-40-34-41-28-20-3-36;a=a<200?200:a,t(e.selector).css("height",a)}},initImageListSizeWithWallArts:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),a=i-215+40;a=a<200?200:a,t(e.selector).css("height",a)}},initImageListSizeWithCase:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),a=i-234;a=a<200?200:a,t(e.selector).css("height",a)}},initImageListSizeWithPadCase:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),a=i-240;a=a<200?200:a,t(e.selector).css("height",a)}},initImageListSizeWithLRB:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),a=i-40-35-10-32-10;a=a<200?200:a,t(e.selector).css("height",a)}},initDecorationListSize:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),a=i-208;a=a<200?200:a,t(e.selector).css("height",a)}},getProjectListSize:function(e){var t=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),i=t-122;return i=i<200?200:i},getBoxLimit:function(e){e=e||340;var t=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,i=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,a=t-e-20,o=i-50-2-160;return a>0?a:a=0,o>0?o:o=0,{width:a,height:o}},getCardBoxLimit:function(e,t){e=e||340;var i=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,o=i-e-20,r=a-76-60-80-20-t;return o>0?o:o=0,r>0?r:r=0,{width:o,height:r}},getBoxLimitWithCase:function(){var e=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,i=e-280-20-60,a=t-50-30-2-150;return i>0?i:i=0,a>0?a:a=0,{width:i,height:a}},getBoxBgSize:function(){var e=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,i=e-340-20,a=t-50-2;return i>0?i:i=0,a>0?a:a=0,{width:i,height:a}},getPreviewBoxLimit:function(e){e=e||!1;var t=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,i=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,a=t-50,o=i-30-60;return e?o:o-=80,a>0?a:a=0,o>0?o:o=0,{width:a,height:o}},getBoxLimitWithTmpl:function(){var e=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,a=e-340-20-60,o=t-50-2-160;return i.isWithTemplate&&(o-=40,i.isChangeTmplExpanded&&(o-=155)),a>0?a:a=0,o>0?o:o=0,{width:a,height:o}},getOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return e-80-60-4},getWallArtsOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return e-50-44-2},getCardsOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;
return e-41-35-36},getPhoneCaseOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return e-80-60-4},getPadCaseOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return console.log(e-80-200),e-80-90},getPrintBoxLimit:function(){if(i.limitWidth)return{width:i.limitWidth,height:i.limitWidth};var e=screen.availWidth,t=(e-240-60-30)/6-20;return t=t<235?235:t,{width:t,height:t}},getPrintPreviewBoxLimit:function(){var e=screen.availWidth,t=(e-80-100)/4;return t=t>=458?458:t-20,t=t<235?235:t,{width:t,height:t}},getCenterPreviewBoxLimit:function(e){e=e||!1;var t=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,i=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,a=t,o=i-30-60;return e?o:o-=80,a>0?a:a=0,o>0?o:o=0,{width:a,height:o}},getBoxWH:function(e,t){var i=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,a=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,o=e?i-e:i,r=t?a-t:a;return o>0?o:o=0,r>0?r:r=0,{width:o,height:r}}}}).call(t,i(4),i(2))},function(e,t,i){(function(t){e.exports={initProjectXml:function(){var e=i(15).analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size});console.log(e);var a=e.base,o=(e.background,e.logo,'<project clientId="web-h5" createAuthor="web-h5|1.0|1"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan/><title><![CDATA["+t.title+']]></title><description/><createdDate/><updatedDate></updatedDate><tshirts><tshirt id="tshirt-1"><spec version="1.0"><option id="product" value="'+t.projectSettings[t.currentSelectProjectIndex].product+'" /><option id="color" value="'+t.projectSettings[t.currentSelectProjectIndex].color+'" /><option id="size" value="'+t.projectSettings[t.currentSelectProjectIndex].size+'" /><option id="measure" value="'+t.projectSettings[t.currentSelectProjectIndex].measure+'" /></spec><tshirtSetting><setting id="count" value="1" /><setting id="pages" value="true,false"/></tshirtSetting><contents><content type="front" width="'+a.width+'" hight="'+a.height+'"><elements></elements></content><content type="back" width="'+a.width+'" hight="'+a.height+'"><elements></elements></content></contents></tshirt></tshirts><images/></project>');return o},getCurrentProjectXml:function(){i(14).syncProjectData(),console.log(t.currentSelectProjectIndex),console.log(t.projectSettings[t.currentSelectProjectIndex].product),console.log(t.projectSettings[t.currentSelectProjectIndex].size);var e=i(15).analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size});console.log(e);for(var a=e.base,o=(e.background,e.logo,'<project clientId="web-h5" createAuthor="web-h5|1.0|1"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan/><title><![CDATA["+t.title+"]]></title><description/><createdDate/><updatedDate></updatedDate><tshirts>"),r=t.projectSettings,n=0;n<r.length;n++){var s=r[n];o+='<tshirt id="tshirt-'+n+'"><spec version="1.0"><option id="product" value="'+s.product+'" /><option id="color" value="'+s.color+'" /><option id="size" value="'+s.size+'" /><option id="measure" value="'+s.measure+'" /></spec><tshirtSetting><setting id="count" value="'+s.count+'" />';for(var d=!1,l=t.projects[n].pages[0],c=0;c<l.canvas.params.length;c++){var p=l.canvas.params[c];"logo"===p.elType||"image"===p.elType?""!=p.imageId&&(d=!0):"text"===p.elType&&(d=!0)}for(var h=!1,g=t.projects[n].pages[1],c=0;c<g.canvas.params.length;c++){var p=g.canvas.params[c];"logo"===p.elType||"image"===p.elType?""!=p.imageId&&(h=!0):"text"===p.elType&&(h=!0)}o+='<setting id="pages" value="'+d+","+h+'" />',o+="</tshirtSetting><contents>";for(var m=t.projects[n].pages,u=0;u<m.length;u++){var f=0===u?"front":"back";o+='<content type="'+f+'" width="'+a.width+'" hight="'+a.height+'">';var v=m[u].canvas;o+="<elements>";for(var x=0;x<v.params.length;x++){console.log("spread which not inited");var w=v.params[x],S=w.width,y=w.height,I=w.x,b=w.y,P=I/v.oriWidth,j=b/v.oriHeight,C=S/v.oriWidth,T=y/v.oriHeight,k=w.rotate;if("logo"===v.params[x].elType||"image"===v.params[x].elType){var L=w.cropPX,D=w.cropPY,B=w.cropPW,z=w.cropPH;L<0?L=0:L,L>1?L=1:L,D<0?D=0:D,D>1?D=1:D,B<0?B=0:B,B>1?B=1:B,z<0?z=0:z,z>1?z=1:z}o+="text"===v.params[x].elType?'<element type="TextElement" elType="'+w.elType+'" x="'+I+'" y="'+b+'" width="'+S+'" height="'+y+'" px="'+P+'" py="'+j+'" pw="'+C+'" ph="'+T+'" rot="'+k+'" dep="'+w.dep+'" color="'+w.fontColor+'" fontSize="'+parseFloat(w.fontSize)/v.oriHeight+'" fontFamily="'+encodeURIComponent(w.fontFamily)+'" fontWeight="'+w.fontWeight+'" textAlign="'+w.textAlign+'" >'+encodeURIComponent(w.text)+"</element>":"logo"===v.params[x].elType?'<element type="LogoElement" elType="'+w.elType+'" x="'+I+'" y="'+b+'" width="'+S+'" height="'+y+'" px="'+P+'" py="'+j+'" pw="'+C+'" ph="'+T+'" rot="'+k+'" dep="'+w.dep+'" imageid="'+w.imageId+'" imgRot="'+(w.imageRotate||0)+'" imgFlip="false" cropLUX="'+L+'" cropLUY="'+D+'" cropRLX="'+(L+B)+'" cropRLY="'+(D+z)+'"/>':'<element type="PhotoElement" elType="'+w.elType+'" x="'+I+'" y="'+b+'" width="'+S+'" height="'+y+'" px="'+P+'" py="'+j+'" pw="'+C+'" ph="'+T+'" rot="'+k+'" dep="'+w.dep+'" imageid="'+w.imageId+'" imgRot="'+(w.imageRotate||0)+'" imgFlip="false" cropLUX="'+L+'" cropLUY="'+D+'" cropRLX="'+(L+B)+'" cropRLY="'+(D+z)+'"/>'}o+="</elements>",o+="</content>"}o+="</contents></tshirt>"}for(o+="</tshirts><images>",n=0;n<t.imageList.length;n++)o+='<image id="'+t.imageList[n].id+'" guid="'+t.imageList[n].guid+'" encImgId="'+t.imageList[n].encImgId+'" order="'+n+'" name="'+encodeURIComponent(t.imageList[n].name)+'" width="'+t.imageList[n].width+'" height="'+t.imageList[n].height+'" shotTime="'+t.imageList[n].shotTime+'"/>';return o+="</images></project>"},saveNewProject:function(e){var a=this.initProjectXml();t.projectXml=a,console.log(t.projectXml),i(7).insertProject(e,a)},saveOldProject:function(e,a){var o=this.getCurrentProjectXml(),r=i(15).analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size}),n=r.base,s=r.background,d=(r.logo,n.x/s.width),l=n.y/s.height,c=n.width/s.width,p=n.height/s.height;a&&"function"==typeof a?i(7).saveProject(e,o,d,l,c,p,a):i(7).saveProject(e,o,d,l,c,p)},handledSaveOldProject:function(e,a){var o=this.getCurrentProjectXml();console.log(o);var r=i(15).analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size}),n=r.base,s=r.background,d=(r.logo,n.x/s.width),l=n.y/s.height,c=n.width/s.width,p=n.height/s.height;i(7).handledSaveProject(e,a,o,d,l,c,p)},getOldProject:function(){t.isPreview?i(7).getShareProject():i(7).getProject()},getProjectOrderedState:function(e){i(7).getProjectOrderedState(e)},addOrUpdateAlbum:function(e,t,a){i(7).addOrUpdateAlbum(e,t,a)},changeProjectTitle:function(e,t,a){i(7).changeProjectTitle(e,t,a)},newProject:function(e,t,a){var o=i(20),r=o();return r.product="TS",r.color=e,r.size="14X16",r.measure=t,r.count=a,r},orderProject:function(e){var a=this.getCurrentProjectXml();console.log(a);var o=i(15).analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size}),r=o.base,n=o.background,s=(o.logo,r.x/n.width),d=r.y/n.height,l=r.width/n.width,c=r.height/n.height;i(7).orderProject(e,a,s,d,l,c)},cloneProject:function(e,a){var o=t.title;t.title=a;var r=this.getCurrentProjectXml(),n=i(15).analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size}),s=n.base,d=n.background,l=(n.logo,s.x/d.width),c=s.y/d.height,p=s.width/d.width,h=s.height/d.height;i(7).cloneProject(e,o,a,r,l,c,p,h)},createProject:function(e,a){var o=t.title;t.title=a;var r=i(20),n=r(),s=i(11);n.product=s.getUrlParam("type"),n.color=s.getUrlParam("color"),n.size="14X16",n.measure="M",n.count=1;for(var d=t.pages[t.selectedPageIdx].canvas,l=d.params.length,c=0;c<l;c++)t.vm.$broadcast("notifyRemoveImage",0);d.params.length=0,t.projectSettings.length=0,t.projects.length=0,t.imageList.length=0,t.projectSettings.push(n);var p=this.initProjectXml();t.projectXml=p;var h=0,g=0,m=1,u=1;i(7).createProjectSuccess(e,o,a,p,h,g,m,u)},getMyPhotoImages:function(e,t){i(7).getMyPhotoImages(e,t)}}}).call(t,i(2))},function(e,t,a){(function(t,o){var r=a(10),n=a(16),s=a(5),d=a(17),l=a(15),c=a(31),p=a(21),h=p.component("photo-element"),g=p.component("text-element");e.exports={createElement:function(e,i){var a=t.pages[t.selectedPageIdx].canvas;if("text"===a.params[e].elType)var o=new g;else var o=new h;o.init(e),o.$mount().$appendTo("#container"),a.elements.push(o)},editElement:function(e,i){var a=t.pages[t.selectedPageIdx].canvas;if(a.elements[e].$destroy(!0),"text"===a.params[e].elType)var o=new g;else var o=new h;o.init(e),o.$mount().$appendTo("#container"),a.elements.splice(e,1,o)},deleteElement:function(e,i){var a=t.pages[t.selectedPageIdx].canvas;a.elements[e].$destroy(!0),a.elements.splice(e,1)},initElementData:function(e){console.log("index is "+e+" in initElementData");var i=t.pages[t.selectedPageIdx].canvas;if("background"===i.params[e].elType||"image"===i.params[e].elType||"logo"===i.params[e].elType){var o="../../static/img/blank.png",s=i.params[e].imageId;if(""!==s){var d=i.params[e].cropPX,l=i.params[e].cropPY,c=i.params[e].cropPW,p=i.params[e].cropPH,h=i.params[e].width*i.ratio/c,g=i.params[e].height*i.ratio/p,m=a(6),u=m.getEncImgId(s),f=m.getQueryString({encImgId:u,px:d,py:l,pw:c,ph:p,width:Math.round(h),height:Math.round(g),rotation:i.params[e].imageRotate});o="/imgservice/op/crop?"+f}i.elements.$set(e,i.paper.image(o,i.params[e].x*i.ratio,i.params[e].y*i.ratio,i.params[e].width*i.ratio,i.params[e].height*i.ratio))}else if("text"===i.params[e].elType){var v=Math.round(r.getTextViewFontSize(i.params[e].fontSize)),x="../../static/img/blank.png";x=v>0?""===i.params[e].text?t.isPreview?"../../static/img/blank.png":t.domains.proxyFontBaseUrl+"/product/text/textImage?text="+encodeURIComponent("Enter text here")+"&font="+encodeURIComponent(i.params[e].fontFamily)+"&fontSize="+v+"&color="+i.params[e].fontColor+"&align=left":t.domains.proxyFontBaseUrl+"/product/text/textImage?text="+encodeURIComponent(i.params[e].text)+"&font="+encodeURIComponent(i.params[e].fontFamily)+"&fontSize="+v+"&color="+i.params[e].fontColor+"&align=left":"../../static/img/blank.png",i.elements.$set(e,i.paper.image(x,i.params[e].x*i.ratio,i.params[e].y*i.ratio,i.params[e].width*i.ratio,i.params[e].height*i.ratio)),i.elements[e].fontFamily=i.params[e].fontFamily,i.elements[e].fontSize=i.params[e].fontSize,i.elements[e].fontWeight=i.params[e].fontWeight,i.elements[e].textAlign=i.params[e].textAlign,i.elements[e].fontColor=i.params[e].fontColor,i.elements[e].text=i.params[e].text}i.elements[e].node.id="element-"+e,i.elements[e].elType=i.params[e].elType,i.elements[e].idx=e,i.elements[e].dep=i.params[e].dep,console.log("set element "+e+" dep into "+i.params[e].dep+" now"),i.elements[e].vWidth=i.params[e].width*i.ratio,i.elements[e].vHeight=i.params[e].height*i.ratio,i.elements[e].sourceImageUrl=i.params[e].url||"",i.elements[e].imageId=i.params[e].imageId||"",i.elements[e].imageRotate=i.params[e].imageRotate||0;var w=n.getImageDetail(i.elements[e].imageId);if(w){if(i.elements[e].imageGuid=w.guid,i.elements[e].imageWidth=w.width,i.elements[e].imageHeight=w.height,90===Math.abs(i.elements[e].imageRotate))var S=i.elements[e].imageHeight,y=i.elements[e].imageWidth;else var S=i.elements[e].imageWidth,y=i.elements[e].imageHeight;i.elements[e].cropX=S*i.params[e].cropPX,i.elements[e].cropY=y*i.params[e].cropPY,i.elements[e].cropW=S*i.params[e].cropPW,i.elements[e].cropH=y*i.params[e].cropPH}else i.elements[e].imageGuid="",i.elements[e].imageWidth="",i.elements[e].imageHeight="",i.elements[e].cropX=0,i.elements[e].cropY=0,i.elements[e].cropW=1,i.elements[e].cropH=1},initElementHandles:function(e){var i=this,a=t.pages[t.selectedPageIdx].canvas;"text"===a.elements[e].elType?a.elements[e].dblclick(function(){t.watches.isChangeThisText=!0}):a.elements[e].dblclick(function(){t.watches.isCropThisImage=!0}),a.elements[e].attr({cursor:"move"}).click(function(){var e=this;i.changeClickDepth({idx:e.idx})})},initElementTransform:function(e,i){var n=this,d=t.pages[t.selectedPageIdx].canvas;if("image"===d.params[e].elType||"logo"===d.params[e].elType)var l={drag:["self"],rotate:!1,scale:["bboxCorners"],keepRatio:!0,snap:{rotate:1,scale:1,drag:1},draw:!1,range:{scale:[0,99999]},idx:e};else if("text"===d.params[e].elType)var l={drag:["self"],rotate:!1,scale:["bboxCorners"],keepRatio:!0,snap:{rotate:0,scale:1,drag:1},draw:!1,range:{scale:[0,99999]},idx:e};d.trans.$set(e,d.paper.freeTransform(d.elements[e],l,function(l,p){if("scale start"===p[0]||"rotate start"===p[0])t.ctrls.tranMode="start",t.ctrls.tranApplyCount=0,n.showSpineLines(),c.deleteElement(e),o("#element-"+e).css("opacity",.2);else if("drag start"===p[0]||"end"===t.ctrls.tranMode&&t.ctrls.tranApplyCount>=3)console.log("drag start"),t.ctrls.isDragStarted=!0,t.ctrls.tranMode="start",t.ctrls.tranApplyCount=0,n.showSpineLines(),c.deleteElement(e);else if("drag end"===p[0]||t.ctrls.isDragStarted&&"apply"===p[0]&&"init"===t.ctrls.lastTranEvent){console.log("drag end"),t.ctrls.isDragStarted=!1,t.ctrls.tranMode="end",t.ctrls.tranApplyCount=0,t.ctrls.lastTranEvent="",n.changeClickDepth({idx:l.opts.idx}),n.hideSpineLines(),d.warns[e]&&d.warns[e].isActive&&c.createElement(e);var h=a(5).getParamsValueByElement(e);if(h.x<-h.width||h.y<-h.height||h.x>d.oriWidth||h.y>d.oriHeight)if(console.info(h),h.x=0,h.y=0,"text"===h.elType){var g=a(23);g.editText(h,e)}else if("image"===h.elType||"logo"===h.elType){var m=a(22);m.editImage(h,e)}}else if("scale end"===p[0]||"rotate end"===p[0]){t.ctrls.tranMode="end",t.ctrls.tranApplyCount=0;var u=s.getCropParamsByElement(l.opts.idx);"text"===d.params[l.opts.idx].elType?(console.log("resize text"),u.fontSize<r.getPxByInch(.3)?u.fontSize=r.getPxByInch(.3):u.fontSize>r.getPxByInch(16)&&(u.fontSize=r.getPxByInch(16)),i.editText(u,l.opts.idx)):(d.params.splice(l.opts.idx,1,u),n.editElement(l.opts.idx),n.highlightSelection(l.opts.idx),n.spineLinesToTop(),n.hideSpineLines())}else"end"===t.ctrls.tranMode&&"apply"===p[0]&&("apply"===t.ctrls.lastTranEvent?(t.ctrls.tranApplyCount++,console.log("apply count:",t.ctrls.tranApplyCount)):t.ctrls.tranApplyCount=0);t.ctrls.lastTranEvent=p[0]||""})),d.trans[e].attrs.rotate=d.params[e].rotate,d.trans[e].apply()},initElementDragEvent:function(e){var i=t.pages[t.selectedPageIdx].canvas;"background"!==i.params[e].elType&&"image"!==i.params[e].elType&&"logo"!==i.params[e].elType||(navigator.userAgent.indexOf("Trident")!==-1?(o("#element-"+e).attr("ondragover","event.preventDefault();"),o("#element-"+e).attr("ondrop","asFn.fnOndrop(event);")):(document.getElementById("element-"+e).ondragover=function(e){e.preventDefault()},document.getElementById("element-"+e).ondrop=function(e){var i={ev:e,newAdded:!1,isBg:!1};t.dropData.ev=i.ev,t.dropData.newAdded=i.newAdded,t.dropData.isBg=i.isBg,t.dropData.ev=e,t.watches.isOnDrop=!0}))},initWarnTip:function(e){var i=t.pages[t.selectedPageIdx].canvas,o=n.getImageDetail(i.elements[e].imageId);if(i.warns[e]={isActive:!1,el:""},("background"===i.params[e].elType||"image"===i.params[e].elType||"logo"===i.params[e].elType)&&o){var r=o.width*i.params[e].cropPW,s=o.height*i.params[e].cropPH;console.log(o.width);var d=a(5).getParamsValueByElement(e),l=d.width/r,p=d.height/s,h=Math.max(l,p);console.log(h),h>t.warnSettings.resizeLimit?c.createElement(e):(c.deleteElement(e),i.warns[e].isActive=!1)}},createBackLayer:function(){var e=t.pages[t.selectedPageIdx].canvas;e.elementBg=e.paper.rect(.5,.5,e.width,e.height),e.elementBg.attr({fill:"rgba(255, 255, 255, 0)",stroke:"rgba(10, 10, 10, 0)"}),e.elementBg.node.id="element-bg"},createBleeding:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.paper.rect(0,0,e.bleedings.left*e.ratio,e.height);i.attr({fill:"rgba(255, 255, 255, .6)",stroke:"rgba(255, 255, 255, 0)"});var a=e.paper.rect(e.bleedings.left*e.ratio,0,(e.oriWidth-e.bleedings.left-e.bleedings.right)*e.ratio,e.bleedings.top*e.ratio);a.attr({fill:"rgba(255, 255, 255, .6)",stroke:"rgba(255, 255, 255, .2)"});var o=e.paper.rect(e.bleedings.left*e.ratio,(e.oriHeight-e.bleedings.bottom)*e.ratio,(e.oriWidth-e.bleedings.left-e.bleedings.right)*e.ratio,e.bleedings.bottom*e.ratio);o.attr({fill:"rgba(255, 255, 255, .6)",stroke:"rgba(255, 255, 255, 0.2)"});var r=e.paper.rect((e.oriWidth-e.bleedings.right)*e.ratio,0,e.bleedings.right*e.ratio,e.height);r.attr({fill:"rgba(255, 255, 255, .6)",stroke:"rgba(255, 255, 255, 0)"});var n=e.paper.rect(e.bleedings.left*e.ratio,e.bleedings.top*e.ratio,(e.oriWidth-e.bleedings.left-e.bleedings.right)*e.ratio,(e.oriHeight-e.bleedings.top-e.bleedings.bottom)*e.ratio);n.attr({fill:"rgba(255, 255, 255, 0)",stroke:"#646464"}),n.node.id="element-bg"},createOuterLine:function(){var e=t.pages[t.selectedPageIdx].canvas;e.outerLine=e.paper.path("M0.5 0.5L"+e.width+" 0.5L"+e.width+" "+e.height+"L0.5 "+e.height+"L0.5 0.5"),e.outerLine.attr({stroke:"#7b7b7b"})},createInnerLine:function(){var e=t.pages[t.selectedPageIdx].canvas,i=t.projectSettings[t.currentSelectProjectIndex],a=l.analyseSpec({size:i.size,product:i.product}),o=a.logo.x*e.ratio,r=a.logo.y*e.ratio,n=a.logo.width*e.ratio,s=a.logo.height*e.ratio;e.innerLine=e.paper.path("M"+o+" "+r+"L"+(o+n)+" "+r+"L"+(o+n)+" "+(r+s)+"L"+o+" "+(r+s)+"L"+o+" "+r),e.innerLine.attr({stroke:"#7b7b7b","stroke-dasharray":"-"})},createCenterLine:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.width/2;e.spineLeft=e.paper.path("M"+i+" 0L"+i+" "+e.height),e.spineLeft.attr({stroke:"#7b7b7b","stroke-dasharray":"-"})},createSpineLine:function(){var e=t.pages[t.selectedPageIdx].canvas;if(0!==e.oriSpineWidth){var i=e.oriSpineWidth*e.ratio,a=(e.width-i)/2,o=a+i;e.spineLeft=e.paper.path("M"+a+" 0L"+a+" "+e.height),e.spineLeft.attr({stroke:"#646464","stroke-dasharray":"-"}),e.spineRight=e.paper.path("M"+o+" 0L"+o+" "+e.height),e.spineRight.attr({stroke:"#646464","stroke-dasharray":"-"})}},hCenterElement:function(e){var i=t.pages[t.selectedPageIdx].canvas,a=i.width,o=(i.height,i.params[e].width*i.ratio);i.params[e].height*i.ratio;i.params[e].x=(a-o)/2/i.ratio},changeClickDepth:function(e){if(e&&void 0!=e.idx){var i=t.pages[t.selectedPageIdx].canvas;i.selectedIdx=e.idx,this.changeDepthValue({idx:e.idx,targetDepth:i.elements.length-1}),this.freshElementDepth(),i.trans[e.idx].apply(),this.highlightSelection(e.idx)}},sendToBack:function(e){e&&void 0!=e.idx&&this.changeDepthValue({idx:e.idx,targetDepth:0})},sendToFront:function(e){if(e&&void 0!=e.idx){var i=t.pages[t.selectedPageIdx].canvas;this.changeDepthValue({idx:e.idx,targetDepth:i.params.length-1})}},bringBackward:function(e){if(e&&void 0!=e.idx){var i=t.pages[t.selectedPageIdx].canvas;i.params[e.idx].dep>0&&this.changeDepthValue({idx:e.idx,targetDepth:i.params[e.idx].dep-1})}},bringForward:function(e){if(e&&void 0!=e.idx){var i=t.pages[t.selectedPageIdx].canvas;i.params[e.idx].dep<i.params.length-1&&this.changeDepthValue({idx:e.idx,targetDepth:i.params[e.idx].dep+1})}},changeDepthValue:function(e){if(e&&void 0!=e.idx&&void 0!=e.targetDepth){var i=t.pages[t.selectedPageIdx].canvas,a=i.params[e.idx].dep,o=e.targetDepth;if(o===a)return;if(o>a){for(var r=0;r<i.params.length;r++)i.params[r].dep>a&&i.params[r].dep<=o&&i.params[r].dep--;i.params[e.idx].dep=o}else{for(var r=0;r<i.params.length;r++)i.params[r].dep<a&&i.params[r].dep>=o&&i.params[r].dep++;i.params[e.idx].dep=o}}},freshElementDepth:function(){for(var e=t.pages[t.selectedPageIdx].canvas,i=[],a=0;a<e.elements.length;a++)i.push({idx:a,dep:e.elements[a].dep});for(i.sort(function(e,t){return e.dep-t.dep}),a=1;a<i.length;a++)e.elements[i[a].idx].toFront(),e.warns[i[a].idx]&&e.warns[i[a].idx].el&&e.warns[i[a].idx].el.toFront();this.spineLinesToTop()},freshDepth:function(e){for(var i=t.pages[t.selectedPageIdx].canvas,a=i.params[e].dep,o=0;o<i.params.length;o++)i.params[o].dep>a&&i.params[o].dep--},freshIdx:function(e){for(var i=t.pages[t.selectedPageIdx].canvas,a=0;a<i.elements.length;a++)i.elements[a].idx>e&&(i.elements[a].idx--,i.elements[a].node.id="element-"+(a-1))},spineLinesToTop:function(){var e=t.pages[t.selectedPageIdx].canvas;""!==e.innerLine&&e.innerLine.toFront(),""!==e.spineLeft&&e.spineLeft.toFront(),""!==e.spineRight&&e.spineRight.toFront()},showSpineLines:function(){var e=t.pages[t.selectedPageIdx].canvas;""!==e.outerLine&&e.outerLine.show(),""!==e.innerLine&&e.innerLine.show(),""!==e.spineLeft&&e.spineLeft.show(),""!==e.spineRight&&e.spineRight.show()},hideSpineLines:function(){var e=t.pages[t.selectedPageIdx].canvas;""!==e.outerLine&&e.outerLine.hide(),""!==e.innerLine&&e.innerLine.hide(),""!==e.spineLeft&&e.spineLeft.hide(),""!==e.spineRight&&e.spineRight.hide()},highlightSelection:function(e){var i=t.pages[t.selectedPageIdx].canvas;e?e:e=i.selectedIdx;for(var a=0;a<i.trans.length;a++)i.trans[a].setOpts({draw:!1});if("image"===i.elements[e].elType||"logo"===i.elements[e].elType)var r={drag:["self"],rotate:!1,scale:["bboxCorners"],keepRatio:!1,snap:{rotate:1,scale:1,drag:1},draw:["bbox"],range:{scale:[0,99999]},idx:e};else var r={drag:["self"],rotate:!1,scale:["bboxCorners"],keepRatio:!0,snap:{rotate:0,scale:1,drag:1},draw:["bbox"],range:{scale:[0,99999]},idx:e};i.trans[e].setOpts(r),i.trans[e].apply(),o("rect.handle.bbox.index-0").css("cursor","nw-resize"),o("rect.handle.bbox.index-1").css("cursor","ne-resize"),o("rect.handle.bbox.index-2").css("cursor","se-resize"),o("rect.handle.bbox.index-3").css("cursor","sw-resize")},blurSelection:function(e){var i=t.pages[t.selectedPageIdx].canvas;e?e:e=i.selectedIdx,i.trans[e].setOpts({draw:!1})},getDefaultNewElementPosition:function(e){if(e){e.x=e.x||0,e.y=e.y||0;var i,a,o=t.pages[t.selectedPageIdx].canvas,r=o.width/o.ratio,s=o.height/o.ratio,d=limitedHeight=150/o.ratio,c=e.x/o.ratio,p=e.y/o.ratio,h=t.dragData.imageId,g=n.getImageDetail(h);if(0===t.selectedPageIdx&&this.isInLogoArea(c,p)){var m=l.analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size}),u=m.logo;g?(i=g.width,a=g.height):(i=u.width,a=u.height);var f=i/a,v=u.width/u.height;if(f>=v){var x=u.width/i;i*=x,a*=x}else{var x=u.height/a;i*=x,a*=x}var w=u.x+(u.width-i)/2,S=u.y+(u.height-a)/2;return{x:w,y:S,width:i,height:a}}g?(i=g.width,a=g.height):(i=r/3,a=s/3);var f=i/a,y=d/limitedHeight;if(f>=y)var x=d/i;else var x=limitedHeight/a;i*=x,a*=x;var I=t.dragData.cursorX/o.ratio,b=t.dragData.cursorY/o.ratio;return console.log(I,b),c-=I,p-=b,{x:c,y:p,width:i,height:a}}return{x:0,y:0,width:300,height:300}},isInLogoArea:function(e,i){if(null!=e&&null!=i){var a=l.analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size}),o=a.logo;return e>=o.x&&e<=o.x+o.width&&i>=o.y&&i<=o.y+o.height}return!1},initCanvasData:function(){if(t.projectSettings&&t.projectXml){var e=t.projectXml;this.initImageList(e),this.initProject(e),t.selectedPageIdx=0}},initImageList:function(e){if(e){var i=o(e).find("images").find("image").length;if(t.imageList=[],i>0)for(var a=0;a<i;a++)t.imageList.push({id:o(e).find("images").find("image").eq(a).attr("id"),guid:o(e).find("images").find("image").eq(a).attr("guid")||"",encImgId:decodeURIComponent(o(e).find("images").find("image").eq(a).attr("encImgId"))||"",url:t.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+o(e).find("images").find("image").eq(a).attr("encImgId")+"&rendersize=fit",name:o(e).find("images").find("image").eq(a).attr("name"),width:parseFloat(o(e).find("images").find("image").eq(a).attr("width"))||0,height:parseFloat(o(e).find("images").find("image").eq(a).attr("height"))||0,shotTime:o(e).find("images").find("image").eq(a).attr("shotTime")||"",usedCount:0})}},initProject:function(e){if(e)for(var i=0;i<o(e).find("tshirt").length;i++){var a=t.projectSettings[i],r=l.analyseSpec({size:a.size,product:a.product});t.projects[i]={},t.projects[i].pages=[];for(var s=0;s<o(e).find("tshirt").eq(i).find("content").length;s++){t.projects[i].pages.push({type:o(e).find("tshirt").eq(i).find("content").eq(s).attr("type")||"",name:"",canvas:{oriWidth:0,oriHeight:0,oriX:0,oriY:0,oriBgWidth:0,oriBgHeight:0,oriSpineWidth:0,realBleedings:{},frameBaseSize:{},frameBorderThickness:{},boardInFrame:{},boardInMatting:{},mattingSize:{},expendSize:{},photoLayer:{},params:[]}});var d=t.projects[i].pages[s].canvas;"coverPage"===t.projects[i].pages[s].type||0===s?(d.oriWidth=r.base.width,d.oriHeight=r.base.height,d.oriX=r.base.x,d.oriY=r.base.y,d.oriBgWidth=r.background.width,d.oriBgHeight=r.background.height):(d.oriWidth=r.base.width,d.oriHeight=r.base.height,d.oriX=r.base.x,d.oriY=r.base.y,d.oriBgWidth=r.background.width,d.oriBgHeight=r.background.height);for(var c=o(e).find("tshirt").eq(i).find("content").eq(s).find("element").length,p=0;p<c;p++){var h=o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("imageid")||"",g=n.getImageDetail(h),m="";""!==g?m=t.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+g.encImgId+"&rendersize=fit":m;var u=parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("x"))||0,f=parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("y"))||0,v=parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("width"))||0,x=parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("height"))||0,w="";"LogoElement"===o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("type")?w="logo":"PhotoElement"===o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("type")?w="image":"TextElement"===o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("type")&&(w="text"),d.params.push({id:p,elType:w,url:"",isRefresh:!1,text:decodeURIComponent(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).text())||"",x:u,y:f,width:v,height:x,rotate:parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("rot")),dep:parseInt(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("dep")),imageId:h,imageGuid:g.guid||"",imageWidth:g.width||"",imageHeight:g.height||"",imageRotate:parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("imgRot"))||0,cropPX:parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("cropLUX"))||0,cropPY:parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("cropLUY"))||0,cropPW:parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("cropRLX"))-parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("cropLUX"))||1,cropPH:parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("cropRLY"))-parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("cropLUY"))||1,fontFamily:decodeURIComponent(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("fontFamily"))||"",fontSize:d.oriHeight*parseFloat(o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("fontSize")||0),fontWeight:o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("fontWeight")||"",textAlign:o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("textAlign")||"",fontColor:o(e).find("tshirt").eq(i).find("content").eq(s).find("element").eq(p).attr("color")||""})}}}},loadProjectIntoPages:function(e){void 0!=e&&null!=e?e:e=t.currentSelectProjectIndex,t.pages=[];for(var i=t.projects[e],a=0;a<i.pages.length;a++)t.pages.push({type:i.pages[a].type||"",name:"",canvas:{isInited:!1,width:0,height:0,x:0,y:0,bgWidth:0,bgHeight:0,ratio:1,oriWidth:i.pages[a].canvas.oriWidth,oriHeight:i.pages[a].canvas.oriHeight,oriX:i.pages[a].canvas.oriX,oriY:i.pages[a].canvas.oriY,oriBgWidth:i.pages[a].canvas.oriBgWidth,oriBgHeight:i.pages[a].canvas.oriBgHeight,oriSpineWidth:i.pages[a].canvas.oriSpineWidth,bleedings:{},realBleedings:i.pages[a].canvas.realBleedings,frameBaseSize:i.pages[a].canvas.frameBaseSize,frameBorderThickness:i.pages[a].canvas.frameBorderThickness,boardInFrame:i.pages[a].canvas.boardInFrame,boardInMatting:i.pages[a].canvas.boardInMatting,mattingSize:i.pages[a].canvas.mattingSize,expendSize:i.pages[a].canvas.expendSize,photoLayer:i.pages[a].canvas.photoLayer,selectedIdx:0,params:i.pages[a].canvas.params.slice(0),elements:[],outerLine:"",innerLine:"",bleedingRibbonLeft:"",bleedingRibbonRight:"",bleedingRibbonTop:"",bleedingRibbonBottom:"",spineLeft:"",spineRight:"",elementBg:""}})},syncProjectData:function(e){void 0!=e&&null!=e?e:e=t.currentSelectProjectIndex;for(var a=0;a<t.pages.length;a++){var o=t.pages[a].canvas;for(i=0;i<t.projectSettings.length;i++)i>t.projects.length-1?this.createProjectData():(t.projects[i].pages[a].canvas.params=[],t.projects[i].pages[a].canvas.params=o.params.slice(0))}},createProjectData:function(){t.projects.push(t.projects[0])},freshPageData:function(){var e=t.pages[t.selectedPageIdx].canvas;e.frameBaseSize=d.getFrameBaseSize(),e.frameBorderThickness=d.getFrameBorderThickness(),e.realBleedings=d.getBleed(),e.boardInFrame=d.getBoardInFrame(),e.boardInMatting=d.getBoardInMatting(),e.mattingSize=d.getMatteSize(),e.photoLayer=d.getPhotoLayer(),e.expendSize={top:e.frameBorderThickness.top-e.boardInFrame.top,right:e.frameBorderThickness.right-e.boardInFrame.right,bottom:e.frameBorderThickness.bottom-e.boardInFrame.bottom,left:e.frameBorderThickness.left-e.boardInFrame.left},e.oriWidth=e.photoLayer.width,e.oriHeight=e.photoLayer.height,e.oriBgWidth=e.frameBaseSize.width,e.oriBgHeight=e.frameBaseSize.height,e.oriX=e.photoLayer.x,e.oriY=e.photoLayer.y}}}).call(t,a(2),a(4))},function(e,t,i){(function(t,i){e.exports={analyseSpec:function(e){if(e&&e.size&&e.product){for(var a=e.size,o=e.product,r=(e.color,e.measure,0),n=0,s=0,d=0,l=0,c=0,p=0,h=0,g=0,m=0,u=(new DOMParser,t.spec.specXml),f=i(u).find('parameter[id="baseSize"]').find("entry"),v=0;v<f.length;v++)if(f.eq(v).attr("key").indexOf(o+"-"+a)!==-1){r=f.eq(v).attr("x"),n=f.eq(v).attr("y"),s=300*f.eq(v).attr("widthInInch"),d=300*f.eq(v).attr("heightInInch");break}for(var x=i(u).find('parameter[id="backgroundSize"]').find("entry"),v=0;v<x.length;v++)if(x.eq(v).attr("key").indexOf(o+"-"+a)!==-1){l=x.eq(v).attr("width"),c=x.eq(v).attr("height");break}for(var w=i(u).find('parameter[id="logoArea"]').find("entry"),v=0;v<w.length;v++)if(w.eq(v).attr("key").indexOf(o+"-"+a)!==-1){p=w.eq(v).attr("x"),h=w.eq(v).attr("y"),g=w.eq(v).attr("width"),m=w.eq(v).attr("height");break}var S={x:parseFloat(r),y:parseFloat(n),width:parseFloat(s),height:parseFloat(d)},y={width:parseFloat(l),height:parseFloat(c)},I={x:parseFloat(p),y:parseFloat(h),width:parseFloat(g),height:parseFloat(m)};return console.log(S),console.log(y),console.log(I),{base:S,background:y,logo:I}}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,i){e.exports={getImageDetail:function(e){if(!e)return"";for(var i=0;i<t.imageList.length;i++)if(t.imageList[i].id===e)return t.imageList[i]},freshImageUsedCount:function(){for(var e=[],a=[],o=0;o<t.pages.length;o++)for(var r=t.pages[o].canvas,n=0;n<r.params.length;n++){if(r.elements[n]&&void 0!=r.elements[n].imageId&&""!==r.elements[n].imageId)var s=r.elements[n];else var s=r.params[n];if(s.imageId&&""!==s.imageId)if(i.inArray(s.imageId,e)===-1)e.push(s.imageId),
a.push(1);else{var d=i.inArray(s.imageId,e);a[d]++}}for(o=0;o<t.imageList.length;o++)for(t.imageList[o].usedCount=0,n=0;n<e.length;n++)if(e[n]===t.imageList[o].id){t.imageList[o].usedCount=a[n];break}}}}).call(t,i(2),i(4))},function(e,t,a){(function(t,o){e.exports={getFrameBaseSize:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,o=e.frameStyle,r=e.size,n=a(1).getParameter("frameBaseSize",[{key:"product",value:i},{key:"frameStyle",value:o},{key:"size",value:r}]),s={},d=e.rotated;return d?(s.width=n.heightInInch*a(1).getDPI(),s.height=n.widthInInch*a(1).getDPI()):(s.width=n.widthInInch*a(1).getDPI(),s.height=n.heightInInch*a(1).getDPI()),s},getCanvasBorderThickness:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,o=e.frameStyle,r=e.canvasBorderSize,n=a(1).getParameter("canvasBorderThickness",[{key:"product",value:i},{key:"canvasBorderSize",value:r},{key:"frameStyle",value:o}]),s={},d=e.rotated;return d?(s.top=parseInt(n.left),s.bottom=parseInt(n.right),s.left=parseInt(n.top),s.right=parseInt(n.bottom)):(s.top=parseInt(n.top),s.bottom=parseInt(n.bottom),s.left=parseInt(n.left),s.right=parseInt(n.right)),s},getFrameBorderThickness:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,o=e.frameStyle,r=a(1).getParameter("frameBorderThickness",[{key:"product",value:i},{key:"frameStyle",value:o}]),n={},s=e.rotated;return s?(n.top=parseInt(r.left),n.bottom=parseInt(r.right),n.left=parseInt(r.top),n.right=parseInt(r.bottom)):(n.top=parseInt(r.top),n.bottom=parseInt(r.bottom),n.left=parseInt(r.left),n.right=parseInt(r.right)),n},getBleed:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,o=e.size,r=e.frameStyle,n=a(1).getParameter("bleed",[{key:"product",value:i},{key:"frameStyle",value:r},{key:"size",value:o}]),s={},d=e.rotated;return d?(s.top=parseInt(n.left),s.bottom=parseInt(n.right),s.left=parseInt(n.top),s.right=parseInt(n.bottom)):(s.top=parseInt(n.top),s.bottom=parseInt(n.bottom),s.left=parseInt(n.left),s.right=parseInt(n.right)),s},getBoardInFrame:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,o=e.frameStyle,r=e.size,n=a(1).getParameter("boardInFrame",[{key:"product",value:i},{key:"frameStyle",value:o},{key:"size",value:r}]),s={},d=e.rotated;return d?(s.top=parseInt(n.left),s.bottom=parseInt(n.right),s.left=parseInt(n.top),s.right=parseInt(n.bottom)):(s.top=parseInt(n.top),s.bottom=parseInt(n.bottom),s.left=parseInt(n.left),s.right=parseInt(n.right)),s},getBoardInMatting:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,o=e.size,r=e.matte,n=e.frameStyle,s=a(1).getParameter("boardInMatting",[{key:"product",value:i},{key:"frameStyle",value:n},{key:"size",value:o},{key:"matte",value:r}]),d={},l=e.rotated;return l?(d.top=parseInt(s.left),d.bottom=parseInt(s.right),d.left=parseInt(s.top),d.right=parseInt(s.bottom)):(d.top=parseInt(s.top),d.bottom=parseInt(s.bottom),d.left=parseInt(s.left),d.right=parseInt(s.right)),d},getMatteSize:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.size,o=e.matte,r=e.product,n=e.frameStyle,s=a(1).getParameter("matteSize",[{key:"product",value:r},{key:"frameStyle",value:n},{key:"size",value:i},{key:"matte",value:o}]),d={},l=e.rotated;return l?(d.top=parseInt(s.left),d.bottom=parseInt(s.right),d.left=parseInt(s.top),d.right=parseInt(s.bottom)):(d.top=parseInt(s.top),d.bottom=parseInt(s.bottom),d.left=parseInt(s.left),d.right=parseInt(s.right)),d},getMatteStyleColor:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.matteStyle,o=a(1).getParameter("matteStyleColor",[{key:"matteStyle",value:i}]);return o&&"0"===o.color?0:16777215},getInitProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getBaseInfoXml()),i=this.getOptionXml(),r=this.getFrameBoardXml(),n=this.getMatteLayerXml(),s=this.getPhotoLayerXml(),d=this.getIntiElementXml(),l=this.getImagesXml();return o(e).find("photoFrame").append(i.firstChild.cloneNode(!0)),o(r).find("frameBoard").append(n.firstChild.cloneNode(!0)),o(s).find("photosLayer").append(d.firstChild.cloneNode(!0)),o(r).find("frameBoard").append(s.firstChild.cloneNode(!0)),o(e).find("photoFrame").append(r.firstChild.cloneNode(!0)),o(e).find("project").append(l.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getCurrentProjectXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=this.getBaseInfoXml(),r=this.getOptionXml(),n=this.getFrameBoardXml(),s=this.getMatteLayerXml(),d=this.getPhotoLayerXml(),l=this.getElementsXml(),c=this.getImagesXml();return o(i).find("photoFrame").append(r.firstChild.cloneNode(!0)),"none"!==e.matte&&o(n).find("frameBoard").append(s.firstChild.cloneNode(!0)),o(d).find("photosLayer").append(l.firstChild.cloneNode(!0)),o(n).find("frameBoard").append(d.firstChild.cloneNode(!0)),o(i).find("photoFrame").append(n.firstChild.cloneNode(!0)),o(i).find("project").append(c.firstChild.cloneNode(!0)),a(3).xmlToString(i)},getOptionXml:function(e){e||(e=t.currentSelectProjectIndex);for(var i=t.projectSettings[e],o='<spec version="'+a(1).getVersion()+'">',r=a(1).getOptionIds(),n=0;n<r.length;n++)o+='<option id="'+r[n]+'" value="'+i[r[n]]+'"/>';return o+="</spec>",a(3).stringToXml(o)},getElementsXml:function(e){e||(e=t.currentSelectProjectIndex);for(var i=(t.projectSettings[e],t.pages[e].canvas),o=i.params,r="<elements>",n=0;n<o.length;n++){var s=o[n].x,d=o[n].y,l=o[n].width,c=o[n].height,p=s/i.oriWidth,h=d/i.oriHeight,g=c/i.oriHeight,m=l/i.oriWidth,u=o[n].rotate,f=o[n].dep,v=o[n].imageId,x=o[n].imageRotate,w=!1,S=parseFloat(o[n].cropPX),y=parseFloat(o[n].cropPY),I=parseFloat(o[n].cropPW),b=parseFloat(o[n].cropPH);console.log(o[n]),"text"===o[n].elType?r+='<element type="TextElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+m+'" ph="'+g+'" rot="'+u+'" dep="'+f+'" color="'+o[n].fontColor+'" fontSize="'+parseFloat(o[n].fontSize)/i.oriHeight+'" fontFamily="'+encodeURIComponent(o[n].fontFamily)+'" fontWeight="'+o[n].fontWeight+'" textAlign="'+o[n].textAlign+'" ><![CDATA['+encodeURIComponent(o[n].text)+"]]></element>":"logo"===o[n].elType?r+='<element type="LogoElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+m+'" ph="'+g+'" rot="'+u+'" dep="'+f+'" imageid="'+v+'" imgRot="'+x+'" imgFlip="'+w+'" cropLUX="'+S.toString()+'" cropLUY="'+y.toString()+'" cropRLX="'+(S+I)+'" cropRLY="'+(y+b).toString()+'" />':"image"===o[n].elType&&(r+='<element type="PhotoElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+m+'" ph="'+g+'" rot="'+u+'" dep="'+f+'" imageid="'+v+'" imgRot="'+x+'" imgFlip="'+w+'" cropLUX="'+S.toString()+'" cropLUY="'+y.toString()+'" cropRLX="'+(S+I)+'" cropRLY="'+(y+b).toString()+'" />')}return r+="</elements>",a(3).stringToXml(r)},getIntiElementXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhotoLayer()),i=(e.width,e.height,"<elements></elements>");return a(3).stringToXml(i)},getBaseInfoXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],'<project schemaVersion="2.0" clientId="web-h5"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description></description><createdDate></createdDate><updatedDate></updatedDate><uiSetting><templateStrip><showTemplatePanel>false</showTemplatePanel><autoLayout>false</autoLayout></templateStrip></uiSetting><photoFrame></photoFrame></project>");return a(3).stringToXml(e)},getFrameBoardXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.rotated,o=this.getFrameBaseSize(),r=this.getFrameBorderThickness(),n=r.top,s=r.bottom,d=r.left,l=r.right,c=this.getCanvasBorderThickness(),p=c.top,h=c.bottom,g=c.left,m=c.right,u=this.getBoardInFrame(),f=u.top,v=u.bottom,x=u.left,w=u.right,S=this.getBoardInMatting(),y=S.top,I=S.bottom,b=S.left,P=S.right,j=o.width+g+m,C=o.height+p+h,T=t.bgColor+"";isNaN(T)&&(T="0");var k='<frameBoard rotated="'+i+'" height="'+C+'" width="'+j+'" frameBorderThicknessTop="'+n+'" frameBorderThicknessBottom="'+s+'" frameBorderThicknessLeft="'+d+'" frameBorderThicknessRight="'+l+'" canvasBorderThicknessTop="'+p+'" canvasBorderThicknessBottom="'+h+'" canvasBorderThicknessLeft="'+g+'" canvasBorderThicknessRight="'+m+'" boardInFrameTop="'+f+'" boardInFrameBottom="'+v+'" boardInFrameLeft="'+x+'" boardInFrameRight="'+w+'" boardInMattingTop="'+y+'" boardInMattingBottom="'+I+'" boardInMattingLeft="'+b+'" boardInMattingRight="'+P+'" canvasBorderColor="'+T+'"></frameBoard>';return a(3).stringToXml(k)},getMatteLayerXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.matte,o=this.getMatteStyleColor(),r=this.getMatteSize(),n=r.top,s=r.bottom,d=r.left,l=r.right,c='<matteLayer id="'+i+'" x="0" y="0" px="0" py="0" matteTop="'+n+'" matteBottom="'+s+'" matteLeft="'+d+'" matteRight="'+l+'" depth="1" color="'+o+'"/>';return a(3).stringToXml(c)},getPhotoLayerXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=this.getPhotoLayer(),o=this.getBleed(),r=o.top,n=o.bottom,s=o.left,d=o.right,l=i.x,c=i.y,p=i.px,h=i.py,g=i.pw,m=i.ph,u=i.width,f=i.height;console.log("color",t.bgColor);var v=e.tplGuid,x=e.tplSuitId,w="";return w=v&&x?'<photosLayer x="'+l+'" y="'+c+'" width="'+u+'" height="'+f+'" px="'+p+'" py="'+h+'" pw="'+g+'" ph="'+m+'" bleedTop="'+r+'" bleedBottom="'+n+'" bleedLeft="'+s+'" bleedRight="'+d+'" tplGuid="'+v+'" tplSuitId="'+x+'"></photosLayer>':'<photosLayer x="'+l+'" y="'+c+'" width="'+u+'" height="'+f+'" px="'+p+'" py="'+h+'" pw="'+g+'" ph="'+m+'" bleedTop="'+r+'" bleedBottom="'+n+'" bleedLeft="'+s+'" bleedRight="'+d+'"></photosLayer>',a(3).stringToXml(w)},getImagesXml:function(){var e="<images>";for(i=0;i<t.imageList.length;i++){var o=isNaN(t.imageList[i].orientation)?"":'orientation="'+t.imageList[i].orientation+'" ';e+='<image id="'+t.imageList[i].id+'" guid="'+t.imageList[i].guid+'" encImgId="'+t.imageList[i].encImgId+'" order="'+i+'" name="'+encodeURIComponent(t.imageList[i].name)+'" width="'+t.imageList[i].width+'" height="'+t.imageList[i].height+'" shotTime="'+t.imageList[i].shotTime+'" '+o+"/>"}return e+="</images>",a(3).stringToXml(e)},getPhotoLayer:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i={},o=(e.rotated,this.getFrameBaseSize()),r=this.getFrameBorderThickness(),n=(r.top,r.bottom,r.left,r.right,this.getCanvasBorderThickness()),s=n.top,d=n.bottom,l=n.left,c=n.right,p=this.getBoardInFrame(),h=(p.top,p.bottom,p.left,p.right,this.getBoardInMatting()),g=h.top,m=h.bottom,u=h.left,f=h.right,v=this.getBleed(),x=v.top,w=v.bottom,S=v.left,y=v.right,e=t.projectSettings[t.currentSelectProjectIndex],I=e.product,b=e.size,P=e.matte,I=e.product,j=e.frameStyle,C=a(1).getParameter("matteSize",[{key:"product",value:I},{key:"frameStyle",value:j},{key:"size",value:b},{key:"matte",value:P}]),T=parseInt(C.top),k=parseInt(C.bottom),L=parseInt(C.left),D=parseInt(C.right),B=a(1).getParameter("floatBgSize",[{key:"product",value:I},{key:"size",value:b}]),z=B?parseInt(B.top):0,F=B?parseInt(B.left):0,R=B?parseInt(B.right):0,U=B?parseInt(B.bottom):0,M=o.width+l+c,E=o.height+s+d,O=0,H=0,W=0,X=0;e.rotated?(O=k-w-m+U,H=L-S-u+F,W=M+x+w-T-k+g+m-z-U,X=E+S+y-L-D+u+f-F-R):(O=L-S-u+F,H=T-x-g+z,W=M+S+y-L-D+u+f-F-R,X=E+x+w-T-k+g+m-z-U);var N=O/M,A=H/E,q=W/M,$=X/E;return i.x=O,i.y=H,i.width=W,i.height=X,i.px=N,i.py=A,i.pw=q,i.ph=$,i},getFrameBorderAsset:function(){var e=t.projectSettings[t.currentSelectProjectIndex];return a(1).getVariable("frameBorderAsset",[{key:"product",value:e.product},{key:"color",value:e.color}])},isSupportMatte:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=a(1).getVariable("availableOperation",[{key:"product",value:e.product},{key:"frameStyle",value:e.frameStyle}]);return"true"===i.supportMatte},isSupportGlass:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=a(1).getVariable("availableOperation",[{key:"product",value:e.product},{key:"frameStyle",value:e.frameStyle}]);return"true"===i.supportGlassStyle},getBaseSize:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=i.product,r=i.size,n=a(1).getParameter("baseSize",[{key:"product",value:o},{key:"size",value:r}]),s={},d=i.rotated;return d?(s.width=n.heightInInch*a(1).getDPI(),s.height=n.widthInInch*a(1).getDPI()):(s.width=n.widthInInch*a(1).getDPI(),s.height=n.heightInInch*a(1).getDPI()),s},getPageBleed:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=i.product,r=i.size,n=a(1).getParameter("pageBleed",[{key:"product",value:o},{key:"size",value:r}]),s={},d=i.rotated;return d?(s.top=parseInt(n.left),s.bottom=parseInt(n.right),s.left=parseInt(n.top),s.right=parseInt(n.bottom)):(s.top=parseInt(n.top),s.bottom=parseInt(n.bottom),s.left=parseInt(n.left),s.right=parseInt(n.right)),s},getProuctCode:function(){for(var e=t.projectSettings.length,i="|",a=0;a<e;a++){var o=t.projectSettings[a].product;i.indexOf("|"+o+"|")<0&&(i+=o+"|")}return i.substring(1,i.length-1)},getPosterBaseInfoXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=(e.product,'<project schemaVersion="3.0" createAuthor="web-h5|1.0|1" clientId="web-h5" productCode="'+this.getProuctCode()+'" categoryCode="'+t.category+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><products></products></project>");return a(3).stringToXml(i)},getPosterInitProjectXml:function(){var e=this.getPosterBaseInfoXml(),t=this.getInitPosterXml(),i=this.getImagesXml();return o(e).find("products").append(t.firstChild.cloneNode(!0)),o(e).find("project").append(i.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getInitPosterXml:function(){for(var e="",i=t.projectSettings.length,o=0;o<i;o++){var r=t.projectSettings[o];e+='<product type="'+r.product+'">';var n=this.getOptionXml(o);e+=a(3).xmlToString(n),e+="<productSetting/>",e+="<contents>";var s=this.getInitPosterContentXml();e+=a(3).xmlToString(s),e+="</contents>",e+="</product>"}return a(3).stringToXml(e)},getInitPosterContentXml:function(){var e=t.projectSettings[0],i=this.getContent(0),o=e.rotated,r="null",n="null",s='<content width="'+i.width+'" height="'+i.height+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="front"  tplGuid="'+r+'" tplSuitId="'+n+'" rotated="'+o+'">';return s+="<elememts>",s+='<element type="PhotoElement" x="0" y="0" width="'+i.width+'" height="'+i.height+'" px="0" py="0" pw="1" ph="1" rot="0" dep="0" imageid="" imgRot="0" imgFlip="false" cropLUX="0" cropLUY="0" cropRLX="1" cropRLY="1" />',s+="</elememts>",s+="</content>",a(3).stringToXml(s)},getPosterCurrentProjectXml:function(){var e=this.getPosterBaseInfoXml(),t=this.getProductXml(),i=this.getImagesXml();return o(e).find("products").append(t.firstChild.cloneNode(!0)),o(e).find("project").append(i.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getContent:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a={},o=(i.rotated,this.getBaseSize()),r=o.width,n=o.height,s=this.getPageBleed(),d=s.top,l=s.bottom,c=s.left,p=s.right,h=r+c+p,g=n+d+l,a={};return a.width=h,a.height=g,a.bleedTop=d,a.bleedBottom=l,a.bleedLeft=c,a.bleedRight=p,a},getProductXml:function(){for(var e="",i=t.projectSettings.length,o=0;o<i;o++){var r=t.projectSettings[o];e+='<product type="'+r.product+'">';var n=this.getOptionXml(o);e+=a(3).xmlToString(n),e+="<productSetting/>",e+="<contents>";var s=this.getContentXml(o);e+=a(3).xmlToString(s),e+="</contents>",e+="</product>"}return a(3).stringToXml(e)},getInitProductXml:function(){for(var e="",i=t.projectSettings.length,o=0;o<i;o++){var r=t.projectSettings[o];e+='<product type="'+r.product+'">';var n=this.getOptionXml(o);e+=a(3).xmlToString(n),e+="<productSetting/>",e+="<contents>";var s=this.getInitContentXml();e+=a(3).xmlToString(s),e+="</contents>",e+="</product>"}return a(3).stringToXml(e)},getContentXml:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=this.getContent(e),r=i.rotated,n=i.tplGuid,s=i.tplSuitId,d='<content width="'+o.width+'" height="'+o.height+'" bleedTop="'+o.bleedTop+'" bleedBottom="'+o.bleedBottom+'" bleedLeft="'+o.bleedLeft+'" bleedRight="'+o.bleedRight+'" type="front"  tplGuid="'+n+'" tplSuitId="'+s+'" rotated="'+r+'">',l=this.getElementsXml(e);return d+=a(3).xmlToString(l),d+="</content>",a(3).stringToXml(d)},getInitContentXml:function(){var e=t.projectSettings[0],i=this.getContent(0),o=e.rotated,r="null",n="null",s='<content width="'+i.width+'" height="'+i.height+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="front"  tplGuid="'+r+'" tplSuitId="'+n+'" rotated="'+o+'">';return s+="<elememts>",s+="</elememts>",s+="</content>",a(3).stringToXml(s)},getPhonecaseBaseSize:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=i.product,r=i.deviceType,n=a(1).getDPI(),s=a(1).getParameter("baseSizeInInch",[{key:"product",value:o},{key:"deviceType",value:r}]),d={};return d.width=s.width*n,d.height=s.height*n,d},getPhonecaseSide:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=i.product,r=i.deviceType,n=a(1).getDPI(),s=a(1).getParameter("sideInInch",[{key:"product",value:o},{key:"deviceType",value:r}]),d={};return d.top=s.top*n,d.bottom=s.bottom*n,d.left=s.left*n,d.right=s.right*n,d},getPhonecaseEdge:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=i.product,r=i.deviceType,n=a(1).getDPI(),s=a(1).getParameter("edgeInInch",[{key:"product",value:o},{key:"deviceType",value:r}]),d={};return d.top=s.top*n,d.bottom=s.bottom*n,d.left=s.left*n,d.right=s.right*n,d},getPhonecaseBleed:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=i.product,r=i.deviceType,n=a(1).getDPI(),s=a(1).getParameter("bleedInInch",[{key:"product",value:o},{key:"deviceType",value:r}]),d={};return d.top=s.top*n,d.bottom=s.bottom*n,d.left=s.left*n,d.right=s.right*n,d},getPhonecaseForeground:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=i.product,r=i.deviceType,n=a(1).getVariable("foreground",[{key:"product",value:o},{key:"deviceType",value:r}]),s={};return s.width=n.width,s.height=n.height,s.top=n.paddingTop,s.right=n.paddingRight,s.left=n.paddingLeft,s.bottom=n.paddingBottom,s},getPhonecaseBaseInfoXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=(e.product,'<project schemaVersion="2.0" createAuthor="web-h5|1.0|1" clientId="web-h5" product="'+t.product+'" productType="'+t.projectType+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><endpointToken></endpointToken><phoneCase></phoneCase></project>");return a(3).stringToXml(i)},getPhonecasePhotoLayerXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhonecasePhotoLayer()),i=this.getPhonecaseBleed(),o=i.top,r=i.bottom,n=i.left,s=i.right,d=e.x,l=e.y,c=e.px,p=e.py,h=e.pw,g=e.ph,m=e.width,u=e.height;console.log("color",t.bgColor);var f='<photosLayer x="'+d+'" y="'+l+'" width="'+m+'" height="'+u+'" px="'+c+'" py="'+p+'" pw="'+h+'" ph="'+g+'" bleedTop="'+o+'" bleedBottom="'+r+'" bleedLeft="'+n+'" bleedRight="'+s+'"></photosLayer>';return a(3).stringToXml(f)},getPhonecasePhotoLayer:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],{}),i=this.getPhonecaseBaseSize(),a=i.width,o=i.height,r=this.getPhonecaseSide(),n=r.top,s=r.bottom,d=r.left,l=r.right,c=this.getPhonecaseEdge(),p=c.top,h=c.bottom,g=c.left,m=c.right,u=this.getPhonecaseBleed(),f=u.top,v=u.bottom,x=u.left,w=u.right,S=0,y=0,I=0,b=0;S=-(d+g+x),y=-(n+p+f),I=a+d+l+g+m+x+w,b=o+n+s+p+h+f+v;var P=S/a,j=y/o,C=I/a,T=b/o;return e.x=S,e.y=y,e.width=I,e.height=b,e.px=P,e.py=j,e.pw=C,e.ph=T,e},getPhonecaseInitProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhonecaseBaseInfoXml()),i=this.getOptionXml(),r=this.getFaceXml(),n=this.getPhonecasePhotoLayerXml(),s=this.getPhonecaseInitElemntsXml(),d=this.getImagesXml();return o(e).find("phoneCase").append(i.firstChild.cloneNode(!0)),o(e).find("phoneCase").append(r.firstChild.cloneNode(!0)),o(e).find("face").append(n.firstChild.cloneNode(!0)),o(e).find("photosLayer").append(s.firstChild.cloneNode(!0)),o(e).find("project").append(d.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getPhonecaseCurrentProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhonecaseBaseInfoXml()),i=this.getOptionXml(),r=this.getFaceXml(),n=this.getPhonecasePhotoLayerXml(),s=this.getElementsXml(),d=this.getImagesXml();return o(e).find("phoneCase").append(i.firstChild.cloneNode(!0)),o(e).find("phoneCase").append(r.firstChild.cloneNode(!0)),o(e).find("face").append(n.firstChild.cloneNode(!0)),o(e).find("photosLayer").append(s.firstChild.cloneNode(!0)),o(e).find("project").append(d.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getPhonecaseInitElemntsXml:function(){var e=this.getPhonecasePhotoLayer(),t="<elements>",i=0,o=0,r=e.width,n=e.height,s=i/e.width,d=o/e.height,l=n/e.height,c=r/e.width,p=0,h=0,g="",m=!1,u=!1,f=0,v=0,x=1,w=1;return t+='<element type="PhotoElement" x="'+i+'" y="'+o+'" width="'+r+'" height="'+n+'" px="'+s+'" py="'+d+'" pw="'+c+'" ph="'+l+'" rot="'+p+'" dep="'+h+'" imageid="'+g+'" imgRot="'+m+'" imgFlip="'+u+'" cropLUX="'+f+'" cropLUY="'+v+'" cropRLX="'+(f+x)+'" cropRLY="'+(v+w)+'" />',t+="</elements>",a(3).stringToXml(t)},getFaceXml:function(){for(var e=this.getPhonecaseBaseSize(),i=e.width,o=e.height,r=this.getPhonecaseSide(),n=r.top,s=r.bottom,d=r.left,l=r.right,c=this.getPhonecaseEdge(),p=c.top,h=c.bottom,g=c.left,m=c.right,u="",f=t.projectSettings.length,v=0;v<f;v++){t.projectSettings[v];u+='<face width="'+i+'" height="'+o+'" sideLeft="'+d+'" sideTop="'+n+'" sideRight="'+l+'" sideBottom="'+s+'" edgeLeft="'+g+'" edgeTop="'+p+'" edgeRight="'+m+'" edgeBottom="'+h+'">',u+="</face>"}return a(3).stringToXml(u)},getPhonecaseContent:function(e){e||(e=t.currentSelectProjectIndex);var i=(t.projectSettings[e],{}),a=this.getPhonecaseBaseSize(),o=a.width,r=a.height,n=this.getPhonecaseSide(),s=n.top,d=n.bottom,l=n.left,c=n.right,p=this.getPhonecaseEdge(),h=p.top,g=p.bottom,m=p.left,u=p.right,f=this.getPhonecaseBleed(),v=f.top,x=f.bottom,w=f.left,S=f.right,y=this.getPhonecaseForeground(),I=o+w+S+m+u+l+c,b=r+v+x+h+g+s+d,P=y.width-y.left-y.right,j=(y.height-y.top-y.bottom,o/P),C=y.width*j,T=y.height*j;return i.bgWidth=C,i.bgHeight=T,i.width=I,i.height=b,i.x=y.left*j-w-l-m,i.y=y.top*j-v-s-h,i.bleedTop=v,i.bleedBottom=x,i.bleedLeft=w,i.bleedRight=S,i.sideTop=s,i.sideBottom=d,i.sideLeft=l,i.sideRight=c,i.edgeTop=h,i.edgeBottom=g,i.edgeLeft=m,i.edgeRight=u,i},getWallArtsInitProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getBaseInfoXml()),i=this.getOptionXml(),r=this.getFrameBoardXml(),n=this.getMatteLayerXml(),s=this.getPhotoLayerXml(),d=this.getWallArtsIntiElementXml(),l=this.getImagesXml();return o(e).find("photoFrame").append(i.firstChild.cloneNode(!0)),o(r).find("frameBoard").append(n.firstChild.cloneNode(!0)),o(s).find("photosLayer").append(d.firstChild.cloneNode(!0)),o(r).find("frameBoard").append(s.firstChild.cloneNode(!0)),o(e).find("photoFrame").append(r.firstChild.cloneNode(!0)),o(e).find("project").append(l.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getWallArtsIntiElementXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhotoLayer()),i=e.width,o=e.height,r='<elements><element type="PhotoElement" x="0" y="0" width="'+i+'" height="'+o+'" px="0" py="0" pw="1" ph="1" rot="0" dep="0" imageid="" imgRot="0" imgFlip="false" cropLUX="0" cropLUY="0" cropRLX="1" cropRLY="1" /></elements>';return a(3).stringToXml(r)},getPrintInitProjectXml:function(){return a(3).xmlToString(this.getPrintInitXml())},getPrintInitXml:function(){var e='<project schemaVersion="1" createAuthor="web-h5|1.0|1" clientId="web-h5" product="'+t.baseProject.product+'" productType="'+t.projectType+'" baseSize="'+t.baseProject.size+'" basePaper="'+t.baseProject.paper+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><endpointToken></endpointToken><prints></prints><images></images></project>";return a(3).stringToXml(e)},getPrintBaseProjectXml:function(){var e='<project schemaVersion="1" createAuthor="web-h5|1.0|1" clientId="web-h5" product="'+t.baseProject.product+'" productType="'+t.projectType+'" baseSize="'+t.baseProject.size+'" basePaper="'+t.baseProject.paper+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><endpointToken></endpointToken></project>";return a(3).stringToXml(e)},getPrintProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPrintBaseProjectXml()),i=this.getPrintContentXml(),r=this.getImagesXml();return o(e).find("project").append(i.firstChild.cloneNode(!0)),o(e).find("project").append(r.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getPrintContentXml:function(){var e=t.projectSettings,i=t.pages,o="";o+="<prints>";for(var r=0;r<i.length;r++){var n=i[r].canvas,s=n.params,d=e[r];o+='<print id="'+a(6).guid()+'" quantity="'+d.quantity+'" imageId="'+s[0].imageId+'">',o+='<spec version="'+a(1).getVersion()+'">',o+='<option id="paper" value="'+d.paper+'"/>',o+='<option id="size" value="'+d.size+'"/>',"undefined"!=typeof d.surfaceType&&"undefined"!==d.surfaceType&&(o+='<option id="surfaceType" value="'+d.surfaceType+'"/>'),o+="</spec>";var l=this.getPrintBaseSize({size:d.size,rotated:d.rotated}),c=this.getPrintBleed(d.size),p=i[r].canvas.borderLength?i[r].canvas.borderLength:0,h=i[r].canvas.borderColor?i[r].canvas.borderColor:"none";o+='<content id="'+a(6).guid()+'" width="'+l.width+'" height="'+l.height+'" bleedTop="'+c.top+'" bleedBottom="'+c.bottom+'" bleedLeft="'+c.left+'" bleedRight="'+c.right+'" borderLength="'+p+'" borderColor="'+h+'">',o+="<elements>";var g=s[0].x,m=s[0].y,u=s[0].width,f=s[0].height,v=g/n.oriWidth,x=m/n.oriHeight,w=f/n.oriHeight,S=u/n.oriWidth,y=s[0].rotate,I=s[0].dep,b=s[0].imageId,P=s[0].imageRotate,j=!1,C=s[0].cropPX,T=s[0].cropPY,k=s[0].cropPW,L=s[0].cropPH;"text"===s[0].elType?o+='<element type="TextElement" x="'+g+'" y="'+m+'" width="'+u+'" height="'+f+'" px="'+v+'" py="'+x+'" pw="'+S+'" ph="'+w+'" rot="'+y+'" dep="'+I+'" color="'+s[0].fontColor+'" fontSize="'+parseFloat(s[0].fontSize)/n.oriHeight+'" fontFamily="'+encodeURIComponent(s[0].fontFamily)+'" fontWeight="'+s[0].fontWeight+'" textAlign="'+s[0].textAlign+'" ><![CDATA['+encodeURIComponent(s[0].text)+"]]></element>":"logo"===s[0].elType?o+='<element type="LogoElement" x="'+g+'" y="'+m+'" width="'+u+'" height="'+f+'" px="'+v+'" py="'+x+'" pw="'+S+'" ph="'+w+'" rot="'+y+'" dep="'+I+'" imageid="'+b+'" imgRot="'+P+'" imgFlip="'+j+'" cropLUX="'+C+'" cropLUY="'+T+'" cropRLX="'+(C+k)+'" cropRLY="'+(T+L)+'" />':"image"===s[0].elType&&(o+='<element type="PhotoElement" x="'+g+'" y="'+m+'" width="'+u+'" height="'+f+'" px="'+v+'" py="'+x+'" pw="'+S+'" ph="'+w+'" rot="'+y+'" dep="'+I+'" imageid="'+b+'" imgRot="'+P+'" imgFlip="'+j+'" cropLUX="'+C+'" cropLUY="'+T+'" cropRLX="'+(C+k)+'" cropRLY="'+(T+L)+'" />'),o+="</elements>",o+="</content>",o+="</print>"}return o+="</prints>",a(3).stringToXml(o)},getRemarkProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPrintBaseProjectXml()),i=this.getRemarkContentXml(),r=this.getImagesXml();return o(e).find("project").append(i.firstChild.cloneNode(!0)),o(e).find("project").append(r.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getRemarkContentXml:function(){for(var e=t.projectSettings,i=t.pages,o=[],r=0;r<e.length;r++)t.selectedSize?t.selectedPaper?e[r].size===t.selectedSize&&e[r].paper===t.selectedPaper&&(o.push(i[r]),o[o.length-1].oid=r):e[r].size===t.selectedSize&&(o.push(i[r]),o[o.length-1].oid=r):t.selectedPaper&&e[r].paper===t.selectedPaper&&(o.push(i[r]),o[o.length-1].oid=r);if(0===o.length){o=i;for(var r=0;r<o.length;r++)o[r].oid=r}var n="";n+="<prints>";for(var r=0;r<o.length;r++){var s=o[r].canvas,d=s.params,l=e[o[r].oid];n+='<print id="'+o[r].guid+'" quantity="'+l.quantity+'" imageId="'+d[0].imageId+'">',n+='<spec version="'+a(1).getVersion()+'">',n+='<option id="paper" value="'+l.paper+'"/>',n+='<option id="size" value="'+l.size+'"/>',"undefined"!=typeof l.surfaceType&&"undefined"!==l.surfaceType&&(n+='<option id="surfaceType" value="'+l.surfaceType+'"/>'),n+="</spec>";var c=this.getPrintBaseSize({size:l.size,rotated:l.rotated}),p=this.getPrintBleed(l.size),h=i[r].canvas.borderLength?i[r].canvas.borderLength:0,g=i[r].canvas.borderColor?i[r].canvas.borderColor:"none";n+='<content id="'+s.guid+'" width="'+c.width+'" height="'+c.height+'" bleedTop="'+p.top+'" bleedBottom="'+p.bottom+'" bleedLeft="'+p.left+'" bleedRight="'+p.right+'" borderLength="'+h+'" borderColor="'+g+'">',n+="<elements>";var m=d[0].x,u=d[0].y,f=d[0].width,v=d[0].height,x=m/s.oriWidth,w=u/s.oriHeight,S=v/s.oriHeight,y=f/s.oriWidth,I=d[0].rotate,b=d[0].dep,P=d[0].imageId,j=d[0].imageRotate,C=!1,T=d[0].cropPX,k=d[0].cropPY,L=d[0].cropPW,D=d[0].cropPH;"text"===d[0].elType?n+='<element type="TextElement" x="'+m+'" y="'+u+'" width="'+f+'" height="'+v+'" px="'+x+'" py="'+w+'" pw="'+y+'" ph="'+S+'" rot="'+I+'" dep="'+b+'" color="'+d[0].fontColor+'" fontSize="'+parseFloat(d[0].fontSize)/s.oriHeight+'" fontFamily="'+encodeURIComponent(d[0].fontFamily)+'" fontWeight="'+d[0].fontWeight+'" textAlign="'+d[0].textAlign+'" ><![CDATA['+encodeURIComponent(d[0].text)+"]]></element>":"logo"===d[0].elType?n+='<element type="LogoElement" x="'+m+'" y="'+u+'" width="'+f+'" height="'+v+'" px="'+x+'" py="'+w+'" pw="'+y+'" ph="'+S+'" rot="'+I+'" dep="'+b+'" imageid="'+P+'" imgRot="'+j+'" imgFlip="'+C+'" cropLUX="'+T+'" cropLUY="'+k+'" cropRLX="'+(T+L)+'" cropRLY="'+(k+D)+'" />':"image"===d[0].elType&&(n+='<element type="PhotoElement" x="'+m+'" y="'+u+'" width="'+f+'" height="'+v+'" px="'+x+'" py="'+w+'" pw="'+y+'" ph="'+S+'" rot="'+I+'" dep="'+b+'" imageid="'+P+'" imgRot="'+j+'" imgFlip="'+C+'" cropLUX="'+T+'" cropLUY="'+k+'" cropRLX="'+(T+L)+'" cropRLY="'+(k+D)+'" />'),n+="</elements>",n+="</content>",n+="</print>"}return n+="</prints>",a(3).stringToXml(n)},getPrintBaseSize:function(e){var i,o;i=e.size?e.size:t.baseProject.size,o=!!e.rotated&&e.rotated;var r=a(1).getParameter("printsBaseSize",[{key:"product",value:"print"},{key:"size",value:i}]),n={};return o?(n.width=r.heightInInch*a(1).getDPI(),n.height=r.widthInInch*a(1).getDPI()):(n.width=r.widthInInch*a(1).getDPI(),n.height=r.heightInInch*a(1).getDPI()),n},getPrintBleed:function(e){e||(e=t.baseProject.size);var i=a(1).getParameter("bleed",[{key:"size",value:e}]),o={};return o.top=parseInt(i.left),o.bottom=parseInt(i.right),o.left=parseInt(i.top),o.right=parseInt(i.bottom),o},getCardSpread:function(e){e||(e=t.currentSelectProjectIndex);var i=(t.projectSettings[e],{}),a=this.getCardBaseSize(),o=a.width,r=a.height,n=this.getPageBleed(),s=n.top,d=n.bottom,l=n.left,c=n.right,p=o+l+c,h=r+s+d,i={};return i.width=p,i.height=h,i.bleedTop=s,i.bleedBottom=d,i.bleedLeft=l,i.bleedRight=c,i},getCardBaseSize:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],o=i.product,r=i.size,n=i.format,s=i.orientation,d=a(1).getParameter("baseSize",[{key:"product",value:o},{key:"size",value:r},{key:"orientation",value:s},{key:"format",value:n}]),l={};return l.width=d.widthInInch*a(1).getDPI(),l.height=d.heightInInch*a(1).getDPI(),
l},getCardCurrentProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getCardsBaseProjectXml()),i=this.getCardsContentXml(),r=this.getImagesXml(),n=this.getDecorationXml();return o(e).find("project").append(i.firstChild.cloneNode(!0)),o(e).find("project").append(r.firstChild.cloneNode(!0)),o(e).find("project").append(n.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getCardsBaseProjectXml:function(){t.isPortal&&(t.deletedPhoto="false");var e=t.projectSettings[t.currentSelectProjectIndex],i=(e.product,'<project schemaVersion="1" clientId="web-h5" productType="'+e.product+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><deletedPhoto>"+t.deletedPhoto+"</deletedPhoto></project>");return a(3).stringToXml(i)},getCardsContentXml:function(){for(var e=t.projectSettings.length,i='<card id="'+t.cardId+'">',o=0;o<e;o++){var r=(t.projectSettings[o],this.getOptionXml(o));i+=a(3).xmlToString(r);var n=this.getCardContentXml(o);i+=a(3).xmlToString(n);var s=this.getCardSettingXml(o);i+=a(3).xmlToString(s)}return i+="</card>",a(3).stringToXml(i)},getCardSettingXml:function(e){var i=" <cardSetting >";return i+='<styleId value="'+t.cardSetting.styleId+'"/>',i+='<festival value="'+t.cardSetting.festival+'"/>',t.templateGuid&&(i+='<templateGuid value="'+t.templateGuid+'"/>'),i+="</cardSetting>",a(3).stringToXml(i)},getCardContentXml:function(e){e||(e=t.currentSelectProjectIndex);for(var i=(t.projectSettings[e],t.pages),o=this.getPageBleed(),r="<spreads>",n=(this.getCardSpread(e),0);n<i.length;n++){var s=i[n];r+='<spread id="'+s.id+'" width="'+s.width+'" height="'+s.height+'" bleedTop="'+o.top+'" bleedBottom="'+o.bottom+'" bleedLeft="'+o.left+'" bleedRight="'+o.right+'" type="'+s.type+'" month="0" year="0" tplGuid="'+s.tplGuid+'" pageNumber="'+s.pageNumber+'" styleId="'+s.styleId+'" styleItemId="'+s.styleItemId+'" w="'+s.width+'" h="'+s.height+'">';var d=this.getCardElementsXml(n);r+=a(3).xmlToString(d),r+="</spread>"}return r+="</spreads>",a(3).stringToXml(r)},getCardElementsXml:function(e){e||(e=t.currentSelectProjectIndex);for(var i=(t.projectSettings[e],t.pages[e].canvas),o=i.params,r="<elements>",n=0;n<o.length;n++){var e=o[n].index?' index="'+o[n].index+'" ':"",s=o[n].x,d=o[n].y,l=o[n].width,c=o[n].height,p=s/i.oriWidth,h=d/i.oriHeight,g=c/i.oriHeight,m=l/i.oriWidth,u=o[n].rotate,f=o[n].dep,v=o[n].imageId,x=o[n].imageRotate,w=!1,S=o[n].cropPX,y=o[n].cropPY,I=o[n].cropPW,b=o[n].cropPH,P=o[n].decorationid,j=o[n].decorationtype,C=o[n].styleGuid,T=o[n].styleId,k=o[n].styleItemId,L=o[n].styleImageId,D=o[n].isFamilyName||"false",B=o[n].textAlign||"left",z=o[n].textVAlign||"top",F=o[n].lineSpacing||"1",R=o[n].fontColor;R="string"==typeof R&&R.indexOf("#")>-1?a(10).hexToDec(R):R;var U=["tagName","tagType","mandatory","constant","isEdit","isDisableRemind","order"],M=[];U.forEach(function(e){e in o[n]&&"undefined"!=typeof o[n][e]&&"undefined"!=o[n][e]&&M.push(" "+e+'="'+o[n][e]+'"')});var E=M.join("");"style"===o[n].elType?r+='<element type="CalendarStyleElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+m+'" ph="'+g+'" rot="'+u+'" dep="'+f+'" styleId ="'+T+'" styleItemId ="'+k+'" styleGuid ="'+C+'" imageId="'+L+'"'+e+" />":"text"===o[n].elType?r+='<element type="TextElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+m+'" ph="'+g+'" rot="'+u+'" dep="'+f+'" color="'+R+'" fontSize="'+parseFloat(o[n].fontSize)/i.oriHeight+'" fontFamily="'+encodeURIComponent(o[n].fontFamily)+'" fontWeight="'+o[n].fontWeight+'" textAlign="'+B+'" textVAlign="'+z+'" lineSpacing="'+F+'" isFamilyName="'+D+'"'+E+e+" ><![CDATA["+encodeURIComponent(o[n].text)+"]]></element>":"image"===o[n].elType?r+='<element type="PhotoElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+m+'" ph="'+g+'" rot="'+u+'" dep="'+f+'" imageid="'+v+'" imgRot="'+x+'" imgFlip="'+w+'" cropLUX="'+S+'" cropLUY="'+y+'" cropRLX="'+(S+I)+'" cropRLY="'+(y+b)+'"'+e+" />":"decoration"===o[n].elType&&(isNaN(s)||isNaN(d)||isNaN(l)||isNaN(c)||(r+='<element type="DecorationElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+m+'" ph="'+g+'" rot="'+u+'" dep="'+f+'" decorationid="'+P+'" decorationtype="'+j+'"'+e+" />"))}return r+="</elements>",a(3).stringToXml(r)},getDecorationXml:function(){for(var e="<decorations>",i=0;i<t.allDecorationList.length;i++)if(t.allDecorationList[i].count){var o=t.allDecorationList[i];e+='<decoration guid="'+o.guid+'" name="'+o.name+'" type="'+o.type+'" count="'+o.count+'" displayRatio="'+o.displayRatio+'" width="'+o.width+'" height="'+o.height+'"/>'}return e+="</decorations>",a(3).stringToXml(e)},getCardInitXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex];t.cardId=a(6).guid();var i='<project schemaVersion="1" clientId="web-h5" productType="'+e.product+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+']]></title><description/><createdDate></createdDate><updatedDate></updatedDate><deletedPhoto>false</deletedPhoto><card id="'+t.cardId+'"><spec version="1.0"><option id="size" value="'+e.size+'"/><option id="paper" value="'+e.paper+'"/><option id="product" value="'+e.product+'"/><option id="orientation" value="'+e.orientation+'"/><option id="trim" value="'+e.trim+'"/></spec>',o=this.getCardContentInitString();return i+=o,i+='<cardSetting><styleId value="'+t.styleId+'"/><festival value="'+t.festival+'"/></cardSetting></card><images></images><decorations></decorations></project>'},getCardContentInitString:function(){var e=t.projectSettings[t.currentSelectProjectIndex].product,i=this.getCardSpread(),i=a(17).getCardSpread(),o=t.projectSettings[t.selectedIdx].orientation,e=t.projectSettings[t.selectedIdx].product,r="FD"===e&&"PO"==o?i.width/2:i.width,n="FD"===e&&"LA"==o?i.height/2:i.height,s="<spreads>";return s+='<spread id="'+a(6).guid()+'" width="'+r+'" height="'+n+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="frontPage" month="0" year="0" tplGuid="null" pageNumber="0" styleId="'+t.styleId+'" styleItemId="0" w="'+r+'" h="'+n+'"><elements>'+(t.isBlankCard?"":'<element type="CalendarStyleElement" x="0" y="0" width="'+r+'" height="'+n+'" px="0" py="0" pw="1" ph="1" rot="0" dep="-999" styleId="'+t.styleId+'" styleItemId="0" styleGuid="'+t.styleGuid+'" imageId="0" />')+'</elements></spread><spread id="'+a(6).guid()+'" width="'+r+'" height="'+n+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="backPage" month="0" year="0" tplGuid="null" pageNumber="1" styleId="'+t.styleId+'" styleItemId="1" w="'+r+'" h="'+n+'"><elements>'+(t.isBlankCard?"":'<element type="CalendarStyleElement" x="0" y="0" width="'+r+'" height="'+n+'" px="0" py="0" pw="1" ph="1" rot="0" dep="-999" styleId="'+t.styleId+'" styleItemId="1" styleGuid="'+t.styleGuid+'" imageId="1" />')+"</elements></spread>","FD"===e&&(s+='<spread id="'+a(6).guid()+'" width="'+i.width+'" height="'+i.height+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="insidePage" month="0" year="0" tplGuid="null" pageNumber="2" styleId="'+t.styleId+'" styleItemId="2" w="'+i.width+'" h="'+i.height+'"><elements></elements></spread>'),s+="</spreads>"},getPadcaseBaseInfoXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=(e.product,'<project schemaVersion="2.0" createAuthor="web-h5|1.0|1" clientId="web-h5" product="'+t.product+'" productType="'+t.projectType+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><endpointToken></endpointToken><padCase></padCase></project>");return a(3).stringToXml(i)},getPadcaseInitProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPadcaseBaseInfoXml()),i=this.getOptionXml(),r=this.getFaceXml(),n=this.getPhonecasePhotoLayerXml(),s=this.getPhonecaseInitElemntsXml(),d=this.getImagesXml();return o(e).find("padCase").append(i.firstChild.cloneNode(!0)),o(e).find("padCase").append(r.firstChild.cloneNode(!0)),o(e).find("face").append(n.firstChild.cloneNode(!0)),o(e).find("photosLayer").append(s.firstChild.cloneNode(!0)),o(e).find("project").append(d.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getPadcaseCurrentProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPadcaseBaseInfoXml()),i=this.getOptionXml(),r=this.getFaceXml(),n=this.getPhonecasePhotoLayerXml(),s=this.getElementsXml(),d=this.getImagesXml();return o(e).find("padCase").append(i.firstChild.cloneNode(!0)),o(e).find("padCase").append(r.firstChild.cloneNode(!0)),o(e).find("face").append(n.firstChild.cloneNode(!0)),o(e).find("photosLayer").append(s.firstChild.cloneNode(!0)),o(e).find("project").append(d.firstChild.cloneNode(!0)),a(3).xmlToString(e)},getProjectSettings:function(e){var i={},o=a(1).getOptionIds(),r=t.projectSettings[e||t.currentSelectProjectIndex];r||(r=t.baseProject);var n=Object.keys(r).filter(function(e){return o.some(function(t){return e===t})});return n.forEach(function(e){i[e]=r[e]}),i},getParamsList:function(e){var t=this.getProjectSettings(e);return Object.keys(t).map(function(e){return{key:e,value:t[e]}})},getSizedBgBorderParams:function(e){var i=document.getElementById(e),a=t.pages[t.selectedPageIdx].canvas,o=a.foreground,r=a.oriBgWidth,n=(a.oriBgHeight,a.oriWidth),s=a.oriHeight,d=i.width/r,l=Math.floor(o.left*d),c=Math.floor(o.top*d),p=Math.floor(n*d),h=Math.floor(s*d);return{x:l,y:c,width:p,height:h}},getWallArtsCurrentProjectJson:function(){for(var e=t.projectSettings[t.currentSelectProjectIndex],i=o(t.spec.specXml).find("product-spec").attr("version"),r=a(1).getOptionIds(),n={},s=0;s<r.length;s++)n[r[s]]=e[r[s]];n.orientation=e.rotated?"Landscape":"Portrait";var d=[this.getWallartsPages()],l={project:{version:i,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,title:t.title,updatedDate:a(18).formatDateTime(new Date),createdDate:a(18).formatDateTime(new Date),guid:t.projectId,summary:{defaultSetting:n},pages:d,images:this.getImages()}};return l},getWallArtsInitProjectJson:function(){for(var e=t.projectSettings[t.currentSelectProjectIndex],i=o(t.spec.specXml).find("product-spec").attr("version"),r=a(1).getOptionIds(),n={},s=0;s<r.length;s++)n[r[s]]=e[r[s]];n.orientation="Landscape";var d=[this.getWallartsPages(!0)],l={project:{version:i,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,title:t.title,updatedDate:a(18).formatDateTime(new Date),createdDate:a(18).formatDateTime(new Date),guid:t.projectId,summary:{defaultSetting:n},pages:d,images:[]}};return l},getWallartsPages:function(e){for(var i=t.projectSettings[t.currentSelectProjectIndex],o=this.getPhotoLayer(),r=this.getBleed(),n=r.top,s=r.bottom,d=r.left,l=r.right,c=(o.x,o.y,o.width),p=o.height,h=(i.tplGuid,i.tplSuitId,this.getFrameBaseSize(),this.getFrameBorderThickness()),g=h.top,m=h.bottom,u=h.left,f=h.right,v=this.getCanvasBorderThickness(),x=v.top,w=v.bottom,S=v.left,y=v.right,I=this.getBoardInFrame(),b=I.top,P=I.bottom,j=I.left,C=I.right,T=this.getBoardInMatting(),k=T.top,L=T.bottom,D=T.left,B=T.right,z=t.bgColor+"",F=this.getMatteStyleColor(),R=this.getMatteSize(),U=R.top,M=R.bottom,E=R.left,O=R.right,H=a(1).getOptionIds(),W={},X=0;X<H.length;X++)W[H[X]]=i[H[X]];var N;return N=e?[{type:"PhotoElement",x:"0",y:"0",width:c,height:p,px:"0",py:"0",pw:"1",ph:"1",rot:"0",dep:"0",imageid:"",imgRot:"0",imgFlip:!1,cropLUX:"0",cropLUY:"0",cropRLX:"1",cropRLY:"1"}]:a(25).getElements(),i.product.indexOf("table_")>-1?{id:a(6).guid(),width:c,height:p,bgColor:"#FFFFFF",type:"Page",bleed:{top:n,bottom:s,left:d,right:l},elements:N,backend:{isPrint:!0,slice:!1},quantity:1,spec:W,frameBorder:{left:u,top:g,right:f,bottom:m},borderInFrame:{left:j,top:b,right:C,bottom:P}}:{id:a(6).guid(),width:c,height:p,bgColor:"#FFFFFF",type:"Page",bleed:{top:n,bottom:s,left:d,right:l},elements:N,backend:{isPrint:!0,slice:!1},quantity:1,spec:W,frameBorder:{left:u,top:g,right:f,bottom:m},borderInFrame:{left:j,top:b,right:C,bottom:P},boardInMatting:{left:D,top:k,right:B,bottom:L},matteLayer:{x:0,y:0,px:0,py:0,left:E,right:O,top:U,bottom:M,color:F,depth:1},canvasBorder:{left:S,top:x,right:y,bottom:w,color:z}}},getImages:function(){for(var e=[],i=0;i<t.imageList.length;i++){var a=t.imageList[i];e.push({id:a.id,guid:a.guid,encImgId:a.encImgId,order:i,name:encodeURIComponent(a.name),width:a.width,height:a.height,shotTime:a.shotTime,orientation:a.orientation})}return e},getPhonecaseCurrentProjectJson:function(){for(var e=t.projectSettings[t.currentSelectProjectIndex],i=o(t.spec.specXml).find("product-spec").attr("version"),r=a(1).getOptionIds(),n={},s=0;s<r.length;s++)n[r[s]]=e[r[s]];var d=[this.getPhoneCasePages()],l={project:{version:i,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,title:t.title,updatedDate:a(18).formatDateTime(new Date),createdDate:a(18).formatDateTime(new Date),guid:t.projectId,summary:{defaultSetting:n},pages:d,images:this.getImages()}};return l},getPhonecaseInitProjectJson:function(){for(var e=t.projectSettings[t.currentSelectProjectIndex],i=o(t.spec.specXml).find("product-spec").attr("version"),r=a(1).getOptionIds(),n={},s=0;s<r.length;s++)n[r[s]]=e[r[s]];var d=[this.getPhoneCasePages(!0)],l={project:{version:i,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,title:t.title,updatedDate:a(18).formatDateTime(new Date),createdDate:a(18).formatDateTime(new Date),guid:t.projectId,summary:{defaultSetting:n},pages:d,images:[]}};return l},getPhoneCasePages:function(e){for(var i=t.projectSettings[t.currentSelectProjectIndex],o=this.getPhonecasePhotoLayer(),r=this.getPhonecaseBleed(),n=r.top,s=r.bottom,d=r.left,l=r.right,c=(o.x,o.y,o.px,o.py,o.pw,o.ph,o.width),p=o.height,h=a(1).getOptionIds(),g={},m=0;m<h.length;m++)g[h[m]]=i[h[m]];var u;return u=e?[{type:"PhotoElement",x:"0",y:"0",width:c,height:p,px:"0",py:"0",pw:"1",ph:"1",rot:"0",dep:"0",imageid:"",imgRot:"0",imgFlip:!1,cropLUX:"0",cropLUY:"0",cropRLX:"1",cropRLY:"1"}]:a(25).getElements(),{id:a(6).guid(),width:c,height:p,bgColor:"#FFFFFF",type:"Page",bleed:{top:n,bottom:s,left:d,right:l},elements:u,backend:{isPrint:!0,slice:!1},quantity:1,spec:g}}}}).call(t,a(2),a(4))},function(e,t){e.exports={formatDate:function(e){var t=new Date(e),i=t.getFullYear(),a=String(t.getMonth()+1),o=String(t.getDate());return a.length<2&&(a="0"+a),o.length<2&&(o="0"+o),[i,a,o].join("-")},formatTime:function(e){var t=new Date(e),i=String(t.getHours()),a=String(t.getMinutes()),o=String(t.getSeconds());return i.length<2&&(i="0"+i),a.length<2&&(a="0"+a),o.length<2&&(o="0"+o),[i,a,o].join(":")},formatDateTime:function(e){return e?this.formatDate(e)+" "+this.formatTime(e):""}}},function(e,t,i){e.exports={drawImage:function(e,t,a,o,r,n,s,d,l,c,p){var h=document.getElementById(e),g=h.getContext("2d"),m=new Image;m.src=t,m.onload=function(e){n&&s?d?g.drawImage(m,d,l,c,p,a,o,n,s):g.drawImage(m,a,o,n,s):g.drawImage(m,a,o),r&&r()},m.onerror=function(){i(8)({ev:i(9).ImageLoadFail,imageUrl:t})}},createRotateElementCanvas:function(e,t){var i=document.createElement("canvas"),a=i.getContext("2d"),o=document.createElement("canvas"),r=o.getContext("2d"),n=this.getCanvasRotateSize(e,t);i.width=n.width<e.width?e.width:n.width,i.height=n.height<e.height?e.height:n.height,o.width=n.width<e.width?e.width:n.width,o.height=n.height<e.height?e.height:n.height;var s=n.width>e.width?n.width/2:e.width/2,d=n.height>e.height?n.height/2:e.height/2,l=s-e.width/2<0?0:s-e.width/2,c=d-e.height/2<0?0:d-e.height/2;return a.clearRect(0,0,i.width,i.height),r.clearRect(0,0,o.width,o.height),a.drawImage(e,l,c),r.translate(s,d),r.rotate(t*Math.PI/180),r.translate(-s,-d),r.drawImage(i,0,0),o},drawRotateCanvas:function(e){var t=e.tarCanvasId,i=e.sourceCanvasId,a=e.x,o=e.y,r=e.width,n=e.height,s=e.sx,d=e.sy,l=e.sw,c=e.sh,p=parseInt(e.rotate)||0,h=document.getElementById(t),g=h.getContext("2d"),m=document.getElementById(i);if(m){var u=(m.getContext("2d"),this.createRotateElementCanvas(m,p)),s=s||0,d=d||0,l=l||u.width,c=c||u.height,a=a||0,o=o||0,f=r||u.width,v=n||u.height;l>0&&c>0&&(a-=(u.width-m.width)/2,o-=(u.height-m.height)/2,g.drawImage(u,s,d,l,c,a,o,f,v))}},drawCanvas:function(e,t,i,a,o,r,n,s,d,l){var c=document.getElementById(e),p=c.getContext("2d"),h=document.getElementById(t);if(h){var n=(h.getContext("2d"),n||0),s=s||0,d=d||h.width,l=l||h.height,i=i||0,a=a||0,g=o||h.width,m=r||h.height;d>0&&l>0&&p.drawImage(h,n,s,d,l,i,a,g,m)}},drawText:function(e,t,i,a,o,r,n){var s=document.getElementById(e),d=s.getContext("2d");d.textBaseline="top";var l=d.fillStyle;d.fillStyle=o,d.font=r+" "+n,d.fillText(t,i,a),d.fillStyle=l},drawLine:function(e,t,i,a,o,r,n){var s=document.getElementById(e),d=s.getContext("2d"),l=d.strokeStyle;d.strokeStyle=t;var c=d.lineWidth;n?d.lineWidth=n:d.lineWidth=1,d.beginPath(),d.moveTo(i,a),d.lineTo(o,r),d.closePath(),d.stroke(),d.strokeStyle=l,d.lineWidth=c},drawDashedLine:function(e,t,i,a,o,r,n,s){var d=document.getElementById(e),l=d.getContext("2d"),c=l.strokeStyle;l.strokeStyle=t;var p=l.lineWidth;n?l.lineWidth=n:l.lineWidth=1,s||(s=5),l.beginPath();for(var h,g,m,u,f=this.getBeveling(o-i,r-a),v=Math.floor(f/s),x=0;x<v;x++)h=i+(o-i)/v*x,g=a+(r-a)/v*x,m=i+(o-i)/v*(x+1),u=a+(r-a)/v*(x+1),l[x%2==0?"moveTo":"lineTo"](i+(o-i)/v*x,a+(r-a)/v*x);v%2!=0&&l.lineTo(m,u),l.closePath(),l.stroke(),l.strokeStyle=c,l.lineWidth=p},getBeveling:function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},drawRect:function(e,t,i,a,o,r,n,s){var d=document.getElementById(e),l=d.getContext("2d");if(n){var c=l.lineWidth;s?l.lineWidth=s:l.lineWidth=1;var p=l.strokeStyle;l.strokeStyle=t,l.beginPath(),l.moveTo(i,a),l.strokeRect(i,a,o,r),l.closePath(),l.stroke(),l.strokeStyle=p,l.lineWidth=c}else{var p=l.fillStyle;l.fillStyle=t,l.beginPath(),l.moveTo(i,a),l.fillRect(i,a,o,r),l.closePath(),l.fillStyle=p}},drawCircular:function(e,t,i,a,o,r,n){var s=document.getElementById(e),d=s.getContext("2d");if(r){var l=d.lineWidth;n?d.lineWidth=n:d.lineWidth=1;var c=d.strokeStyle;d.strokeStyle=t,d.moveTo(i,a),d.beginPath(),d.arc(i,a,o,0,2*Math.PI),d.closePath(),d.stroke(),d.strokeStyle=c,d.lineWidth=l}else{var c=d.fillStyle;d.fillStyle=t,d.moveTo(i,a),d.beginPath(),d.arc(i,a,o,0,2*Math.PI),d.closePath(),d.fill(),d.fillStyle=c}},clear:function(e,t,i,a,o){var r=document.getElementById(e),n=r.getContext("2d"),t=t||0,i=i||0,a=a||r.width,o=o||r.height;n.clearRect(t,i,a,o)},getImageData:function(e,t,i,a,o){var r=document.getElementById(e),n=r.getContext("2d");return t=t||0,i=i||0,a=a||r.width,o=o||r.height,n.getImageData(t,i,a,o)},fillImageData:function(e,t,i,a,o,r){var n=document.getElementById(e),s=n.getContext("2d"),o=o||n.width,r=r||n.height,i=i||0,a=a||0;s.putImageData(t,i,a,0,0,o,r)},createImageData:function(e,t,i){var a=document.getElementById(e),o=a.getContext("2d"),t=t||a.width,i=i||a.height;return o.createImageData(t,i)},getClient:function(e){var t=document.getElementById(e);return{width:t.width,height:t.height,context:t.getContext("2d")}},imageDataVRevert:function(e,t){for(var i=0,a=e.height;i<a;i++)for(j=0,w=e.width;j<w;j++)t.data[i*w*4+4*j+0]=e.data[(a-i)*w*4+4*j+0],t.data[i*w*4+4*j+1]=e.data[(a-i)*w*4+4*j+1],t.data[i*w*4+4*j+2]=e.data[(a-i)*w*4+4*j+2],t.data[i*w*4+4*j+3]=e.data[(a-i)*w*4+4*j+3];return t},imageDataHRevert:function(e,t){for(var i=0,a=e.height;i<a;i++)for(j=0,w=e.width;j<w;j++)t.data[i*w*4+4*j+0]=e.data[i*w*4+4*(w-j)+0],t.data[i*w*4+4*j+1]=e.data[i*w*4+4*(w-j)+1],t.data[i*w*4+4*j+2]=e.data[i*w*4+4*(w-j)+2],t.data[i*w*4+4*j+3]=e.data[i*w*4+4*(w-j)+3];return t},canvasToBase64:function(e){var t=document.getElementById(e);return t.toDataURL("image/jpeg")},wrapBorder:function(e,t,i){var a=document.getElementById(e),o=document.createElement("canvas"),r=o.getContext("2d"),n=a.width,s=a.height,i=i||.5,t=t||"right",d={top:[1,0,-i,i,0,s/2],right:[-i,i,0,1,n/2,-n/2]};return console.log(n,s),n>s?(o.width=n+s/2,o.height=s):(o.width=n,o.height=s+n/2),CanvasRenderingContext2D.prototype.transform.apply(r,d[t]),n>s?r.drawImage(a,s/2,0):r.drawImage(a,0,n/2),r.getImageData(0,0,o.width,o.height)},setSize:function(e,t){var i=document.getElementById(e);t.width&&(i.width=t.width),t.height&&(i.height=t.height)},fillEmptyDataWithColor:function(e,t,i,a){for(var o=0;o<e.width*e.height;o++)0===e.data[4*o+3]&&(e.data[4*o]=t.r,e.data[4*o+1]=t.g,e.data[4*o+2]=t.b,e.data[4*o+3]=255);return e},replaceColor:function(e,t,i,a,o,r,n){var t=~~(t||0),i=~~(i||0),o=t+o||e.width,r=i+r||e.height;if(t<0||i<0||o>e.width||r>e.height)throw new Error("error params!");for(var s=i;s<r;s++)for(var d=t;d<o;d++){var l=s*e.width+d,c=e.data[4*l],p=e.data[4*l+1],h=e.data[4*l+2];c==a.r&&p==a.g&&h==a.b&&(n?(e.data[4*l]=n.r,e.data[4*l+1]=n.g,e.data[4*l+2]=n.b,e.data[4*l+3]=255):e.data[4*l+3]=0)}return e},resizeImage:function(e,t,i){var a=document.getElementById(e),o=(a.getContext("2d"),document.createElement("canvas")),r=o.getContext("2d"),t=t||a.width,i=i||a.height;if(t!==a.width||i!==a.height){var n;t>i?(n=a.width/t,i=a.height/n):t===i&&a.width>a.height?(n=a.width/t,i=a.height/n):(n=a.height/i,t=a.width/n)}return o.width=t,o.height=i,r.drawImage(a,0,0,t,i),o.toDataURL("image/png")},getCanvasRotateSize:function(e,t){var i=this.getCanvasRotatePoint(e,t),a=0,o=0;return i.forEach(function(e){a=e.x>a?e.x:a,o=e.y>o?e.y:o}),{width:2*a,height:2*o}},getCanvasRotatePoint:function(e,t){for(var i=Math.sqrt(e.width*e.width+e.height*e.height)/2,a=1,o=1,r=0,n=[],s=0;s<4;s++){switch(s){case 0:a=-1,o=1,r=360;break;case 1:a=1,o=1,r=0;break;case 2:a=1,o=-1,r=180;break;case 3:a=-1,o=-1,r=180}var d={x:e.width/2*a,y:e.height/2*o},l=Math.atan(d.y/d.x)/Math.PI*180+r,c=(l+t)/180*Math.PI;n.push({x:Math.cos(c)*i,y:Math.sin(c)*i})}return n},drawBorderRadius:function(e,t,i){var a=document.getElementById(e),o=a.getContext("2d"),r=a.width||0,n=a.height||0;o.fillStyle=i||"#fff",o.beginPath(),o.moveTo(0,0),o.lineTo(t,0),o.arcTo(0,0,0,t,t),o.lineTo(0,0),o.fill(),o.closePath(),o.beginPath(),o.moveTo(r,0),o.lineTo(r-t,0),o.arcTo(r,0,r,t,t),o.lineTo(r,0),o.fill(),o.closePath(),o.beginPath(),o.moveTo(0,n),o.lineTo(0,n-t),o.arcTo(0,n,t,n,t),o.lineTo(0,n),o.fill(),o.closePath(),o.fillStyle=i||"black",o.beginPath(),o.moveTo(r,n),o.lineTo(r-t,n),o.arcTo(r,n,r,n-t,t),o.lineTo(r,n),o.fill(),o.closePath(),o.fillStyle=i||"rgba(0,0,0,0.6)",o.beginPath(),o.moveTo(r-t,0),o.arcTo(r,0,r,t,t),o.lineTo(r,t/3),o.lineTo(r-t,0),o.fill(),o.closePath()},resizeImageWithShadow:function(e,t,i,a){var o=document.getElementById(e),r=(o.getContext("2d"),document.createElement("canvas")),n=r.getContext("2d"),t=o.width,i=o.height,s=t+20,d=i+20;return r.width=s,r.height=d,n.fillStyle="white",n.fillRect(0,0,s,d),n.shadowBlur=1,n.shadowOffsetX=3,n.shadowOffsetY=2,n.fillStyle="black",n.shadowColor="rgba(0,0,0,0.8)",n.beginPath(),n.moveTo(10+a,d-10),n.arcTo(10,d-10,10,d-10-a,a),n.lineTo(10+a,10),n.arcTo(s-10,10,s-10,10+a/2,a),n.lineTo(s-10,d-10-a),n.arcTo(s-10,d-10,s-10-a,d-10,a),n.lineTo(10+a/1.5,d-10),n.fill(),n.closePath(),n.shadowBlur=0,n.shadowColor="transparents",n.shadowOffsetX=0,n.shadowOffsetY=0,n.drawImage(o,10,10,t,i),r.toDataURL("image/png")},replaceColorOutOfArea:function(e,t,i,a,o,r,n,s,d){var t=~~(t||0),i=~~(i||0),o=t+o||e.width,r=i+r||e.height,l=e.width,c=e.height;if(t<0||i<0||o>e.width||r>e.height)throw new Error("error params!");for(var p=0;p<c;p++)for(var h=0;h<l;h++){var g=!0,m=!0;switch(d){case"Round":var u=(o+t)/2,f=(r+i)/2,v=(o-t)/2;g=m=Math.sqrt(Math.pow(h-u,2)+Math.pow(p-f,2))<v;break;case"Square":default:g=h>=t&&h<o,m=p>=i&&p<r}var x=p*e.width+h,w=e.data[4*x],S=e.data[4*x+1],y=e.data[4*x+2],I=e.data[4*x+3];if(s&&255!==I&&(e.data[4*x+3]=255),g&&m)s&&255!==I&&(e.data[4*x]=s.r,e.data[4*x+1]=s.g,e.data[4*x+2]=s.b,e.data[4*x+3]=255);else{var b=w>a.r-10&&w<a.r+10,P=S>a.g-10&&S<a.g+10,j=y>a.b-10&&y<a.b+10;b&&P&&j&&(n?(e.data[4*x]=n.r,e.data[4*x+1]=n.g,e.data[4*x+2]=n.b,e.data[4*x+3]=255):e.data[4*x+3]=0)}}return e}}},function(e,t){e.exports=function(){return{projectId:"",userId:"",albumId:"",token:"",uploadTimestamp:"",title:"test-tshirt",projectXml:"",ordered:"",tplGuid:"",price:0}}},,function(e,t,i){(function(t){var a=i(14);e.exports={createImage:function(e){e&&this.addImageInParams(e)},editImage:function(e,t){e&&void 0!=t&&null!=t&&this.changeImageInParams(e,t)},deleteImage:function(e){void 0!=e&&null!=e&&(this.removeImageFromParams(e),t.vm.$broadcast("notifyRefreshScreenshot"))},addImageInParams:function(e){var i=t.pages[t.selectedPageIdx].canvas,a=i.params.length;i.params.push(e),this.createImageElement(a)},changeImageInParams:function(e,i){var a=t.pages[t.selectedPageIdx].canvas;a.params.splice(i,1,e),this.editImageElement(i)},removeImageFromParams:function(e){var i=t.pages[t.selectedPageIdx].canvas;a.freshDepth(e),i.params.splice(e,1),this.deleteImageElement(e)},createImageElement:function(e){a.createElement(e),a.spineLinesToTop()},editImageElement:function(e){a.editElement(e),a.spineLinesToTop()},deleteImageElement:function(e){a.deleteElement(e),a.spineLinesToTop()}}}).call(t,i(2))},function(e,t,i){(function(t){var a=i(10),o=i(14);e.exports={createText:function(e){var i=this;if(e){var o=Math.round(a.getTextViewFontSize(e.fontSize));if(o>0){var r=new Image;if(""===e.text?r.src=t.domains.proxyFontBaseUrl+"/product/text/textImage?text="+encodeURIComponent("Enter text here")+"&font="+encodeURIComponent(e.fontFamily)+"&fontSize="+o+"&color="+e.fontColor+"&align=left":r.src=t.domains.proxyFontBaseUrl+"/product/text/textImage?text="+encodeURIComponent(e.text)+"&font="+encodeURIComponent(e.fontFamily)+"&fontSize="+o+"&color="+e.fontColor+"&align=left",r.complete)return void i.addTextInParams(e,r.width,r.height);r.onload=function(){i.addTextInParams(e,r.width,r.height)}}else i.addTextInParams(e,1,1)}},editText:function(e,i){var o=this;if(e&&void 0!=i&&null!=i){var r=(t.pages[t.selectedPageIdx].canvas,Math.round(a.getTextViewFontSize(e.fontSize)));if(r>0){var n=new Image;if(""===e.text?n.src=t.domains.proxyFontBaseUrl+"/product/text/textImage?text="+encodeURIComponent("Enter text here")+"&font="+encodeURIComponent(e.fontFamily)+"&fontSize="+r+"&color="+e.fontColor+"&align=left":n.src=t.domains.proxyFontBaseUrl+"/product/text/textImage?text="+encodeURIComponent(e.text)+"&font="+encodeURIComponent(e.fontFamily)+"&fontSize="+r+"&color="+e.fontColor+"&align=left",n.complete)return void o.changeTextInParams(e,n.width,n.height,i);n.onload=function(){o.changeTextInParams(e,n.width,n.height,i)}}else o.changeTextInParams(e,1,1,i)}},deleteText:function(e){void 0!=e&&null!=e&&(this.removeTextFromParams(e),t.vm.$broadcast("notifyRefreshScreenshot"))},addTextInParams:function(e,i,a){var o=t.pages[t.selectedPageIdx].canvas,r=o.params.length;e.width=i/o.ratio,e.height=a/o.ratio,e.dep=r,o.params.push(e),this.createTextElement(r)},changeTextInParams:function(e,i,a,o){var r=t.pages[t.selectedPageIdx].canvas;e.width=i/r.ratio,e.height=a/r.ratio,r.params.splice(o,1,e),this.editTextElement(o)},removeTextFromParams:function(e){var i=t.pages[t.selectedPageIdx].canvas;o.freshDepth(e),i.params.splice(e,1),this.deleteTextElement(e)},createTextElement:function(e){var t=this;o.createElement(e,t),o.spineLinesToTop()},editTextElement:function(e){var t=this;o.editElement(e,t),o.spineLinesToTop()},deleteTextElement:function(e){var t=this;o.deleteElement(e,t),o.spineLinesToTop()}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={events:{dispatchRotate:function(){},dispatchDragEnd:function(){this.elementData.x*this.ratio<-this.elementData.width*this.ratio&&(this.elementData.x=0,this.elementData.y*this.ratio<-this.elementData.height*this.ratio*.8&&(this.elementData.y=0)),this.elementData.y*this.ratio<-this.elementData.height*this.ratio&&(this.elementData.y=0,this.elementData.x*this.ratio<-this.elementData.width*this.ratio*.8&&(this.elementData.x=0));var e=t.pages[t.selectedPageIdx].canvas;this.elementData.x*this.ratio>e.width&&(this.elementData.x=e.width/this.ratio-this.elementData.width,this.elementData.y*this.ratio>.8*e.height&&(this.elementData.y=e.height/this.ratio-this.elementData.height)),this.elementData.y*this.ratio>e.height&&(this.elementData.y=e.height/this.ratio-this.elementData.height,this.elementData.x*this.ratio>.8*e.width&&(this.elementData.x=e.width/this.ratio-this.elementData.width))},dispatchScaleEnd:function(){this.elementData.x*this.ratio<-this.elementData.width*this.ratio&&(this.elementData.x=0,this.elementData.y*this.ratio<-this.elementData.height*this.ratio*.8&&(this.elementData.y=0)),this.elementData.y*this.ratio<-this.elementData.height*this.ratio&&(this.elementData.y=0,this.elementData.x*this.ratio<-this.elementData.width*this.ratio*.8&&(this.elementData.x=0));var e=t.pages[t.selectedPageIdx].canvas;this.elementData.x*this.ratio>e.width&&(this.elementData.x=e.width/this.ratio-this.elementData.width,this.elementData.y*this.ratio>.8*e.height&&(this.elementData.y=e.height/this.ratio-this.elementData.height)),this.elementData.y*this.ratio>e.height&&(this.elementData.y=e.height/this.ratio-this.elementData.height,this.elementData.x*this.ratio>.8*e.width&&(this.elementData.x=e.width/this.ratio-this.elementData.width))},dispatchMove:function(e){this.elementData.x+=e.x/this.ratio,this.elementData.y+=e.y/this.ratio},dispatchCornerClick:function(){this.setIndex(),t.isEditLayerShow=!1},dispatchSideClick:function(){this.setIndex(),t.isEditLayerShow=!1}}}}).call(t,i(2))},function(e,t,i){(function(t,a){var o=i(18);e.exports={initProjectJson:function(){for(var e=i(1).getOptionIds(),r=t.projectSettings[t.currentSelectProjectIndex],n=a(t.spec.specXml).find("product-spec").attr("version"),s={},d=0;d<e.length;d++)s[e[d]]=r[e[d]];var l=[this.initPage()];return{project:{guid:"",version:n,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:o.formatDateTime(new Date),updatedDate:o.formatDateTime(new Date),summary:{},spec:s,pages:l,images:[]}}},initNewPrintProjectJson:function(){for(var e=i(1).getOptionIds(),r=t.projectSettings[t.currentSelectProjectIndex],n=a(t.spec.specXml).find("product-spec").attr("version"),s={},d=[],l=0;l<e.length;l++)s[e[l]]=r[e[l]];return{project:{version:n,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:o.formatDateTime(new Date),updatedDate:o.formatDateTime(new Date),summary:{defaultSetting:s},pages:d,images:[]}}},getCurrentProjectJson:function(){for(var e=i(1).getOptionIds(),r=t.projectSettings[t.currentSelectProjectIndex],n=a(t.spec.specXml).find("product-spec").attr("version"),s={},d=0;d<e.length;d++)s[e[d]]=r[e[d]];var l=this.getPages(),c=this.getImages();return{project:{guid:t.projectId,version:n,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:t.createdDate,updatedDate:o.formatDateTime(new Date),summary:{},spec:s,pages:l,images:c}}},getSkuJson:function(){for(var e=t.userSettings,o=i(1).getOptionIds(),r=a(t.spec.specXml).find("product-spec").attr("version"),n=t.projectSettings[t.currentSelectProjectIndex],s={project:{version:r,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:e.userId,artisan:e.userName}},d=0;d<o.length;d++)s.project[o[d]]=n[o[d]];return s},getBaseSize:function(e){var a="undefined"!=typeof e?e:t.currentSelectProjectIndex,o=t.projectSettings[a],r=i(1).getOptionIds(),n=[];r.forEach(function(e){n.push({key:e,value:o[e]})});var s=i(1).getParameter("baseSizeInInch",n);
return{width:s.width*i(1).getDPI(),height:s.height*i(1).getDPI()}},getBleedSize:function(e){var a="undefined"!=typeof e?e:t.currentSelectProjectIndex,o=t.projectSettings[a],r=i(1).getDPI(),n=o.size,s=o.product,d=i(1).getParameter("bleedInInch",[{key:"product",value:s},{key:"size",value:n}]);return{top:d.top*r,right:d.right*r,bottom:d.bottom*r,left:d.left*r}},getLMCBaseSize:function(e){var a="undefined"!=typeof e?e:t.currentSelectProjectIndex,o=t.projectSettings[a],r=o.size,n=o.product,s=o.frameStyle,d=o.orientation,l=i(1).getParameter("frameBaseSize",[{key:"product",value:n},{key:"frameStyle",value:s},{key:"size",value:r},{key:"orientation",value:d}]);return{width:parseFloat(l.widthInInch)*i(1).getDPI(),height:parseFloat(l.heightInInch)*i(1).getDPI()}},getLMCBleedSize:function(e){var a="undefined"!=typeof e?e:t.currentSelectProjectIndex,o=t.projectSettings[a],r=o.size,n=o.product,s=i(1).getParameter("bleed",[{key:"product",value:n},{key:"size",value:r}]);return{top:parseFloat(s.top),right:parseFloat(s.right),bottom:parseFloat(s.bottom),left:parseFloat(s.left)}},getLMCCanvasBorder:function(e){var a="undefined"!=typeof e?e:t.currentSelectProjectIndex,o=t.projectSettings[a],r=o.size,n=o.product,r=o.size,s=o.canvasBorderSize,d=i(1).getParameter("canvasBorderThickness",[{key:"product",value:n},{key:"size",value:r},{key:"canvasBorderSize",value:s}]);return{top:parseFloat(d.top),right:parseFloat(d.right),bottom:parseFloat(d.bottom),left:parseFloat(d.left)}},getCanvasBorder:function(){return{top:0,right:0,bottom:0,left:0}},getLMCPhotoLayer:function(e){var i="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=t.projectSettings[i],o=(a.orientation,{}),r=this.getLMCBaseSize(i),n=this.getLMCCanvasBorder(i),s=n.top,d=n.bottom,l=n.left,c=n.right,p=this.getLMCBleedSize(i),h=p.top,g=p.bottom,m=p.left,u=p.right,f=r.width+l+c,v=r.height+s+d,x=0,w=0,S=0,y=0;"Portrait"===a.orientation?(x=-g,w=-m,S=f+h+g,y=v+m+u):(x=-m,w=-h,S=f+m+u,y=v+h+g);var I=x/S,b=w/y,P=S/S,j=y/y;return o.x=x,o.y=w,o.width=S,o.height=y,o.px=I,o.py=b,o.pw=P,o.ph=j,o},getLMCDefaultElement:function(e){var a="undefined"!=typeof e?e:t.currentSelectProjectIndex,r=this.getLMCPhotoLayer(a),n=this.getLMCCanvasBorder(a),s=this.getLMCBleedSize(a),d=s.left+n.left,l=s.top+n.top,c=r.width-n.left-n.right-s.left-s.right,p=r.height-n.top-n.bottom-s.top-s.bottom;return{id:i(6).guid(),type:"PhotoElement",elType:"image",x:d,y:l,width:c,height:p,px:d/r.width,py:l/r.height,pw:c/r.width,ph:p/r.height,imgFlip:!1,rot:0,imgRot:0,encImgId:"",imageid:"",dep:0,cropLUX:0,cropLUY:0,cropRLX:1,cropRLY:1,lastModified:o.formatDateTime(new Date)}},getDefaultElement:function(e,t){return{id:i(6).guid(),type:"PhotoElement",elType:"image",x:0,y:0,width:e,height:t,px:0,py:0,pw:1,ph:1,imgFlip:!1,rot:0,imgRot:0,encImgId:"",imageid:"",dep:0,cropLUX:0,cropLUY:0,cropRLX:1,cropRLY:1,lastModified:o.formatDateTime(new Date)}},initPage:function(){var e=this.getBaseSize(),t=this.getBleedSize(),a=e.width+t.left+t.right,o=e.height+t.top+t.right,r=[this.getDefaultElement(a,o)];return{id:i(6).guid(),width:a,height:o,type:"Page",bleed:t,elements:r,backend:{isPrint:!0}}},getPhotoLayer:function(e){var i="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=t.projectSettings[i],o=(a.orientation,this.getBaseSize(i)),r=this.getBleedSize(),n=(o.width+r.left+r.right,o.height+r.top+r.right,0),s=0,d=0,l=0;return"Portrait"===a.orientation?(n=-r.bottom,s=-r.left,d=o.width+r.left+r.right,l=o.height+r.top+r.right):(n=-r.left,s=-r.top,d=o.width+r.left+r.right,l=o.height+r.top+r.right),{x:n,y:s,width:d,height:l,px:n/o.width,py:s/o.height,pw:d/o.width,ph:l/o.height}},getPages:function(){for(var e=[],i=this.getBleedSize(),a=this.getPhotoLayer(),o=a.width,r=a.height,n=(this.getElements(),0);n<t.pages.length;n++)e.push({width:o,height:r,type:"Page",bleed:i,elements:this.getElements(n),backend:{isPrint:!0}});return e},getImages:function(){for(var e=[],i=0;i<t.imageList.length;i++){var a=t.imageList[i];e.push({id:a.id,guid:a.guid,encImgId:a.encImgId,order:i,name:encodeURIComponent(a.name),width:a.width,height:a.height,shotTime:a.shotTime,orientation:a.orientation})}return e},getElements:function(e){for(var i="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=(t.projectSettings[i],t.pages[i].canvas),o=a.params,r=[],n=0;n<o.length;n++){var s=o[n],d={x:s.x,y:s.y,px:s.x/a.oriWidth,py:s.y/a.oriHeight,width:s.width,height:s.height,pw:s.width/a.oriWidth,ph:s.height/a.oriHeight,dep:s.dep,rot:s.rotate};switch(s.elType){case"text":d.type="TextElement",d.color=s.fontColor,d.text=encodeURIComponent(s.text),d.fontWeight=s.fontWeight,d.textAlign=s.textAlign,d.fontFamily=encodeURIComponent(s.fontFamily),d.fontSize=parseFloat(s.fontSize)/a.oriHeight;break;case"image":var l=s.encImgId;l||t.imageList.some(function(e){if(e.id==s.imageId)return l=e.encImgId,!0}),d.type="PhotoElement",d.imageid=s.imageId,d.encImgId=l,d.imgRot=s.imageRotate,d.imgFlip=!1,d.cropLUX=parseFloat(s.cropPX).toString(),d.cropLUY=parseFloat(s.cropPY).toString(),d.cropRLX=(parseFloat(s.cropPX)+parseFloat(s.cropPW)).toString(),d.cropRLY=(parseFloat(s.cropPY)+parseFloat(s.cropPH)).toString(),d.style={brightness:s.style&&s.style.brightness?s.style.brightness:0,effectId:0,opacity:100},d.border={size:0,color:"#000000",opacity:100}}r.push(d)}return r},getPrintBaseSize:function(e){var t=!1,a=i(17).getParamsList();e.size&&(a=a.map(function(t){return"size"===t.key&&(t.value=e.size),t})),e.rotated&&(t=e.rotated);var o=i(1).getParameter("baseSizeInInch",a),r={};return t?(r.width=o.heightInInch*i(1).getDPI(),r.height=o.widthInInch*i(1).getDPI()):(r.width=o.widthInInch*i(1).getDPI(),r.height=o.heightInInch*i(1).getDPI()),r},getPrintBleed:function(e){var a=!1,o=i(1).getDPI(),r=i(17).getParamsList();r=r.map(function(i){return"size"===i.key&&(e&&e.size?i.value=e.size:i.value=t.baseProject.size),i}),e.rotated&&(a=e.rotated);var n=i(1).getParameter("bleedInInch",r),s={};return s.top=parseInt(n.top*o),s.bottom=parseInt(n.bottom*o),s.left=parseInt(n.left*o),s.right=parseInt(n.right*o),a&&(s.top=parseInt(n.left*o),s.bottom=parseInt(n.right*o),s.left=parseInt(n.top*o),s.right=parseInt(n.bottom*o)),s},getPrintCornerRadius:function(e){var a=i(1).getDPI(),o=i(17).getParamsList();o=o.map(function(i){return"size"===i.key&&(e&&e.size?i.value=e.size:i.value=t.baseProject.size),i});var r=i(1).getParameter("cornerRadiusInInch",o).value;return r=(r-0)*a},getNewPrintCurrentProjectJson:function(){for(var e=i(1).getOptionIds(),r=(t.projectSettings[t.currentSelectProjectIndex],a(t.spec.specXml).find("product-spec").attr("version")),n={},s=0;s<e.length;s++)n[e[s]]=t.baseProject[e[s]];var d=this.getNewPrintPages(),l=this.getImages();return{project:{guid:t.projectId,version:r,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:t.createdDate,updatedDate:o.formatDateTime(new Date),summary:{defaultSetting:n},pages:d,images:l}}},getNewPrintPages:function(){for(var e=[],a=t.projectSettings,o=t.pages,r=i(1).getOptionIds(),n=0;n<o.length;n++){for(var s=o[n].canvas,d=this.getNewPrinteElements(s,s.params),l=a[n],c=o[n].guid||i(6).guid(),p=l.quantity,h=(i(1).getVersion(),{}),g="Print",m=0;m<r.length;m++)h[r[m]]=l[r[m]];h.quantity=p;var u=this.getPrintBaseSize({size:l.size,rotated:l.rotated}),f=this.getPrintBleed({size:l.size,rotated:l.rotated}),v=o[n].canvas.borderLength?o[n].canvas.borderLength:0,x=o[n].canvas.borderColor?o[n].canvas.borderColor:"none";e.push({id:c,spec:h,width:u.width+f.left+f.right,height:u.height+f.top+f.bottom,type:g,bleed:f,border:{color:x,size:v},elements:d,backend:{isPrint:!0}})}return e},getNewPrinteElements:function(e,a){var o=a.map(function(a){var o=a.guid||i(6).guid(),r=a.x,n=a.y,s=a.width,d=a.height,l=r/e.oriWidth,c=n/e.oriHeight,p=d/e.oriHeight,h=s/e.oriWidth,g=a.rotate,m=a.dep,u=a.imageId,f=a.imageRotate,v=!1,x=a.cropPX,w=a.cropPY,S=a.cropPW,y=a.cropPH,I=a.style&&a.style.brightness?a.style.brightness:0,b=t.imageList.filter(function(e){return e.id===a.imageId}),P={id:o,x:r,y:n,width:s,height:d,px:l,py:c,pw:h,ph:p,rot:g,dep:m};return"text"===a.elType?(P.type="TextElement",P.color=a.fontColor,P.fontSize=parseFloat(a.fontSize)/e.oriHeight,P.fontFamily=encodeURIComponent(a.fontFamily),P.fontWeight=a.fontWeight,P.textAlign=a.textAlign,P.text=encodeURIComponent(a.text)):"logo"===a.elType?P.type="LogoElement":"image"===a.elType&&(P.type="PhotoElement",P.imageid=u,P.imgFlip=v,P.imgRot=f,P.encImgId=b.length?b[0].encImgId:"",P.cropLUX=x,P.cropLUY=w,P.cropRLX=x+S,P.cropRLY=w+y,P.style={brightness:I,effectId:0,opacity:100},P.border={size:0,color:"#000000",opacity:100}),P});return o},getNewPrintSkuJson:function(e){var t=e.project.pages,a=e.project.version,o=e.project.clientId,r=e.project.createAuthor,n=e.project.userId,s=e.project.artisan,d={},l=e.project.summary.defaultSetting,c=!!l&&"LPP"===l.product,p=!!l&&"LSC"===l.product,h=i(1).getOptionIds();return 0===t.length&&(l.id="defaultSetting",l.version=a,l.clientId=o,l.createAuthor=r,l.userId=n,l.artisan=s,l.quantity=1,d={defaultSetting:l}),t.forEach(function(e){if(!((c||p)&&Object.keys(d).length>0)){d[e.id]={id:e.id,version:a,clientId:o,createAuthor:r,userId:n,artisan:s,quantity:e.spec?e.spec.quantity:1};for(var t=0;t<h.length;t++)d[e.id][h[t]]=e.spec[h[t]]}}),d},getNewPrintRemarkPages:function(){for(var e=t.projectSettings,a=t.pages,o=[],r=[],n=i(1).getOptionIds(),s=0;s<e.length;s++)t.selectedSize?t.selectedPaper?e[s].size===t.selectedSize&&e[s].paper===t.selectedPaper&&(o.push(a[s]),o[o.length-1].oid=s):e[s].size===t.selectedSize&&(o.push(a[s]),o[o.length-1].oid=s):t.selectedPaper&&e[s].paper===t.selectedPaper&&(o.push(a[s]),o[o.length-1].oid=s);if(0===o.length){o=a;for(var s=0;s<o.length;s++)o[s].oid=s}for(var s=0;s<o.length;s++){for(var d=o[s].canvas,l=this.getNewPrinteElements(d,d.params),c=e[o[s].oid],p=o[s].guid||i(6).guid(),h=c.quantity,g=(i(1).getVersion(),{}),m="Print",u=0;u<n.length;u++)g[n[u]]=c[n[u]];g.quantity=h;var f=this.getPrintBaseSize({size:c.size,rotated:c.rotated}),v=this.getPrintBleed({size:c.size}),x=o[s].canvas.borderLength?o[s].canvas.borderLength:0,w=o[s].canvas.borderColor?o[s].canvas.borderColor:"none";h&&r.push({id:p,spec:g,width:f.width,height:f.height,type:m,quantity:h,bleed:v,border:{color:w,size:x},elements:l,backend:{isPrint:!0}})}return r},getNewPrintRemarkProject:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getNewPrintCurrentProjectJson()),i=this.getNewPrintRemarkPages(),a=this.getImages();return e.project.pages=i,e.project.images=a,e},getWallartsSkuJson:function(e){var t=e.project.pages,a=e.project.version,o=e.project.clientId,r=e.project.createAuthor,n=e.project.userId,s=e.project.artisan,d={},l=e.project.summary.defaultSetting;!!l&&"LPP"===l.product,!!l&&"LSC"===l.product,i(1).getOptionIds();return l.id=t[0].id,l.version=a,l.clientId=o,l.createAuthor=r,l.userId=n,l.artisan=s,l.quantity=1,d[t[0].id]=l,d}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){e.exports={getUserInfo:function(){t.ajax({url:a.domains.baseUrl+"/BigPhotoBookServlet/getSessionUserInfo?webClientId="+a.webClientId+"&autoRandomNum="+i(10).getRandomNum(),type:"get",dataType:"xml",async:!1}).done(function(e){a.userSettings.userId=t(e).find("user").attr("id"),a.userSettings.uploadTimestamp=t(e).find("user").find("timestamp").text(),a.userSettings.token=t(e).find("user").find("authToken").text(),a.userSettings.userName=t(e).find("user").find("firstName").text(),a.userSettings.email=t(e).find("user").find("email").text()})},keepAlive:function(){t.ajax({url:a.domains.baseUrl+"/userid/"+a.userSettings.userId+"/heartbeat",type:"get",dataType:"xml"}).done(function(e){})}}}).call(t,i(4),i(2))},function(e,t){e.exports={getDefaultCrop:function(e,t,i,a){if(e&&t&&i&&a){var o,r,n,s,d=e/t,l=i/a;if(d>l){var c=t,p=c*l,h=(e-p)/2;o=h/e,r=0,n=p/e,s=1}else{var p=e,c=p/l,h=(t-c)/2;o=0,r=h/t,n=1,s=c/t}return{px:Math.abs(o.toFixed(8)),py:Math.abs(r.toFixed(8)),pw:Math.abs(n.toFixed(8)),ph:Math.abs(s.toFixed(8))}}return{px:0,py:0,pw:1,ph:1}},getConformCrop:function(e,t,i,a,o,r,n,s,d,l){var c,p,h=i*e,g=a*t,m=o*e,u=r*t,f=d*m/n,v=l*u/s;f-m<v-u?(c=m,p=c/f*v):(p=u,c=p/v*f),f=c,v=p;var x=(f-m)/2,w=(v-u)/2,S=h-x,y=g-w,I=S+f,b=y+v;return S<0&&(S=0),y<0&&(y=0),I>e&&(S=e-f),b>t&&(y=t-v),(f>e||v>t)&&(f-m>v-u?(c=m,p=c/f*v):(p=u,c=p/v*f),f=c,v=p,x=(f-m)/2,w=(v-u)/2,S=h-x,y=g-w),{px:S/e,py:y/t,pw:f/e,ph:v/t}},getRotatedAngle:function(e,t){return void 0!=e&&null!=e?(t=isNaN(parseFloat(t))?90:parseFloat(t),e+=t,e>180?e-=360:e,e<-90?e+=360:e,e):0},stecheTo:function(e,t,i,a,o){o="meet";var r=e/t,n=i/a,s=1;return s=r>n?"slice"===o?a/t:i/e:"slice"===o?i/e:a/t,{width:e*s,height:t*s}}}},,,function(e,t,i){(function(t){var a=i(19);e.exports={convertScreenshotToBase64:function(){return a.resizeImage("screenshot",t.screenshotSize.width,t.screenshotSize.height)}}}).call(t,i(2))},function(e,t,i){(function(t){i(10),i(16),i(5),i(15);e.exports={createElement:function(e){this.initElement(e)},editElement:function(e){this.deleteElement(e),this.initElement(e)},deleteElement:function(e){var i=t.pages[t.selectedPageIdx].canvas;i.warns[e]&&(i.warns[e].el&&i.warns[e].el.remove(),i.warns[e].el="")},initElement:function(e){var a=t.pages[t.selectedPageIdx].canvas,o="../../static/img/warn_big_icon.png",r=i(5).getParamsValueByElement(e);a.warns[e].isActive=!0,a.warns[e].el=a.paper.image(o,r.x*a.ratio+5,(r.y+r.height)*a.ratio-15,t.warnSettings.warnImageWidth,t.warnSettings.warnImageHeight),a.warns[e].el.node.id="warn-tip-"+e;var n=document.createElementNS("http://www.w3.org/2000/svg","title"),s=document.createTextNode(t.warnSettings.resizeWarnMsg);n.appendChild(s),document.getElementById("warn-tip-"+e).appendChild(n)},showBeforeElements:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.warns;i.map(function(e){e.el&&e.el.toFront()})},refreshLaterTips:function(e){for(var i=t.pages[t.selectedPageIdx].canvas,a=e,o=i.warns.length;a<o;a++)i.warns[a]&&i.warns[a].isActive&&(i.warns[a].el.node.id="warn-tip-"+a)}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={events:{dispatchImageUpload:function(){this.$broadcast("notifyShowImageUpload")},dispatchImageList:function(){this.$broadcast("notifyImageList")},dispatchImageCrop:function(){this.$broadcast("notifyImageCrop")},dispatchReplaceImage:function(e){this.$broadcast("notifyReplaceImage",e)},dispatchShowAddText:function(){this.$broadcast("notifyShowAddText")},dispatchAddText:function(e){this.$broadcast("notifyAddText",e)},dispatchModifyText:function(e){this.$broadcast("notifyModifyText",e)},dispatchResetCanvas:function(){this.$broadcast("notifyResetCanvas")},dispatchShowSpineLines:function(){this.$broadcast("notifyShowSpineLines")},dispatchHideSpineLines:function(){this.$broadcast("notifyHideSpineLines")},dispatchShowOptionWindow:function(){this.$broadcast("notifyShowOptionWindow")},dispatchUpdateAlbumResponse:function(e,t){this.$broadcast("notifyUpdateAlbumResponse",e,t)},dispatchShowOrderWindow:function(){this.$broadcast("notifyShowOrderWindow")},dispatchShowContactUsWindow:function(){this.$broadcast("notifyShowContactUsWindow")},dispatchPreviewSave:function(e){this.$broadcast("notifyPreviewSave",e)},dispatchShowPopup:function(e){this.$broadcast("notifyShowPopup",e)},dispatchReorder:function(e){this.$broadcast("notifyReorder",e)},dispatchRedirectHome:function(){this.$broadcast("notifyRedirectHome")},dispatchDepthFront:function(e){console.log(e)},dispatchShowWarnTip:function(e){this.$broadcast("notifyShowWarnTip",e)},dispatchHideWarnTip:function(e){this.$broadcast("notifyHideWarnTip",e)},dispatchShowOptionsWindow:function(){this.$broadcast("notifyShowOptionsWindow")},dispatchRotate:function(){this.$broadcast("notifyRotate")},dispatchRepaintProject:function(){this.$broadcast("notifyRepaintProject")},dispatchAddImage:function(e){this.$broadcast("notifyAddImage",e)},dispatchShowCloneWindow:function(){this.$broadcast("notifyShowCloneWindow")},dispatchResetProjectInfo:function(){if(i(6).getIsShowProjectInfoView()){i(6).getProjectInfoViewText()}else this.$broadcast("notifyResetProjectInfo",!0)},dispatchClearScreen:function(e){e=!!e,this.sharedStore.isLostFocus=!0},dispatchShowProjectChooseWindow:function(){t.fromCart=!0,t.watches.isProjectLoaded=!1,i(7).getProjectIdByTitle(t.title),this.$broadcast("notifyShowCartReturnWindow")},dispatchGetProjectIdByTitleSuccess:function(){""!==t.userSettings.userId&&""!==t.projectId&&(i(7).getProjectInfo(),i(13).getOldProject())},dispatchShowNewProjectWindow:function(){this.$broadcast("notifyShowNewProjectWindow")}}}}).call(t,i(2))},function(e,t,i){(function(t,i){e.exports={methods:{handleResize:function(){""!==t.ctrls.tcResize&&(clearTimeout(t.ctrls.tcResize),t.ctrls.tcResize=""),t.ctrls.tcResize=setTimeout(function(){t.watches.flagRepaint=!0,clearTimeout(t.ctrls.tcResize),t.ctrls.tcResize=""},500)}},events:{resize:function(){this.handleResize()}},created:function(){var e=this;i.window.addEventListener("resize",function(){e.$emit("resize")}),e.$watch("sharedStore.watches.flagRepaint",function(){e.sharedStore.watches.flagRepaint&&(e.sharedStore.watches.flagRepaint=!1,t.isImageCropShow&&t.vm.$broadcast("notifyImageCrop"),t.watches.isSpecLoaded&&t.watches.isProjectLoaded&&e.$broadcast("notifyRefreshCanvas",t.currentSelectProjectIndex))})}}}).call(t,i(2),function(){return this}())},function(e,t){e.exports={dpi:300,imageQualityBufferPercent:30,products:[],colors:[],sizes:[],measures:[],specXml:""}},function(e,t,i){(function(t,a){e.exports={loadDomainUrls:function(){t.ajax({url:"/userid/getEnv?webClientId=1&autoRandomNum="+i(10).getRandomNum(),type:"get",async:!1}).done(function(e){e&&(a.domains.baseUrl=t(e).find("baseUrl").text().substr(0,t(e).find("baseUrl").text().length-1)||"",a.domains.proxyFontBaseUrl=a.domains.baseUrl+"/api",a.domains.calendarBaseUrl=t(e).find("calendarBaseUrl").text().substr(0,t(e).find("calendarBaseUrl").text().length-1)||"",a.domains.uploadUrl=t(e).find("uploadBaseUrl").text().substr(0,t(e).find("uploadBaseUrl").text().length-1)||"",a.domains.productBaseUrl=t(e).find("productBaseURL").text().substr(0,t(e).find("productBaseURL").text().length-1)||"",a.domains.portalBaseUrl=t(e).find("portalBaseURL").text().substr(0,t(e).find("portalBaseURL").text().length-1)||"",a.domains.layoutTemplateServerBaseUrl=t(e).find("layoutTemplateServerBaseUrl").text().substr(0,t(e).find("layoutTemplateServerBaseUrl").text().length-1)||"",a.domains.backendBaseUrl=t(e).find("backendBaseURL").text().substr(0,t(e).find("backendBaseURL").text().length-1)||"")})}}}).call(t,i(4),i(2))},function(e,t,i){(function(t,a){var o={book:1,frame:2,poster:9,cards:5,phonecase:10};e.exports={loadSpec:function(e){var i=this;t.ajax({url:a.domains.productBaseUrl+"/product/spec/product-spec?productType=7",type:"get",dataType:"text"}).done(function(a){if(a=t.parseXML(a),a&&"success"===t(a).find("resultData").attr("state")){var o=t(a).find("availableVersionPath").text();t.ajax({url:o,type:"get",dataType:"text"}).done(function(e){e=t.parseXML(e),i.parseSpecXml(e)})}else e.$dispatch("dispatchShowPopup",{type:"spec",status:0})})},loadLocalSpec:function(){t.ajax({url:"./assets/data/spec.xml?requestKey="+i(11).getRequestKey(),type:"get",dataType:"text"}).done(function(e){e=t.parseXML(e),a.spec.specXml=e,a.watches.isSpecLoaded=!0})},parseSpecXml:function(e){a.spec.specXml=e;for(var i=t(e).find('optionGroup[id="product"]').find("option"),o=0;o<i.length;o++)a.spec.products.push({id:i.eq(o).attr("id"),title:i.eq(o).find("title").text()});for(var r=t(e).find('optionGroup[id="size"]').find("option"),o=0;o<r.length;o++)a.spec.sizes.push({id:r.eq(o).attr("id"),name:r.eq(o).attr("name"),default:r.eq(o).attr("default")});for(var n=t(e).find('optionGroup[id="color"]').find("option"),o=0;o<n.length;o++)a.spec.colors.push({id:n.eq(o).attr("id"),name:n.eq(o).attr("name")});for(var s=t(e).find('optionGroup[id="measure"]').find("option"),o=0;o<s.length;o++)a.spec.measures.push({id:s.eq(o).attr("id"),name:s.eq(o).attr("name")});a.watches.isSpecLoaded=!0},loadProductSpec:function(e,i){t.ajax({url:a.domains.productBaseUrl+"/product/spec/product-spec?productType="+o[e],type:"get",dataType:"text"}).done(function(e){if(e=t.parseXML(e),console.log(e),e&&"success"===t(e).find("resultData").attr("state")){var o=t(e).find("availableVersionPath").text();t.ajax({url:o,type:"get",dataType:"text"}).done(function(e){e=t.parseXML(e),a.spec.specXml=e,i(),a.watches.isSpecLoaded=!0})}else console.log("load spec failed")})}}}).call(t,i(4),i(2))},function(e,t,i){(function(t,a){e.exports=function(e,o,r){if(e&&o&&o.fileSelector){var n=document.querySelector(o.fileSelector),s=n.files;s=Array.prototype.slice.call(s),s.sort(function(e){var t=e.name.toLowerCase().indexOf(".jpeg")!==-1||e.name.toLowerCase().indexOf(".png")!==-1||e.name.toLowerCase().indexOf(".jpg")!==-1,i=e.size/1048576;return!!(t&&i<100&&0!==i)}),t.retryId>=0&&(s=[],s.push(t.errorUploadedFiles[t.errorUploadedFiles.length-1-t.retryId])),t.maxPageNum&&t.pages.length+s.length>t.maxPageNum&&"number"!=typeof t.watchData.replacePageId&&(s.length=t.maxPageNum-t.pages.length),s.length>0&&a.ajax({url:t.domains.uploadUrl+"/upload/UploadServer/GetBatchImageIds",type:"get",data:"imageIdCount="+s.length+"&timestamp="+Date.now(),error:function(e){t.vm.$dispatch("dispatchShowPopup",{type:"noInterenet",status:0})}}).done(function(o){if(o){var n=o,d=a(n).find("id").length;t.retryId<0&&(t.prevFilesTotal=t.filesTotal,t.filesTotal=t.filesTotal?t.filesTotal+d:d);for(var l=0;l<d;l++){t.filesTotalInQueue=d,t.filesCountInQueue=0;var c=a(n).find("id").eq(l).text(),p=new XMLHttpRequest;t.retryId<=0&&(t.oriImageIds.push(c),t.uploadProgress.push({percent:0,imgId:c,xhr:p}));var h=s[l].name.toLowerCase().indexOf(".jpeg")!==-1||s[l].name.toLowerCase().indexOf(".png")!==-1||s[l].name.toLowerCase().indexOf(".jpg")!==-1,g=s[l].size/1048576;if(h&&g<100&&0!==g)!function(o,n,l){var c=new FormData;c.append("uid",t.userSettings.userId),c.append("timestamp",t.userSettings.uploadTimestamp),c.append("token",t.userSettings.token),c.append("albumId",t.userSettings.albumId),c.append("albumName",t.title);var p=s[o];c.append("Filename",p.name),c.append("filename",p),t.oriImageNames.push({filename:p.name,imgId:n});var h=t.domains.uploadUrl+"/upload/UploadServer/uploadImg?imageId="+n,g=o;r||(g+=t.prevFilesTotal),t.retryId>=0&&(g=t.retryId),l.upload.onprogress=function(i){if(i.loaded&&i.total)if(e.isWindowOpen()){var a=i.loaded,r=i.total,s=Math.floor(a/r*100);s>=99&&(s=99),console.log("percent",s,o);for(var d=0;d<t.uploadProgress.length;d++){var c=t.uploadProgress[d];if(c.imgId===n){g=d;break}}var h=t.uploadProgress[g].startUploadAt||0;t.uploadProgress[g].successUploadAt||0;t.uploadProgress.$set(g,{percent:s,imgId:n,xhr:l,file:p,startUploadAt:h})}else l.onload=null,l.error=null,l.upload.onprogress=null},l.onreadystatechange=function(){if(4==l.readyState&&413==l.status){t.errorUploaded++,t.filesCountInQueue++,t.errorExt++,t.uploadProgress.$set(g,{percent:"File exceeds maximum size of 100M",imgId:n,info:"Failed: File exceeds maximum size of 100M"}),a("#retry-"+g).show(),a("#progress-c-"+g).hide(),a("#delete-"+g).hide();var i=t.uploadProgress.splice(g,1);t.uploadProgress.unshift(i[0]),t.filesCountInQueue==d&&(t.vm.$dispatch("dispatchSaveProject",!0),t.vm.$broadcast("notifyAddNewUploadedImgIntoPages"),t.isLostFocus=!0),e.refreshImageUploadDom()}},l.onload=function(o){var r=this.responseText;if(console.log(r),!(t.cancelledImgIds.indexOf(a(r).find("id").text())>=0)){t.filesCountInQueue++;for(var s=0;s<t.uploadProgress.length;s++){var c=t.uploadProgress[s];if(c.imgId===n){g=s;break}}if(r&&r.indexOf('state="success"')!==-1){console.log("done");var h=t.uploadProgress[g].startUploadAt||0,m=t.uploadProgress[g].successUploadAt||0;if(t.uploadProgress.$set(g,{percent:"Done",imgId:n,xhr:l,file:p,startUploadAt:h,successUploadAt:m}),a("#delete-"+g).hide(),t.currentUploadCount++,t.successfullyUploaded++,t.currentSuccessUpload++,t.filesTotal===t.successfullyUploaded+t.errorUploaded){var u=-1;t.startUploadTime&&(u=new Date-t.startUploadTime,t.startUploadTime=0),t.isUploading=!1,i(8)({ev:i(9).UploadComplete,uploadTimes:++t.uploadTimes,success:t.currentSuccessUpload,failed:t.currentErrorUpload,spendTime:u})}t.retryId>=0&&t.errorUploaded--,t.imageList.push({id:a(r).find("id").text(),guid:a(r).find("guid").text()||"",encImgId:a(r).find("encImgId").text()||"",url:t.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+a(r).find("encImgId").text()+i(11).getSecurityString()+"&rendersize=fit",name:a(r).find("name").text(),width:parseFloat(a(r).find("width").text())||0,height:parseFloat(a(r).find("height").text())||0,shotTime:a(r).find("shotTime").text()||"",createTime:p.lastModified,uploadTime:new Date(a(r).find("insertTime").text()).valueOf()||0,orientation:i(!function(){var e=new Error('Cannot find module "UtilImage"');throw e.code="MODULE_NOT_FOUND",e}()).getExifDegree(a(r).find("exifOrientation").text()),usedCount:0,previewUrl:""}),i(!function(){var e=new Error('Cannot find module "UtilImage"');throw e.code="MODULE_NOT_FOUND",e}()).getBlobImagePreviewUrl(t.imageList.length-1),"undefined"==typeof t.newUploadedImg&&(t.newUploadedImg=[]),t.newUploadedImg.push({id:a(r).find("id").text(),guid:a(r).find("guid").text()||"",encImgId:a(r).find("encImgId").text()||"",url:t.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+a(r).find("encImgId").text()+i(11).getSecurityString()+"&rendersize=fit",name:a(r).find("name").text(),width:parseFloat(a(r).find("width").text())||0,height:parseFloat(a(r).find("height").text())||0,shotTime:a(r).find("shotTime").text()||"",createTime:p.lastModified,uploadTime:new Date(a(r).find("insertTime").text()).valueOf()||0,orientation:i(!function(){var e=new Error('Cannot find module "UtilImage"');throw e.code="MODULE_NOT_FOUND",e}()).getExifDegree(a(r).find("exifOrientation").text()),usedCount:0,previewUrl:""}),t.vm.$broadcast("notifyAddNewUploadedImgIntoPages"),t.successfullyUploaded==t.filesTotal&&(e.handleSaveAndHideUpload(!0),t.vm.$broadcast("notifyHidePopup")),t.retryId=-1,console.log(t.imageList),e.$dispatch("dispatchImageList")}else if(r&&r.indexOf('state="fail"')!==-1){if(t.cancelledImgIds.indexOf(a(r).find("id").text())>=0)return void(t.retryId>=0&&(t.retryId=-1));if(t.errorUploaded++,t.retryId<0){t.currentUploadCount++,t.currentErrorUpload++,t.filesTotal===t.successfullyUploaded+t.errorUploaded&&(t.isUploading=!1,i(8)({ev:i(9).UploadComplete,uploadTimes:++t.uploadTimes,success:t.currentSuccessUpload,failed:t.currentErrorUpload}));var f=t.uploadProgress.splice(g,1);t.uploadProgress.unshift(f[0]),t.errorUploadedFiles.push(p),t.filesCountInQueue==d&&(t.vm.$dispatch("dispatchSaveProject",!0),t.vm.$broadcast("notifyAddNewUploadedImgIntoPages"),t.isLostFocus=!0),e.refreshImageUploadDom()}var v=t.retryId>=0?t.retryId:0;t.uploadProgress.$set(v,{percent:a(r).find("errorInfo").text(),imgId:n,xhr:l,info:"Failed: "+a(r).find("errorInfo").text()||"Upload failed!"}),t.retryId=-1,a("#retry-"+v).show(),a("#progress-c-"+v).hide(),a("#delete-"+v).hide()}}},l.onerror=function(i){console.log("err"),t.errorUploaded++,t.currentUploadCount++,t.currentErrorUpload++,t.filesCountInQueue++,t.uploadProgress.$set(g,{percent:"File exceeds maximum size of 100M",imgId:n,info:"Failed: File exceeds maximum size of 100M"}),a("#retry-"+g).show(),a("#progress-c-"+g).hide(),a("#delete-"+g).hide();var o=t.uploadProgress.splice(g,1);t.uploadProgress.unshift(o[0]),t.filesCountInQueue==d&&(t.vm.$dispatch("dispatchSaveProject",!0),t.vm.$broadcast("notifyAddNewUploadedImgIntoPages"),t.isLostFocus=!0),e.refreshImageUploadDom()},l.open("post",h,!0),l.send(c),t.retryId<0&&e.initImageUploadDom(g,p.name)}(l,c,p);else{index=l,index+=t.prevFilesTotal,t.errorUploaded++,t.errorExt++,t.oriImageNames.push({filename:s[l].name,imgId:c}),e.initImageUploadDom(index,s[l].name),a("#retry-"+index).show(),a("#progress-c-"+index).hide(),a("#delete-"+index).hide();var m="Only .jpg .jpeg and .png files are supported",u="Only .jpg .jpeg and .png files are supported";0===g&&(m="Invalid image file, please select another file",u="Failed: Invalid image file, please select another file"),g>=100&&(m="File exceeds maximum size of 100M",u="Failed: File exceeds maximum size of 100M"),t.uploadProgress.$set(index,{percent:m,imgId:c,info:u});var f=t.uploadProgress.splice(index,1);t.uploadProgress.unshift(f[0]),e.refreshImageUploadDom()}}}})}}}).call(t,i(2),i(4))},function(e,t){e.exports={baseUrl:"",uploadUrl:"",productBaseUrl:"",proxyFontBaseUrl:"",portalBaseUrl:"",layoutTemplateServerBaseUrl:"",assetBaseUrl:"",calendarBaseUrl:"",backendBaseUrl:""}},function(e,t,i){!function(t,i){e.exports=i()}(this,function(){"use strict";function e(e){var t=null,i=document.cookie.split(";");if(i)for(var a=0;a<i.length;a++){var o=i[a].split("=");if(o.length>1&&e==o[0]){t=unescape(o[1]);break}}return t}function t(t,a,o,r,n){var s=window.location.hostname+"",a=a||e(" JSESSIONID")||e("JSESSIONID"),d=o||e(" AS_UID")||e("AS_UID");t=a+","+d+","+(new Date).getTime()+","+t;var l="https://venus.zno.com/b.htm?"+t;"www.zno.com"!=s&&(l="https://log.zno.com.t/b.htm?"+t),i(l,r,n)}function i(e,t,i){var a=new XMLHttpRequest;a.onload=function(e){t&&"function"==typeof t&&t(e||window.event)},a.onerror=function(e){i&&"function"==typeof i&&i(e||window.event)},a.open("GET",e),a.send()}return{go:t}})},function(e,t,i){(function(t){e.exports={template:'<div class="bed-actionpanel-top"><div style="height: 80px;text-align: center;"><div class="button action-item" style="margin-top: 30px; margin-bottom: 20px; width: 120px;height: 28px;line-height: 28px;border-radius: 14px;text-align: center;font-size: 12px; font-weight: 500;" v-on:click="handleAddText()">Add Text</div></div></div>',data:function(){return{privateStore:{},sharedStore:t}},methods:{handleAddText:function(){this.$dispatch("dispatchShowAddText"),i(8)({ev:i(9).AddText})}}}}).call(t,i(2))},function(e,t,i){(function(t){var a=(i(17),i(19)),o=i(15);e.exports={template:"<!-- background --><canvas id=\"bg-part\" style=\"position: absolute; left: 0; top: 0; \"></canvas><canvas id=\"helpline-border-up\" v-show=\"(sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory'\" v-bind:style=\"{ left: borderUpLeft + 'px', top: borderUpTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas><canvas id=\"helpline-border-right\" v-show=\"(sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory'\" v-bind:style=\"{ left: borderRightLeft + 'px', top: borderRightTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas><canvas id=\"helpline-border-down\" v-show=\"(sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory'\" v-bind:style=\"{ left: borderDownLeft + 'px', top: borderDownTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas><canvas id=\"helpline-border-left\" v-show=\"(sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory'\" v-bind:style=\"{ left: borderLeftLeft + 'px', top: borderLeftTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas><canvas id=\"helpline-logo-up\" v-show=\"((sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory') && sharedStore.selectedPageIdx === 0\" v-bind:style=\"{ left: logoUpLeft + 'px', top: logoUpTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas><canvas id=\"helpline-logo-right\" v-show=\"((sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory') && sharedStore.selectedPageIdx === 0\" v-bind:style=\"{ left: logoRightLeft + 'px', top: logoRightTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas><canvas id=\"helpline-logo-down\" v-show=\"((sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory') && sharedStore.selectedPageIdx === 0\" v-bind:style=\"{ left: logoDownLeft + 'px', top: logoDownTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas><canvas id=\"helpline-logo-left\" v-show=\"((sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory') && sharedStore.selectedPageIdx === 0\" v-bind:style=\"{ left: logoLeftLeft + 'px', top: logoLeftTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas><canvas id=\"helpline-center\" v-show=\"(sharedStore.operateMode !=='' && sharedStore.operateMode !== 'idle') || sharedStore.previewSource ==='factory'\" v-bind:style=\"{ left: centerLeft + 'px', top: centerTop + 'px', zIndex: helplineZindex }\" style=\"position: absolute;\"></canvas>",
props:["width","height"],data:function(){return{sharedStore:t,borderColor:"#7b7b7b",borderUpLeft:0,borderUpTop:0,borderRightLeft:0,borderRightTop:0,borderDownLeft:0,borderDownTop:0,borderLeftLeft:0,borderLeftTop:0,logoColor:"#7b7b7b",logoUpLeft:0,logoUpTop:0,logoRightLeft:0,logoRightTop:0,logoDownLeft:0,logoDownTop:0,logoLeftLeft:0,logoLeftTop:0,centerColor:"#de3418",centerLeft:0,centerTop:0}},computed:{helplineZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+2)}},methods:{initBg:function(){this.initBgImage(),this.initHelplines()},initHelplines:function(){this.initLineBorder(),this.initLineLogo(),this.initLineCenter()},initLineBorder:function(){var e=this,i=t.pages[t.selectedPageIdx].canvas,o=document.getElementById("helpline-border-up"),r=document.getElementById("helpline-border-right"),n=document.getElementById("helpline-border-down"),s=document.getElementById("helpline-border-left"),d=o.getContext("2d"),l=r.getContext("2d"),c=n.getContext("2d"),p=s.getContext("2d");o.width=n.width=i.width,o.height=r.width=n.height=s.width=2,r.height=s.height=i.height,e.borderUpLeft=e.borderDownLeft=e.borderLeftLeft=i.x,e.borderUpTop=e.borderRightTop=e.borderLeftTop=i.y,e.borderRightLeft=i.x+i.width,e.borderDownTop=i.y+i.height,d.clearRect(-1,-1,o.width+2,o.height+2),a.drawDashedLine("helpline-border-up",e.borderColor,0,0,o.width,0,2,3),l.clearRect(-1,-1,r.width+2,r.height+2),a.drawDashedLine("helpline-border-right",e.borderColor,0,0,0,r.height,2,3),c.clearRect(-1,-1,n.width+2,n.height+2),a.drawDashedLine("helpline-border-down",e.borderColor,0,0,n.width,0,2,3),p.clearRect(-1,-1,s.width+2,s.height+2),a.drawDashedLine("helpline-border-left",e.borderColor,0,0,0,r.height,2,3)},initLineLogo:function(){var e=this,i=t.pages[t.selectedPageIdx].canvas,r=document.getElementById("helpline-logo-up"),n=document.getElementById("helpline-logo-right"),s=document.getElementById("helpline-logo-down"),d=document.getElementById("helpline-logo-left"),l=r.getContext("2d"),c=n.getContext("2d"),p=s.getContext("2d"),h=d.getContext("2d"),g=o.analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size}),m=g.logo;r.width=s.width=m.width*i.ratio,r.height=n.width=s.height=d.width=2,n.height=d.height=m.height*i.ratio,e.logoUpLeft=e.logoDownLeft=e.logoLeftLeft=i.x+m.x*i.ratio,e.logoUpTop=e.logoRightTop=e.logoLeftTop=i.y+m.y*i.ratio,e.logoRightLeft=i.x+(m.x+m.width)*i.ratio,e.logoDownTop=i.y+(m.y+m.height)*i.ratio,l.clearRect(-1,-1,r.width+2,r.height+2),a.drawDashedLine("helpline-logo-up",e.logoColor,0,0,r.width,0,2,3),c.clearRect(-1,-1,n.width+2,n.height+2),a.drawDashedLine("helpline-logo-right",e.logoColor,0,0,0,n.height,2,3),p.clearRect(-1,-1,s.width+2,s.height+2),a.drawDashedLine("helpline-logo-down",e.logoColor,0,0,s.width,0,2,3),h.clearRect(-1,-1,d.width+2,d.height+2),a.drawDashedLine("helpline-logo-left",e.logoColor,0,0,0,n.height,2,3)},initLineCenter:function(){var e=this,i=t.pages[t.selectedPageIdx].canvas,o=document.getElementById("helpline-center"),r=o.getContext("2d");o.width=2,o.height=1.2*i.height,e.centerLeft=i.x+i.width/2,e.centerTop=i.y-.1*i.height,r.clearRect(-1,-1,o.width+2,o.height+2),a.drawDashedLine("helpline-center",e.centerColor,0,0,0,o.height,2,3)},initBgImage:function(){var e=this,i=(t.pages[t.selectedPageIdx].canvas,"");t.projectSettings[t.currentSelectProjectIndex].color&&null!=t.selectedPageIdx&&(i="./assets/img/"+t.projectSettings[t.currentSelectProjectIndex].color+"-"+t.selectedPageIdx+".png");var a=document.getElementById("bg-part"),o=a.getContext("2d");a.width=e.width,a.height=e.height,o.clearRect(-1,-1,a.width+2,a.height+2);var r=new Image;r.src=i,r.onload=function(){o.drawImage(r,0,0,e.width,e.height),t.vm.$broadcast("notifyRefreshScreenshot")}}},events:{notifyRefreshBackground:function(){this.initBg()},notifyChangeBgImage:function(){this.initBgImage()}},ready:function(){var e=this;e.$watch("width",function(){e.width&&e.initBg()}),e.$watch("height",function(){e.height&&e.initBg()})}}}).call(t,i(2))},function(e,t,i){(function(t){i(5);e.exports={template:'<div class="box-bar" v-bind:style="{ width: boxWidth + \'px\', left: boxLeft + \'px\', top: boxTop + \'px\', zIndex: windowZindex }"><!-- image bars --><span class="button" v-if="type === \'image\'" v-on:click="handleEditImage()" title="Click to crop image" style="display: inline-block;width: 35px; height: 30px; margin-right: 1px; border-top-left-radius: 15px;border-bottom-left-radius: 15px;"><img draggable="false" src="../../static/img/bar-crop.png" alt="CR" style="width: 20px; height: 20px; margin-top: 5px; margin-left: 3px;" /></span><span class="button" v-if="type === \'image\'" v-on:click="handleRotate(90)" title="Rotate right" style="display: inline-block;width: 30px; height: 30px; margin-right: 1px;"><img draggable="false" src="../../static/img/bar-rotate-right.png" alt="RR" style="width: 20px; height: 20px; margin-top: 5px;" /></span><span class="button" v-if="type === \'image\'" v-on:click="handleHCenterImage()" title="Move To Center" style="display: inline-block;width: 30px; height: 30px; margin-right: 1px;"><img draggable="false" src="../../static/img/bar-aligncenter.png" alt="AC" style="width: 20px; height: 20px; margin-top: 5px;" /></span><span class="button"  v-if="type === \'image\'" v-on:click.stop="handleLayer()" title="Layer" style="display: inline-block;width: 30px; height: 30px; margin-right: 1px;"><img draggable="false" src="../../static/img/bar-layer.png" alt="LAYER" style="width: 20px; height: 20px; margin-top: 5px;" /></span><span class="button" v-if="type === \'image\'" v-on:click="handleRemoveImage()" title="Remove" style="display: inline-block;width: 35px; height: 30px; margin-right: 1px; border-top-right-radius: 15px;border-bottom-right-radius: 15px;"><img draggable="false" src="../../static/img/bar-delete.png" alt="DEL" style="width: 20px; height: 20px; margin-top: 5px; margin-right: 3px;" /></span><!-- text bars --><span class="button" v-if="type === \'text\'" v-on:click="handleEditText()" title="Edit" style="display: inline-block;width: 35px; height: 30px; margin-right: 1px; border-top-left-radius: 15px;border-bottom-left-radius: 15px;"><img draggable="false" src="../../static/img/bar-edit.png" alt="ET" style="width: 20px; height: 20px; margin-top: 5px; margin-left: 3px;" /></span><span class="button" v-if="type === \'text\'" v-on:click="handleHCenterText()" title="Move To Center" style="display: inline-block;width: 30px; height: 30px; margin-right: 1px;"><img draggable="false" src="../../static/img/bar-aligncenter.png" alt="AC" style="width: 20px; height: 20px; margin-top: 5px;" /></span><span class="button"  v-if="type === \'text\'" v-on:click.stop="handleLayer()" title="layer" style="display: inline-block;width: 30px; height: 30px; margin-right: 1px;"><img draggable="false" src="../../static/img/bar-layer.png" alt="LAYER" style="width: 20px; height: 20px; margin-top: 5px;" /></span><span class="button" v-if="type === \'text\'" v-on:click="handleRemoveText()" title="Remove" style="display: inline-block;width: 35px; height: 30px; margin-right: 1px; border-top-right-radius: 15px;border-bottom-right-radius: 15px;"><img draggable="false" src="../../static/img/bar-delete.png" alt="DEL" style="width: 20px; height: 20px; margin-top: 5px; margin-right: 3px;" /></span><subbar-panel v-bind:idx="idx"></subbar-panel></div>',data:function(){return{boxHeight:30,id:0,sharedStore:t}},computed:{boxWidth:function(){var e=t.pages[t.selectedPageIdx].canvas;return"image"===e.params[e.selectedIdx].elType?165:"text"===e.params[e.selectedIdx].elType?135:0},idx:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.selectedIdx},boxLeft:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.selectedIdx,a=e.params[i];this.width=a.width*e.ratio;var o=-1*(this.width-this.boxWidth)/2;if(a.x*e.ratio-o<0)return 4;if(a.x*e.ratio+this.width+o>e.width){var e=t.pages[t.selectedPageIdx].canvas;return e.width-this.boxWidth-4}return(this.width-this.boxWidth)/2+a.x*e.ratio},boxTop:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.selectedIdx,a=e.params[i];return this.height=a.height*e.ratio,a.y*e.ratio+this.height+this.boxHeight+4>=e.height?e.height-this.boxHeight-4:a.y*e.ratio+a.height*e.ratio+4},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)},type:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.params[e.selectedIdx].elType?e.params[e.selectedIdx].elType:""}},methods:{handleRemoveImage:function(){var e=t.pages[t.selectedPageIdx].canvas,a=e.selectedIdx;t.watchData.removeElementIdx=a,t.watchData.removeElementType="image",t.watches.isRemoveElement=!0,i(8)({ev:i(9).ClickRemoveImage})},handleRemoveText:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.selectedIdx;t.watchData.removeElementIdx=i,t.watchData.removeElementType="text",t.watches.isRemoveElement=!0},handleRotate:function(e){var a=t.pages[t.selectedPageIdx].canvas,o=a.selectedIdx;t.vm.$broadcast("notifyRotateImage",{idx:o,nDegree:e}),i(8)({ev:i(9).ClickRotateImage})},handleEditImage:function(){var e=t.pages[t.selectedPageIdx].canvas,a=e.selectedIdx;t.watchData.cropImageIdx=a,t.watches.isCropThisImage=!0,i(8)({ev:i(9).ClickCropImage})},handleEditText:function(){t.watches.isChangeThisText=!0},handleHCenterImage:function(){this.$dispatch("dispatchHCenter"),i(8)({ev:i(9).ClickMoveImageToCenter})},handleHCenterText:function(){this.$dispatch("dispatchHCenter"),i(8)({ev:i(9).ClickMoveTextToCenter})},handleLayer:function(){this.sharedStore.isEditLayerShow=!this.sharedStore.isEditLayerShow}},events:{},ready:function(){}}}).call(t,i(2))},function(e,t,i){(function(t,a){e.exports={template:'<div v-show="sharedStore.isShowContactUs"><div class="shadow-bg"></div><div id="contactUsWindow" class="box-order" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" draggable="false" width="16" height="16" v-on:click="handleHideView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Contact Us</div></div><div style="margin: 50px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Have a question?</label><div class="box-textarea"><textarea v-model="privateStore.question" class="font-textarea"  style="height: 80px; width: 533px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[0]}}"></textarea></div></div><div style="margin: 60px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Have a feature request?</label><div class="box-textarea"><textarea v-model="privateStore.featureRequest" class="font-textarea" style="height: 80px; width: 533px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[1]}}"></textarea></div></div><div style="margin: 60px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Want to report a bug?</label><div class="box-textarea"><textarea v-model="privateStore.bug" class="font-textarea" style="height: 80px; width: 533px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[2]}}"></textarea></div></div><div class="texteditor-button" style="margin-top: 50px;"><div id="emptyLabel" style="width: 200px;text-align: center;height: 40px;line-height: 40px;font-size: 14px;color:red;margin-left:auto;margin-right:auto;opacity:0;">Please enter something.</div><div><div class="button t-center" v-on:click="submit" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; margin-left: 245px;font-size: 14px;">Done</div></div></div></div>',data:function(){return{privateStore:{width:655,height:655,question:"",featureRequest:"",bug:"",selector:"#contactUsWindow",marks:["input your question here","input your feature request here","input the bug description here"]},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideView:function(){this.sharedStore.isShowContactUs=!1},checkWords:function(e){for(var t=0;t<this.privateStore.marks.length;t++)e.target.value===this.privateStore.marks[t]&&(e.target.value="")},submit:function(){if(""===this.privateStore.question.trim()&&""===this.privateStore.featureRequest.trim()&&""===this.privateStore.bug.trim())a("#emptyLabel").css("opacity",1);else{var e=this.privateStore.question,t=this.privateStore.featureRequest,o=this.privateStore.bug,r=navigator.platform,n="[appName:"+navigator.appName+";userAgent:"+navigator.userAgent+";appVersion:"+navigator.appVersion+"]";i(7).sentContactUs(this,e,t,o,r,n),this.sharedStore.isShowContactUs=!1,this.privateStore.question="",this.privateStore.featureRequest="",this.privateStore.bug=""}}},ready:function(){},events:{notifyShowContactUsWindow:function(){console.log("ShowContactUsWindow");var e=i(12);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.sharedStore.isShowContactUs=!0,a("#emptyLabel").css("opacity",0)}},created:function(){}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){var o=i(27),r=i(12),n=i(16),s=i(5),d=i(14),l=i(22),c=i(23);e.exports={template:'<div id="box-canvasbg" v-bind:style="{ width: privateStore.operationWidth + \'px\', height: privateStore.operationHeight + \'px\', margin: operationMarginTop + \'px \' + operationMarginLeft  + \'px\' }" style="position: relative;"><bg-layer v-bind:width="privateStore.operationWidth" v-bind:height="privateStore.operationHeight"></bg-layer><div class="bed-operation" id="container" v-bind:style="{ top: privateStore.canvasTop + \'px\', left: privateStore.canvasLeft + \'px\', background: background }" style="position: absolute; overflow: hidden"><bar-panel v-show="!sharedStore.isPreview && isShowHandle"></bar-panel><handle v-if="!sharedStore.isPreview" v-bind:id="privateStore.handleId" v-bind:is-Show-Handles="privateStore.isShowHandle" v-bind:is-Corner-Handles="privateStore.isCornerHandles" v-bind:is-Side-Handles="privateStore.isSideHandles" /></div><screenshot></screenshot></div>',data:function(){return{privateStore:{operationWidth:0,operationHeight:0,operationPaddingTop:0,operationPaddingLeft:0,canvasTop:0,canvasLeft:0,handleId:"bg",isShowHandle:!0,isCornerHandles:!1,isSideHandles:!1},sharedStore:t}},computed:{operationMarginTop:function(){return this.privateStore.operationPaddingTop},operationMarginLeft:function(){return this.privateStore.operationPaddingLeft},isShowHandle:function(){t.pages[t.selectedPageIdx].canvas;return!t.isLostFocus},background:function(){return t.isPreview?"":"#fff"}},methods:{initCanvas:function(){var e=this,i=e.sharedStore,o=i.pages[i.selectedPageIdx].canvas;t.pages.length>1&&(t.isChangePageShow=!0),e.initWindow(),a(".bed-operation").css("width",o.width).css("height",o.height);for(var r=0;r<o.params.length;r++)d.createElement(r);o.selectedIdx=s.getFrontElementIndex(),n.freshImageUsedCount()},clearCanvas:function(){for(var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length-1;i>=0;i--)d.deleteElement(i)},initWindow:function(){var e=this,t=e.sharedStore,i=t.pages[t.selectedPageIdx].canvas;if(t.isPreview)var a=r.getPreviewBoxLimit();else var a=r.getBoxLimit();if(a.width>0&&a.height>0){if(void 0!=i.expendSize.top&&null!=i.expendSize.top)var o=i.oriBgWidth+i.expendSize.left+i.expendSize.right,n=i.oriBgHeight+i.expendSize.top+i.expendSize.bottom,s=i.expendSize.left,d=i.expendSize.top;else var o=i.oriBgWidth,n=i.oriBgHeight,s=0,d=0;var l=a.width/o,c=a.height/n;l>c?(i.ratio=c,i.width=i.oriWidth*i.ratio,i.height=i.oriHeight*i.ratio,i.x=i.oriX*i.ratio,i.y=i.oriY*i.ratio,i.bgWidth=i.oriBgWidth*i.ratio,i.bgHeight=i.oriBgHeight*i.ratio,e.privateStore.operationPaddingLeft=(a.width-i.bgWidth)/2):(i.ratio=l,i.width=i.oriWidth*i.ratio,i.height=i.oriHeight*i.ratio,i.x=i.oriX*i.ratio,i.y=i.oriY*i.ratio,i.bgWidth=i.oriBgWidth*i.ratio,i.bgHeight=i.oriBgHeight*i.ratio,e.privateStore.operationPaddingLeft=0+s*i.ratio),e.privateStore.operationPaddingTop=0+d*i.ratio,e.privateStore.operationWidth=i.bgWidth,e.privateStore.operationHeight=i.bgHeight,e.privateStore.canvasTop=i.y,e.privateStore.canvasLeft=i.x}else t.isPreview?console.log("Window size is too small!"):alert("Window size is too small!")},changePage:function(e){e=parseInt(e)||0,e!==this.sharedStore.selectedPageIdx&&(this.clearCanvas(),this.sharedStore.selectedPageIdx=e,this.initCanvas(),this.$broadcast("notifyRefreshBackground"))},handleOndrop:function(e){var t=this,a=t.sharedStore,r=a.pages[a.selectedPageIdx].canvas;if(e){var s,d=e.newAdded,l=e.isBg,c=a.dragData.imageId,p=a.dragData.sourceImageUrl;s=d?r.params.length-1:l?0:e.idx,r.params[s].imageId=c;var h=n.getImageDetail(c);h&&(r.params[s].imageGuid=h.guid,r.params[s].imageWidth=h.width,r.params[s].imageHeight=h.height);var g=o.getDefaultCrop(r.params[s].imageWidth,r.params[s].imageHeight,r.params[s].width*r.ratio,r.params[s].height*r.ratio),m=g.px,u=g.py,f=g.pw,v=g.ph,x=r.params[s].width*r.ratio/f,w=r.params[s].height*r.ratio/v;r.params[s].cropX=h.width*m,r.params[s].cropY=h.height*u,r.params[s].cropW=h.width*f,r.params[s].cropH=h.height*v,r.params[s].cropPX=m,r.params[s].cropPY=u,r.params[s].cropPW=f,r.params[s].cropPH=v,r.params[s].imageRotate=0;var S=i(6),y=S.getEncImgId(c),I=S.getQueryString({encImgId:y,px:m,py:u,pw:f,ph:v,width:Math.round(x),height:Math.round(w)});r.params[s].url="/imgservice/op/crop?"+I,r.params[s].isRefresh=!0,r.params[s].sourceImageUrl=p,n.freshImageUsedCount(),t.freshImageList()}},freshImageList:function(){this.$dispatch("dispatchImageList")},addImage:function(e){if(e&&void 0!=e.id&&null!=e.id){e.x=e.x||0,e.y=e.y||0;var i=t.pages[t.selectedPageIdx].canvas,a=d.getDefaultNewElementPosition({x:e.x,y:e.y});if(i.params.length)var o=parseInt(i.params[i.params.length-1].id)+1;else var o=0;var r={id:o,elType:"image",url:"",isRefresh:!1,x:a.x,y:a.y,width:a.width,height:a.height,rotate:0,dep:i.params.length,imageId:"",cropPX:0,cropPY:0,cropPW:1,cropPH:1};l.createImage(r);var n={newAdded:!0,isBg:!1};t.dropData.newAdded=n.newAdded,t.dropData.isBg=n.isBg,t.watches.isOnDrop=!0}},removeImage:function(e){l.deleteImage(e),n.freshImageUsedCount(),this.freshImageList()},removeText:function(e){c.deleteText(e)},refreshCanvas:function(){this.$broadcast("notifyRefreshBackground"),this.clearCanvas(),this.initCanvas()}},events:{notifyChangePage:function(e){this.changePage(e)},notifyRotate:function(){d.freshPageData(),this.refreshCanvas()},notifyRepaintProject:function(){d.freshPageData(),this.refreshCanvas()},notifyPaint:function(){d.loadProjectIntoPages(),this.freshImageList(),this.initCanvas()},notifyRepaint:function(e){void 0!=e&&null!=e&&(t.isPreview||d.syncProjectData(e)),this.clearCanvas(),d.loadProjectIntoPages(),this.freshImageList(),this.initCanvas()},notifyRefreshCanvas:function(){this.refreshCanvas()},notifyRemoveImage:function(e){this.removeImage(e)},notifyAddImage:function(e){this.addImage(e)},dispatchDepthFront:function(e){if(void 0!=e&&null!=e){var i=t.pages[t.selectedPageIdx].canvas;d.changeDepthValue({idx:e,targetDepth:i.params.length-1})}},dispatchDrop:function(e){this.addImage(e)},dispatchHCenter:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.selectedIdx;d.hCenterElement(i)}},ready:function(){var e=this;e.$watch("sharedStore.watches.isChangeDepthFront",function(){if(e.sharedStore.watches.isChangeDepthFront){e.sharedStore.watches.isChangeDepthFront=!1;var i=e.sharedStore.watchData.changeDepthIdx;if(e.sharedStore.watchData.changeDepthIdx="",null!=i&&""!==i){var a=t.pages[t.selectedPageIdx].canvas;d.changeDepthValue({idx:i,targetDepth:a.params.length-1})}}}),e.$watch("sharedStore.watches.isOnDrop",function(){e.sharedStore.watches.isOnDrop&&(e.sharedStore.watches.isOnDrop=!1,e.handleOndrop(e.sharedStore.dropData))}),e.$watch("sharedStore.watches.isRemoveElement",function(){if(e.sharedStore.watches.isRemoveElement){e.sharedStore.watches.isRemoveElement=!1;var t=e.sharedStore.watchData.removeElementIdx,i=e.sharedStore.watchData.removeElementType;e.sharedStore.watchData.removeElementIdx="",e.sharedStore.watchData.removeElementType="",null!=t&&""!==t&&("image"===i?e.removeImage(t):e.removeText(t))}})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){var a=i(21),o=a.extend(i(40)),r=a.extend(i(44));e.exports={template:'<div v-on:click="blurFocus()" style="float: right;"><!-- action panel component --><action-panel v-if="!sharedStore.isPreview"></action-panel><!-- operation area --><operation-area></operation-area><div class="bed-actionpanel-bottom"><div style="height: 80px;text-align: center;"><div class="action-item" v-show="shouldChangePageShow" style="margin-top: 20px; width: 160px;height: 28px;line-height: 28px;border-radius: 14px;"><div class="button" v-on:click="broadcastChangePage()" style="width: 80px;float: left;border-top-left-radius: 14px;border-bottom-left-radius: 14px; font-size: 12px; font-weight: 500;"><i class="fa fa-caret-left" style="font-size: 12px;"></i>&nbsp&nbspFront</div><div class="button" v-on:click="broadcastChangePage(1)" style="width: 80px;float: left;border-top-right-radius: 14px;border-bottom-right-radius: 14px; font-size: 12px; font-weight: 500;">Back&nbsp&nbsp<i class="fa fa-caret-right" style="font-size: 12px;"></i></div></div></div></div></div>',data:function(){return{privateStore:{},sharedStore:t}},computed:{shouldActionPanelShow:function(){return!t.isPreview},shouldChangePageShow:function(){return!!this.sharedStore.isChangePageShow}},components:{"action-panel":o,"operation-area":r},methods:{blurFocus:function(){this.$dispatch("dispatchClearScreen")},broadcastChangePage:function(e){t.vm.$broadcast("notifyChangePage",e)}}}}).call(t,i(2))},function(e,t,i){(function(t){var a=i(5);e.exports={template:'<div class="box-handle" id="handles-{{ id }}" v-bind:style="{ opacity: isShowHandles? 1: 0 }"><!-- center layer --><div class="handle-center-layer" draggable="true"></div><!-- top left corner handle --><div class="handle-icon" id="" style="top: -4px; left: -4px;" v-if="isCornerHandles"></div><div class="handle handle-corner handle-top-left" id="" draggable="true" style="top: -4px; left: -4px;" v-if="isCornerHandles"></div><!-- top side handle --><div class="handle-icon" id="" style="top: -4px; left: {{ halfLeft }};" v-if="isSideHandles"></div><div class="handle handle-side handle-top-side" id="" draggable="true" style="top: -4px; left: {{ halfLeft }};" v-if="isSideHandles"></div><!-- top right corner handle --><div class="handle-icon" id="" style="top: -4px; right: -4px;" v-if="isCornerHandles"></div><div class="handle handle-corner handle-top-right" id="" draggable="true" style="top: -4px; right: -4px;" v-if="isCornerHandles"></div><!-- right side handle --><div class="handle-icon" id="" style="top: {{ halfTop }}; right: -4px;" v-if="isSideHandles"></div><div class="handle handle-side handle-right-side" id="" draggable="true" style="top: {{ halfTop }}; right: -4px;" v-if="isSideHandles"></div><!-- bottom right corner handle --><div class="handle-icon" id="" style="bottom: -4px; right: -4px;" v-if="isCornerHandles"></div><div class="handle handle-corner handle-bottom-right" id="" draggable="true" style="bottom: -4px; right: -4px;" v-if="isCornerHandles"></div><!-- bottom side handle --><div class="handle-icon" id="" style="bottom: -4px; left: {{ halfLeft }};" v-if="isSideHandles"></div><div class="handle handle-side handle-bottom-side" id="" draggable="true" style="bottom: -4px; left: {{ halfLeft }};" v-if="isSideHandles"></div><!-- bottom left corner handle --><div class="handle-icon" id="" style="bottom: -4px; left: -4px;" v-if="isCornerHandles"></div><div class="handle handle-corner handle-bottom-left" id="" draggable="true" style="bottom: -4px; left: -4px;" v-if="isCornerHandles"></div><!-- left side handle --><div class="handle-icon" id="" style="top: {{ halfTop }}; left: -4px;" v-if="isSideHandles"></div><div class="handle handle-side handle-left-side" id="" draggable="true" style="top: {{ halfTop }}; left: -4px;" v-if="isSideHandles"></div></div>',props:["id","isCornerHandles","isSideHandles","isShowHandles"],data:function(){return{}},computed:{halfLeft:function(){var e=t.pages[t.selectedPageIdx].canvas,i=a.getIndexById(this.id);return e.params[i].width/2*e.ratio-4+"px"},halfTop:function(){var e=t.pages[t.selectedPageIdx].canvas,i=a.getIndexById(this.id);return e.params[i].height/2*e.ratio-4+"px"}},methods:{bindHandleEvents:function(e){this.bindLayerEvents(e),this.isCornerHandles&&this.bindCornerEvents(e),this.isSideHandles&&this.bindSideEvents(e)},bindLayerEvents:function(e){var i=this;if(null!=e){var a,o,r,n,s,d,l=document.getElementById("handles-"+e),c=l.querySelector(".handle-center-layer"),p=!1;"bg"===e?(c.ondrop=function(e){e.preventDefault(),!p&&t.dragData.isFromList&&(console.log("drop",e),i.$dispatch("dispatchDrop",{id:i.id,x:e.offsetX||e.layerX||0,y:e.offsetY||e.layerY||0}))},c.ondragover=function(e){e.preventDefault()},c.onclick=function(e){console.log("click",e)},c.ondblclick=function(e){console.log("dbclick",e)},c.onmouseover=function(e){},c.onmouseout=function(e){}):(c.onmousedown=function(e){e.preventDefault(),p=!0,a=e.screenX||0,o=e.screenY||0,t.operateMode="drag",i.$dispatch("dispatchDragStart"),s=function(e){e.preventDefault(),r=e.screenX||0,n=e.screenY||0;var s=r-a,d=n-o;0===r&&0===n?s=d=0:(a=r,o=n),t.operateMode="drag",i.$dispatch("dispatchMove",{x:s,y:d})},d=function(e){e.preventDefault(),document.removeEventListener("mouseup",d),document.removeEventListener("mousemove",s),p=!1,r=e.screenX||0,n=e.screenY||0,console.log(e,r,n);var l=r-a,c=n-o;0===r&&0===n?l=c=0:(a=r,o=n),(Math.abs(l)>8||Math.abs(c)>8)&&(l=0,c=0),i.$dispatch("dispatchMove",{x:l,y:c}),i.$dispatch("dispatchDragEnd"),t.operateMode="idle"},document.addEventListener("mouseup",d),document.addEventListener("mousemove",s)},c.ondrop=function(e){e.preventDefault(),!p&&t.dragData.isFromList&&(console.log("drop",e),i.$dispatch("dispatchDrop",{id:i.id,x:e.offsetX||e.layerX||0,y:e.offsetY||e.layerY||0}))},c.ondragover=function(e){e.preventDefault(),p||i.$dispatch("dispatchDragOver")},c.onclick=function(e){e.stopPropagation(),console.log("click",e),i.$dispatch("dispatchClick")},c.ondblclick=function(e){console.log("dbclick",e),i.$dispatch("dispatchDblClick")},c.onmouseover=function(e){i.$dispatch("dispatchMouseOver")},c.onmouseout=function(e){i.$dispatch("dispatchMouseOut")}),document.onkeypress=function(e){console.log("key press",e)}}},bindCornerEvents:function(e){if(null!=e){var i,o,r,n,s,d,l=this,c=t.pages[t.selectedPageIdx].canvas,p=document.getElementById("handles-"+e),h=p.querySelectorAll(".handle-corner");for(var g in h){var m=h[g];m.onmousedown=function(e){e.stopPropagation(),e.preventDefault(),i=e.screenX||0,o=e.screenY||0,t.operateMode="scale",l.$dispatch("dispatchScaleStart");var p=e.target.className;s=function(e){e.preventDefault(),r=e.screenX||0,n=e.screenY||0;var s=r-i,d=n-o;0===r&&0===n?s=d=0:(i=r,o=n);var h=a.getIndexById(l.id);if(p.indexOf("top-left")!==-1){var g=s*c.params[h].height/c.params[h].width;l.$dispatch("dispatchMove",{x:s,y:g}),l.$dispatch("dispatchScale",{width:-1*s,height:-1*g})}else if(p.indexOf("top-right")!==-1){var g=s*c.params[h].height/c.params[h].width;l.$dispatch("dispatchMove",{x:0,y:-1*g}),l.$dispatch("dispatchScale",{width:s,height:g})}else if(p.indexOf("bottom-left")!==-1){var g=s*c.params[h].height/c.params[h].width;l.$dispatch("dispatchMove",{x:s,y:0}),l.$dispatch("dispatchScale",{width:-1*s,height:-1*g})}else if(p.indexOf("bottom-right")!==-1){var g=s*c.params[h].height/c.params[h].width;l.$dispatch("dispatchScale",{width:s,height:g})}t.operateMode="scale"},d=function(e){e.preventDefault(),document.removeEventListener("mousemove",s),document.removeEventListener("mouseup",d),r=e.screenX||0,n=e.screenY||0;var h=r-i,g=n-o;0===r&&0===n?h=g=0:(i=r,o=n);var m=a.getIndexById(l.id);if(p.indexOf("top-left")!==-1){var u=h*c.params[m].height/c.params[m].width;l.$dispatch("dispatchMove",{x:h,y:u}),l.$dispatch("dispatchScaleEnd",{width:-1*h,height:-1*u})}else if(p.indexOf("top-right")!==-1){var u=h*c.params[m].height/c.params[m].width;l.$dispatch("dispatchMove",{x:0,y:-1*u}),l.$dispatch("dispatchScaleEnd",{width:h,height:u})}else if(p.indexOf("bottom-left")!==-1){var u=h*c.params[m].height/c.params[m].width;l.$dispatch("dispatchMove",{x:h,y:0}),l.$dispatch("dispatchScaleEnd",{width:-1*h,height:-1*u})}else if(p.indexOf("bottom-right")!==-1){var u=h*c.params[m].height/c.params[m].width;l.$dispatch("dispatchScaleEnd",{width:h,height:u})}t.operateMode="idle"},document.addEventListener("mousemove",s),document.addEventListener("mouseup",d)},m.onclick=function(e){e.stopPropagation(),console.log("cornerClick",e),l.$dispatch("dispatchCornerClick")}}}},bindSideEvents:function(e){if(null!=e){var i,a,o,r,n,s,d=this,l=(t.pages[t.selectedPageIdx].canvas,document.getElementById("handles-"+e)),c=l.querySelectorAll(".handle-side");for(var p in c){var h=c[p];h.onmousedown=function(e){e.preventDefault(),e.stopPropagation();var l=e.target.className;i=e.screenX||0,a=e.screenY||0,t.operateMode="scale",d.$dispatch("dispatchScaleStart"),n=function(e){e.preventDefault(),o=e.screenX||0,r=e.screenY||0;var n=o-i,s=r-a;if(0===o&&0===r?n=s=0:(i=o,a=r),l.indexOf("top")!==-1){var c=0;d.$dispatch("dispatchMove",{x:c,y:s}),d.$dispatch("dispatchScale",{width:-1*c,height:-1*s})}else if(l.indexOf("left")!==-1){var p=0;d.$dispatch("dispatchMove",{x:n,y:p}),d.$dispatch("dispatchScale",{width:-1*n,height:-1*p})}else if(l.indexOf("right")!==-1){var p=0;d.$dispatch("dispatchScale",{width:n,height:p})}else if(l.indexOf("bottom")!==-1){var c=0;d.$dispatch("dispatchScale",{width:c,height:s})}t.operateMode="scale"},s=function(e){e.preventDefault(),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",s),o=e.screenX||0,r=e.screenY||0;var c=o-i,p=r-a;if(0===o&&0===r?c=p=0:(i=o,a=r),l.indexOf("top")!==-1){var h=0;d.$dispatch("dispatchMove",{x:h,y:p}),d.$dispatch("dispatchScaleEnd",{width:-1*h,height:-1*p})}else if(l.indexOf("left")!==-1){var g=0;d.$dispatch("dispatchMove",{x:c,y:g}),d.$dispatch("dispatchScaleEnd",{width:-1*c,height:-1*g})}else if(l.indexOf("right")!==-1){var g=0;d.$dispatch("dispatchScaleEnd",{width:c,height:g})}else if(l.indexOf("bottom")!==-1){var h=0;d.$dispatch("dispatchScaleEnd",{width:h,height:p})}t.operateMode="idle"},document.addEventListener("mousemove",n),document.addEventListener("mouseup",s)},h.onclick=function(e){e.stopPropagation(),console.log("sideClick",e),d.$dispatch("dispatchSideClick")}}}}},ready:function(){this.bindHandleEvents(this.id)}}}).call(t,i(2))},function(e,t,i){(function(t,a){e.exports={mixins:[i(7)],template:'<div class="bed-header" v-on:click="blurFocus"><div style="display: inline-block; height: 50px;"><div id="logo" v-on:click="handleLogoClicked()" style="margin-left: 40px;float: left;cursor: pointer;width:100px;" title="Home"><img src="../../static/img/new-logo.svg" height="15" draggable="false" alt="Logo" style="margin: 20px 20px 10px 0;" /></div><pre class="box-title" style="float: left;">{{ sharedStore.title }}</pre></div><div style="float: right; height: 48px;margin-top: 2px;"><span class="menu-item" v-on:click="handleOptions()" style="height: 48px;line-height: 48px;margin-right: 40px;">Options</span><span class="menu-item" v-on:click="handlePreview()" style="height: 48px;line-height: 48px;margin-right: 40px;">Preview</span><span v-show="!sharedStore.fromCart" id="saveButton" class="menu-item" v-on:click="handleSave()" style="height: 48px;line-height: 48px;margin-right: 40px;">Save</span><span id="orderButton" class="menu-item" v-on:click="handleOrder()" style="height: 48px;line-height: 48px;margin-right: 40px;">{{orderLabel}}</span></div><div v-on:click="handleHideHelp()" v-show="sharedStore.isShowHelp" style="position: fixed;width: 100%;height: 100%;top: 0px;" v-bind:style="{zIndex: windowZindex-2}"></div></div>',
data:function(){return{privateStore:{},sharedStore:t}},computed:{productText:function(){switch(this.sharedStore.projectSettings[t.currentSelectProjectIndex].product){case"TS":return"T-Shirt";default:return"[ERR PRODUCT]"}},orderLabel:function(){return this.sharedStore.fromCart||this.sharedStore.checkFailed?"Submit":"Order"},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleFAQ:function(){window.open("/support.html#/Software","_blank"),this.sharedStore.isShowHelp=!1},handleContactUs:function(){this.$dispatch("dispatchShowContactUsWindow"),this.sharedStore.isShowHelp=!1},handleHelp:function(){this.sharedStore.isShowHelp=!this.sharedStore.isShowHelp},handleDownloadSpec:function(){t.isPopSave=!1,window.open("assets/data/14X16SPEC_TS.zip","_parent")},handleLogoClicked:function(){this.$dispatch("dispatchShowPopup",{type:"logo",status:-1})},handlePreview:function(){i(6).getIsShowProjectInfoView()?t.isInnerPreviewShow=!0:i(13).handledSaveOldProject(this,"dispatchPreviewSave"),i(8)({ev:i(9).ClickPreview})},handleSave:function(e,t,a){var o=this;if(i(6).getIsShowProjectInfoView()){var r=i(6).getProjectInfoViewText();this.$dispatch("dispatchShowPopup",{type:"saveAs",status:0,info:r})}else i(13).saveOldProject(o,i(7).deleteImageList);i(8)({ev:i(9).ClickSave})},handleOrder:function(){if(t.checkFailed)i(13).saveOldProject(_this,function(){i(7).updateCheckStatus()});else if(i(6).getIsShowProjectInfoView()){var e=i(6).getProjectInfoViewText();this.$dispatch("dispatchShowPopup",{type:"saveAs",status:0,info:e})}else this.$dispatch("dispatchShowOrderWindow")},handleOptions:function(){this.$dispatch("dispatchShowOptionWindow")},handleHideHelp:function(){this.sharedStore.isShowHelp=!1},blurFocus:function(){this.$dispatch("dispatchClearScreen")}},events:{notifyPreviewSave:function(e){console.log("save-"+e),"success"===e?t.isInnerPreviewShow=!0:this.$dispatch("dispatchShowPopup",{type:"save",status:-1})},notifyResetProjectInfo:function(e){e?(a("#saveButton").css("pointer-events","auto"),a("#saveButton").css("opacity",1),a("#orderButton").css("pointer-events","auto"),a("#orderButton").css("opacity",1)):(a("#saveButton").css("pointer-events","none"),a("#saveButton").css("opacity",.4),a("#orderButton").css("pointer-events","none"),a("#orderButton").css("opacity",.4))}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){var o=(i(29),i(27)),r=i(12),n=i(16),s=i(22),d=i(14);e.exports={template:'<div class="bed-image-crop" v-show="sharedStore.isImageCropShow"><div class="shadow-bg"></div><div class="box-image-crop" v-bind:style="{ zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 700px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="hideImageCrop()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Set Image</div><div class="font-desc t-left">Image - {{ imageName }}</div></div><div style="margin: 30px auto 20px;width: 680px;"><div id="box-crop"><img id="image-tobecrop" src="" /></div></div><div style="height: 46px;"><span class="button-circle" v-on:click="doRotate(-90) | debounce" style="display: inline-block; margin-left: 291px;height:46px;" title="rotate left"><img src="../../static/img/rotate_left.png" onmouseover="this.src = \'../../static/img/rotate_left_hover.png\';" onmouseout="this.src = \'../../static/img/rotate_left.png\';" width="46" height="46" alt="rotate left" /></span><span class="button-circle" v-on:click="doRotate(90) | debounce" style="display: inline-block; margin-left: 70px;" title="rotate right"><img src="../../static/img/rotate_right.png" onmouseover="this.src = \'../../static/img/rotate_right_hover.png\';" onmouseout="this.src = \'../../static/img/rotate_right.png\';" width="46" height="46" alt="rotate right" /></span></div><div style="height: 20px;"><span style="display: inline-block; width: 46px; height: 20px; line-height: 20px; text-align: center; margin-left: 291px; font-size: 12px; color: #7a7a7a;">- 90°</span><span style="display: inline-block; width: 46px; height: 20px; line-height: 20px; text-align: center; margin-left: 70px; font-size: 12px; color: #7a7a7a;">+ 90°</span></div><div class="button" v-on:click="doImageCrop()" style="display: inline-block; width: 160px;height: 40px;line-height: 40px;margin:25px 0 0 290px;text-align: center;font-size: 14px;" title="Click to crop image">Done</div></div></div>',data:function(){return{privateStore:{jcrop_api:"",isCanRotate:!1,cropWindowParams:{width:740,height:698,selector:".box-image-crop"},isRemoveButtonShow:!0},init:[],selectedIdx:"",sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{hideImageCrop:function(){this.selectedIdx="",this.sharedStore.isImageCropShow=!1},handleSendToBack:function(){var e=t.pages[t.selectedPageIdx].canvas;d.sendToBack({idx:e.selectedIdx}),this.hideImageCrop()},doRotate:function(e){if(this.privateStore.isCanRotate){var t=this,i=t.sharedStore,a=i.pages[i.selectedPageIdx].canvas,r=""!==this.selectedIdx?this.selectedIdx:a.selectedIdx,n=o.getRotatedAngle(a.params[r].imageRotate,e);if(a.params[r].imageRotate=n,90===Math.abs(a.params[r].imageRotate))var s=a.params[r].imageHeight,d=a.params[r].imageWidth;else var s=a.params[r].imageWidth,d=a.params[r].imageHeight;var l=o.getDefaultCrop(s,d,a.params[r].width*a.ratio,a.params[r].height*a.ratio),c=l.px,p=l.py,h=l.pw,g=l.ph;a.params[r].width*a.ratio/h,a.params[r].height*a.ratio/g;a.params[r].cropX=s*c,a.params[r].cropY=d*p,a.params[r].cropW=s*h,a.params[r].cropH=d*g,a.params[r].cropPX=c,a.params[r].cropPY=p,a.params[r].cropPW=h,a.params[r].cropPH=g,a.params[r].isRefresh=!0,t.triggerImageCrop()}},triggerImageCrop:function(e){var t=this.sharedStore,i=t.pages[t.selectedPageIdx].canvas;""!==this.selectedIdx&&(i.selectedIdx=this.selectedIdx),null!=e&&""!==e?e:e=i.selectedIdx,i.params[e].imageId&&(this.handleCropInit(e),r.setPopWindowPosition(this.privateStore.cropWindowParams),t.isImageCropShow=!0)},handleCropInit:function(e){var t=this,o=t.sharedStore,r=o.pages[o.selectedPageIdx].canvas;t.privateStore.isCanRotate=!1,null!=e&&""!==e?e:e=r.selectedIdx;var s=n.getImageDetail(r.params[e].imageId),d=s.width,l=s.height;if(this.init[e]||(r.params[e].cropX=d*r.params[e].cropPX,r.params[e].cropY=l*r.params[e].cropPY,r.params[e].cropW=d*r.params[e].cropPW,r.params[e].cropH=l*r.params[e].cropPH,r.params[e].imageWidth=s.width,r.params[e].imageHeight=s.height,this.init[e]=!0),t.imageName=s.name||"",90===Math.abs(r.params[e].imageRotate))var c=r.params[e].imageHeight,p=r.params[e].imageWidth;else var c=r.params[e].imageWidth,p=r.params[e].imageHeight;var h=(r.params[e].cropX/c,r.params[e].cropY/p,r.params[e].cropW/c),g=r.params[e].cropH/p,m=(r.params[e].width*r.ratio/h,r.params[e].height*r.ratio/g,680),u=400;this.privateStore.cropWindowParams.height>window.innerHeight&&(u=window.innerHeight-295);var f=m/u,v=c/p;f>v?o.cropImageRatio=u/p:o.cropImageRatio=m/c;var x=c*o.cropImageRatio,w=p*o.cropImageRatio,S=(m-x)/2,y=(u-w)/2;a("#box-crop").css("margin-left",S).css("padding-top",y),""!==t.privateStore.jcrop_api&&t.privateStore.jcrop_api.destroy();var I=i(6),b=I.getEncImgId(r.params[e].imageId),P=I.getQueryString({encImgId:b,px:0,py:0,pw:1,ph:1,width:Math.round(x),height:Math.round(w),rotation:r.params[e].imageRotate});a("#image-tobecrop").attr("src","/imgservice/op/crop?"+P).attr("width",x).attr("height",w).css("width",x).css("height",w).Jcrop({aspectRatio:r.params[e].width/r.params[e].height,setSelect:[r.params[e].cropX*o.cropImageRatio,r.params[e].cropY*o.cropImageRatio,(r.params[e].cropX+r.params[e].cropW)*o.cropImageRatio,(r.params[e].cropY+r.params[e].cropH)*o.cropImageRatio],bgColor:"black",allowSelect:!1,bgOpacity:.4,onSelect:function(e){o.cropParams={x:e.x,y:e.y,w:e.w,h:e.h}}},function(){t.privateStore.jcrop_api=this,t.privateStore.isCanRotate=!0})},doImageCrop:function(){var e=this,t=e.sharedStore,i=t.pages[t.selectedPageIdx].canvas,a=i.selectedIdx;if(90===Math.abs(i.params[a].imageRotate))var o=i.params[a].imageHeight,r=i.params[a].imageWidth;else var o=i.params[a].imageWidth,r=i.params[a].imageHeight;var n=(i.params[a].imageId,t.cropParams.x/t.cropImageRatio/o),s=t.cropParams.y/t.cropImageRatio/r,d=t.cropParams.w/t.cropImageRatio/o,l=t.cropParams.h/t.cropImageRatio/r;i.params[a].width*i.ratio/d,i.params[a].height*i.ratio/l;i.params[a].cropX=t.cropParams.x/t.cropImageRatio,i.params[a].cropY=t.cropParams.y/t.cropImageRatio,i.params[a].cropW=t.cropParams.w/t.cropImageRatio,i.params[a].cropH=t.cropParams.h/t.cropImageRatio,i.params[a].cropPX=n,i.params[a].cropPY=s,i.params[a].cropPW=d,i.params[a].cropPH=l,i.params[a].isRefresh=!0,e.hideImageCrop()},handleRemoveImage:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;s.deleteImage(e.selectedIdx),n.freshImageUsedCount(),this.sharedStore.isImageCropShow=!1}},props:["imageName"],events:{notifyImageCrop:function(){this.triggerImageCrop()},notifyRotateImage:function(e){var t=this,i=t.sharedStore,a=i.pages[i.selectedPageIdx].canvas;void 0!=e.idx&&null!=e.idx&&""!==e.idx?e.idx:e.idx=a.selectedIdx,void 0!=e.nDegree&&null!=e.nDegree?e.nDegree:e.nDegree=0;var r=e.idx,n=e.nDegree,s=o.getRotatedAngle(a.params[r].imageRotate,n);if(a.params[r].imageRotate=s,90===Math.abs(a.params[r].imageRotate))var d=a.params[r].imageHeight,l=a.params[r].imageWidth;else var d=a.params[r].imageWidth,l=a.params[r].imageHeight;var c=o.getDefaultCrop(d,l,a.params[r].width*a.ratio,a.params[r].height*a.ratio),p=c.px,h=c.py,g=c.pw,m=c.ph;a.params[r].width*a.ratio/g,a.params[r].height*a.ratio/m;a.params[r].cropX=d*p,a.params[r].cropY=l*h,a.params[r].cropW=d*g,a.params[r].cropH=l*m,a.params[r].cropPX=p,a.params[r].cropPY=h,a.params[r].cropPW=g,a.params[r].cropPH=m,a.params[r].isRefresh=!0}},created:function(){var e=this;e.$watch("sharedStore.watches.isCropThisImage",function(){if(e.sharedStore.watches.isCropThisImage){var t=e.sharedStore.watchData.cropImageIdx;this.selectedIdx=t,e.sharedStore.watches.isCropThisImage=!1,e.sharedStore.watchData.cropImageIdx="",e.triggerImageCrop(t)}})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){e.exports={template:'<div style="text-align: center;"><div class="button" v-on:click="triggerImageUpload()" style="width: 260px;height: 50px;line-height: 50px;margin: 40px 0px 10px 40px;font-size: 14px;">Add Photos</div><div class="t-left" style="margin: 0 0 2px 40px;height: 20px;line-height: 20px;"><input type="checkbox" id="input-hideused" v-on:click="handleHideUsedToggle()" v-model="privateStore.isHideUsed" style="float: left;" /><label for="input-hideused" style="height: 20px;line-height: 20px;padding-left:4px;font-size: 12px;float:left;display:inline-block;cursor:pointer;">Hide Used</label></div><div id="list-image"><div class="item-image" v-for="item in newImageList" v-on:mouseover="handleShowDeleteIcon($index)" v-on:mouseout="handleHideDeleteIcon($index)"><span class=""><span class="box-preview-image" count-content="{{ item.usedCount }}" v-bind:style="{opacity: item.usedCount > 0? 1: 0 }" ></span><img class="preview-image" id="ori-image-{{ $index }}" :imageid="item.id" :imageurl="item.url" :src="item.previewUrl" :alt="item.name" draggable="true" /></span><img id="icon-delete-{{ $index }}" src="../../static/img/delete.svg" width="20" height="20" v-on:click="handleDeleteImage($index)" v-show="item.usedCount <= 0" alt="delete" title="delete" style="position: relative; top: 7px; left: -16px; opacity: 0; cursor: pointer;" /><img src="../../static/img/delete.svg" width="20" height="20" v-else alt="delete" style="position: relative; top: 7px; left: -16px; opacity: 0; cursor: pointer;" /><div class="preview-image-tip" title="{{ item.imageTip.longTip }}">{{ item.imageTip.shortTip }}</div></div></div></div>',data:function(){return{privateStore:{imageList:[],isHideUsed:!1,imageListParams:{selector:"#list-image"}},sharedStore:t}},computed:{newImageList:function(){for(var e=[],t=0;t<this.sharedStore.imageList.length;t++)(this.privateStore.isHideUsed===!1||this.privateStore.isHideUsed===!0&&this.sharedStore.imageList[t].usedCount<=0)&&(e.push(this.sharedStore.imageList[t]),e[e.length-1].previewUrl=this.sharedStore.imageList[t].url+"350",e[e.length-1].imageTip=this.chopImageTip(this.sharedStore.imageList[t].name,this.sharedStore.imageList[t].width,this.sharedStore.imageList[t].height));return this.bindImageDragEvent(),e}},methods:{triggerImageUpload:function(){this.$dispatch("dispatchImageUpload"),i(8)({ev:i(9).AddPhotos})},chopImageTip:function(e,t,i){e=e||"",t=t||0,i=i||0;var a="",o="",r="",n="";if(t>0&&i>0&&(r=a=" ("+t+"x"+i+")"),e.length+a.length>20)if(a.length>14){var s=t+"x"+i;if(r=" ("+s.substr(0,9)+"...)",e.length>6){var d=6,l=d-4;o=e,n=o.substr(0,l)+"..."+o.substr(o.length-3)}else n=o=e}else{var d=20-a.length,l=d-4;o=e,n=o.substr(0,l)+"..."+o.substr(o.length-3)}else n=o=e;return{longTip:o+a,shortTip:n+r}},handleHideUsedToggle:function(){},handleShowDeleteIcon:function(e){a("#icon-delete-"+e).css("opacity",1)},handleHideDeleteIcon:function(e){a("#icon-delete-"+e).css("opacity",0)},handleDeleteImage:function(e){if(void 0!=e){var t=a("#ori-image-"+e).attr("imageid")||"";if(""!==t)for(var i=0;i<this.sharedStore.imageList.length;i++)if(t==this.sharedStore.imageList[i].id){this.sharedStore.imageList.splice(i,1),this.sharedStore.deleImagelist.push(this.sharedStore.imageList[i].encImgId);break}}},bindImageDragEvent:function(){var e=this;e.$nextTick(function(){console.log("binding events now");for(var t=0;t<a(".item-image").length;t++)a(".item-image")[t].ondragstart=function(t){console.log("trigger event now "+a(t.target).attr("imageid")),e.$dispatch("dispatchShowSpineLines"),e.sharedStore.elementDragged=t.target,e.sharedStore.dragData.imageId=a(t.target).attr("imageid"),e.sharedStore.dragData.sourceImageUrl=a(t.target).attr("imageurl"),e.sharedStore.dragData.cursorX=t.offsetX||0,e.sharedStore.dragData.cursorY=t.offsetY||0,e.sharedStore.dragData.isFromList=!0,e.sharedStore.operateMode="drag"},a(".item-image")[t].ondragend=function(t){console.log("dragging ends now"),e.sharedStore.dragData.isFromList=!1,e.sharedStore.operateMode="idle",e.$dispatch("dispatchHideSpineLines")}})}},events:{notifyImageList:function(){console.log("notify image list event");var e=i(12);e.initImageListSize(this.privateStore.imageListParams)}},created:function(){}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={template:'<div v-show="sharedStore.isInnerPreviewShow" style="position: fixed; z-index: 9999999; left: 0; top: 0; width: 100%; height: 100%; background-color: white;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHidePreview()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="position: absolute; top: 18px; right: 44px; cursor: pointer;" /><iframe v-bind:src="privateStore.previewUrl" frameborder="0" scrolling="auto" style="width: 100%; height: 100%;"></iframe></div>',data:function(){return{privateStore:{previewUrl:""},sharedStore:t}},computed:{},methods:{handleHidePreview:function(){this.sharedStore.isInnerPreviewShow=!1}},ready:function(){var e=this;e.$watch("sharedStore.isInnerPreviewShow",function(){if(e.sharedStore.isInnerPreviewShow){var i=window.location.href,a=i.split("index.html?")[0];i=a+"preview.html?initGuid="+t.projectId+"&isPreview=true&source=self",e.privateStore.previewUrl=i}else e.privateStore.previewUrl=""})}}}).call(t,i(2))},function(e,t,i){(function(t){var a=i(21),o=a.extend(i(49)),r=a.extend(i(59));e.exports={template:'<div class="bed-list-tab" v-on:click="blurFocus" style="float: left;border-right: 1px solid rgba(232, 232, 232, 1);"><div style="height: 60px;"><div class="t-center" v-bind:class="list0Class" v-on:click="handleChangeTab(0)" style="width: 169px;border-right:1px solid rgba(232, 232, 232, 1);">Your Items</div><div class="t-center" v-bind:class="list1Class" v-on:click="handleChangeTab(1)" style="width: 169px;">Images</div></div><div style="width:16px;height:16px;position: absolute;top: 60px;left: 135px;"><span style="padding-top: 2px;font-size: 12px;line-height: 12px;display:block;color:#e13724;text-align:center;">{{sharedStore.itemListNum}}</span></div><image-list v-show="privateStore.currentView === \'image-list\'"></image-list><project-item-list v-show="privateStore.currentView === \'project-item-list\'"></project-item-list></div>',data:function(){return{privateStore:{currentView:"image-list"},sharedStore:t}},computed:{list0Class:function(){return"project-item-list"===this.privateStore.currentView?"list-tab-selected":"list-tab"},list1Class:function(){return"image-list"===this.privateStore.currentView?"list-tab-selected":"list-tab"}},components:{"image-list":o,"project-item-list":r},methods:{handleChangeTab:function(e){switch(e){case 0:this.privateStore.currentView="project-item-list";break;case 1:this.privateStore.currentView="image-list"}},blurFocus:function(){this.$dispatch("dispatchClearScreen")}}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={props:["measure","id","num","disabled"],template:'<div style="display: inline-block;width:156px;height:38px;line-height:38px;margin-right:20px;margin-bottom:20px"><label style="float:left;width:40px;height:38px;text-align:right;color:#7b7b7b;font-size:14px;">{{showMeasure}}:</label><a v-if="!disabled && this.num > 0" style="float:left;margin-left: 5px;height:38px;width: 26px;" href="javascript:" v-on:click="numDown()"><img style="margin-top:6px;" src="assets/img/down.png" draggable="false"></a><a v-if="disabled || this.num <= 0" style="float:left;margin-left: 5px;height:38px;width: 26px;cursor:not-allowed;" href="javascript:"><img style="margin-top:6px;" src="assets/img/down-Disable.png" draggable="false"></a><div style="float:left;width:50px;height:38px;margin-left:4px;"><input v-on:blur="handleTextBlur()" style="display:block;width:100%;text-align:center;color:#7b7b7b;margin-top:6px;height:24px;font-size:14px;top:5px;background:#f4f4f4;border-style:none" v-model="num" v-bind:disabled="disabled"/></div><a v-if="!disabled && this.num < 99999" style="float:left;margin-left: 4px;width: 26px;height: 38px;" href="javascript:" v-on:click="numUp()"><img style="margin-top:6px;" src="assets/img/up.png" draggable="false"></a><a v-if="disabled || this.num >= 99999" style="float:left;margin-left: 4px;width: 26px;height: 38px;cursor:not-allowed;" href="javascript:"><img style="margin-top:6px;" src="assets/img/up-Disable.png" draggable="false"></a></div>',data:function(){return{privateStore:{isFireFox:!1},sharedStore:t}},computed:{showMeasure:function(){return"XXL"===this.measure?"2XL":this.measure}},methods:{numUp:function(){this.disabled||(this.num++,this.num>99999&&(this.num=99999))},numDown:function(){this.disabled||(this.num--,this.num<0&&(this.num=0))},handleTextBlur:function(){var e=Math.round(this.num);isNaN(e)&&(e=1),e<0?e=0:e>99999&&(e=99999),this.num=e}},ready:function(){},events:{}}}).call(t,i(2))},function(e,t,i){(function(t,a){e.exports={template:'<div  v-show="sharedStore.isOptionsViewShow"><div class="shadow-bg"></div><div id="option-window" class="box-options" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }" ><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHideOptionsView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Options</div></div><div style="margin-top: 50px; margin-left: 40px;"><div><label class="invalid-title-text" v-show="privateStore.isTitleInvalid">{{privateStore.invalidTxt}}</label></div><div class="options-div"><label class="options-label font-label" style="height: 35px; line-height: 35px;">Title:</label><input class="input font-input" id="titleInput" type="text" name="title" v-model="privateStore.currentSelectTitle" style="width: 453px; height: 33px;" v-on:blur="handleTitleInputBlur()" maxlength="50"/></div></div><div class="options-button"><div class="button t-center" v-on:click="handleSubmitOptions()" style="width: 160px;height: 40px;line-height: 40px;margin:0 auto;font-size: 14px;">Done</div></div></div></div>',data:function(){return{privateStore:{currentSelectTitle:"",isTitleInvalid:!1,invalidTxt:"Incorrect format, please try again.",width:650,height:300,selector:"#option-window"},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideOptionsView:function(){this.sharedStore.isOptionsViewShow=!1,this.initOptions()},handleSubmitOptions:function(){if(this.privateStore.isTitleInvalid=!this.checkInvalid(this.privateStore.currentSelectTitle),console.log(this.privateStore.isTitleInvalid),!this.privateStore.isTitleInvalid&&this.privateStore.currentSelectTitle.trim())if(this.sharedStore.title!=this.privateStore.currentSelectTitle){(new Date).valueOf();i(13).changeProjectTitle(this.privateStore.currentSelectTitle,this,"dispatchUpdateAlbumResponse")}else this.submitData();else this.privateStore.currentSelectTitle.trim()?this.privateStore.invalidTxt="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.":this.privateStore.invalidTxt="Title is required.",this.privateStore.isTitleInvalid=!0},submitData:function(){this.sharedStore.title=this.privateStore.currentSelectTitle,this.sharedStore.isOptionsViewShow=!1,this.initOptions()},handleCanelOptions:function(){this.sharedStore.isOptionsViewShow=!1,this.initOptions()},handleTitleInputBlur:function(){var e=a("#titleInput");e.val(this.replaceInvalidString(e.val())),this.privateStore.isTitleInvalid=!this.checkInvalid(this.privateStore.currentSelectTitle),this.privateStore.currentSelectTitle.trim()?this.privateStore.invalidTxt="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.":this.privateStore.invalidTxt="Title is required."},checkInvalid:function(e){return/^[a-zA-Z 0-9\d_\s\-]+$/.test(e)},replaceInvalidString:function(e){var t=/<\/?[^>]*>/g,i=/[ | ]*\n/g,a=/&nbsp;/gi;return e.replace(t,"").replace(i,"").replace(a,"").replace(/(^\s+)|(\s+$)/g,"")},initOptions:function(){this.privateStore.isTitleInvalid=!1,this.privateStore.currentSelectTitle=this.sharedStore.title}},ready:function(){this.initOptions()},events:{notifyShowOptionWindow:function(){console.log("showOptionWindow");var e=i(12);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.sharedStore.isOptionsViewShow=!0,this.initOptions()},notifyUpdateAlbumResponse:function(e,t){this.privateStore.isTitleInvalid=e,console.log(this.privateStore.isTitleInvalid),this.privateStore.isTitleInvalid?this.privateStore.invalidTxt=t:this.submitData()}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){e.exports={template:'<div  v-show="sharedStore.isOrderViewShow"><div class="shadow-bg"></div><div id="order-window" class="box-order" style="overflow-x: hidden; overflow-y: hidden;" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }" ><div style="height: 40px:line-height: 40px;"><div id="closeButton" style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHideOptionsView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Select Your Quantity</div></div><div style="width:100%;height:320px;overflow:hidden;overflow-y: auto;margin: 40px 0px 0px 0px;" ><div style="display:inline-block;width:100%;margin-left:30px;margin-top:14px;margin-bottom:14px" v-for="item in newImageList"><span style="display:inline-block;position:relative;height:110px;"><img class="order-project-image" style="width:auto;position:absolute;top:0;left:0" v-bind:class="{ \'order-select-image\': item.isEmpty}"  id="project-item-{{ $index }}" :imageid="item.id" :imageurl="item.url" :src="item.previewUrl" :alt="item.color"/><img class="order-project-image" style="width:auto;position:absolute;top:0;left:0" v-bind:class="{ \'order-select-image\': item.isEmpty}"  id="project-item-{{ $index }}" :imageid="item.id" :imageurl="item.url" :src="sharedStore.currentImage" :alt="item.color"/></span><div style="position:relative;display:inline-block;width:530px;top:15px;left:95px;"><measure-option v-for="measure in item.measures"  v-bind:measure="measure.measure" v-bind:id="item.id" v-bind:num.sync="measure.num" v-bind:disabled="measure.isDisabled"></measure-option></div></div></div><div style="width: 230px;text-align: center;height: 40px;line-height: 40px;margin:0 auto;font-size: 14px;color:red;" v-show="privateStore.isShowEmptyLabel">Please select your quantity!</div><div><div v-on:click="handleShowSizeChart()" style="text-decoration: underline;margin-left: 30px;font-size: 14px;color: #7b7b7b;cursor:pointer;">Size Chart</div><div id="submitButton" class="button t-center" v-on:click="handleSubmitOrder()" style="width: 160px;height: 40px;line-height: 40px;margin:10px auto;font-size: 14px;">Order</div></div></div></div>',data:function(){return{privateStore:{width:670,height:550,selector:"#order-window",measure:["S","M","L","XL","XXL"],isShowEmptyLabel:!1},sharedStore:t}},computed:{newImageList:function(){for(var e=[],t=[],i=0;i<this.sharedStore.projectSettings.length;i++){var a=this.sharedStore.projectSettings[i].color,o=this.sharedStore.projectSettings[i].count,r=this.sharedStore.projectSettings[i].measure;if(e.indexOf(a)==-1){e.push(a);for(var n=this.getColorAssets(a),s={id:i,name:a,color:a,isEmpty:!1,url:n.backgroundImage,previewUrl:n.backgroundImage},d=[],l=0;l<this.privateStore.measure.length;l++){var c=new Object,p=0,h=!1;this.privateStore.measure[l]===r&&(p=o),this.isMeasureDisabled(a,this.privateStore.measure[l])&&(h=!0),c.measure=this.privateStore.measure[l],c.num=p,c.isDisabled=h,d.push(c)}s.measures=d,t.push(s)}else for(var g=0;g<t.length;g++)if(a===t[g].color)for(var m=0;m<t[g].measures.length;m++)t[g].measures[m].measure===r&&(t[g].measures[m].num=o)}return t},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideOptionsView:function(){this.sharedStore.isOrderViewShow=!1,this.initOrders()},handleSubmitOrder:function(){for(var e=!1,t=[],a=0;a<this.newImageList.length;a++){for(var o=!0,r=0;r<this.newImageList[a].measures.length;r++)0!==this.newImageList[a].measures[r].num&&(o=!1,t.push({color:this.newImageList[a].color,measure:this.newImageList[a].measures[r].measure,count:this.newImageList[a].measures[r].num}));this.newImageList[a].isEmpty=o,o&&(e=!0)}if(e)this.privateStore.isShowEmptyLabel=!0;else{this.privateStore.isShowEmptyLabel=!1;this.sharedStore.projectSettings=[];for(var a=0;a<t.length;a++){var n=t[a],s=i(13).newProject(n.color,n.measure,n.count);this.sharedStore.projectSettings.push(s)}this.disabledSubmitButton(),i(13).orderProject(this)}i(8)({ev:i(9).ClickOrder})},handleCanelOptions:function(){this.sharedStore.isOrderViewShow=!1,this.initOrders()},initOrders:function(){this.privateStore.isShowEmptyLabel=!1},getColorAssets:function(e){for(var t=0;t<this.sharedStore.colorOptionList.length;t++)if(this.sharedStore.colorOptionList[t].type===e)return this.sharedStore.colorOptionList[t]},handleShowSizeChart:function(){this.sharedStore.isSizeChartShow=!0},disabledSubmitButton:function(){a("#submitButton").css("pointer-events","none"),a("#submitButton").css("opacity",.4),a("#closeButton").css("pointer-events","none"),a("#closeButton").css("opacity",.4)},abledSubmitButton:function(){a("#submitButton").css("pointer-events","auto"),a("#submitButton").css("opacity",1),a("#closeButton").css("pointer-events","auto"),a("#closeButton").css("opacity",1)},isMeasureDisabled:function(e,i){return t.disableOptions[e]&&t.disableOptions[e].options.indexOf(i)!==-1}},ready:function(){this.initOrders()},events:{notifyShowOrderWindow:function(){console.log("showOrderWindow");var e=i(12);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.sharedStore.isOrderViewShow=!0,this.initOrders(),this.abledSubmitButton()},notifyReorder:function(){i(13).orderProject(this)},notifyCloseWindow:function(){this.sharedStore.isOrderViewShow=!1,this.initOrders(),this.abledSubmitButton()}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={mixins:[i(24)],template:"<div style=\"position:absolute;\" v-bind:style=\"{backgroundColor:bgColor,left:elementData.x*ratio + 'px',top:elementData.y*ratio + 'px',width: viewSize.width + 'px',height:viewSize.height + 'px',zIndex:(elementData.dep+1)*100}\">"+'<img v-bind:src="photoSrc" style="position:absolute;left:0;top:0;opacity:0.2;" v-bind:style="{width: viewSize.width + \'px\',height:viewSize.height + \'px\'}" v-show="backImgShow" /><canvas id="photoElementCanvas{{id}}"  style="position:absolute;top:0;left:0;" width="{{viewSize.width}}" height="{{viewSize.height}}"></canvas><warntip-element v-bind:id="id" v-if="!sharedStore.isPreview" v-bind:width="viewSize.width" v-bind:height="viewSize.height"></warntip-element><handle v-if="!sharedStore.isPreview"  v-bind:id="id" v-bind:is-Show-Handles="isShowHandle" v-bind:is-Corner-Handles="isCornerHandles" v-bind:is-Side-Handles="isSideHandles"></handle></div>',data:function(){return{sharedStore:t,elementData:Object,ratio:0,id:0,isCornerHandles:!0,isSideHandles:!0,imageData:null,type:"image",photoSrc:"",backImgShow:!1}},computed:{isShowHandle:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.selectedIdx===i(5).getIndexById(this.id)&&!t.isLostFocus},viewSize:function(){var e=Math.ceil(this.elementData.width*this.ratio),t=Math.ceil(this.elementData.height*this.ratio);return{width:e,height:t}},bgColor:function(){return this.elementData.imageId?"rgba(255,255,255,0)":"#f5f5f5"}},methods:{init:function(e){var i=t.pages[t.selectedPageIdx].canvas;this.elementData=i.params[e],this.id=this.elementData.id,this.ratio=i.ratio},destroy:function(){},refreshImage:function(e){i(19).clear("photoElementCanvas"+this.id),i(19).drawImage("photoElementCanvas"+this.id,e,0,0,function(){t.vm.$broadcast("notifyRefreshScreenshot")},this.viewSize.width,this.viewSize.height),this.photoSrc=e},onDragOver:function(){},setCrop:function(){if(90===Math.abs(this.elementData.imageRotate))var e=i(16).getImageDetail(this.elementData.imageId).height,t=i(16).getImageDetail(this.elementData.imageId).width;else var e=i(16).getImageDetail(this.elementData.imageId).width,t=i(16).getImageDetail(this.elementData.imageId).height;var a=this.elementData.cropPX,o=this.elementData.cropPY,r=this.elementData.cropPW,n=this.elementData.cropPH,s=this.elementData.width,d=this.elementData.height,l=a,c=a+r,p=o,h=o+n,g=d/s,m=e,u=t,f=l+(c-l)/2,v=p+(h-p)/2,x=f*m,w=v*u,S=(c-l)*m/s,y=(h-p)*u/d,I=s*S,b=d*y;I>m&&(I=m),b>u&&(b=u);var P,j,C,T;I*g>b?(T=b,C=b/g):(C=I,T=I*g),P=x-C/2,P=P>0?P:0,P+C>m&&(P-=P+C-m,P=P>0?P:0),j=w-T/2,j=j>0?j:0,j+T>u&&(j-=j+T-u,j=j>0?j:0),this.elementData.cropPX=P/m||0,this.elementData.cropPY=j/u||0,
this.elementData.cropPW=C/m||1,this.elementData.cropPH=T/u||1},setIndex:function(){var e=t.pages[t.selectedPageIdx].canvas;e.selectedIdx=i(5).getIndexById(this.id),t.isLostFocus=!1},refreshImageById:function(e){t.dropData.isBg=!1,t.dropData.newAdded=!1,t.dropData.idx=i(5).getIndexById(this.id),t.watches.isOnDrop=!0}},events:{refreshHandler:function(e){this.refreshImage(i(5).getCropImageUrl(i(5).getIndexById(this.id)))},dispatchScaleEnd:function(e){this.backImgShow=!1;var t=this.elementData.width+e.width/this.ratio;t>=300&&(this.elementData.width+=e.width/this.ratio);var a=this.elementData.height+e.height/this.ratio;a>=300&&(this.elementData.height+=e.height/this.ratio),this.setCrop(),this.refreshImage(i(5).getCropImageUrl(i(5).getIndexById(this.id)))},dispatchScaleStart:function(){this.setIndex(),i(19).clear("photoElementCanvas"+this.id),this.backImgShow=!0},dispatchClick:function(){this.setIndex(),this.sharedStore.isEditLayerShow=!1},dispatchMove:function(e){this.setIndex(),t.vm.$broadcast("notifyRefreshScreenshot")},dispatchDblClick:function(){console.log("dispatchDblClick"),t.watchData.cropImageIdx=i(5).getIndexById(this.id),t.watches.isCropThisImage=!0},dispatchDrop:function(e){this.elementData.imageId?(t.dropData.idx=i(5).getIndexById(this.id),t.watches.isReplaceImage=!0,t.vm.$broadcast("notifyAddOrReplaceImage",{id:e.id,x:e.x+this.elementData.x*this.ratio,y:e.y+this.elementData.y*this.ratio})):(t.dropData.isBg=!1,t.dropData.newAdded=!1,t.dropData.idx=i(5).getIndexById(this.id),t.watches.isOnDrop=!0)},dispatchScale:function(e){var t=this.elementData.width+e.width/this.ratio;t>=300&&(this.elementData.width+=e.width/this.ratio);var i=this.elementData.height+e.height/this.ratio;i>=300&&(this.elementData.height+=e.height/this.ratio)}},created:function(){},ready:function(){var e=this;this.elementData.imageId&&this.refreshImage(i(5).getCropImageUrl(i(5).getIndexById(this.id))),this.$watch("elementData.isRefresh",function(){e.elementData.isRefresh&&(e.elementData.isRefresh=!1,console.log("refreshUrl"),e.refreshImage(i(5).getCropImageUrl(i(5).getIndexById(e.id))))})}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={template:'<div  v-show="sharedStore.isPopupShow"><div class="shadow-bg" v-show="privateStore.showCenter"></div><div id="popup-window" v-show="privateStore.showCenter" class="box-popup" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }" ><div v-show="privateStore.showcloseButton" style="height: 50px;line-height: 50px;"><div style="width: 40px;height: 40px;float:right;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHidePopup" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="line-height: 25px;padding:10px 10px 0;text-align:center;color: #3a3a3a;font-size:16px;">{{{ privateStore.msg }}}</div><div class="popup-button" style="margin-top:30px;text-align:center;"><div v-if="privateStore.confirm" class="button t-center" v-on:click="handleOkPopup" style="width: 160px;height: 40px;line-height: 40px;margin:0 auto;font-size: 14px;">{{ privateStore.b0 }}</div><template v-else><div class="button t-center" v-on:click="handleNowPopup" style="display:inline-block;width: 160px;height: 40px;line-height: 40px;font-size: 14px;">{{ privateStore.b2 }}</div><div class="button t-center button-white" v-on:click="handleLaterPopup" style="display:inline-block;width: 160px;height: 40px;margin-left:20px;line-height: 40px;font-size: 14px;border:1px solid #393939;color: #393939;box-sizing:border-box;">{{ privateStore.b1 }}</div></template></div></div></div><div id="pop-window-top" v-show="privateStore.showTop"  style="border:1px solid rgba(232, 232, 232, 1);background:#fff;right:-7px;" v-bind:style="{width: privateStore.tWidth + \'px\',height: privateStore.tHeight + \'px\'}" ><span class="poptip-arrow-top" style="left:64%;"><em class="poptip-arrow-top-em">◆</em><i class="poptip-arrow-top-i">◆</i></span><div v-show="privateStore.showcloseButton" style="height: 40px;line-height: 40px;position:absolute;right:0;"><div style="width: 40px;height: 40px;position:absolute;right:-1px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHideTopPopup" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 20px; margin-left: 4px; cursor: pointer;" /></div></div><div style="height:100%;"><img :src="privateStore.image" v-show="sharedStore.saveImage" style="height:83%;padding: 15px;float: left;"><span style="line-height:130px;float:left;margin-left: 30px;">{{ privateStore.topMsg }}</span></div></div></div>',data:function(){return{privateStore:{params:"",width:470,height:206,tWidth:358,tHeight:130,confirm:!0,showCenter:!1,showTop:!1,image:null,texts:["OK","Try Later","Try Now","Continue","Save","Replace","Place on top","Sure","Cancel","Don't Save","Save as"],b1:"Try Later",b2:"Try Now",b0:"OK",showcloseButton:!0,msg:"",topMsg:"",selector:"#popup-window",addparams:""},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+12)}},methods:{handleNowPopup:function(){var e=this.privateStore.type;if("order"===e)this.$dispatch("dispatchReorder");else if("logo"===e)t.isPopSave=!1,i(13).handledSaveOldProject(this,"dispatchRedirectHome");else if("replace"===e){var a=this.sharedStore,o=a.pages[a.selectedPageIdx].canvas.elements.length;a.dragData.imageId;a.shouldNewImage=!0,this.$dispatch("dispatchAddImage",this.privateStore.addparams)}else if("delete"===e){var o=this.privateStore.addparams.idx,e=this.privateStore.addparams.type;this.sharedStore.watchData.removeElementIdx=o,this.sharedStore.watchData.removeElementType=e,this.sharedStore.watches.isRemoveElement=!0}else"saveAs"===e?this.$dispatch("dispatchShowCloneWindow"):"login"===e&&window.open("/sign-in.html","_blank");this.handleHidePopup(),this.initOptions()},handleLaterPopup:function(){var e=this.privateStore.type;if("order"===e);else if("logo"===e)t.isPopSave=!1,this.redirectHome();else if("replace"===e){var a=this.sharedStore.dropData.idx,o=this.sharedStore.dragData.imageId,r=t.pages[t.selectedPageIdx].canvas;r.elements[a].refreshImageById(o)}else if("cancelUpload"===e){for(var n=0;n<this.sharedStore.uploadProgress.length;n++)t.vm.$broadcast("notifyCancelItem",n);t.cancelByX?i(8)({ev:i(9).CancelAllFilesByXClicked}):i(8)({ev:i(9).CancelAllFilesClicked}),this.sharedStore.isImageUploadShow=!1,i(8)({ev:i(9).CloseMonitor,auto:!1})}this.handleHidePopup(),this.initOptions()},handleOkPopup:function(){this.privateStore.type;this.handleHidePopup(),this.initOptions()},handleHidePopup:function(){this.privateStore.showCenter=!1},handleHideTopPopup:function(){this.privateStore.showTop=!1},initOptions:function(){this.sharedStore.isPopupShow=!1,this.privateStore.confirm=!0,this.privateStore.msg="",this.privateStore.showcloseButton=!0,this.privateStore.showCenter=!1,this.privateStore.showTop=!1,this.privateStore.b1=this.privateStore.texts[1],this.privateStore.b2=this.privateStore.texts[2]},redirectHome:function(){location.href="/"},strategies:function(){var e=this,t=e.privateStore.height;return e.privateStore.height=206,{order:function(t){t==-1&&(e.privateStore.confirm=!1,e.privateStore.b1=e.privateStore.texts[1],e.privateStore.b2=e.privateStore.texts[2],e.setMsg("Unable to add to cart, please try again."))},save:function(i){return e.privateStore.b0=e.privateStore.texts[0],0==i?(e.privateStore.height=t,e.setTopMsg("Saved successfully!"),e.privateStore.showTop=!0,e.privateStore.image=e.getImageSelected(),!0):void(i==-1?e.privateStore.msg="Unable to save, please try again.":i==-2?e.privateStore.msg="Project Title already Exists":i==-3&&(e.privateStore.height=246,e.privateStore.msg="This item was already ordered, you can't modify it anymore. Please create a new project if you want to modify."))},preview:function(t){t==-1&&(e.privateStore.b0=e.privateStore.texts[0],e.privateStore.confirm=!0,e.setMsg("Preview failed, please try again."))},upload:function(t){t==-1&&(e.privateStore.b0=e.privateStore.texts[0],e.privateStore.confirm=!0,e.setMsg("Please wait for the upload to finish."))},contact:function(t){0==t?(e.privateStore.b0=e.privateStore.texts[0],e.privateStore.confirm=!0,e.setMsg("Submit successfully.\nMany thanks for your feedback.")):(e.privateStore.b0=e.privateStore.texts[0],e.privateStore.confirm=!0,e.setMsg("Send failed, you may try again later"))},spec:function(t){t==-1&&(e.privateStore.b0=e.privateStore.texts[0],e.privateStore.confirm=!0,e.setMsg("Request api service failed"))},logo:function(t){t==-1&&(e.privateStore.height=232,e.privateStore.width=510,e.privateStore.b1=e.privateStore.texts[9],e.privateStore.b2=e.privateStore.texts[4],e.privateStore.confirm=!1,e.setMsg("This will take you to home page.<br/>Please select an option before continuing."))},replace:function(t){t==-1&&(e.privateStore.b1=e.privateStore.texts[5],e.privateStore.b2=e.privateStore.texts[6],e.privateStore.confirm=!1,e.setMsg("How do you want to handle this image? "))},isOrder:function(t){t==-1&&(e.privateStore.height=250,e.privateStore.b0=e.privateStore.texts[3],e.privateStore.confirm=!0,e.setMsg("This item was already ordered, you can not modify it anymore. Please create a new project if you want to modify."))},delete:function(t){t==-1&&(e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2=e.privateStore.texts[7],e.privateStore.confirm=!1,e.setMsg("Current element will  be removed from workbench, please confirm? "))},saveAs:function(t){e.privateStore.height=236,e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2=e.privateStore.texts[10],e.privateStore.confirm=!1,e.setMsg(e.privateStore.params.info)},clone:function(t){e.privateStore.confirm=!0,e.setMsg(e.privateStore.params.info)},cancelUpload:function(){e.privateStore.b1=e.privateStore.texts[3],e.privateStore.b2=e.privateStore.texts[8],e.privateStore.confirm=!1,e.setMsg("Your image has not been uploaded.<br />What do you want to do?")},login:function(){e.privateStore.height=260,e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2="Log In",e.setMsg("Your session has timed out. You must log in again to continue. Clicking Log In will open a new window. Once successfully logged in, you may return to this window to continue editing."),e.privateStore.confirm=!1}}},showPopup:function(e){if(this.privateStore.params=e,"save"!==e.type&&(this.privateStore.type=e.type),this.checkType(e),this.privateStore.showCenter){var t=i(12);t.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector})}this.sharedStore.isPopupShow=!0},checkType:function(e){this.strategies()[e.type](e.status)?this.privateStore.showTop=!0:this.privateStore.showCenter=!0},getImageSelected:function(){if(this.sharedStore.projectSettings[this.sharedStore.currentSelectProjectIndex].color&&null!=this.sharedStore.selectedPageIdx)return"./assets/img/"+this.sharedStore.projectSettings[this.sharedStore.currentSelectProjectIndex].color+"-"+this.sharedStore.selectedPageIdx+".png"},setMsg:function(e){this.privateStore.msg=e},setTopMsg:function(e){this.privateStore.topMsg=e}},events:{notifyShowPopup:function(e){var t=this;this.showPopup(e),t.privateStore.showTop&&setTimeout(function(){t.handleHideTopPopup()},2e3)},notifyRedirectHome:function(){this.redirectHome()},notifyAddOrReplaceImage:function(e){this.showPopup({type:"replace",status:-1}),this.privateStore.addparams=e},notifyDeleteElement:function(e){this.showPopup({type:"delete",status:-1}),this.privateStore.addparams=e}},ready:function(){}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={mixins:[i(7)],template:'<div class="bed-header"><div style="float: right; height: 48px;margin-top: 2px;"></div></div>',data:function(){return{privateStore:{},sharedStore:t}},computed:{productText:function(){switch(this.sharedStore.projectSettings[t.currentSelectProjectIndex].product){case"TS":return"T-Shirt";default:return"[ERR PRODUCT]"}}},methods:{handleCloseView:function(){navigator.userAgent;window.close()}},events:{}}}).call(t,i(2))},function(e,t,i){(function(t,a){var o=i(12);e.exports={template:'<div  v-bind:style="{right:imageToRight + \'px\'}" style="margin-top:10px;width:16px;z-index:100;position: fixed;top:40px;"><div style="min-height:130px" id="project-div-{{item.id}}" v-on:click="projectItemClick(item.id)" v-for="item in newImageList"><div style="height:130px;margin-top:30px"><span style="display:inline-block;margin-left:0;margin-top:30px"><img class="preview-project-image" style="border: 1px solid rgba(250, 250, 250, 1);" id="project-item-{{ item.id }}" :imageid="item.id" :imageurl="item.url" :src="item.previewUrl" :alt="item.color"/></span></div></div></div>',data:function(){return{privateStore:{selectedColor:[]},sharedStore:t,imageToRight:""}},computed:{imageToRight:function(){var e=this,t=e.sharedStore,i=t.pages[t.selectedPageIdx].canvas;if(t.isPreview)var a=o.getPreviewBoxLimit();else var a=o.getBoxLimit();if(a.width>0&&a.height>0){var r=a.width/i.oriBgWidth,n=a.height/i.oriBgHeight;r>n?(i.ratio=n,i.width=i.oriWidth*i.ratio,i.height=i.oriHeight*i.ratio,i.x=i.oriX*i.ratio,i.y=i.oriY*i.ratio,i.bgWidth=i.oriBgWidth*i.ratio,i.bgHeight=i.oriBgHeight*i.ratio,e.privateStore.operationPaddingLeft=(a.width-i.bgWidth)/2):(i.ratio=r,i.width=i.oriWidth*i.ratio,i.height=i.oriHeight*i.ratio,i.x=i.oriX*i.ratio,i.y=i.oriY*i.ratio,i.bgWidth=i.oriBgWidth*i.ratio,i.bgHeight=i.oriBgHeight*i.ratio,e.privateStore.operationPaddingLeft=0),e.privateStore.operationWidth=i.bgWidth,e.privateStore.operationHeight=i.bgHeight,e.privateStore.canvasTop=i.y,e.privateStore.canvasLeft=i.x;var s=parseInt(52+i.bgWidth+i.x);return console.log(i.bgWidth),console.log(i.x),console.log(s),s<610?88:200}},newImageList:function(){for(var e=[],t=[],i=0;i<this.sharedStore.projectSettings.length;i++){var a=this.sharedStore.projectSettings[i].color;if(e.indexOf(a)==-1){e.push(a);var o=this.getColorAssets(a),r={id:i,name:a,color:a,url:o.backgroundImage,previewUrl:o.backgroundImage};t.push(r)}}return this.sharedStore.itemListNum=t.length,t}},methods:{projectItemClick:function(e){this.sharedStore.currentSelectProjectIndex=e;for(var i=0;i<this.sharedStore.projectSettings.length;i++)i==e?a("#project-item-"+e).css("border-color","#7b7b7b"):a("#project-item-"+i).css("border-color","#ffffff");t.vm.$broadcast("notifyRefreshBackground")},getColorAssets:function(e){for(var t=0;t<this.sharedStore.colorOptionList.length;t++)if(this.sharedStore.colorOptionList[t].type===e)return this.sharedStore.colorOptionList[t]}},events:{},ready:function(){setTimeout(function(){a("#project-item-0").css("border-color","#7b7b7b")},500)}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){var o=(i(11),i(12));e.exports={template:'<div id="list-project" v-bind:style="{ height: privateStore.minHeight + \'px\' }" style="margin-top:10px;overflow-x: hidden; overflow-y: auto;"><div style="min-height:130px" id="project-div-{{item.id}}" v-on:click="projectItemClick(item.id)" v-for="item in newImageList" v-on:mouseover="handleShowDeleteIcon($index)" v-on:mouseout="handleHideDeleteIcon($index)"><div style="height:130px"><span style="display:inline-block;margin-left:40px;margin-top:18px;position:relative;"><img draggable="false" class="preview-project-image" style="width:auto;" id="project-item-{{ item.id }}" :imageid="item.id" :imageurl="item.url" :src="item.previewUrl" :alt="item.color"/><img class="preview-project-image" style="width:auto;position:absolute;top:0;left:0" id="project-item-{{ item.id }}" :imageid="item.id" :imageurl="item.url" :src="sharedStore.currentImage" :alt="item.color"/></span><input type="image" id="item-delete-{{ $index }}" src="../../static/img/delete.svg" width="20" height="20" alt="delete" style="position: relative; bottom: 100px; left: 155px; cursor: pointer; opacity:0;" v-show="item.show" v-on:click="deleteButtonClick(item.color)"/><img draggable="false" src="../../static/img/delete.svg" width="20" height="20" v-else style="position: relative; bottom: 100px; left: 155px;opacity:0;"/><span style="position:relative;font-size:14px;color:#7b7b7b;bottom:54px;left:0px;right:16px;">Color:</span><span style="position:relative;font-size:12px;color:#3a3a3a;text-decoration:underline;cursor: pointer;bottom:54px;left:16px;" v-on:click="itemButtonClick(item.color,item.id)"/>{{item.title}}</span></div><div id="selectItemColorDiv-{{$index}}" class="selectItemColorDiv"><img draggable="false" id="White-item-{{item.id}}" style="margin-left:10px;margin-top:10px;" v-bind:style="getOptionStyle(\'White\')" src="assets/img/white-normal.png" width="50" height="50" v-on:click="itemColorClick(\'White\',$index,item.color)" /><img draggable="false" id="Black-item-{{item.id}}" style="margin-left:10px;margin-top:10px;" v-bind:style="getOptionStyle(\'Black\')" src="assets/img/black-normal.png" width="50" height="50" v-on:click="itemColorClick(\'Black\',$index,item.color)" /><img draggable="false" id="SportGrey-item-{{item.id}}" style="margin-left:10px;margin-top:10px;" v-bind:style="getOptionStyle(\'SportGrey\')" src="assets/img/grey-pressed.png" width="50" height="50" v-on:click="itemColorClick(\'SportGrey\',$index,item.color)" /><img draggable="false" id="NavyBlue-item-{{item.id}}" style="margin-left:10px;margin-top:10px;" v-bind:style="getOptionStyle(\'NavyBlue\')" src="assets/img/navy-normal.png" width="50" height="50" v-on:click="itemColorClick(\'NavyBlue\',$index,item.color)" /><img draggable="false" id="RoyalBlue-item-{{item.id}}" style="margin-left:10px;margin-top:10px;" v-bind:style="getOptionStyle(\'RoyalBlue\')" src="assets/img/royal-normal.png" width="50" height="50" v-on:click="itemColorClick(\'RoyalBlue\',$index,item.color)" /></div></div><div v-on:click="clickSelectColor()" style="margin-top: 12px;cursor: pointer;"><span style="margin-left:85px;font-size:14px;color:#3a3a3a">+ Add Another Color</span></div><div class="selectColorDiv"><img draggable="false" id="White-project-item" style="margin-left:12px;margin-top:12px;" v-bind:style="getOptionStyle(\'White\')" src="assets/img/white-normal.png" width="50" height="50" v-on:click="addColorClick(\'White\')" /><img draggable="false" id="Black-project-item" style="margin-left:12px;margin-top:12px;" v-bind:style="getOptionStyle(\'Black\')" src="assets/img/black-normal.png" width="50" height="50" v-on:click="addColorClick(\'Black\')" /><img draggable="false" id="SportGrey-project-item" style="margin-left:12px;margin-top:12px;" v-bind:style="getOptionStyle(\'SportGrey\')" src="assets/img/grey-normal.png" width="50" height="50" v-on:click="addColorClick(\'SportGrey\')" /><img draggable="false" id="NavyBlue-project-item" style="margin-left:12px;margin-top:12px;" v-bind:style="getOptionStyle(\'NavyBlue\')" src="assets/img/navy-normal.png" width="50" height="50" v-on:click="addColorClick(\'NavyBlue\')" /><img draggable="false" id="RoyalBlue-project-item" style="margin-left:12px;margin-top:6px;" v-bind:style="getOptionStyle(\'RoyalBlue\')" src="assets/img/royal-normal.png" width="50" height="50" v-on:click="addColorClick(\'RoyalBlue\')" /></div></div>',data:function(){return{privateStore:{isShowColorDiv:!1,selectedColor:[],minHeight:200},sharedStore:t}},computed:{newImageList:function(){for(var e=[],t=[],i=0;i<this.sharedStore.projectSettings.length;i++){var a=this.sharedStore.projectSettings[i].color;if(e.indexOf(a)==-1){e.push(a);var o=this.getColorAssets(a);console.log("color:"+e.length);var r=!0,n={id:i,name:a,title:o.title,color:a,url:o.backgroundImage,previewUrl:o.backgroundImage,show:r};t.push(n)}}return 1===t.length&&(t[0].show=!1),this.sharedStore.itemListNum=t.length,t}},methods:{handleShowDeleteIcon:function(e){this.newImageList.length>1&&a("#item-delete-"+e).css("opacity",1)},handleHideDeleteIcon:function(e){a("#item-delete-"+e).css("opacity",0)},deleteButtonClick:function(e){for(var i=0;i<this.sharedStore.projectSettings.length;i++){var a=this.sharedStore.projectSettings[i];a.color===e&&(this.sharedStore.projectSettings.splice(i,1),this.sharedStore.currentSelectProjectIndex=0)}t.vm.$broadcast("notifyRefreshBackground")},getDefaultMeasure:function(e,i){var a="M",o=["S","M","L","XL","XXL"];return t.disableOptions[e]&&(availableMeasures=o.filter(function(i){return t.disableOptions[e].options.indexOf(i)===-1}),availableMeasures.indexOf(a)===-1&&(a=availableMeasures[0])),a},addColorClick:function(e){if(!this.isOptionDisabled(e)){var t="14X16";if(this.privateStore.selectedColor.indexOf(e)!=-1)this.hideColorDiv();else{var o=i(13).newProject(e,this.getDefaultMeasure(e,t),1);this.sharedStore.projectSettings.push(o),this.hideColorDiv();var r=this;setTimeout(function(){r.sharedStore.currentSelectProjectIndex=0,a("#project-div-0").css("background","#f8f8f8")},300)}}},projectItemClick:function(e){this.sharedStore.currentSelectProjectIndex=e;for(var i=0;i<this.sharedStore.projectSettings.length;i++)i==e?a("#project-div-"+e).css("background","#f8f8f8"):a("#project-div-"+i).css("background","#ffffff");t.vm.$broadcast("notifyRefreshBackground")},itemButtonClick:function(e,t){"1"===a("#selectItemColorDiv-"+t).css("opacity")?this.hideColorItemDiv(t):(this.setSelectedColorItem(),this.showColorItemDiv(t),this.setItemSelectColor(t))},itemColorClick:function(e,i,a){if(!this.isOptionDisabled(e))if(this.privateStore.selectedColor.indexOf(e)==-1){this.setSelectedColorItem();for(var o=0;o<this.sharedStore.projectSettings.length;o++){var r=this.sharedStore.projectSettings[o];r.color===a&&(r.color=e,r.measure=this.getDefaultMeasure(r.color,r.size))}this.setItemSelectColor(i),t.vm.$broadcast("notifyRefreshBackground")}else this.hideColorItemDiv(i)},setItemSelectColor:function(e){for(var t=0;t<this.sharedStore.colorOptionList.length;t++){var i=this.sharedStore.colorOptionList[t].type;this.privateStore.selectedColor.indexOf(i)!=-1?(console.log(this.sharedStore.colorOptionList[t].pressColor),a("#"+i+"-item-"+e).attr("src",this.sharedStore.colorOptionList[t].pressColor)):(console.log(this.sharedStore.colorOptionList[t].normalColor),a("#"+i+"-item-"+e).attr("src",this.sharedStore.colorOptionList[t].normalColor))}},clickSelectColor:function(){var e=this.privateStore.isShowColorDiv;e?this.hideColorDiv():this.showColorDiv(),this.setSelectedColorItem()},setSelectedColorItem:function(){var e=this.sharedStore.projectSettings;this.privateStore.selectedColor=[];for(var t=0;t<e.length;t++)this.privateStore.selectedColor.push(e[t].color);for(var i=0;i<this.sharedStore.colorOptionList.length;i++){var o=this.sharedStore.colorOptionList[i].type;this.privateStore.selectedColor.indexOf(o)!=-1?a("#"+o+"-project-item").attr("src",this.sharedStore.colorOptionList[i].pressColor):a("#"+o+"-project-item").attr("src",this.sharedStore.colorOptionList[i].normalColor)}},showColorDiv:function(){a(".selectColorDiv").css("opacity",1),a(".selectColorDiv").css("height","134px"),this.privateStore.isShowColorDiv=!0},hideColorDiv:function(){a(".selectColorDiv").css("opacity",0),a(".selectColorDiv").css("height","0px"),this.privateStore.isShowColorDiv=!1},showColorItemDiv:function(e){a("#selectItemColorDiv-"+e).css("opacity",1),a("#selectItemColorDiv-"+e).css("height","70px")},hideColorItemDiv:function(e){a("#selectItemColorDiv-"+e).css("opacity",0),a("#selectItemColorDiv-"+e).css("height","0px")},getColorAssets:function(e){for(var t=0;t<this.sharedStore.colorOptionList.length;t++)if(this.sharedStore.colorOptionList[t].type===e)return this.sharedStore.colorOptionList[t]},getOptionStyle:function(e,t){var i=1,a="point";return this.isOptionDisabled(e)&&(i=.5,a="not-allowed"),{opacity:i,cursor:a}},isOptionDisabled:function(e){return t.disableOptions[e]&&t.disableOptions[e].isAllDisabled},hasDisabledMeasure:function(e){return t.disableOptions[e.color]&&t.disableOptions[e.color].options.indexOf(e.measure)!==-1}},events:{notifyImageList:function(){console.log("notify image list event"),this.privateStore.minHeight=o.getProjectListSize()},notifyResetProjectToDefault:function(){var e=this,t=this.sharedStore.projectSettings;t.forEach(function(t){e.hasDisabledMeasure(t)&&(t.count=0)}),this.sharedStore.projectSettings=t}},ready:function(){this.privateStore.minHeight=o.getProjectListSize(),setTimeout(function(){a("#project-div-0").css("background","#f8f8f8")},500)}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){var o=i(19);i(17);e.exports={template:'<canvas id="screenshot" style="display:none;position:absolute;" v-bind:width="width" v-bind:height="height"></canvas>',data:function(){return{privateStore:{ratio:0,timer:null},sharedStore:t}},computed:{width:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;return e.bgWidth},height:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;return e.bgHeight}},methods:{createScreenshot:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params;this.privateStore.ratio=e.ratio;var r=(a("#container"),a("#screenshot").get(0));i=this.sortByDepth(i.slice(0)),this.getAddon(i),o.drawRect("screenshot","#fff",0,0,r.width,r.height),this.drawBg(),this.drawElems(i)},refreshScreenshot:function(){o.clear("screenshot"),this.createScreenshot()},sortByDepth:function(e){return e.sort(function(e,t){return e.dep>t.dep})},getAddon:function(e){this.drawElems(e),this.sharedStore.currentImage=screenshot.toDataURL("image/png")},drawElems:function(e){var i=t.pages[t.selectedPageIdx].canvas,o=document.createElement("canvas"),r=o.getContext("2d"),n=a("#screenshot").get(0),s=n.getContext("2d");o.width=i.bgWidth,o.height=i.bgHeight;for(var d=0,l=e.length;d<l;d++){var c=e[d],p=("text"===c.elType?"textElementCanvas":"photoElementCanvas")+c.id;r.drawImage(a("#"+p).get(0),c.x*this.privateStore.ratio,c.y*this.privateStore.ratio)}s.drawImage(o,0,0,i.width,i.height,i.x,i.y,i.width,i.height)},drawBg:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;o.drawCanvas("screenshot","bg-part",0,0,e.bgWidth,e.bgHeight)}},events:{notifyRefreshScreenshot:function(){if(0===this.sharedStore.selectedPageIdx){var e=this;e.privateStore.timer&&clearTimeout(e.privateStore.timer),e.privateStore.timer=setTimeout(function(){e.refreshScreenshot()},100)}}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={template:'<div  v-show="sharedStore.isSizeChartShow"><div id="bed-sizechart" v-bind:style="{zIndex: windowZindex}" style="width:1000px;height:600px;" ><div style="height: 40px:line-height: 40px;"><div id="closeButton" style="width: 40px;height: 40px;margin-left: 940px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleCloseSizeChart()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div class="font-light" style="margin:10px 0 30px;font-size:40px;color:#3a3a3a;text-align:center;">Size Chart</div><table class="font-light" border="1" cellspacing="0" cellpadding="0" width="500" style="font-size:14px;text-align: center;margin:0 0 20px 60px"><tr height="40" style="background: black;color:#eee;font-size: 18px;font-family: Gotham Book;"><td class="font-normal" colspan="7" style="border:1px solid #000;">Size Chart</td></tr><tr height="36" style="background: rgb(204,204,204);"><td class="font-lightBlack" width="110">Size</td><td class="font-lightBlack" colspan="2">(a) Width</td><td class="font-lightBlack" colspan="2">(b) Height</td><td class="font-lightBlack" colspan="2">(c) Sleeve</td></tr><tr height="36"><td></td><td width="62">inches</td><td width="63">cm</td><td width="62">inches</td><td width="63">cm</td><td width="62">inches</td><td width="63">cm</td></tr><tr height="31" v-for="item in sizeData"><td class="font-lightBlack"">{{item.size}}</td><td width="62">{{item.ainches}}</td><td width="63">{{item.acm}}</td><td width="62">{{item.binches}}</td><td width="63">{{item.bcm}}</td><td width="62">{{item.cinches}}</td><td width="63">{{item.ccm}}</td></tr></table><span class="font-light" style="margin:0 0 0 60px;font-size:14px;color:#3a3a3a;">Note: Please allow 0.75inch or 2cm of tolerance</span><div class="button t-center font-medium" v-on:click="handleCloseSizeChart()" style="width: 160px;height: 40px;line-height: 40px;margin:82px auto;font-size: 16px;">Close</div></div></div>',data:function(){return{privateStore:{width:1e3,height:600,selector:"#bed-sizechart"},sizeData:[{size:"S",ainches:18,acm:45,binches:28,bcm:71,cinches:7.3,ccm:18.5},{size:"M",ainches:20,acm:50,binches:29,bcm:73,cinches:7.3,ccm:18.5},{size:"L",ainches:22,acm:55,binches:30,bcm:76,cinches:7.5,ccm:19},{size:"XL",ainches:24,acm:60,binches:31,bcm:79,cinches:7.7,ccm:19.5},{size:"XXL",ainches:26,acm:65,binches:32,bcm:81,cinches:7.7,ccm:19.5}],sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)+10}},methods:{handleCloseSizeChart:function(){this.sharedStore.isSizeChartShow=!1}},ready:function(){var e=this;e.$watch("sharedStore.isSizeChartShow",function(){if(e.sharedStore.isSizeChartShow){var t=i(12);t.setPopWindowPosition({width:e.privateStore.width,height:e.privateStore.height,selector:e.privateStore.selector})}})},events:{}}}).call(t,i(2))},function(e,t,i){(function(t){i(5);e.exports={template:'<!-- top sub bar --><ul class="sub-box-bar" id="box-subbar-top" v-show="sharedStore.isEditLayerShow && toggleSubbar ===\'top\'" v-bind:style="{ width: boxWidth + \'px\', zIndex: windowZindex }" style="position:absolute;margin:0;padding:0;top: -175px;left: 0;"><li class="button" v-on:click="handleToFront" title="Bring To Front" style="width:100%;font-size: 14px;height: 30px;line-height: 30px;padding: 5px;font-weight: lighter;">Bring To Front</li><li class="button" v-on:click="handleToBack" title="Send To Back" style="width:100%;font-size: 14px;height: 30px;line-height: 30px;padding: 5px;font-weight: lighter;">Send To Back</li><li class="button" v-on:click="handleForward" title="Bring Forward" style="width:100%;font-size: 14px;height: 30px;line-height: 30px;padding: 5px;font-weight: lighter;">Bring Forward</li><li class="button" v-on:click="handleBackward" title="Send Backward" style="width:100%;font-size: 14px;height: 30px;line-height: 30px;padding: 5px;font-weight: lighter;">Send Backward</li></ul><!-- bottom sub bar --><ul class="sub-box-bar" id="box-subbar-bottom" v-show="sharedStore.isEditLayerShow && toggleSubbar ===\'bottom\'" v-bind:style="{ width: boxWidth + \'px\', zIndex: windowZindex }" style="position:absolute;margin:0;padding:0;top: 45px;left: 0;"><li class="button" v-on:click="handleToFront" title="Bring To Front" style="width:100%;font-size: 14px;height: 30px;line-height: 30px;padding: 5px;font-weight: lighter;">Bring To Front</li><li class="button" v-on:click="handleToBack" title="Send To Back" style="width:100%;font-size: 14px;height: 30px;line-height: 30px;padding: 5px;font-weight: lighter;">Send To Back</li><li class="button" v-on:click="handleForward" title="Bring Forward" style="width:100%;font-size: 14px;height: 30px;line-height: 30px;padding: 5px;font-weight: lighter;">Bring Forward</li><li class="button" v-on:click="handleBackward" title="Send Backward" style="width:100%;font-size: 14px;height: 30px;line-height: 30px;padding: 5px;font-weight: lighter;">Send Backward</li></ul>',props:["idx"],data:function(){return{boxWidth:150,boxHeight:30,fullBoxHeight:165,sharedStore:t}},computed:{toggleSubbar:function(){var e=t.pages[t.selectedPageIdx].canvas;return(e.params[e.selectedIdx].y+e.params[e.selectedIdx].height)*e.ratio<this.fullBoxHeight?"bottom":"top"},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params[this.idx];
return 100*(i.dep+1)+90}},methods:{handleToFront:function(){i(14).sendToFront({idx:this.idx}),this.sharedStore.isEditLayerShow=!1},handleToBack:function(){i(14).sendToBack({idx:this.idx}),this.sharedStore.isEditLayerShow=!1},handleForward:function(){i(14).bringForward({idx:this.idx}),this.sharedStore.isEditLayerShow=!1},handleBackward:function(){i(14).bringBackward({idx:this.idx}),this.sharedStore.isEditLayerShow=!1}},events:{}}}).call(t,i(2))},function(e,t,i){(function(t,a){var o=(i(28),i(12)),r=i(10),n=(i(5),i(23));e.exports={template:'<div v-show="sharedStore.isTextEditorShow"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div class="box-text-editor" style="overflow:hidden" v-bind:style="{ zIndex: windowZindex}"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHideTextEditorView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 22px; margin-left: 33px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Text Editor</div></div><div style="margin: 50px 0 0 40px; width: 604px;"><div class="box-textarea"><textarea class="font-textarea" id="textArea" placeholder="Enter text here" style="height: 80px; width: 578px; line-height: 1.2; background-color: #f5f5f5;" v-model="privateStore.inputTextEditorTxt" v-on:change="handleTextChange()"></textarea><label class="font-label" v-show="privateStore.isShowInvalidTxt" style="color: red;float:right;margin-right:4px;">Invalid characters removed</label></div><div style="margin-top: 30px;"><span style="position: relative;display: inline-block; width: 300px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;">Font Family:</label><select class="input font-select" v-model="privateStore.selectFontFamily" style="width: 200px;border-width:2px;border-color:rgb(161,195,250);"></select><label class="options-label font-label" v-on:click="handleFontFamilyClick"  type="text" style="position: absolute; width: 177px;height: 35px; line-height: 35px;right:10px;top:0;">{{displayFontFamily}}</label><div v-show="privateStore.isShowFontFamilySelect" style="position:absolute;width: 200px;height:403px;border: 1px solid rgb(161,195,250);left: 100px;z-index: 200;background-color: rgb(245,245,245);bottom: -145px;"><div class="fontFamilySelect" v-on:click="handleSelectFontFamily(item.id)" style="height:20px" v-for="item in sharedStore.fontList"><img v-bind:src="item.imageUrl" style="padding-left: 10px;" height="16"/></div></div></span><span style="display: inline-block; width: 300px;margin-left: 4px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;margin-left:4px;width:90px;">Font Style:</label><select class="input font-select" id="fontStyleSelect" v-model="privateStore.selectFontStyle" style="width: 202px;"><option v-for="item in privateStore.fontStyleList" value="{{item.fontFamily}}">{{item.displayName}}</option></select></span></div><div style="margin-top: 20px;"><span style="position: relative; display: inline-block; width: 304px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;">Font Size:</label><!-- pop-out fake select button --><select class="input font-select" style="position: absolute; display: inline-block; width: 200px; right: 10px; top: 0;"></select><input class="input font-input" id="fontSizeText" type="text" v-on:blur="handleTextBlur()" v-on:focus="handleTextFocus()"  style="position: absolute; width: 177px; height: 33px; right: 10px; top: 0; background-color: rgba(245, 245, 245, 0);" value="{{displayFontSize}}"/><input class="input font-input" type="text" style="width: 181px; height: 33px;"><div v-show="privateStore.isFontsizeSliderShow" style="position: absolute; display: inline-block; width: 140px; left: 100px; top: 37px; padding: 0 8px; border-radius: 4px; background-color: #e6e6e6; box-shadow: 0 2px 3px 1px #cbcbcb;"><input type="text" id="as-slide-fontsize" data-slider-id="asFontsizeSlider" data-slider-min="0.3" data-slider-max="16" data-slider-step="0.1" data-slider-value="{{ privateStore.selectedInchFontSize }}" data-slider-handle="custom" data-slider-tooltip="hide" v-model="privateStore.selectedInchFontSize" /></div></span><span style="display: inline-block; width: 300px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;margin-left:4px;width:90px;">Font Color:</label><select class="input font-select" id="fontColorSelect" v-model="privateStore.selectFontColor" style="width: 202px;"><option value="0">Black</option><option value="6712688">Gray</option><option value="13289166">Light Gray</option><option value="16711422">White</option><option value="10497843">Cardinal</option><option value="16711680">Red</option><option value="16042184">Pink</option><option value="15690240">Orange</option><option value="14202129">Gold</option><option value="16776960">Yellow</option><option value="5679643">Green</option><option value="13158">Navy</option></select></span></div></div><div class="texteditor-button"><div id="texteditor-submitButton" class="button t-center" v-on:click="handleText()" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; margin-left: 258px;font-size: 14px;">{{ privateStore.submitButtonLabel }}</div></div><div v-show="privateStore.isShowFontFamilySelect" style="width:100%;height:100%;position: absolute;top: 50px;" v-on:click="handleNoSelectFontFamily"></div></div></div>',data:function(){return{privateStore:{fontStyleList:[],selectFontFamily:"font_arial",selectFontStyle:"Arial Narrow",selectFontColor:0,selectedInchFontSize:2,submitButtonLabel:"Done",isFontsizeSliderShow:!1,isEdit:!1,isRemoveButtonShow:!1,inputTextEditorTxt:"",textWindowParams:{width:680,height:420,selector:".box-text-editor"},isShowFontFamilySelect:!1,isShowInvalidTxt:!1},sharedStore:t}},computed:{selectedPxFontSize:function(){var e=this.privateStore.selectedInchFontSize,t=r.getPxByInch(e);return Math.round(t)},displayFontSize:function(){return this.privateStore.selectedInchFontSize+" in."},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)},displayFontFamily:function(){for(var e=0;e<this.sharedStore.fontList.length;e++)if(this.sharedStore.fontList[e].id===this.privateStore.selectFontFamily)return this.sharedStore.fontList[e].displayName;return""}},methods:{handleShowTextEditor:function(){o.setPopWindowPosition(this.privateStore.textWindowParams),this.sharedStore.isTextEditorShow=!0,this.resetSumbitButton()},handleShowFontsizeSlider:function(){this.privateStore.isFontsizeSliderShow=!0},handleTextBlur:function(){var e=parseFloat(a("#fontSizeText").val().replace(" in.",""));isNaN(e)&&(e=this.privateStore.selectedInchFontSize),e<.3?e=.3:e>16&&(e=16),a("#fontSizeText").val(e+" in."),this.privateStore.selectedInchFontSize=e,a("#as-slide-fontsize").slider("setValue",e),this.privateStore.isFontsizeSliderShow=!1},handleTextFocus:function(){a("#fontSizeText").val(a("#fontSizeText").val().replace(" in.","")),this.privateStore.isFontsizeSliderShow=!0},handleHideTextEditorView:function(){this.sharedStore.isTextEditorShow=!1,this.resetView()},handleFontFamilyChange:function(){this.resetFontStyle()},handleText:function(){i(8)({ev:i(9).CompleteTextEdit});var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas,t=0,o=""+this.privateStore.selectFontColor,r=this.selectedPxFontSize;if(!this.privateStore.isShowInvalidTxt){if(this.privateStore.isEdit){var s=e.params[e.selectedIdx],d={id:s.id,elType:"text",text:a("#textArea").val(),x:s.x,y:s.y,width:s.width,height:s.height,rotate:s.rotate,dep:s.dep,fontFamily:this.privateStore.selectFontStyle,fontSize:r,fontWeight:"normal",textAlign:"left",fontColor:o,isRefresh:!1};t=e.selectedIdx,n.editText(d,t)}else{var l=0,c=e.params.length;c&&(l=e.params[c-1].id+1);var d={id:l,elType:"text",text:a("#textArea").val(),x:500,y:500,width:2e3,height:500,rotate:0,dep:t,fontFamily:this.privateStore.selectFontStyle,fontSize:r,fontWeight:"normal",textAlign:"left",fontColor:o,isRefresh:!1};n.createText(d)}this.sharedStore.isTextEditorShow=!1,this.privateStore.inputTextEditorTxt="",this.resetView()}},handleRemoveText:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;n.deleteText(e.selectedIdx),this.sharedStore.isTextEditorShow=!1,this.resetView()},resetFontStyle:function(){for(var e,t=this.privateStore.selectFontFamily,i=0;i<this.sharedStore.fontList.length;i++)if(this.sharedStore.fontList[i].id==t){e=this.sharedStore.fontList[i];break}this.privateStore.fontStyleList=e.fonts,this.privateStore.selectFontStyle=this.privateStore.fontStyleList[0].fontFamily},initView:function(e){var t=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;void 0!=e&&null!=e||(e=t.selectedIdx),this.privateStore.isEdit=!0,this.privateStore.isRemoveButtonShow=!0;for(var i=t.params[e],o=i.fontFamily,n=i.fontSize,s=i.fontColor,d=i.text,l="",c="",p=0;p<this.sharedStore.fontList.length;p++)for(var h=this.sharedStore.fontList[p],g=h.id,m=(h.name,h.displayName,0);m<h.fonts.length;m++){var u=h.fonts[m],f=u.fontFamily;u.displayName;o==f&&(l=g,c=f)}l&&(this.privateStore.selectFontFamily=l),this.resetFontStyle(),this.privateStore.selectFontStyle=c,a("#textArea").val(d),this.privateStore.inputTextEditorTxt=d;var v=parseFloat(r.getInchByPx(n).toFixed(1));a("#fontSizeText").val(v+" in."),this.privateStore.selectedInchFontSize=v,a("#as-slide-fontsize").slider("setValue",v),this.privateStore.selectFontColor=s,this.handleShowTextEditor()},resetView:function(){a("#textArea").val(""),this.privateStore.selectFontFamily="font_arial",this.privateStore.selectFontStyle="Arial Narrow",this.privateStore.selectFontColor=0,a("#fontSizeText").val("2 in."),this.privateStore.selectedInchFontSize=2,a("#as-slide-fontsize").slider("setValue",2),this.resetFontStyle(),this.privateStore.isShowFontFamilySelect=!1,this.privateStore.inputTextEditorTxt=""},getTextFamily:function(){var e=this;a.ajax({url:"./assets/data/fonts.xml",type:"get",dataType:"xml"}).done(function(i){if(i){for(var o=0;o<a(i).find("fontFamily").length;o++){var r={},n=a(i).find("fontFamily").eq(o),s=n.attr("id"),d=n.attr("name"),l=n.attr("displayName");r.id=s,r.name=d,r.displayName=l,r.fonts=[],r.imageUrl="assets/img/fonts/"+s+".png";for(var c=0;c<n.find("font").length;c++){var p=n.find("font").eq(c),h=(p.attr("id"),p.attr("displayName")),g=p.attr("fontFamily");p.attr("fontFace"),p.attr("weight"),p.attr("isDefault");r.fonts[c]={fontFamily:g,displayName:h}}t.fontList.push(r)}e.privateStore.fontStyleList=t.fontList[0].fonts}})},handleFontFamilyClick:function(){this.privateStore.isShowFontFamilySelect=!0},handleNoSelectFontFamily:function(){this.privateStore.isShowFontFamilySelect=!1},handleSelectFontFamily:function(e){this.privateStore.isShowFontFamilySelect=!1,this.privateStore.selectFontFamily=e,this.resetFontStyle()},resetSumbitButton:function(){this.privateStore.inputTextEditorTxt.length>0?(a("#texteditor-submitButton").css("pointer-events","auto"),a("#texteditor-submitButton").css("opacity",1)):(a("#texteditor-submitButton").css("pointer-events","none"),a("#texteditor-submitButton").css("opacity",.4))},handleTextChange:function(){var e=/[^\u000d\u000a\u0020-\u007e]*/g,t=this.privateStore.inputTextEditorTxt,i=t.replace(e,"");if(t!==i){this.privateStore.isShowInvalidTxt=!0,this.privateStore.inputTextEditorTxt=i;var a=this;setTimeout(function(){a.privateStore.isShowInvalidTxt=!1},2e3)}else this.privateStore.isShowInvalidTxt=!1}},ready:function(){this.getTextFamily(),a("#as-slide-fontsize").slider({})},events:{notifyModifyText:function(e){this.initView(e)},notifyShowAddText:function(){this.handleShowTextEditor(),this.privateStore.isEdit=!1,this.privateStore.isRemoveButtonShow=!1,this.resetView(),this.resetSumbitButton()}},created:function(){var e=this;e.$watch("sharedStore.watches.isChangeThisText",function(){e.sharedStore.watches.isChangeThisText&&(e.sharedStore.watches.isChangeThisText=!1,e.initView())}),e.$watch("privateStore.inputTextEditorTxt",function(){e.resetSumbitButton()})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){var a=i(10);e.exports={mixins:[i(24)],template:"<div style=\"position:absolute;cursor:move;\" v-bind:style=\"{left:elementData.x*ratio + 'px',zIndex: ( elementData.dep + 1 ) * 100, top:elementData.y*ratio + 'px',width: elementData.width*ratio + 'px',height:elementData.height*ratio + 'px'}\">"+'<canvas id="textElementCanvas{{id}}" width="{{elementData.width*ratio}}px" height="{{elementData.height*ratio}}px" style="position:absolute;top:0;left:0;"></canvas><img v-bind:src="textSrc" style="position:absolute;left:0;top:0;"v-bind:style="{width: elementData.width*ratio + \'px\',height:elementData.height*ratio + \'px\'}" v-show="backImgShow" /><handle v-if="!sharedStore.isPreview" v-bind:id="id" v-bind:is-Show-Handles="isShowHandle" v-bind:is-Corner-Handles="isCornerHandles" v-bind:is-Side-Handles="isSideHandles"></handle></div>',data:function(){return{privateStore:{},sharedStore:t,elementData:Object,ratio:0,lastSize:0,fontRatio:0,textSrc:"",limitHeight:[],limitSize:[],allow:!0,backImgShow:!1,isCornerHandles:!0,isSideHandles:!1,imageRatio:0,type:"text",id:0}},computed:{isShowHandle:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.selectedIdx===i(5).getIndexById(this.id)&&!t.isLostFocus}},methods:{init:function(e){var i=t.pages[t.selectedPageIdx].canvas;this.elementData=i.params[e],this.ratio=i.ratio,this.id=this.elementData.id,this.lastSize=Math.round(a.getTextViewFontSize(i.params[e].fontSize))},destroy:function(){},refreshText:function(){var e=new Image,o=this,r=o.getTextImageUrl();currentCanvas=t.pages[t.selectedPageIdx].canvas,e.src=r,e.onload=function(){o.elementData.width=this.width,o.elementData.height=this.height,o.imageRatio=this.width/this.height,currentCanvas.params[i(5).getIndexById(o.id)].width=this.width/o.ratio,currentCanvas.params[i(5).getIndexById(o.id)].height=this.height/o.ratio,o.fontRatio||(o.fontRatio=currentCanvas.params[i(5).getIndexById(o.id)].height/Math.round(a.getTextViewFontSize(currentCanvas.params[i(5).getIndexById(o.id)].fontSize))),o.limitHeight.length||(o.limitHeight.push(o.limitSize[0]*o.fontRatio),o.limitHeight.push(o.limitSize[1]*o.fontRatio)),i(19).drawImage("textElementCanvas"+o.id,r,0,0,function(){t.vm.$broadcast("notifyRefreshScreenshot")},this.width,this.height)},o.textSrc=r},getTextImageUrl:function(){var e=i(5).getIndexById(this.id),a=t.pages[t.selectedPageIdx].canvas,o="../../static/img/blank.png",r=0,n=0;return n=Math.round(i(10).getTextViewFontSize(a.params[e].fontSize)),this.fontRatio&&this.lastSize===n&&this.allow?(a.params[e].fontSize=this.elementData.height/this.fontRatio/this.ratio,r=Math.round(i(10).getTextViewFontSize(a.params[e].fontSize))):(r=n,this.allow=!0),this.lastSize=r,r>0&&(o=""===a.params[e].text?t.isPreview?"../../static/img/blank.png":t.domains.proxyFontBaseUrl+"/product/text/textImage?text="+encodeURIComponent("Enter text here")+"&font="+encodeURIComponent(a.params[e].fontFamily)+"&fontSize="+r+"&color="+a.params[e].fontColor+"&align=left":t.domains.proxyFontBaseUrl+"/product/text/textImage?text="+encodeURIComponent(a.params[e].text)+"&font="+encodeURIComponent(a.params[e].fontFamily)+"&fontSize="+r+"&color="+a.params[e].fontColor+"&align=left"),o},onDoubleClick:function(e){},onDragOver:function(){},setIndex:function(){var e=t.pages[t.selectedPageIdx].canvas;e.selectedIdx=i(5).getIndexById(this.id),t.isLostFocus=!1},getlimitHeight:function(){},setLimitSize:function(){var e=a.getTextViewFontSize(a.getPxByInch(.3)),t=a.getTextViewFontSize(a.getPxByInch(16));this.limitSize.push(e),this.limitSize.push(t)}},events:{dispatchRefresh:function(){this.refreshText()},dispatchScaleEnd:function(e){var t=this.elementData.width+e.width/this.ratio,i=this.elementData.height+e.height/this.ratio;i<=this.limitHeight[0]?(this.elementData.width=this.limitHeight[0]*this.imageRatio,this.elementData.height=this.limitHeight[0]):i>=this.limitHeight[1]?(this.elementData.width=this.limitHeight[1]*this.imageRatio,this.elementData.height=this.limitHeight[1]):(this.elementData.width=t,this.elementData.height=i),this.refreshText(),this.backImgShow=!1},dispatchScaleStart:function(){this.setIndex(),i(19).clear("textElementCanvas"+this.id),this.backImgShow=!0},dispatchClick:function(){this.setIndex(),this.sharedStore.isEditLayerShow=!1},dispatchMove:function(e){this.setIndex(),t.vm.$broadcast("notifyRefreshScreenshot")},dispatchDblClick:function(){this.sharedStore.watches.isChangeThisText=!0},dispatchScale:function(e){var t=this.elementData.width+e.width/this.ratio,i=this.elementData.height+e.height/this.ratio;i<=this.limitHeight[0]?(this.elementData.width=this.limitHeight[0]*this.imageRatio,this.elementData.height=this.limitHeight[0]):i>=this.limitHeight[1]?(this.elementData.width=this.limitHeight[1]*this.imageRatio,this.elementData.height=this.limitHeight[1]):(this.elementData.width=t,this.elementData.height=i)}},created:function(){},ready:function(){this.setLimitSize(),this.refreshText()}}}).call(t,i(2))},,function(e,t,i){(function(t){e.exports={template:'<div><div class="shadow-bg" v-show="privateStore.isShowCartReturn" v-bind:style="{zIndex: windowZindex-1}"></div><div id="cartReturnWindow" v-show="privateStore.isShowCartReturn" class="box-popup" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }" ><div style="font-size: 24px;margin: 40px 45px 54px 45px;color: #3a3a3a;">What would you like to do?</div><div style="margin: 40px 45px 54px 45px;"><div><input id="currentItem" name="cartRerutnItem" type="radio" value="current" v-model="privateStore.selected"><label for="currentItem" style="font-size:18px;color: #3a3a3a;">Edit current project</label><div style="font-size:14px;color: #7b7b7b;margin: 10px 0 0 22px;height: 50px;"></div></div><div><input id="cloneItem" name="cartRerutnItem" type="radio" value="clone" v-model="privateStore.selected"><label for="cloneItem" style="font-size:18px;color: #3a3a3a;">Clone current project</label><div style="font-size:14px;color: #7b7b7b;margin: 10px 0 0 22px;height: 50px;">Create a copy of the current project to edit.</div></div><div><input id="newItem"  name="cartRerutnItem" type="radio" value="new" v-model="privateStore.selected"><label for="newItem" style="font-size:18px;color: #3a3a3a;">Create a new blank project</label></div></div><div class="popup-button" style="margin-top:35px;text-align:center;"><div class="button t-center" v-on:click="optionChange()" style="display:inline-block;width: 160px;height: 40px;line-height: 40px;font-size: 14px;">Continue</div></div></div></div>',data:function(){return{privateStore:{width:580,height:450,selector:"#cartReturnWindow",selected:"current",isShowCartReturn:!1},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{optionChange:function(){switch(this.privateStore.selected){case"current":return void(this.privateStore.isShowCartReturn=!1);case"clone":return t.fromCart=!1,this.privateStore.isShowCartReturn=!1,void this.$dispatch("dispatchShowCloneWindow");case"new":return t.fromCart=!1,t.watches.isProjectLoaded=!1,this.privateStore.isShowCartReturn=!1,void this.$dispatch("dispatchShowNewProjectWindow")}}},events:{notifyShowCartReturnWindow:function(){var e=i(12);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.privateStore.isShowCartReturn=!0}},created:function(){},ready:function(){}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={template:'<div v-show="sharedStore.isShowClone"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div id="cloneWindow" class="box-order" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" draggable="false" width="16" height="16" v-on:click="handleHideView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Clone Project</div></div><div style="margin: 40px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Please input new project name</label><div class="box-textarea"><input id="clone_title" type="text" v-model="privateStore.title" class="font-textarea"  style="width: 533px;height:35px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[0]}}" v-on:blur="handleTitleInputBlur()" v-on:focus="handleTitleInputFocus()" maxlength="50"></textarea></div></div><div class="texteditor-button" style="margin-top: 0px;"><div id="emptyInfo" v-show="privateStore.isProjectNameInvalid" style="width: auto;text-align: center;height: 30px;line-height: 30px;font-size: 14px;color:red;margin-left:auto;margin-right:auto;">{{privateStore.invalidateTitle}}</div><div style="text-align: center; margin-top:25px;"><div class="button t-center button-white" v-on:click="cancel" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; font-size: 14px; margin-right: 26px;border: 1px solid #ccc;color: #393939;">Cancel</div><div class="button t-center" v-on:click="submit" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; font-size: 14px;">Clone</div></div></div></div>',data:function(){return{privateStore:{width:655,height:318,title:"",selector:"#cloneWindow",marks:["input new name here"],invalidateTitle:"Please input new project name. ",isProjectNameInvalid:!1},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideView:function(){this.sharedStore.isShowClone=!1,this.privateStore.title=""},submit:function(){this.privateStore.title&&""!==this.privateStore.title.trim()?i(6).checkInvalid(this.privateStore.title)?(this.privateStore.isProjectNameInvalid=!1,i(13).cloneProject(this,this.privateStore.title),this.privateStore.title=""):(this.privateStore.invalidateTitle="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.",this.privateStore.isProjectNameInvalid=!0):(this.privateStore.invalidateTitle="Please input new project name",this.privateStore.isProjectNameInvalid=!0)},cancel:function(){this.sharedStore.isShowClone=!1,this.privateStore.title=""},handleTitleInputBlur:function(){return this.privateStore.title=this.replaceInvalidString(this.privateStore.title),this.privateStore.title&&""!==this.privateStore.title.trim()?void(i(6).checkInvalid(this.privateStore.title)?this.privateStore.isProjectNameInvalid=!1:(this.privateStore.invalidateTitle="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.",this.privateStore.isProjectNameInvalid=!0)):(this.privateStore.invalidateTitle="Please input new project name",void(this.privateStore.isProjectNameInvalid=!0))},handleTitleInputFocus:function(){this.privateStore.invalidateTitle=""},replaceInvalidString:function(e){var t=/<\/?[^>]*>/g,i=/[ | ]*\n/g,a=/&nbsp;/gi;return e.replace(t,"").replace(i,"").replace(a,"").replace(/(^\s+)|(\s+$)/g,"")}},ready:function(){},events:{notifyShowCloneWindow:function(){var e=i(12);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.sharedStore.isShowClone=!0,this.privateStore.isProjectNameInvalid=!1},notifyHideCloneWindow:function(){this.sharedStore.isShowClone=!1},notifyShowInvalidTitle:function(e){this.privateStore.invalidateTitle=e,this.privateStore.isProjectNameInvalid=!0}},created:function(){}}}).call(t,i(2))},function(e,t,i){(function(t,a){e.exports={template:'<div class="bed-image-upload" v-show="sharedStore.isImageUploadShow"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div class="box-image-upload" v-bind:style="{ zIndex: windowZindex }" style="width:655px;height:480px;"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 600px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="hideImageUpload(true)" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 14px; cursor: pointer;" /></div></div><div style="margin: 0 40px;position:relative;"><div class="font-title t-left">Upload Images</div><div v-show="isWarnMessageShow && !(sharedStore.maxPageNum && !sharedStore.isUploading)" class="font-light" style="position:absolute;top: 33px;font-size:12px;color:#de3418;">{{warnMessage}}</div></div><div style="margin: 30px 40px 0;"><div class="upload-row-title"><span class="upload-status-head">File</span><span class="upload-status-sub">File Progress</span></div></div><div id="box-upload-list" style="margin: 0 20px 0 40px;height: 230px; overflow: auto;position:relative;"></div><div style="margin: 24px 40px;height:40px;position:relative;"><div style="float:left;line-height:38px;"><span class="font-normal" style="font-size:12px;color:#7B7B7B;">{{sharedStore.successfullyUploaded}} Complete</span><span style="margin-left: 15px;color:#de3418;font-size:12px;" v-show="sharedStore.errorUploaded">{{sharedStore.errorUploaded}} Failed</span></div><div v-show="sharedStore.maxPageNum && !sharedStore.isUploading && sharedStore.maxPageNum > sharedStore.pages.length" style="position:absolute;right:1px;top:-30px;background-color:#3a3a3a;color:#fff;font-size:12px;padding:4px 10px;box-shadow:0 2px 4px 0 rgba(0,0,0,.13);">{{remainTip}}<div style="position:absolute;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:5px solid #3a3a3a;left:78%;bottom:-5px;transform:translateX(-50%);"></div></div><div style="float:right;"><div class="button-white t-center" :style="addMoreStyle" v-on:click="handleUploadClick(true)" style="width: 160px;height: 40px;line-height: 40px;display: inline-block;font-size: 14px;">Add More Photos</div></div><input type="file" name="" id="multi-files" multiple accept="{{sharedStore.uploadAcceptType}}" v-on:change="handleDoUpload()" style="display: none;" /><input type="file" name="" id="single-files"  accept="image/*" v-on:change="handleDoUpload()" style="display: none;" /></div></div></div>',data:function(){return{privateStore:{els:"",uploadWindowParams:{width:655,height:480,selector:".box-image-upload"},uploadParams:{fileSelector:"#multi-files"},firstUpload:!1,single:null},sharedStore:t,isWarnMessageShow:!1}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)},warnMessage:function(){return"You can only upload "+t.maxPageNum+" images per pack in total."},remainTip:function(){return"Still need to upload "+(t.maxPageNum-t.pages.length)+" photo(s), click here to continue"},addMoreStyle:function(){var e=this.sharedStore.maxPageNum&&(this.sharedStore.isUploading||this.sharedStore.maxPageNum<=this.sharedStore.pages.length);return{color:e?"#ccc":"#000",borderColor:e?"#ccc":"rgba(203, 203, 203, 1)",cursor:e?"not-allowed":"pointer"}}},methods:{showImageUpload:function(){var e=i(12);e.setPopWindowPosition(this.privateStore.uploadWindowParams),this.sharedStore.isImageUploadShow=!0},hideImageUpload:function(e,o){e||(t.cancelByX=!0),this.sharedStore.filesCountInQueue+this.sharedStore.errorExt>=this.sharedStore.filesTotalInQueue?(a(this.privateStore.uploadParams.fileSelector).val(""),this.sharedStore.isImageUploadShow=!1,t.isUploading=!1,e&&i(8)({ev:i(9).CloseMonitor,auto:!!o})):this.$dispatch("dispatchShowPopup",{type:"cancelUpload",status:-1}),this.isWarnMessageShow=!1},handleUploadClick:function(e,o){this.sharedStore.maxPageNum&&(this.sharedStore.isUploading||this.sharedStore.maxPageNum<=this.sharedStore.pages.length&&"number"!=typeof t.watchData.replacePageId)||(e?i(8)({ev:i(9).AddMorePhotos}):(this.resetImageUploadDom(),t.uploadProgress.length=0,t.successfullyUploaded=0,t.errorUploaded=0,t.cancelledUpload.length=0,t.oriImageIds=[],t.oriImageNames=[],t.currentUploadCount=0,t.filesTotal=0,t.prevFilesTotal=[],t.prevFilesTotal=0,t.filesTotalInQueue=0,t.filesCountInQueue=0),t.currentSuccessUpload=0,t.currentErrorUpload=0,t.errorExt=0,a(this.privateStore.uploadParams.fileSelector).val(""),o||this.privateStore.single?(this.privateStore.uploadParams.fileSelector="#single-files",a("#single-files").trigger("click")):(this.privateStore.uploadParams.fileSelector="#multi-files",a("#multi-files").trigger("click")))},handleDoUpload:function(){var e=i(37),a=document.querySelector(this.privateStore.uploadParams.fileSelector).files;a.length&&(t.maxPageNum&&t.pages.length+a.length>t.maxPageNum&&"number"!=typeof t.watchData.replacePageId&&(this.isWarnMessageShow=!0),i(8)({ev:i(9).FinishPhotoSelect,chooseTimes:++t.chooseTimes,chooseCount:a.length}),this.privateStore.firstUpload?(e(this,this.privateStore.uploadParams,!0),this.privatedStore.firstUpload=!1):e(this,this.privateStore.uploadParams),this.sharedStore.startUploadTime=new Date,i(8)({ev:i(9).StartUpload,uploadCount:a.length}),this.sharedStore.isUploading=!0),this.showImageUpload()},handleSaveAndHideUpload:function(e){if(this.sharedStore.filesCountInQueue>=this.sharedStore.filesTotalInQueue){if(this.$dispatch("dispatchSaveProject",!0),this.sharedStore.maxPageNum&&this.sharedStore.pages.length<this.sharedStore.maxPageNum)return;this.hideImageUpload(!0,e),t.cancelByX=!1,t.isLostFocus=!0,setTimeout(function(){t.watchData.replacePageId=null})}else t.vm.$broadcast("notifyShowPopup",{type:"cancelUpload",status:-1})},refreshImageUploadDom:function(){a("#box-upload-list").find(".new-add-upload-row").remove();for(var e=0;e<this.sharedStore.uploadProgress.length;e++)this.sharedStore.uploadProgress[e]&&this.sharedStore.uploadProgress[e].percent&&(this.initImageUploadDom(e,this.getImageName(this.sharedStore.uploadProgress[e].imgId)),"Done"===this.sharedStore.uploadProgress[e].percent&&a("#delete-"+e).hide(),(this.sharedStore.uploadProgress[e].percent.toString().indexOf("Only")>=0||this.sharedStore.uploadProgress[e].info&&this.sharedStore.uploadProgress[e].info.toString().indexOf("Failed")>=0)&&(a("#retry-"+e).show(),a("#progress-c-"+e).hide(),a("#delete-"+e).hide(),a("#status-"+e).css("width","310")))},getImageName:function(e){for(var i=0;i<t.oriImageNames.length;i++){var a=t.oriImageNames[i];if(a.imgId===e)return a.filename}},initImageUploadDom:function(e,t){var i=t;if(i.length>15&&(i=i.substr(0,12)+"..."+i.substr(i.length-3)),e<5){a("#upload-row-item-"+e+" .upload-status-head").text(i).attr("title",t);var o='<span id="progress-c-'+e+'" style="display: inline-block;position:relative;vertical-align:middle; top: 0; left: 10px;width: 341px;height: 10px; border-radius: 5px; background-color: white;"><span id="progress-'+e+'" style="display: inline-block;width: 1px; height: 10px; border-radius: 5px; background-color: #ccc;">&nbsp;</span></span><span id="status-'+e+'" style="position: relative;vertical-align: middle; left: 26px;display:inline-block;;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">0%</span><span id="error-tip-'+e+'"></span><div style="display:none;position:absolute;right:7px;top:0;text-decoration:none;color:#de3418;" class="upload-retry" id="retry-'+e+'">Failed</div>';a("#upload-row-item-"+e+" .upload-status-sub").html(o)}else{var r='<div class="upload-row-item new-add-upload-row" style="overflow:hidden;" id="upload-row-item-'+e+'"><span class="upload-status-head" style="float:left;display:inherit;" title="'+t+'">'+i+'</span><span class="upload-status-sub" style="position:relative;"><span id="progress-c-'+e+'" style="display: inline-block;vertical-align:middle;position:relative; top: 0; left: 10px;width: 341px;height: 10px; border-radius: 5px; background-color: white;"><span id="progress-'+e+'" style="display: inline-block;width: 1px; height: 10px; border-radius: 5px; background-color: #ccc;">&nbsp;</span></span><span id="status-'+e+'" style="position: relative;vertical-align: middle; left: 26px;display:inline-block;;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">0%</span><span id="error-tip-'+e+'"></span><div style="display:none;position:absolute;right:7px;top:0;text-decoration:none;color:#de3418;" class="upload-retry" id="retry-'+e+'">Failed</div></span></div>';
a("#box-upload-list").append(r)}},resetImageUploadDom:function(){for(var e="",t=0;t<5;t++)e+='<div class="upload-row-item" style="overflow:hidden;" id="upload-row-item-'+t+'"><span class="upload-status-head" style="float:left;display:inherit;">&nbsp</span><span class="upload-status-sub" style="position:relative;">&nbsp</span></div>';a("#box-upload-list").html(e),a("#multi-files").val(""),this.sharedStore.filesTotalInQueue=0,this.sharedStore.filesCountInQueue=0},updateUploadProgress:function(){for(var e=0;e<this.sharedStore.uploadProgress.length;e++)if(this.sharedStore.uploadProgress[e]&&"Done"===this.sharedStore.uploadProgress[e].percent){if(a("#status-"+e).text("Done").css("color","#7a7a7a"),a("#progress-"+e).css("width",341).css("background-color","#393939").attr("title",""),["PR","CLO","flushMountPrint","LSC"].indexOf(t.projectType)<0&&t.pages&&t.pages[t.selectedPageIdx].canvas){var i=t.pages[t.selectedPageIdx].canvas;if(i.params.length&&i.params[i.selectedIdx]&&"image"===i.params[i.selectedIdx].elType&&""===i.params[i.selectedIdx].imageId&&this.$dispatch("dispatchSingleImageUploadComplete",t.oriImageIds[e]),"CR"===t.projectType){for(var o=0,r="",n=0,s=0;s<i.params.length;s++)"image"===i.params[s].elType&&(o++,r=i.params[s].imageId,n=i.params[s].id);1!==o||r||(i.selectedIdx=n,this.$dispatch("dispatchSingleImageUploadComplete",t.oriImageIds[e]))}}0===this.sharedStore.uploadProgress[e].successUploadAt&&(this.sharedStore.uploadProgress[e].successUploadAt=(new Date).getTime(),this.trackPhotoFinishUpload(this.sharedStore.uploadProgress[e]))}else this.sharedStore.uploadProgress[e]&&"Error"===this.sharedStore.uploadProgress[e].percent?(a("#status-"+e).text("Error").css("color","#7a7a7a"),a("#progress-"+e).css("width",341).css("background-color","#de3418").attr("title",this.sharedStore.uploadProgress[e].info)):this.sharedStore.uploadProgress[e]&&(this.sharedStore.uploadProgress[e].percent.toString().indexOf("Only")>=0||this.sharedStore.uploadProgress[e].info&&this.sharedStore.uploadProgress[e].info.toString().indexOf("Failed")>=0?a("#status-"+e).text(this.sharedStore.uploadProgress[e].percent).css("color","#de3418").css("width","310").css("left","10px").css("font-size","12px").css("font-style","italic").attr("title",this.sharedStore.uploadProgress[e].info):(0===this.sharedStore.uploadProgress[e].startUploadAt&&(this.sharedStore.uploadProgress[e].startUploadAt=(new Date).getTime(),this.trackPhotoStartUpload(this.sharedStore.uploadProgress[e])),a("#status-"+e).text(this.sharedStore.uploadProgress[e].percent+"%").css("color","#7a7a7a"),a("#progress-"+e).css("width",3.41*this.sharedStore.uploadProgress[e].percent).css("background-color","#ccc")))},trackPhotoStartUpload:function(e){var a=e.file.name,o=e.file.size,r=e.startUploadAt,n="";n=t.projectSettings.length?t.projectSettings[0].product:t.baseProject&&t.baseProject.product,i(8)({ev:i(9).StartUploadEachPhoto,product:n,startUploadAt:r,photoName:a,photoSize:o})},trackPhotoFinishUpload:function(e){var a=e.file.name,o=e.file.size,r=e.startUploadAt,n=e.successUploadAt,s="";s=t.projectSettings.length?t.projectSettings[0].product:t.baseProject&&t.baseProject.product,i(8)({ev:i(9).CompleteUploadEachPhoto,product:s,successUploadAt:n,photoName:a,photoSize:o,uploadSpend:n-r})},isWindowOpen:function(){return t.isImageUploadShow},cancelItem:function(e){t.cancelledImgIds.indexOf(t.oriImageIds[e])<0&&(t.cancelledUpload.push(e),t.cancelledImgIds.push(t.oriImageIds[e])),a("#upload-row-item-"+e).hide(),this.sharedStore.uploadProgress[e].xhr&&this.sharedStore.uploadProgress[e].xhr.abort(),this.sharedStore.filesCountInQueue++,t.cancelledUpload.length===t.filesTotal&&(this.sharedStore.uploadProgress.length=0,this.handleSaveAndHideUpload(),this.sharedStore.isUploading=!1,t.vm.$broadcast("notifyHidePopup"))}},events:{notifyShowImageUpload:function(e){this.handleUploadClick(null,e)},notifyCancelItem:function(e){this.cancelItem(e)}},created:function(){var e=this;e.$watch("sharedStore.uploadProgress",e.updateUploadProgress,{deep:!0})},ready:function(){t.cancelledImgIds=[]}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){i(7);e.exports={template:'<div v-show="privateStore.isShowCreateProject"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div id="newProjectWindow" class="box-order" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" draggable="false" width="16" height="16" v-on:click="handleHideView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Create a new project</div></div><div style="margin: 40px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Please input new project name</label><div class="box-textarea"><input id="new_project_title" type="text" v-model="privateStore.title" class="font-textarea"  style="width: 533px;height:35px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[0]}}" v-on:blur="handleTitleInputBlur()" maxlength="50"></textarea></div></div><div class="texteditor-button" style="margin-top: 0px;"><div id="new_project_emptyInfo" style="width: auto;text-align: center;height: 30px;line-height: 30px;font-size: 14px;color:red;margin-left:auto;margin-right:auto;visibility:hidden;">{{privateStore.invalidateTitle}}</div><div style="text-align: center;margin-top:25px;"><div class="button t-center button-white" v-on:click="cancel" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; font-size: 14px; margin-right: 26px;border: 1px solid #ccc;color: #393939;">Cancel</div><div class="button t-center" v-on:click="submit" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; font-size: 14px;">Done</div></div></div></div>',data:function(){return{privateStore:{width:655,height:318,title:"",selector:"#newProjectWindow",marks:["input new name here"],invalidateTitle:"Please input new project name. ",isShowCreateProject:!1},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideView:function(){this.privateStore.isShowCreateProject=!1,this.privateStore.title=""},submit:function(){var e=this;if(this.privateStore.title&&""!==this.privateStore.title.trim())if(this.privateStore.title===t.title){var o="Title existed, please pick another one.";t.vm.$broadcast("notifyShowNewProjectInvalidTitle",o)}else i(6).checkInvalid(this.privateStore.title)?i(7).createProjectAddOrUpdateAlbum(e.privateStore.title,t.title,function(t){a("#new_project_emptyInfo").css("visibility","hidden"),i(13).createProject(e,t),e.privateStore.title=""},function(){}):(this.privateStore.invalidateTitle="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.",a("#new_project_emptyInfo").css("visibility","visible"));else this.privateStore.invalidateTitle="Please input new project name",a("#new_project_emptyInfo").css("visibility","visible")},cancel:function(){this.privateStore.isShowCreateProject=!1},handleTitleInputBlur:function(){return this.privateStore.title=this.replaceInvalidString(this.privateStore.title),this.privateStore.title&&""!==this.privateStore.title.trim()?void(i(6).checkInvalid(this.privateStore.title)?a("#new_project_emptyInfo").css("visibility","hidden"):(this.privateStore.invalidateTitle="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.",a("#new_project_emptyInfo").css("visibility","visible"))):(this.privateStore.invalidateTitle="Please input new project name",void a("#new_project_emptyInfo").css("visibility","visible"))},replaceInvalidString:function(e){var t=/<\/?[^>]*>/g,i=/[ | ]*\n/g,a=/&nbsp;/gi;return e.replace(t,"").replace(i,"").replace(a,"").replace(/(^\s+)|(\s+$)/g,"")}},ready:function(){},events:{notifyShowNewProjectWindow:function(){var e=i(12);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.privateStore.isShowCreateProject=!0,a("#new_project_emptyInfo").css("visibility","hidden")},notifyHideNewProjectWindow:function(){this.privateStore.isShowCreateProject=!1},notifyShowNewProjectInvalidTitle:function(e){this.privateStore.invalidateTitle=e,a("#new_project_emptyInfo").css("visibility","visible")}},created:function(){}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,a){var o=i(5),r=i(16);e.exports={template:'<div id="warnTipElement-{{ id }}" v-show="scale > warnTipLimit" v-bind:style="{ height:  (privateStore.height) + \'px\', bottom: bottom + \'px\', left: left + \'px\', zIndex: windowZindex }" style="position: absolute;"><img src="../../static/img/warn_big_icon.svg" width="{{ privateStore.width }}px" height="{{ privateStore.height }}px" alt="" title="{{ warnTipMsg }}" /> {{ privateStore.warnTipContent }}</div>',props:["id","width","height","x","y","pagenum"],data:function(){return{privateStore:{width:18,height:18,warnTipContent:"",margin:t.warnTipMargin||90,scale:1},sharedStore:t}},computed:{warnTipLimit:function(){return this.sharedStore.warnTipLimit||200},scale:function(){var e=this.sharedStore.pages[this.pagenum||this.sharedStore.selectedPageIdx].canvas,t=o.getIndexById(this.id),i=e.params[t],a=r.getImageDetail(i.imageId),n=a.width*e.params[t].cropPW,s=this.width/e.ratio;if(n<s)var d=100*(s-n)/n;else var d=0;return Math.round(d)},bottom:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas,i=this.privateStore.margin*e.ratio;if(this.sharedStore.warnTipBottom)return this.sharedStore.warnTipBottom;if(this.sharedStore.isCanvas){var a=(e.photoLayer.height-Math.abs(e.photoLayer.y)-e.canvasBordeThickness.top)*e.ratio;return this.y+this.height>a&&(i+=this.y+this.height-a),i}switch(this.sharedStore.projectSettings[t.currentSelectProjectIndex].product){case"frameCanvas":case"acrylicPrint":case"metalPrint":case"woodPrint":case"LRB":case"LSC":case"mountPrint":var a=(e.photoLayer.height-Math.abs(e.photoLayer.y))*e.ratio;return this.y+this.height>a&&(i+=this.y+this.height-a),i;case"IPadCase":return(this.privateStore.margin+e.realSides.bottom+e.realEdges.bottom+e.realBleedings.bottom+10)*e.ratio;case"PhoneCase":return(this.privateStore.margin+e.realSides.bottom+e.realEdges.bottom+e.realBleedings.bottom)*e.ratio;default:var o="M"===this.sharedStore.projectSettings[t.currentSelectProjectIndex].matte?Math.abs(e.boardInMatting.top):Math.abs(e.photoLayer.y),a=(e.photoLayer.height-o)*e.ratio;return this.y+this.height>a&&(i="M"===this.sharedStore.projectSettings[t.currentSelectProjectIndex].matte?i+e.boardInMatting.bottom*e.ratio:i+e.boardInFrame.bottom*e.ratio),i}},left:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas,i=this.privateStore.margin*e.ratio;if(this.sharedStore.warnTipLeft)return this.sharedStore.warnTipLeft;if(this.sharedStore.isCanvas){var a=(Math.abs(e.photoLayer.x)+e.canvasBordeThickness.left)*e.ratio;return this.x<a&&(i+=a-this.x),i}switch(this.sharedStore.projectSettings[t.currentSelectProjectIndex].product){case"frameCanvas":case"flushMountCanvas":case"acrylicPrint":case"metalPrint":case"woodPrint":case"LRB":case"LSC":case"mountPrint":var a=Math.abs(e.photoLayer.x)*e.ratio;return this.x<a&&(i+=a-this.x),"acrylicPrint"==this.sharedStore.projectSettings[t.currentSelectProjectIndex].product&&(i+=300*e.ratio),i;case"IPadCase":return(this.privateStore.margin+e.realSides.left+e.realEdges.left+e.realBleedings.left+300)*e.ratio;case"PhoneCase":return(this.privateStore.margin+e.realSides.left+e.realEdges.left+e.realBleedings.left)*e.ratio;default:var a="M"===this.sharedStore.projectSettings[t.currentSelectProjectIndex].matte?Math.abs(e.boardInMatting.left)*e.ratio:Math.abs(e.photoLayer.x)*e.ratio;return this.x<a&&(i="M"===this.sharedStore.projectSettings[t.currentSelectProjectIndex].matte?i+e.boardInMatting.left*e.ratio:i+e.boardInFrame.left*e.ratio),i}},mirrorLength:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;return e.ratio*this.sharedStore.mirrorLength},windowZindex:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas,t=o.getIndexById(this.id),i=e.params[t];return 100*(i.dep+1)+80},warnTipMsg:function(){return"Photo has low resolution and may look poor in print."}},methods:{hideWarnTip:function(e){a("#warnTipElement-"+e).hide()},showWarnTip:function(e){a("#warnTipElement-"+e).show()}},events:{notifyShowWarnTip:function(){var e=o.getIndexById(this.id);this.showWarnTip(e)},notifyHideWarnTip:function(){var e=o.getIndexById(this.id);this.hideWarnTip(e)}},created:function(){},ready:function(){}}}).call(t,i(2),i(4))}]);