webpackJsonp([1],[function(e,t,i){(function(e,t){var r=i(42);r.loadDomainUrls();var a=i(33);a.getUserInfo();var o=i(11),n=i(7),s=i(13),d=(i(16),i(24)),l=d.extend(i(71));d.component("page-loading",l);var c=d.extend(i(60));d.component("as-header",c);var p=d.extend(i(87));d.component("image-upload",p);var h=d.extend(i(77));d.component("single-image-upload",h);var g=d.extend(i(64));d.component("list-tab",g);var u=d.extend(i(59));d.component("handle",u);var m=d.extend(i(55));d.component("bar-panel",m);var f=d.extend(i(72));d.component("photo-element",f);var v=d.extend(i(82));d.component("text-element",v);var S=d.extend(i(76));d.component("screenshot-element",S);var y=d.extend(i(67));d.component("mirror-element",y);var w=d.extend(i(54));d.component("bg-layer",w);var x=d.extend(i(58));d.component("dashboard",x);var I=d.extend(i(61));d.component("image-crop",I);var b=d.extend(i(81));d.component("text-editor",b);var P=d.extend(i(66));d.component("measure-option",P);var j=d.extend(i(70));d.component("order-window",j);var C=d.extend(i(73));d.component("preview-header",C);var T=d.extend(i(56));d.component("contact-us-window",T);var k=d.extend(i(65));d.component("matting-change-confirm",k);var L=d.extend(i(74));d.component("preview-item-list",L);var D=d.extend(i(89));d.component("pop-up",D);var B=d.extend(i(86));d.component("clone-window",B);var R=d.extend(i(63));d.component("inner-preview",R);var F=d.extend(i(68));d.component("option-list",F);var U=d.extend(i(69));d.component("option-item",U);var z=d.extend(i(79));d.component("layout-list",z);var M=d.extend(i(80));d.component("template-item",M);var H=d.extend(i(85));d.component("cart-choose-window",H);var O=d.extend(i(88));d.component("new-project-window",O);var E=d.extend(i(84));d.component("warntip-element",E);var A=d.extend(i(75));d.component("price-item",A);var N=d.extend(i(78));d.component("style-select-modal",N);var W=new d({el:"#app",mixins:[i(38),i(40)],data:{privateStore:{isShowPage:!1},sharedStore:e,imageName:"",isCanvas:!1},computed:{},methods:{init:function(){var r=this;r.sharedStore.domains;if(prj=r.sharedStore.projectSettings[e.currentSelectProjectIndex],user=r.sharedStore.userSettings,e.title=decodeURIComponent(n.getUrlParam("title")),e.projectId=n.getUrlParam("initGuid"),e.fromCart=n.getUrlParam("fromCart"),e.isPreview=n.getUrlParam("isPreview"),e.isFromMarketplace=n.getUrlParam("isFromMarketplace"),e.mainProjectUid=n.getUrlParam("mainProjectUid"),e.encImageId=n.getUrlParam("encImageId"),e.style=n.getUrlParam("style"),e.isFromMyPhoto=n.getUrlParam("isFromMyPhoto"),e.isOrderedPreview=n.getUrlParam("orderedPreview"),e.isFromFactory="factory"===n.getUrlParam("source")||"remake"===n.getUrlParam("source"),e.selectedPageIdx=n.getUrlParam("selectedPageIdx")?Number(n.getUrlParam("selectedPageIdx")):0,e.selectedPageGuid=n.getUrlParam("pageId"),e.currentSelectProjectIndex=n.getUrlParam("selectedPageIdx")?Number(n.getUrlParam("selectedPageIdx")):0,e.source=n.getUrlParam("source"),e.lppQuantity=n.getUrlParam("lppQuantity"),e.isRemark="remake"===decodeURIComponent(n.getUrlParam("source")),e.token=n.getUrlParam("token"),e.pUser=n.getUrlParam("pUser"),e.orderNumber=decodeURIComponent(n.getUrlParam("orderNumber")),e.timestamp=n.getUrlParam("timestamp"),""===e.projectId){this.sharedStore.LSCPageNum=parseInt(e.lppQuantity),e.isNewProject=!0,e.baseProject={};var a=i(1).getOptionIds();a.forEach(function(t){e.baseProject[t]=n.getUrlParam(t)||"none"});for(var d=0;d<this.sharedStore.LSCPageNum;d++){var l=i(19),c=l();c.product=n.getUrlParam("product")||"none",c.color=n.getUrlParam("color")||"none",c.matteStyle=n.getUrlParam("matteStyle")||"none",c.category=n.getUrlParam("category")||"none",c.paper=n.getUrlParam("paper")||"none",c.glassStyle=n.getUrlParam("glassStyle")||"none",c.size=n.getUrlParam("size")||"none",c.frameStyle=n.getUrlParam("style")||"none",c.canvasBorder=n.getUrlParam("canvasBorder")||"none",c.canvasBorderSize=n.getUrlParam("canvasBorderSize")||"none",c.matte=n.getUrlParam("matte")||"none",c.metalType=n.getUrlParam("type")||"none",c.orientation=n.getUrlParam("orientation")||"Landscape",c.finish=n.getUrlParam("finish")||"none",c.rotated=!0,this.sharedStore.projectSettings.push(c)}e.isFromMarketplace="true"===n.getUrlParam("isFromMarketplace"),e.isFromMarketplace&&(e.isShowPostToSale=!0);t(document).attr("title")}(!e.isRemark&&!e.isPreview&&""===user.userId||prj&&(""===prj.product||""===prj.size)&&""===e.projectId)&&(alert("Please log in!"),window.location="/"),e.projectId&&o.getAlbumId(),""!==user.userId&&""!==e.projectId&&(e.isPreview||s.getProjectOrderedState(this),i(11).getProjectInfo(),this.sharedStore.isReadyToLoadProject=!0),setInterval(function(){i(33).keepAlive()},24e4)},loadProjectXml:function(){""===e.projectId&&i(13).setDefaultValue(),e.projectId?s.getOldProject():s.saveNewProject(this)},$watchAll:function(e,t){var i=this;e.forEach(function(e){i.$watch(e,t)})}},events:{},created:function(){var r=this;i(44).loadLocalSpec(),window.onpageshow=function(e){e.persisted&&window.location.reload()},r.$watch("sharedStore.watches.isSpecLoaded",function(){r.sharedStore.watches.isSpecLoaded&&(r.init(),r.loadProjectXml())}),r.$watch("sharedStore.watches.isProjectLoaded",function(){if(r.sharedStore.watches.isProjectLoaded){i(8)({ev:i(9).LoadComplete,isNewProject:e.isNewProject}),i(11).getTitle(),s.transformOldProjectToNew(),s.initProjectSettings(),e.isNewProject&&e.projectId&&window.history.replaceState({},"LittleRoundBlock","?initGuid="+e.projectId+"&webClientId=1");var a=r.sharedStore.projectSettings[e.currentSelectProjectIndex];"woodPrint"!==a.product||"natural"!==a.finish&&"white"!==a.finish||("natural"===a.finish&&(a.finish="glossy"),"white"===a.finish&&(a.finish="matte"),r.sharedStore.isWoodPrintOptionUpdated=!0);var o=t(document).attr("title"),n=document.querySelector("meta[name=keywords]"),d=document.querySelector("meta[name=description]"),l=i(1).getOptionNameById("product",a.product),c=o.replace("Product",l);t(document).attr("title",c),n.content=n.content.replace("Product",l),d.content=d.content.replace("Product",l),a.category=i(1).getCategoryByProduct(a.product);var p=parseFloat(i(1).getVersion());if(p<3.7&&("contemporary"!==a.product&&"metal"!==a.product&&"classicFrame"!==a.product&&"rusticFrame"!==a.product||"CP"!==a.paper&&"MP"!==a.paper&&"none"===a.glassStyle&&(a.glassStyle="coating")),t(e.projectXml).find("photosLayer")&&(a.tplGuid=t(e.projectXml).find("photosLayer").attr("tplGuid"),a.tplSuitId=t(e.projectXml).find("photosLayer").attr("tplSuitId")),i(15).initCanvasData(),r.$broadcast("notifyPaint"),this.sharedStore.isPreview||setTimeout(function(){r.$broadcast("notifyShowItem")}),!e.isPreview){var h=[],g=a.product,u=r.sharedStore.userSettings.userId,m=["albumId","ordered","price","projectId","projectXml","rotated","title","token","tplGuid","tplSuitId","uploadTimestamp","userId","product","category"],f=Object.keys(a).filter(function(e){return m.indexOf(e)===-1});f.forEach(function(e){a[e]&&"none"!==a[e]&&h.push(a[e])}),h=h.join(","),i(11).getCanvasPrice(g,h,u)}if(e.isRemark){for(var v=0;v<e.projectSettings.length;v++)e.projectSettings[v].quantity=0;r.privateStore.isShowPage=!0}i(28).loadAllTemplateList(2,a.size,!1);var S=i(1),y=S.getDisableOptionIds();if(r.sharedStore.watches.isProjectComplete=!0,y.length>0)for(var w in y){for(var x=S.getOptionMapKeyPatternById(y[w]).split("-"),I=[],b=e.projectSettings[e.currentSelectProjectIndex],P=0,j=x.length;P<j;P++){var C=b[x[P]];if(C){var T={key:x[P],value:C};I.push(T)}}var k,L=S.getDisableOptionsMap(y[w],I);null!=L&&(k=L.split(",")),k.indexOf(b[y[w]])>-1&&(console.log("disable",y[w]),e.disableArray.push(y[w]))}}setTimeout(function(){e.mainProjectUid&&s.getMainProjectImages(r,e.mainProjectUid,e.encImageId)}),"true"==e.isFromMyPhoto&&s.getMyPhotoImages(r,e.userSettings.userId,!1)}),r.$watch("sharedStore.currentSelectProjectIndex",function(e,t){}),r.$watchAll(["sharedStore.isWoodPrintOptionUpdated","sharedStore.watches.isProjectInfoLoaded"],function(){r.sharedStore.isWoodPrintOptionUpdated&&r.sharedStore.watches.isProjectInfoLoaded&&(e.projectInfo.isInCart||e.projectInfo.isOrdered||this.$dispatch("dispatchShowPopup",{type:"woodPrintAlert",status:0}))}),r.$watchAll(["sharedStore.watches.isProjectLoaded","sharedStore.watches.isProjectInfoLoaded","sharedStore.watches.isProjectOrderedStateLoaded"],function(){var e=r.sharedStore.watches.isProjectLoaded&&r.sharedStore.watches.isProjectInfoLoaded&&r.sharedStore.watches.isProjectOrderedStateLoaded;e&&(r.privateStore.isShowPage=!0)})},ready:function(){var e=this;t("body").on("click",function(t){var i=t.target||t.srcElement;"show-edit-matt"!==i.id&&(e.sharedStore.isMattingGlassEditShow=!1)})}});e.vm=W,window.store=e,t(window).bind("beforeunload",function(){return e.isPopSave!==!0||e.isPreview?void(e.isPopSave=!0):"Unsaved changes(If any) will be discarded. Are you sure to exit?"})}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){var a=t.spec.specXml;e.exports={getVersion:function(){return r(a).find("product-spec").attr("version")},getDPI:function(){return parseInt(r(a).find("dpi").text())},getImageQualityBufferPercent:function(){return parseInt(r(a).find("imageQualityBufferPercent").text())},getOptions:function(e){for(var t=r(a).find("optionGroup[id="+e+"]").find("option"),i=[],o=0;o<t.length;o++){for(var n={},s=t.eq(o).get(0).attributes,d=0;d<s.length;d++)n[s[d].name]=s[d].value;var l=t.eq(o).find("title").text();""!=l&&(n.title=l),i.push(n)}return i},getOptionsMap:function(e,t){var i=r(a).find("configurableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),o=r(a).find("configurableOptionMap").find("optionMap[id="+e+"]").find("entry"),n=this.getIsPattern(i,o,t);return n?n.attr("value"):null},getOptionsMapDefaultValue:function(e,t){var i=r(a).find("configurableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),o=r(a).find("configurableOptionMap").find("optionMap[id="+e+"]").find("entry"),n=this.getIsPattern(i,o,t);return n?n.attr("defaultValue"):null},getParameter:function(e,t){var i=r(a).find("parameter[id="+e+"]").attr("keyPattern").toString(),o=r(a).find("parameter[id="+e+"]").find("entry"),n=this.getIsPattern(i,o,t);if(n){for(var s={},d=n.get(0).attributes,l=0;l<d.length;l++)s[d[l].name]=d[l].value;return s}return null},getVariable:function(e,t){var i=r(a).find("variable[id="+e+"]").attr("keyPattern").toString(),o=r(a).find("variable[id="+e+"]").find("entry"),n=this.getIsPattern(i,o,t);if(n){for(var s={},d=n.get(0).attributes,l=0;l<d.length;l++)s[d[l].name]=d[l].value;return s}return null},getIsPattern:function(e,t,i){for(var r=e.split("-"),a=0;a<t.length;a++){for(var o=t.eq(a).attr("key"),n=o.split("-"),s=t.eq(a),d=[],l=0;l<n.length;l++){var c=r[l],p=n[l];if("*"===p)d.push(!0);else for(var h=0;h<i.length;h++)if(i[h].key===c){var g=/\[/.test(p),u=i[h].value;if(g){var m=p.substr(1,p.length-2).split(","),f=m.map(function(e){return e.trim()});f.indexOf(u)!==-1&&d.push(!0)}else p===u&&d.push(!0)}}for(var v=!0,S=0;S<d.length;S++)d[S]===!1&&(v=!1);if(d.length===r.length&&v)return s}return null},getOptionIds:function(){for(var e=[],t=r(a).find("optionGroup"),i=0;i<t.length;i++)e.push(t.eq(i).attr("id"));return e},getOptionMapIds:function(){for(var e=[],t=r(a).find("configurableOptionMap").find("optionMap"),i=0;i<t.length;i++)e.push(t.eq(i).attr("id"));return e},getOptionMapById:function(e){return r(a).find("configurableOptionMap").find("optionMap[id="+e+"]").find("entry")},getCategoryByProduct:function(e){for(var t=this.getOptionMapById("product"),i=0;i<t.length;i++)for(var r=t.eq(i).attr("value"),a=r.split(","),o=0;o<a.length;o++)if(a[o]===e)return t.eq(i).attr("key");return"none"},getOptionMapKeyPatternById:function(e){return r(a).find("configurableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString()},getParameterIds:function(){for(var e=[],t=r(a).find("parameter"),i=0;i<t.length;i++)e.push(t.eq(i).attr("id"));return e},getParameterKeyPatternById:function(e){return r(a).find("parameter[id="+e+"]").attr("keyPattern").toString()},getVariableKeyPatternById:function(e){return r(a).find("variable[id="+e+"]").attr("keyPattern").toString()},getDisableOptionsMap:function(e,t){if(r(a).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern")){var i=r(a).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),o=r(a).find("disableOptionMap").find("optionMap[id="+e+"]").find("entry"),n=this.getIsPattern(i,o,t);return n?n.attr("value"):null}return null},getDisableOptionMapKeyPatternById:function(e){try{return r(a).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString()}catch(t){return""}},getDisableOptionIds:function(){for(var e=[],t=r(a).find("disableOptionMap").find("optionMap"),i=0;i<t.length;i++)e.push(t.eq(i).attr("id"));return e},getDisableOptionValues:function(e){for(var t=[],i=r(a).find("disableOptionMap").find("optionMap").find("entry"),o=0;o<i.length;o++)i.eq(o).attr("key").indexOf(e)!=-1&&t.push(i.eq(o).attr("value"));return t},getAllSize:function(){var e="size",t=(this.getOptionMapKeyPatternById(e).split("-"),[]),i={key:"product",value:"print"};return t.push(i),this.getOptionsMap(e,t).split(",")},getAllPaper:function(e){var i="paper",r=(this.getOptionMapKeyPatternById(i).split("-"),[]),a=(t.projectSettings[t.currentSelectProjectIndex],{key:"size",value:e});return r.push(a),this.getOptionsMap(i,r).split(",")},getElementById:function(e){return r(a).find("#"+e)},getOptionNameById:function(e,t){var i=this.getOptions(e),r="";return i.some(function(e){if(e.id===t)return r=e.name||e.title,!0}),r},getAvailableOptions:function(e,t,r){var a=i(16).getParamsList(r);return t=t||[],Array.isArray(t)||(t=[t]),a=a.map(function(e){var i=t.filter(function(t){return t.key===e.key});return i.length>0&&(e=i[0]),e}),this.getOptionsMap(e,a).split(",")},isDisableOptionShow:function(e,t,i){if(r(a).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern")){var o=r(a).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),n=r(a).find("disableOptionMap").find("optionMap[id="+e+"]").find("entry"),s=this.getIsPattern(o,n,t);if(s){var d=s.attr("value").split(",");return!(!d||d.indexOf(i)===-1)&&"true"===s.attr("isShow")}return!1}return!1},getOptionsMapDefaultValueWithoutDisableOption:function(e,t){var i=r(a).find("configurableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),o=r(a).find("configurableOptionMap").find("optionMap[id="+e+"]").find("entry"),n=this.getIsPattern(i,o,t);if(r(a).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern"))var s=r(a).find("disableOptionMap").find("optionMap[id="+e+"]").attr("keyPattern").toString(),d=r(a).find("disableOptionMap").find("optionMap[id="+e+"]").find("entry"),l=this.getIsPattern(s,d,t);if(l&&n&&n.attr("defaultValue")===l.attr("value")){var c=n.attr("value").split(",").filter(function(e){return e!==l.attr("value")});return c[0]}return n?n.attr("defaultValue"):null}}}).call(t,i(2),i(4))},function(e,t,i){var r=[],a=i(46),o=i(41);e.exports={isPreview:!1,isNewProject:!1,previewSource:"",operateMode:"idle",isLostFocus:!0,isFrontPage:!0,isInnerPreviewShow:!1,isChangePageShow:!1,isPopupShow:!1,isFrameOptionsShow:!1,OptionType:"frame",isImageUploadShow:!1,isImageCropShow:!1,isOptionsViewShow:!1,isTextEditorShow:!1,isOrderViewShow:!1,isMattingGlassShow:!1,isMattingGlassEditShow:!1,isEditBorderShow:!1,isFrameLayer:!1,isBorderShow:!1,isPrjSaved:!1,isPopSave:!0,isShowHelp:!1,isShowClone:!1,isTrialPriceShow:!1,mirrorLength:0,isMirrorBorder:!1,isShowContactUs:!1,isPageLoadingShow:!0,cancelledUpload:[],currentUploadCount:0,successfullyUploaded:0,errorUploaded:0,currentSuccessUpload:0,currentErrorUpload:0,errorUploadedFiles:[],retryId:-1,cancelByX:!1,chooseTimes:0,uploadTimes:0,filesTotal:0,filesTotalInQueue:0,filesCountInQueue:0,saveImage:!1,isSwitchLoadingShow:!1,projectSettings:r,spec:o,domains:a,cropImageRatio:1,selectedPageIdx:0,elementDragged:"",photoPrice:{sPrice:"",oriPrcie:"",couponId:"",options:{}},priceChange:!1,dragData:{imageId:"",sourceImageUrl:"",cursorX:0,cursorY:0,isFromList:!1},cropParams:{},projects:[],pages:[],oriImageIds:[],imageList:[],deleImagelist:[],fontList:[],ctrls:{tcResize:"",lastTranEvent:"",isDragStarted:!1},watches:{flagRepaint:!1,isSpecLoaded:!1,isProjectLoaded:!1,isRefreshImage:!1,isCropThisImage:!1,isChangeThisText:!1,isOnDrop:!1,isChangeDepthFront:!1,isRemoveElement:!1,isReplaceImage:!1,isApplyLayout:!1,isProjectComplete:!1,isProjectInfoLoaded:!1,isProjectOrderedStateLoaded:!1},watchData:{changeDepthIdx:"",cropImageIdx:"",removeElementType:"",removeElementIdx:""},dropData:{ev:"",newAdded:!1,isBg:!1,idx:""},warnMargin:{left:30,top:30,width:15,height:15,visible:!1,rate:30},warnSettings:{resizeLimit:30,resizeWarnMsg:"beyond resize limit!",warnImageWidth:10,warnImageHeight:10,visible:!1},uploadProgress:[],webClientId:1,currentSelectProjectIndex:0,userSettings:{},projectId:"",projectXml:"",title:"test",itemListNum:0,fromCart:!1,colorOptionList:[{type:"White",backgroundImage:"assets/img/White-0.png",normalColor:"assets/img/white-normal.png",pressColor:"assets/img/white-pressed.png"},{type:"Black",backgroundImage:"assets/img/Black-0.png",normalColor:"assets/img/black-normal.png",pressColor:"assets/img/black-pressed.png"},{type:"SportGrey",backgroundImage:"assets/img/SportGrey-0.png",normalColor:"assets/img/grey-normal.png",pressColor:"assets/img/grey-pressed.png"},{type:"NavyBlue",backgroundImage:"assets/img/NavyBlue-0.png",normalColor:"assets/img/navy-normal.png",pressColor:"assets/img/navy-pressed.png"},{type:"RoyalBlue",backgroundImage:"assets/img/RoyalBlue-0.png",normalColor:"assets/img/royal-normal.png",pressColor:"assets/img/royal-pressed.png"}],projectType:"LSC",orderType:"commonProduct",isFromMarketplace:!1,isFromFactory:!1,vm:null,bgColor:16777215,isCanvas:!1,projectInfo:{isOrdered:!1,isInCart:!1,isInMarket:!1},uploadAcceptType:"image/jpeg,image/x-png,image/png",screenshotSize:{width:200,height:200},barPosition:{x:0,y:0},isSingleImageUploadShow:!1,isShowPostToSale:!1,templateList:[],autoLayout:!0,cycleLock:!1,isBgLoaded:!1,isLogoClicked:!1,queueKey:!1,mattCycleLock:!1,isMattLoaded:!1,mattQueueKey:!1,disableArray:[],checkFailed:!1,isShowProgress:!1,productTitle:"",firstRender:!0,isWoodPrintOptionUpdated:!1,isShowCategoryOptions:!0,mainProjectUid:"",encImageId:"",isNewInsertProject:!1,isShowAddPhotoText:!0,warnTipLimit:200,isOrderedPreview:!1,warnTipMargin:45,baseProject:{},emptyImage:"",isRemark:!1,token:"",pUser:"",selectedPageGuid:"",isStyleSelectModalShow:!1,LSCPageNum:0,isReadyToLoadProject:!1,newUploadedImg:[]}},function(e,t,i){(function(t){e.exports={xmlToString:function(e){return(new XMLSerializer).serializeToString(e)},stringToXml:function(e){var i=t.parseXML(e);return i}}}).call(t,i(4))},,function(e,t,i){(function(t){e.exports={getRandomNum:function(){return Math.round(1e13*Math.random())},getInchByPx:function(e){return e=parseFloat(e)||0,e/300},getPxByInch:function(e){return e=parseFloat(e)||0,300*e},getInchByMM:function(e){e=parseFloat(e)||0;var t=parseFloat(30*e/2.54);return(t/300).toFixed(7)},getPtByPx:function(e){return e=parseFloat(e)||0,e/300*72},getPxByPt:function(e){return e=parseFloat(e)||0,300*e/72},getPxByMM:function(e){return e=parseFloat(e)||0,30*e/2.54},hexToDec:function(e){return parseInt(e.replace("#",""),16)},decToHex:function(e){for(var t=e.toString(16);t.length<6;)t="0"+t;return"#"+t},rgbToHsl:function(e,t,i){e/=255,t/=255,i/=255;var r,a,o=Math.max(e,t,i),n=Math.min(e,t,i),s=(o+n)/2;if(o==n)r=a=0;else{var d=o-n;switch(a=s>.5?d/(2-o-n):d/(o+n),o){case e:r=(t-i)/d+(t<i?6:0);break;case t:r=(i-e)/d+2;break;case i:r=(e-t)/d+4}r/=6}return[r,a,s]},getTextViewFontSize:function(e){if(e&&e>0){var i=t.pages[t.selectedPageIdx].canvas.ratio,r=parseFloat(e)*i;return r}return 0},toFixed:function(e,t){const i=String(e),r=i.indexOf(".");return r!==-1?i.substr(0,r+t+1):i},round:function(e,t){if(isNaN(e))return 0;const i=Math.pow(10,2),r=Math.round(e*i)/i;return parseFloat(this.toFixed(r,t))}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={getIsShowProjectInfoView:function(){var e=!1;return!t.checkFailed&&((t.projectInfo.isInCart||t.projectInfo.isOrdered||t.projectInfo.isInMarket)&&(e=!0),t.fromCart&&t.projectInfo.isInCart&&!t.projectInfo.isOrdered&&(e=!1),e)},getProjectInfoViewText:function(){return t.projectInfo.isInMarket?"This item was already posted to sale. You need to save your additional changes into a new project.":"Your current project was already ordered or added to cart. You need to save your additional changes into a new project."},getProjectOrderText:function(){if(!t.projectInfo.isOrdered)return"Please select at least one image before placing your order."},checkInvalid:function(e){return/^[a-zA-Z 0-9\d_\s\-]+$/.test(e)},guid:function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})},getQueryString:function(e){var t="";for(var i in e){var r=e[i];t+=encodeURIComponent(i)+"="+encodeURIComponent(r)+"&"}return t.length>0&&(t=t.substring(0,t.length-1)),t},getEncImgId:function(e){return t.imageList.filter(function(t){return t.id===e})[0].encImgId},isIncludeDisableOption:function(){var e=i(1),r=t.projectSettings[t.currentSelectProjectIndex],a=r.product,o=e.getDisableOptionValues(a),n=[];o.forEach(function(e,t,i){n=n.concat(e.split(","))});for(var s in o)console.log(s);for(var d in r)if(n.indexOf(r[d])!=-1)return!0;return!1}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={getUrlParam:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),i=window.location.search.substr(1).match(t);return null!=i?unescape(i[2]):""},getRequestKey:function(){var e=new Date;return"web-h5|1|XML|"+e.getTime()},getJSONRequestKey:function(){var e=new Date;return"web-h5|1|JSON|"+e.getTime()},getSecurityString:function(){var e=t.userSettings.userId||"",i=t.userSettings.token,r=t.userSettings.uploadTimestamp,a=t.encProjectId||"";return"-1"==e&&(e=""),"&customerId="+e+"&token="+i+"&timestamp="+r+"&encProjectId="+encodeURIComponent(a)}}}).call(t,i(2))},function(e,t,i){(function(t,r){e.exports=function(e){var a=0,o=0,n=t.projectSettings[t.currentSelectProjectIndex],s=n&&n.product;if("undefined"==typeof s)switch(t.projectType){case"PR":s="print";break;case"flushMountPrint":s="flushMountPrint";break;default:s=t.projectType}var d="H5_"+s+","+t.projectId+",";for(var l in e)o++;for(var l in e)d+="ev"===l?e[l]:l+"="+e[l],a++<o-1&&(d+=",");var c=i(49);c.go(r.trim(d,","))}}).call(t,i(2),i(4))},function(e,t){e.exports={AddText:"AddText",LoadComplete:"LoadComplete",CompleteTextEdit:"CompleteTextEdit",ClickToForm:"ClickToForm",ClickChangeAll:"ClickChangeAll",ClickEditPrint:"ClickEditPrint",ClickDeletePrint:"ClickDeletePrint",ClickDuplicatePrint:"ClickDuplicatePrint",ClickReplacePrint:"ClickReplacePrint",ChangeSize:"ChangeSize",ChangePaper:"ChangePaper",ChangeTrimStyle:"ChangeTrimStyle",ChangeiPadmodel:"ChangeiPadmodel",ClickSave:"ClickSave",ClickExit:"ClickExit",ClickOrder:"ClickOrder",ClickPreview:"ClickPreview",ClickCropImage:"ClickCropImage",ClickRotateImage:"ClickRotateImage",ClickRemoveImage:"ClickRemoveImage",ClickMoveTextToCenter:"ClickMoveTextToCenter",ClickMoveImageToCenter:"ClickMoveImageToCenter",ClickReset:"ClickReset",ClickRemove:"ClickRemove",ClickAddText:"ClickAddText",ClickResetConfirm:"ClickResetConfirm",ClickFrontCover:"ClickFrontCover",ClickBackCover:"ClickBackCover",ClickPreviousPage:"ClickPreviousPage",ClickNextPage:"ClickNextPage",ClickOptionTab:"ClickOptionTab",ClickImagesTab:"ClickImagesTab",ClickLayoutTab:"ClickLayoutTab",ClickDecorationTab:"ClickDecorationTab",ClickFormTab:"ClickFormTab",SwitchSide:"SwitchSide",SwitchSideInPreview:"SwitchSideInPreview",SwitchOrientation:"SwitchOrientation",ImageLoadFail:"ImageLoadFail",DragPhotoToPage:"DragPhotoToPage",ChangeSort:"ChangeSort",ChangeHideUsed:"ChangeHideUsed",CheckPrice:"CheckPrice",SaveComplete:"SaveComplete",SwitchBlocks:"SwitchBlocks",SwitchBlocksInPreview:"SwitchBlocksInPreview",RemoveBlock:"RemoveBlock",SwitchBlocksByNav:"SwitchBlocksByNav",AddBlock:"AddBlock",ClickAddPhotos:"ClickAddPhotos",ClickDeleteCanvas:"ClickDeleteCanvas",SwitchSize:"SwitchSize",StartUploadEachPhoto:"StartUploadEachPhoto",CompleteUploadEachPhoto:"CompleteUploadEachPhoto",AddPhotos:"AddPhotos",ClickCloudUploadImage:"ClickCloudUploadImage",FinishPhotoSelect:"FinishPhotoSelect",AddMorePhotos:"AddMorePhotos",StartUpload:"StartUpload",UploadComplete:"UploadComplete",CloseMonitor:"CloseMonitor",CancelSingleFile:"CancelSingleFile",CancelAllFilesClicked:"CancelAllFilesClicked",CancelAllFilesByXClicked:"CancelAllFilesByXClicked",CheckIncompleteFields:"CheckIncompleteFields",CheckIncompleteFieldsContinue:"CheckIncompleteFieldsContinue",CheckIncompleteFieldsCancel:"CheckIncompleteFieldsCancel",ModifyPhotoFrame:"ModifyPhotoFrame",ModifyTextFrame:"ModifyTextFrame",RemovePhotoFrame:"RemovePhotoFrame",RemoveTextFrame:"RemoveTextFrame",UpgradeOption:"UpgradeOption"}},function(e,t,i){(function(t){i(5);e.exports={getParamsValueByElement:function(e,i){void 0!=i&&null!=i?i:i=t.selectedPageIdx;var r=t.pages[i].canvas;if(void 0!=e&&null!=e){var a=r.trans[e].attrs.size.x*r.trans[e].attrs.scale.x,o=r.trans[e].attrs.size.y*r.trans[e].attrs.scale.y,n=a/r.ratio,s=o/r.ratio,d=(r.trans[e].attrs.x+r.trans[e].attrs.translate.x-(a-r.trans[e].attrs.size.x)/2)/r.ratio,l=(r.trans[e].attrs.y+r.trans[e].attrs.translate.y-(o-r.trans[e].attrs.size.y)/2)/r.ratio,c=r.trans[e].attrs.rotate;if(90===Math.abs(r.elements[e].imageRotate))var p=r.elements[e].imageHeight,h=r.elements[e].imageWidth;else var p=r.elements[e].imageWidth,h=r.elements[e].imageHeight;if("text"===r.elements[e].elType)var g=r.elements[e].fontSize*r.trans[e].attrs.scale.x;else var g=r.elements[e].fontSize;return{elType:r.elements[e].elType,url:r.elements[e].sourceImageUrl,text:r.elements[e].text,x:d,y:l,width:n,height:s,rotate:c,dep:r.elements[e].dep,imageId:r.elements[e].imageId,imageRotate:r.elements[e].imageRotate||0,cropPX:r.elements[e].cropX/p||0,cropPY:r.elements[e].cropY/h||0,cropPW:r.elements[e].cropW/p||1,cropPH:r.elements[e].cropH/h||1,fontFamily:r.elements[e].fontFamily||"",fontSize:parseFloat(g)||"",fontWeight:r.elements[e].fontWeight||"",textAlign:r.elements[e].textAlign||"",fontColor:r.elements[e].fontColor||""}}return""},getCropParamsByElement:function(e,i){void 0!=i&&null!=i?i:i=t.selectedPageIdx;var r=t.pages[i].canvas;if(void 0!=e&&null!=e){var a=r.trans[e].attrs.size.x*r.trans[e].attrs.scale.x,o=r.trans[e].attrs.size.y*r.trans[e].attrs.scale.y,n=a/r.ratio,s=o/r.ratio,d=(r.trans[e].attrs.x+r.trans[e].attrs.translate.x-(a-r.trans[e].attrs.size.x)/2)/r.ratio,l=(r.trans[e].attrs.y+r.trans[e].attrs.translate.y-(o-r.trans[e].attrs.size.y)/2)/r.ratio,c=r.trans[e].attrs.rotate;if(90===Math.abs(r.elements[e].imageRotate))var p=r.elements[e].imageHeight,h=r.elements[e].imageWidth;else var p=r.elements[e].imageWidth,h=r.elements[e].imageHeight;if("text"===r.elements[e].elType)var g=r.elements[e].fontSize*r.trans[e].attrs.scale.x;else var g=r.elements[e].fontSize;var u=r.elements[e].cropX/p,m=r.elements[e].cropY/h,f=r.elements[e].cropW/p,v=r.elements[e].cropH/h,S=n,y=s,w=u,x=u+f,I=m,b=m+v,P=y/S,j=p,C=h,T=w+(x-w)/2,k=I+(b-I)/2,L=T*j,D=k*C,B=(x-w)*j/S,R=(b-I)*C/y,F=S*B,U=y*R;F>j&&(F=j),U>C&&(U=C);var z,M,H,O;F*P>U?(O=U,H=U/P):(H=F,O=F*P),z=L-H/2,z=z>0?z:0,z+H>j&&(z-=z+H-j,z=z>0?z:0),M=D-O/2,M=M>0?M:0,M+O>C&&(M-=M+O-C,M=M>0?M:0);var E={elType:r.elements[e].elType,url:r.elements[e].sourceImageUrl,text:r.elements[e].text,x:d,y:l,width:n,height:s,rotate:c,dep:r.elements[e].dep,imageId:r.elements[e].imageId,imageRotate:r.elements[e].imageRotate||0,cropPX:z/j||0,cropPY:M/C||0,cropPW:H/j||1,cropPH:O/C||1,fontFamily:r.elements[e].fontFamily||"",fontSize:parseFloat(g)||"",fontWeight:r.elements[e].fontWeight||"",textAlign:r.elements[e].textAlign||"",fontColor:r.elements[e].fontColor||""};return E}return""},getCropImageUrl:function(e,r,a){void 0!=r&&null!=r?r:r=t.selectedPageIdx;var o=t.pages[r].canvas,n=a?a:o.ratio;if(void 0==e||null==e||"background"!==o.params[e].elType&&"image"!==o.params[e].elType&&"logo"!==o.params[e].elType&&"PhotoElement"!==o.params[e].elType)return"";var s="../../static/img/blank.png";if(""!==o.params[e].imageId){var d=o.params[e],l=Math.abs(d.cropPX.toFixed(8)),c=Math.abs(d.cropPY.toFixed(8)),p=Math.abs(d.cropPW.toFixed(8)),h=Math.abs(d.cropPH.toFixed(8)),g=d.width*n/p,u=d.height*n/h,m=d.style&&d.style.brightness?d.style.brightness:0,f=i(6),v=f.getEncImgId(o.params[e].imageId),S=f.getQueryString({encImgId:v,px:l,py:c,pw:p,ph:h,width:Math.ceil(g),height:Math.ceil(u),rotation:o.params[e].imageRotate,brightness:m});s="/imgservice/op/crop?"+S+i(7).getSecurityString()}return s},getCropDecorationUrl:function(e,i){void 0!=i&&null!=i?i:i=t.selectedPageIdx;var r=t.pages[i].canvas;if(void 0==e||null==e||"background"!==r.params[e].elType&&"decoration"!==r.params[e].elType&&"logo"!==r.params[e].elType&&"DecorationElement"!==r.params[e].elType)return"";var a="../../static/img/blank.png";if(""!==r.params[e].decorationid){var o=r.params[e].decorationid;a=t.domains.baseUrl+"/artwork/png/1000/"+o+".png"}return a},getFontImageUrl:function(){},getShiftValue:function(e,i){if(void 0!=i&&null!=i?i:i=t.selectedPageIdx,e=e||t.pages[i].canvas,"none"!==t.project2.matte)var r=-1*(e.boardInMatting.left+e.realBleedings.left),a=-1*(e.boardInMatting.top+e.realBleedings.top),o=-1*(e.boardInMatting.right+e.realBleedings.right),n=-1*(e.boardInMatting.bottom+e.realBleedings.bottom);else var r=-1*(e.boardInFrame.left+e.realBleedings.left),a=-1*(e.boardInFrame.top+e.realBleedings.top),o=-1*(e.boardInFrame.right+e.realBleedings.right),n=-1*(e.boardInFrame.bottom+e.realBleedings.bottom);return{x:r,y:a,xDot:o,yDot:n}},getShiftPosition:function(e,t,i,r,a,o){if(null!=e&&null!=t&&null!=i&&null!=r){a=a||0,o=o||0;var n=e+a,s=t+o;return{x:n,y:s,width:i,height:r}}return{x:0,y:0,width:0,height:0}},getUnshiftPosition:function(e){if(void 0!=e&&null!=e){var i,r,a,o,n=t.pages[t.selectedPageIdx].canvas,s=-1*this.getShiftValue().x,d=-1*this.getShiftValue().y,l=-1*this.getShiftValue().xDot,c=-1*this.getShiftValue().yDot,p=n.params[e].x||0,h=n.params[e].y||0,g=n.params[e].width||0,u=n.params[e].height||0,m=n.oriWidth||0,f=n.oriHeight||0;return p+=s,h+=d,i=p/(m+s+l),r=h/(f+d+c),a=g/(m+s+l),o=u/(f+d+c),i<0?i=0:i,i>1?i=1:i,r<0?r=0:r,r>1?r=1:r,a<0?a=0:a,a>1?a=1:a,o<0?o=0:o,o>1?o=1:o,{x:p,y:h,px:i,py:r,pw:a,ph:o}}return console.fail("idx is invalid in getUnshiftPosition() [ParamsManage]"),""},getIndexById:function(e,i){var i=i||t.selectedPageIdx;if(void 0!=e&&null!=e&&""!==e){for(var r=t.pages[i].canvas,a=0;a<r.params.length;a++)if(r.params[a].id===e)return a;return-1}return-1},getIndexByDep:function(e){for(var i=t.pages[t.selectedPageIdx].canvas,r=0;r<i.params.length;r++)if(i.params[r].dep===e)return r;return 0},getFrontElementIndex:function(){var e=t.pages[t.selectedPageIdx].canvas;return this.getIndexByDep(e.params.length-1)},getBorderHiddenSize:function(){var e=t.pages[t.selectedPageIdx].canvas,i=topLimit=rightLimit=bottomLimit=0;if(t.isCanvas)i=(e.canvasBordeThickness.left+e.realBleedings.left)*e.ratio,rightLimit=(e.canvasBordeThickness.right+e.realBleedings.right)*e.ratio,topLimit=(e.canvasBordeThickness.top+e.realBleedings.top)*e.ratio,bottomLimit=(e.canvasBordeThickness.bottom+e.realBleedings.bottom)*e.ratio;else{var r=e.frameBaseSize.width*e.ratio,a=e.frameBaseSize.height*e.ratio,o=Math.abs(e.x),n=Math.abs(e.y);e.width>r?t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?(i=o+e.boardInMatting.left*e.ratio,rightLimit=e.width-r-o+e.boardInMatting.right*e.ratio):(i=o+e.boardInFrame.left*e.ratio,rightLimit=e.width-r-o+e.boardInFrame.right*e.ratio):t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?(i=e.boardInMatting.left*e.ratio+e.realBleedings.left*e.ratio,rightLimit=e.boardInMatting.right*e.ratio+e.realBleedings.right*e.ratio):(i=e.boardInFrame.left*e.ratio+e.realBleedings.left*e.ratio,
rightLimit=e.boardInFrame.right*e.ratio+e.realBleedings.right*e.ratio),e.height>a?t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?(topLimit=n+e.boardInMatting.top*e.ratio,bottomLimit=e.height-a-n+e.boardInMatting.bottom*e.ratio):(topLimit=n+e.boardInFrame.top*e.ratio,bottomLimit=e.height-a-n+e.boardInFrame.bottom*e.ratio):t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?(topLimit=e.boardInMatting.top*e.ratio+e.realBleedings.top*e.ratio,bottomLimit=e.boardInMatting.bottom*e.ratio+e.realBleedings.bottom*e.ratio):(topLimit=e.boardInFrame.top*e.ratio+e.realBleedings.top*e.ratio,bottomLimit=e.boardInFrame.bottom*e.ratio+e.realBleedings.bottom*e.ratio)}return{left:i,top:topLimit,right:rightLimit,bottom:bottomLimit}}}}).call(t,i(2))},function(e,t,i){(function(t,r){e.exports={loadLocalProject:function(){console.log("projectService"),t.ajax({url:"./assets/data/tshirt-project.1.0.xml",type:"get",dataType:"xml",async:!1}).done(function(e){r.xml=e})},insertProject:function(e,a){var o=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectType;r.projectXml=a;var n="",s=r.title,d=r.quantity?r.quantity:1,l=r.mainProjectUid?"cart":"";if("CV"!==r.projectType&&"FM"!==r.projectType&&"PHC"!==r.projectType&&"CLO"!==r.projectType&&"PR"!==r.projectType&&"flushMountPrint"!==r.projectType&&"PP"!==r.projectType&&"IPadCase"!==r.projectType||(n=this.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===r.projectType||"FM"===r.projectType){var c=r.projectSettings[r.currentSelectProjectIndex],p=c.product;o=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+p}t.ajax({url:o,type:"post",data:{mainProjectUid:r.mainProjectUid,crossSell:l,removeCart:r.fromCart,encodeimage:n,projectXml:a,requestKey:i(7).getRequestKey(),isFromMarketplace:r.isFromMarketplace,title:s,quantity:d}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(console.log("new project successfully"+i),r.projectId=t(i).find("guid").text()||"",r.projectXml=i,r.watches.isProjectLoaded=!0,r.isNewInsertProject=!0):(r.watches.isProjectLoaded=!0,"-3"===t(i).find("errorCode").text()&&e.$dispatch("dispatchShowProjectChooseWindow"))})},saveProject:function(e,a,o,n,s,d,l){var c=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectId+"/"+r.projectType,p="",h=r.title,g=r.quantity?r.quantity:1;if("CV"!==r.projectType&&"FM"!==r.projectType&&"PHC"!==r.projectType&&"CLO"!==r.projectType&&"PR"!==r.projectType&&"flushMountPrint"!==r.projectType&&"PP"!==r.projectType&&"CR"!==r.projectType&&"IPadCase"!==r.projectType||(p=this.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===r.projectType||"FM"===r.projectType){var u=r.projectSettings[r.currentSelectProjectIndex],m=u.product;c=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectId+"/"+m}t.ajax({url:c,type:"post",dataType:"xml",data:{removeCart:r.fromCart,encodeimage:p,projectXml:a,requestKey:i(7).getRequestKey(),isFromMarketplace:r.isFromMarketplace,thumbnailPX:o,thumbnailPY:n,thumbnailPW:s,thumbnailPH:d,title:h,quantity:g},error:function(e){r.vm.$dispatch("dispatchShowPopup",{type:"noInterenet",status:0})}}).done(function(a){a&&"success"===t(a).find("resultData").attr("state")?(r.projectXml=a,l&&"function"==typeof l?l():e.$dispatch("dispatchShowPopup",{type:"save",status:0}),i(8)({ev:i(9).SaveComplete}),r.isPrjSaved=!0):a&&"fail"===t(a).find("resultData").attr("state")?"201"===t(a).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-3}),r.vm.$broadcast("notifyCloseWindow")):"202"===t(a).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-4}),r.vm.$broadcast("notifyCloseWindow")):"205"===t(a).find("code").text()?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1})})},orderProject:function(e,a,o,n,s,d){if(r.projectId){var l=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectId+"/"+r.projectType,c="",p=r.title,h=r.quantity?r.quantity:1;if("CV"!==r.projectType&&"FM"!==r.projectType&&"PHC"!==r.projectType&&"CLO"!==r.projectType&&"PR"!==r.projectType&&"flushMountPrint"!==r.projectType&&"PP"!==r.projectType&&"CR"!==r.projectType&&"IPadCase"!==r.projectType||(c=this.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===r.projectType||"FM"===r.projectType){var g=r.projectSettings[r.currentSelectProjectIndex],u=g.product;l=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectId+"/"+u}t.ajax({url:l,type:"post",dataType:"xml",data:{removeCart:r.fromCart,encodeimage:c,projectXml:a,requestKey:i(7).getRequestKey(),isFromMarketplace:r.isFromMarketplace,thumbnailPX:o,thumbnailPY:n,thumbnailPW:s,thumbnailPH:d,title:p,quantity:h},error:function(e){r.vm.$dispatch("dispatchShowPopup",{type:"noInterenet",status:0})}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(console.log("save project successfully"+i),console.log("errorCode"+t(i).find("errorCode").text()),r.projectXml=i,r.isPrjSaved=!0,r.isPopSave=!1,window.location="/"+r.orderType+"/addShoppingCart.html?projectGUID="+r.projectId+"&quantity="+h):i&&"fail"===t(i).find("resultData").attr("state")?"201"===t(i).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-3}),r.vm.$broadcast("notifyCloseWindow")):"205"===t(i).find("code").text()?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch("dispatchShowPopup",{type:"order",status:-1}):e.$dispatch("dispatchShowPopup",{type:"order",status:-1})})}},getShareProject:function(){var e=this;t.ajax({url:r.domains.uploadUrl+"/upload/Preview/GetPhotobookXmlByProjectId?projectId="+encodeURIComponent(r.projectId),type:"get",dataType:"xml",data:"webClientId=1"}).done(function(a){if(a){r.encProjectId=r.projectId,r.projectXml=a,r.title=t(a).find("title").text(),r.projectId=t(a).find("guid").text(),r.projectSettings.length=0;for(var o=0;o<t(a).find("spec").length;o++){for(var n=t(a).find("spec").eq(o),s=i(19),d=s(),l=0;l<n.find("option").length;l++){var c=n.find("option").eq(l);d[c.attr("id")]=c.attr("value")}"categoryFrame"!==d.category&&"categoryCanvas"!==d.category&&"categoryWallarts"!==d.category||(d.metalType=d.metalType||"none",d.finish=d.finish||"none");for(var p=0;p<t(a).find("tshirtSetting").eq(o).find("setting").length;p++){var h=t(a).find("tshirtSetting").eq(o).find("setting").eq(p);d[h.attr("id")]=h.attr("value")}t(a).find("frameBoard")&&(d.rotated="true"===t(a).find("frameBoard").attr("rotated"),r.bgColor=parseInt(t(a).find("frameBoard").attr("canvasBorderColor"))),["FT","FD"].indexOf(t(a).find("project").attr("productType")!==-1)&&(r.cardId=t(a).find("card").attr("id"),r.deletedPhoto=t(a).find("deletedPhoto").text(),d.trim=d.trim||t(a).find("trim").attr("value")),console.log(d),r.projectSettings.push(d)}e.getAlbumId(),r.watches.isProjectLoaded=!0}})},getProject:function(){var e=this;t.ajax({url:r.domains.baseUrl+"/userid/"+r.userSettings.userId+"/project/"+r.projectId,type:"get",dataType:"xml",data:"webClientId=1&autoRandomNum="+i(5).getRandomNum()}).done(function(a){if(a){r.projectXml=a,r.title=t(a).find("title").text(),r.projectId=t(a).find("guid").text(),r.projectSettings.length=0;for(var o=0;o<t(a).find("spec").length;o++){for(var n=t(a).find("spec").eq(o),s=i(19),d=s(),l=0;l<n.find("option").length;l++){var c=n.find("option").eq(l);d[c.attr("id")]=c.attr("value"),"None"===d[c.attr("id")]&&(d[c.attr("id")]="none")}"categoryFrame"!==d.category&&"categoryCanvas"!==d.category&&"categoryWallarts"!==d.category||(d.metalType=d.metalType||"none","undefined"===d.metalType?d.metalType="none":d.metalType,d.finish=d.finish||"none","undefined"===d.finish?d.finish="none":d.finish);for(var p=0;p<t(a).find("tshirtSetting").eq(o).find("setting").length;p++){var h=t(a).find("tshirtSetting").eq(o).find("setting").eq(p);d[h.attr("id")]=h.attr("value")}t(a).find("frameBoard")&&(d.rotated="true"===t(a).find("frameBoard").attr("rotated"),r.bgColor=parseInt(t(a).find("frameBoard").attr("canvasBorderColor"))),["FT","FD"].indexOf(t(a).find("project").attr("productType")!==-1)&&(r.cardId=t(a).find("card").attr("id"),r.deletedPhoto=t(a).find("deletedPhoto").text(),d.trim=d.trim?d.trim:t(a).find("trim").attr("value")),console.log(d),r.projectSettings.push(d)}if("PR"==r.projectType)if(t(a).find("spec")&&t(a).find("spec").length>0){var g=t(a).find("spec").eq(0).find('option[id="size"]').attr("value"),u=t(a).find("spec").eq(0).find('option[id="paper"]').attr("value");r.baseProject.size=g,r.baseProject.paper=u}else r.baseProject.size="4X6",r.baseProject.paper="GP";if("flushMountPrint"==r.projectType)if(t(a).find("spec")&&t(a).find("spec").length>0){var g=t(a).find("spec").eq(0).find('option[id="size"]').attr("value"),u=t(a).find("spec").eq(0).find('option[id="paper"]').attr("value"),m=t(a).find("spec").eq(0).find('option[id="surfaceType"]').attr("value");r.baseProject.size=g,r.baseProject.paper=u,r.baseProject.surfaceType=m}else r.baseProject.size="4X6",r.baseProject.paper="GP",r.baseProject.surfaceType="SS";e.getAlbumId(),r.watches.isProjectLoaded=!0}})},getAlbumId:function(){var e=this;t.ajax({url:r.domains.baseUrl+"/userid/"+r.userSettings.userId+"/getAlbumId?projectId="+r.projectId,type:"get"}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?r.userSettings.albumId=t(i).find("albumId").text()||"":(r.userSettings.albumId="",e.addOrUpdateAlbum(r.title))})},addOrUpdateAlbum:function(e,a,o){var n=(new Date).valueOf();t.ajax({url:r.domains.baseUrl+"/userid/"+r.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+n+"&projectId="+r.projectId+"&albumName="+e+"&webClientId="+r.webClientId+"&autoRandomNum="+i(5).getRandomNum()}).done(function(e){e&&("success"==t(e).find("resultData").attr("state")?(r.userSettings.albumId=t(e).find("albumId").text()||"",a&&a.$dispatch(o,!1,"This title already exists, please try again.")):a&&a.$dispatch(o,!0,"This title already exists, please try again."))})},handledSaveProject:function(e,a,o,n,s,d,l){var c=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectId+"/"+r.projectType,p="",h=r.title,g=r.quantity?r.quantity:1;if("CV"!==r.projectType&&"FM"!==r.projectType&&"PHC"!==r.projectType&&"CLO"!==r.projectType&&"PR"!==r.projectType&&"flushMountPrint"!==r.projectType&&"PP"!==r.projectType&&"CR"!==r.projectType&&"IPadCase"!==r.projectType||(p=this.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===r.projectType||"FM"===r.projectType){var u=r.projectSettings[r.currentSelectProjectIndex],m=u.product;c=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectId+"/"+m}t.ajax({url:c,type:"post",dataType:"xml",data:{removeCart:r.fromCart,encodeimage:p,projectXml:o,requestKey:i(7).getRequestKey(),thumbnailPX:n,thumbnailPY:s,thumbnailPW:d,thumbnailPH:l,title:h,quantity:g}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(console.log("save project successfully"+i),r.projectXml=i,r.isPrjSaved=!0,e.$dispatch(a,"success")):"205"===t(i).find("code").text()?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch(a,"failed")})},getProjectOrderedState:function(e){t.ajax({url:"/userid/"+r.userSettings.userId+"/getProjectOrderedState/"+r.projectId,type:"get",dataType:"xml",data:"webClientId=1&autoRandomNum="+i(5).getRandomNum()}).done(function(e){e&&(r.userSettings.ordered="true"==t(e).find("ordered").text(),r.checkFailed="true"==t(e).find("checkFailed").text(),r.watches.isProjectOrderedStateLoaded=!0,"true"==r.userSettings.ordered)})},sentContactUs:function(e,a,o,n,s,d){t.ajax({url:r.domains.baseUrl+"/userid/service/feedback",type:"post",dataType:"xml",data:{userId:r.userSettings.userId,userName:r.userSettings.userName,userEmail:r.userSettings.email,sku:"",projectName:r.title,projectId:r.projectId,autoRandomNum:i(5).getRandomNum(),webClientId:1,os:s,browser:d,question:a,featureRequest:o,bug:n}}).done(function(i){"success"==t(i).find("resultData").attr("state")?e.$dispatch("dispatchShowPopup",{type:"contact",status:0}):e.$dispatch("dispatchShowPopup",{type:"contact",status:-1})})},cloneProject:function(e,a,o,n,s,d,l,c){var p=this,h="",g=(new Date).valueOf(),u=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectType,m=r.title,f=r.quantity?r.quantity:1;if("CV"!==r.projectType&&"FM"!==r.projectType&&"PHC"!==r.projectType&&"IPadCase"!==r.projectType||(h=p.getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,","")),"CV"===r.projectType||"FM"===r.projectType){var v=r.projectSettings[r.currentSelectProjectIndex],S=v.product;u=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+S}t.ajax({url:u,type:"post",data:{removeCart:r.fromCart,encodeimage:h,projectXml:n,requestKey:i(7).getRequestKey(),isFromMarketplace:r.isFromMarketplace,thumbnailPX:s,thumbnailPY:d,thumbnailPW:l,thumbnailPH:c,title:m,quantity:f}}).done(function(e){if(e&&"success"===t(e).find("resultData").attr("state")){r.projectId=t(e).find("guid").text()||"",r.projectXml=e,r.isPrjSaved=!0,r.vm.$broadcast("notifyHideCloneWindow"),i(11).getProjectInfo(),t.ajax({url:"/userid/"+r.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+g+"&projectId="+r.projectId+"&albumName="+o+"&webClientId="+r.webClientId+"&autoRandomNum="+i(5).getRandomNum()}).done(function(e){if(e)if("success"==t(e).find("resultData").attr("state"))r.userSettings.albumId=t(e).find("albumId").text()||"";else if("fail"==t(e).find("resultData").attr("state")){var i,o=t(e).find("errorCode").text();r.title=a,i="1"===o?"Title existed, please pick another one.":"2"===o?"Please input new project name":"Save project name failed. errorInfo："+t(e).find("errorInfo").text(),r.vm.$broadcast("notifyShowInvalidTitle",i)}})}else{var n="Clone failed";r.title=a,r.vm.$broadcast("notifyShowInvalidTitle",n)}})},getScreenshot:function(){return i(31).convertScreenshotToBase64()},getProjectInfo:function(){r.isPreview&&"factory"===r.source||t.ajax({url:r.domains.baseUrl+"/clientH5/projectInfo/"+r.projectId+"?"+(new Date).getTime(),type:"get",dataType:"json"}).done(function(e){e&&(r.projectInfo.isOrdered=1===e.order,r.projectInfo.isInCart=1===e.cart,1===e.market||2===e.market?r.projectInfo.isInMarket=!0:r.projectInfo.isInMarket=!1,"undefined"!=typeof e.market&&(r.isShowPostToSale=!0),r.watches.isProjectInfoLoaded=!0,r.vm.$dispatch("dispatchResetProjectInfo"))})},updateCheckStatus:function(e){t.ajax({url:"/userid/"+r.userSettings.userId+"/submitCheckFailProject/"+r.projectId+"?isParentBook=false&redirectParentBook=false",type:"get",dataType:"xml"}).done(function(e){if(e){var i=t(e).find("code").text();"200"===i?(r.checkFailed=!1,r.submitTitle?r.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Thank you for submitting your changes to this ordered "+r.submitTitle+" project. We will review this "+r.submitTitle+" project again. If no issue is found, we will proceed with your order processing."}):r.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Thank you for submitting your changes to this ordered frame project. We will review this frame project again. If no issue is found, we will proceed with your order processing."})):r.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"notifyShowInvalidTitle','Submit failed, please try again or contact us."})}})},getPhotoPrice:function(e,i,a){if(!r.isTopPriceShow){for(var o=!1,n=0;n<r.priceOptions.length;n++){var s=r.priceOptions[n].key,d=r.priceOptions[n].value;if(s&&s==i)if(o=!0,d)r.projectSettings[a].price=d;else{var l=r.priceOptions[n].idxs;l.indexOf(a)==-1&&r.priceOptions[n].idxs.push(a)}}if(!o){var c={key:i,value:"",idxs:[a]};r.priceOptions.push(c),t.ajax({url:r.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:i,timestamp:r.freshTimestamp||0},dataType:"json"}).done(function(e){if(console.log("getPhotoPrice",i),e){e.couponId?r.projectSettings[a].price=+e.sPrice:r.projectSettings[a].price=+e.oriPrice;for(var t=0;t<r.priceOptions.length;t++){var o=r.priceOptions[t].key;r.priceOptions[t].value;if(o&&o==i){for(var n=0;n<r.priceOptions[t].idxs.length;n++)r.projectSettings[r.priceOptions[t].idxs[n]].price=r.projectSettings[a].price;r.priceOptions[t].value=r.projectSettings[a].price,r.priceOptions[t].idxs=[]}}}else console.log(e.error)})}}},getNewPrintPrice:function(){var e=i(1).getOptionIds(),a=r.baseProject.product,o=[];if(r.isTopPriceShow){e.forEach(function(e){"product"!==e&&o.push(r.baseProject[e])}),o=o.filter(function(e){return e&&"none"!==e});t.ajax({url:r.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:a,options:o.join(","),timestamp:r.freshTimestamp||0},dataType:"json"}).done(function(e){console.log("getNewPrintPrice",o),e?(r.photoPrice.oriPrice=+e.oriPrice,r.photoPrice.sPrice=+e.sPrice,r.photoPrice.couponId=e.couponId||"",r.photoPrice.options=e.options||{},r.priceChange=!0):console.log(e.error)})}},getCanvasPrice:function(e,i,a){t.ajax({url:r.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:i,userId:a},dataType:"json"}).done(function(e){console.log(e),e?(r.photoPrice.oriPrice=(e.oriPrice-0).toFixed(2)-0,r.photoPrice.sPrice=(e.sPrice-0).toFixed(2)-0,r.photoPrice.couponId=e.couponId||"",r.photoPrice.options=e.options||{},r.priceChange=!0):console.log(e.error)})},getPadPrice:function(e,i,a){t.ajax({url:r.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:i,userId:a},dataType:"json"}).done(function(e){console.log(e),e?("undefined"!=typeof e.trialPrice?r.photoPrice.trialPrice=+e.trialPrice:e.sPrice>0&&(r.photoPrice.trialPrice=+e.sPrice),r.photoPrice.oriPrice=+e.oriPrice,r.priceChange=!0):console.log(e.error)})},getPosterPrice:function(e,i,a){t.ajax({url:r.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:i,userId:a},dataType:"json"}).done(function(e){console.log(e),e?(r.photoPrice.oriPrice=(e.oriPrice-0).toFixed(2)-0,r.photoPrice.sPrice=(e.sPrice-0).toFixed(2)-0,r.photoPrice.couponId=e.couponId||"",r.photoPrice.options=e.options||{},r.priceChange=!0):console.log(e.error)})},getCardsPrice:function(e,i,a,o,n){t.ajax({url:r.domains.baseUrl+"/clientH5/product/book/price",type:"get",data:{product:e,options:i},dataType:"json"}).done(function(e){if(e){var t=e.data.main,i=e.data.options;r.photoPrice.oriPrice=+t.oriPrice,r.photoPrice.sPrice=+t.sPrice,r.photoPrice.couponId=t.couponId||"",r.photoPrice.options=i||{},r.priceChange=!0}else console.log(e.error)})},getLMCPrice:function(e,i,a,o,n){t.ajax({url:r.domains.baseUrl+"/clientH5/product/price",type:"get",data:{product:e,options:o,userId:n},dataType:"json"}).done(function(e){e?(r.photoPrice.allSize.push({size:i,shape:a,oriPrice:e.oriPrice-0,sPrice:e.sPrice-0}),r.priceChange=!0):console.log(e)})},saveRemarkProject:function(e,a){var o=i(16).getRemarkProjectXml(),n=r.domains.portalBaseUrl+"/portal/h5-client/feedBackPrintsRemark.ep";t.ajax({url:n,type:"post",data:{projectId:r.projectId,remarkProjectXml:o,orderNumber:r.orderNumber,timestamp:r.timestamp,token:r.token,pUser:r.pUser}}).done(function(i){console.log(i),i&&"success"===t(i).find("resultData").attr("state")?(e&&e(),r.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Reprint successfully"})):(a&&a(),r.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Failed to reprint, please try again later."}))})},getPortalProject:function(){var e=this;t.ajax({url:r.domains.portalBaseUrl+"/portal/projectProcess/getProjectById.ep?projectId="+encodeURIComponent(r.projectId),type:"get",dataType:"xml"}).done(function(a){if(a){r.encProjectId=r.projectId,r.projectXml=a,r.title=t(a).find("title").text(),r.projectId=t(a).find("guid").text(),r.projectSettings.length=0;for(var o=0;o<t(a).find("spec").length;o++){for(var n=t(a).find("spec").eq(o),s=i(19),d=s(),l=0;l<n.find("option").length;l++){var c=n.find("option").eq(l);d[c.attr("id")]=c.attr("value"),"None"===d[c.attr("id")]&&(d[c.attr("id")]="none")}"categoryFrame"!==d.category&&"categoryCanvas"!==d.category&&"categoryWallarts"!==d.category||(d.metalType=d.metalType||"none","undefined"===d.metalType?d.metalType="none":d.metalType,d.finish=d.finish||"none","undefined"===d.finish?d.finish="none":d.finish);for(var p=0;p<t(a).find("tshirtSetting").eq(o).find("setting").length;p++){var h=t(a).find("tshirtSetting").eq(o).find("setting").eq(p);d[h.attr("id")]=h.attr("value")}t(a).find("frameBoard")&&(d.rotated="true"===t(a).find("frameBoard").attr("rotated"),r.bgColor=parseInt(t(a).find("frameBoard").attr("canvasBorderColor"))),console.log(d),r.projectSettings.push(d)}if("PR"==r.projectType)if(t(a).find("spec")&&t(a).find("spec").length>0){var g=t(a).find("spec").eq(0).find('option[id="size"]').attr("value"),u=t(a).find("spec").eq(0).find('option[id="paper"]').attr("value");r.baseProject.size=g,r.baseProject.paper=u}else r.baseProject.size="4X6",r.baseProject.paper="GP";if("flushMountPrint"==r.projectType)if(t(a).find("spec")&&t(a).find("spec").length>0){var g=t(a).find("spec").eq(0).find('option[id="size"]').attr("value"),u=t(a).find("spec").eq(0).find('option[id="paper"]').attr("value"),m=t(a).find("spec").eq(0).find('option[id="surfaceType"]').attr("value");r.baseProject.size=g,r.baseProject.paper=u,r.baseProject.surfaceType=m}else r.baseProject.size="4X6",r.baseProject.paper="GP",r.baseProject.surfaceType="SS";e.getAlbumId(),r.watches.isProjectLoaded=!0}})},getProjectIdByTitle:function(e){var i=r.userSettings.userId;t.ajax({url:r.domains.baseUrl+"/userid/getProjectUidByTitleAndCid.ep?customerId="+i+"&title="+encodeURIComponent(e),type:"get"}).done(function(e){e&&"success"===t(e).find("resultData").attr("state")&&(r.projectId=t(e).find("projectId").text()||"",r.vm.$dispatch("dispatchGetProjectIdByTitleSuccess"))})},createProject:function(e,a,o,n,s,d,l,c){var p="",h=(new Date).valueOf(),g=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectType,u=r.title,m=r.quantity?r.quantity:1;if("CV"===r.projectType||"FM"===r.projectType){var f=r.projectSettings[r.currentSelectProjectIndex],v=f.product;g=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+v}t.ajax({url:g,type:"post",data:{removeCart:r.fromCart,encodeimage:p,projectXml:n,requestKey:i(7).getRequestKey(),isFromMarketplace:r.isFromMarketplace,thumbnailPX:s,thumbnailPY:d,thumbnailPW:l,thumbnailPH:c,title:u,quantity:m}}).done(function(e){if(e&&"success"===t(e).find("resultData").attr("state")){r.projectId=t(e).find("guid").text()||"",r.projectXml=e,r.watches.isProjectLoaded=!0,r.vm.$broadcast("notifyHideNewProjectWindow"),t.ajax({url:"/userid/"+r.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+h+"&projectId="+r.projectId+"&albumName="+o+"&webClientId="+r.webClientId+"&autoRandomNum="+i(5).getRandomNum()}).done(function(e){if(e)if("success"==t(e).find("resultData").attr("state"))r.userSettings.albumId=t(e).find("albumId").text()||"";else if("fail"==t(e).find("resultData").attr("state")){var i=t(e).find("errorCode").text();r.errCode=!1;var o;r.title=a,o="1"===i?"Title existed, please pick another one.":"2"===i?"Please input new project name":"Save project name failed. errorInfo："+t(e).find("errorInfo").text(),r.vm.$broadcast("notifyShowNewProjectInvalidTitle",o)}}),i(11).getProjectInfo()}else{var n="Create failed";r.title=a,r.vm.$broadcast("notifyShowNewProjectInvalidTitle",n)}})},createProjectAddOrUpdateAlbum:function(e,a,o,n){var s=(new Date).valueOf();t.ajax({url:"/userid/"+r.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+s+"&projectId="+r.projectId+"&albumName="+e+"&webClientId="+r.webClientId+"&autoRandomNum="+i(5).getRandomNum()}).done(function(i){if(i)if("success"==t(i).find("resultData").attr("state"))r.userSettings.albumId=t(i).find("albumId").text()||"",o&&o(e);else if("fail"==t(i).find("resultData").attr("state")){var s,d=t(i).find("errorCode").text();r.title=a,s="1"===d?"Title existed, please pick another one.":"2"===d?"Please input new project name":"Save project name failed. errorInfo："+t(i).find("errorInfo").text(),r.vm.$broadcast("notifyShowNewProjectInvalidTitle",s),n&&n(e)}})},createProjectSuccess:function(e,a,o,n,s,d,l,c){var p="",h=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+r.projectType,g=r.title,u=r.quantity?r.quantity:1;if(r.errCode=!0,"CV"===r.projectType||"FM"===r.projectType){var m=r.projectSettings[r.currentSelectProjectIndex],f=m.product;h=r.domains.baseUrl+"/general/"+r.userSettings.userId+"/project/"+f}t.ajax({url:h,type:"post",data:{removeCart:r.fromCart,encodeimage:p,projectXml:n,requestKey:i(7).getRequestKey(),isFromMarketplace:r.isFromMarketplace,thumbnailPX:s,thumbnailPY:d,thumbnailPW:l,thumbnailPH:c,title:g,quantity:u}}).done(function(e){if(e)if(e&&"success"===t(e).find("resultData").attr("state")){r.projectId=t(e).find("guid").text()||"",r.projectXml=e,r.watches.isProjectLoaded=!0,r.vm.$broadcast("notifyHideNewProjectWindow"),i(11).getProjectInfo()}else{var o="Create failed";r.title=a,r.vm.$broadcast("notifyShowNewProjectInvalidTitle",o)}})},getTitle:function(){var e=this,a=r.domains.baseUrl+"/web-api/customerId/"+r.userSettings.userId+"/getProjectNameByProjectId";t.ajax({url:a,type:"get",data:"projectId="+r.projectId+"&autoRandomNum="+i(5).getRandomNum()}).done(function(t){t&&"200"===t.respCode&&(r.title=t.projectName,e.getAlbumId())})},changeProjectTitle:function(e,i,a){var o=r.domains.baseUrl+"/web-api/customerId/"+r.userSettings.userId+"/updateProjectAndAlbumTitle";t.ajax({url:o,type:"get",data:"projectId="+r.projectId+"&projectName="+e}).then(function(e){e&&("200"===e.respCode?i&&i.$dispatch(a,!1,"This title already exists, please try again."):i&&i.$dispatch(a,!0,"This title already exists, please try again."))})},savePortalCardProject:function(e,i,a){r.projectXml=i;var o=(new Date).valueOf(),n=r.domains.baseUrl+"/card-template/save.ep";t.ajax({url:n,type:"post",data:{projectXml:i,autoRandomNum:o,webClientId:1}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(r.projectId=t(i).find("guid").text()||"",r.projectXml=i,r.watches.isProjectLoaded=!0,a&&"function"==typeof a?a():e.$dispatch("dispatchShowPopup",{type:"save",status:0})):(r.watches.isProjectLoaded=!0,"300"===t(i).find("code").text()&&e.$dispatch("dispatchShowPopup",{type:"save",status:-5}))})},getCardPortalProject:function(){var e=this;t.ajax({url:r.domains.baseUrl+"/card-template/get.ep",type:"get",dataType:"xml",data:"initGuid="+r.projectId+"&webClientId=1&autoRandomNum="+i(5).getRandomNum()}).done(function(a){if(a){r.projectXml=a,r.title=t(a).find("title").text(),r.projectId=t(a).find("guid").text(),r.projectSettings.length=0;for(var o=0;o<t(a).find("spec").length;o++){for(var n=t(a).find("spec").eq(o),s=i(19),d=s(),l=0;l<n.find("option").length;l++){var c=n.find("option").eq(l);d[c.attr("id")]=c.attr("value"),"None"===d[c.attr("id")]&&(d[c.attr("id")]="none")}for(var p=0;p<t(a).find("tshirtSetting").eq(o).find("setting").length;p++){var h=t(a).find("tshirtSetting").eq(o).find("setting").eq(p);d[h.attr("id")]=h.attr("value")}["FT","FD"].indexOf(t(a).find("project").attr("productType")!==-1)&&(r.cardId=t(a).find("card").attr("id"),r.deletedPhoto=t(a).find("deletedPhoto").text(),d.trim=d.trim?d.trim:t(a).find("trim").attr("value")),r.projectSettings.push(d)}e.getAlbumId(),r.watches.isProjectLoaded=!0}})},submitPortalCardProject:function(e,a){var o=r.domains.baseUrl+"/card-template/submit.ep";t.ajax({url:o,type:"post",dataType:"xml",data:{encodeimage1:r.encodeImage1,encodeimage2:r.encodeImage2,projectXml:a,webClientId:1,autoRandomNum:i(5).getRandomNum()}}).done(function(i){i&&"success"===t(i).find("resultData").attr("state")?(r.projectXml=i,r.isPrjSaved=!0,r.vm.$dispatch("dispatchShowPopup",{type:"save",status:1})):i&&"fail"===t(i).find("resultData").attr("state")?"201"===t(i).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-3}),r.vm.$broadcast("notifyCloseWindow")):"202"===t(i).find("code").text()?(e.$dispatch("dispatchShowPopup",{type:"save",status:-4}),r.vm.$broadcast("notifyCloseWindow")):"205"===t(i).find("code").text()?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1})})},getMainProject:function(e,a,o,n){var s=r.domains.baseUrl+"/clientH5/project/imageInfo";t.ajax({url:s,type:"get",dataType:"json",data:{projectId:a,autoRandomNum:i(5).getRandomNum()}}).done(function(a){if(a&&"1"===a.errorCode){var s="",d="",l="";try{s=JSON.parse(a.data)}catch(c){d=i(3).stringToXml(a.data)}if(d){var p=t(d).find("images").find("image").length;if(r.imageList=[],p>0)for(var h=0;h<p;h++){var g=t(d).find("images").find("image").eq(h).attr("id"),u=t(d).find("images").find("image").eq(h).attr("encImgId")||"";r.imageList.push({id:g,guid:t(d).find("images").find("image").eq(h).attr("guid")||"",encImgId:u,url:r.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+t(d).find("images").find("image").eq(h).attr("encImgId")+"&rendersize=fit"+i(7).getSecurityString(),name:decodeURIComponent(t(d).find("images").find("image").eq(h).attr("name"))||"",width:parseFloat(t(d).find("images").find("image").eq(h).attr("width"))||0,height:parseFloat(t(d).find("images").find("image").eq(h).attr("height"))||0,shotTime:t(d).find("images").find("image").eq(h).attr("shotTime")||"",orientation:t(d).find("images").find("image").eq(h).attr("orientation")||0,usedCount:0,previewUrl:""}),o&&encodeURIComponent(o)===u&&(l=g),i(23).getBlobImagePreviewUrl(h)}}else if(s){var p=s.length;if(r.imageList=[],p>0)for(var h=0;h<p;h++)r.imageList.push({id:s[h].id.toString()||"",guid:s[h].guid||"",encImgId:s[h].encImgId||"",url:r.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+s[h].encImgId+"&rendersize=fit"+i(7).getSecurityString(),name:decodeURIComponent(s[h].name)||"",width:parseFloat(s[h].width)||0,height:parseFloat(s[h].height)||0,shotTime:s[h].shotTime||"",orientation:s[h].orientation||0,usedCount:0,previewUrl:""}),o&&encodeURIComponent(o)===s[h].encImgId&&(l=s[h].id.toString()),i(23).getBlobImagePreviewUrl(h)}l?e.$dispatch("dispatchSingleImageUploadComplete",l):n&&r.vm.$broadcast("notifyAddMyPhotosIntoPages",r.imageList)}})},getMyPhotoImages:function(e,a,o){var n=r.domains.baseUrl+"/web-api/customer/getMyPhotosInfo";t.ajax({url:n,type:"post",dataType:"json",data:{customerId:a,autoRandomNum:i(5).getRandomNum()}}).done(function(e){if(e&&"1"===e.errorCode&&e.data){var t=JSON.parse(e.data),a=[];r.maxPageNum&&t.length>r.maxPageNum&&(t.length=r.maxPageNum),t.forEach(function(e){var t={id:String(e.id),guid:e.guid,encImgId:e.encImgId,url:r.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+e.encImgId+"&rendersize=fit"+i(7).getSecurityString(),name:e.name,width:e.width,height:e.height,shotTime:e.shotTime,orientation:isNaN(+e.orientation)?0:+e.orientation,previewUrl:"",usedCount:0};a.push(t),r.imageList.push(t),i(23).getBlobImagePreviewUrl(r.imageList.length-1)}),o&&r.vm.$broadcast("notifyAddMyPhotosIntoPages",a)}})},getTshirtDisableOptions:function(){var e=r.domains.baseUrl+"/clientH5/getTshirtOffLine",a=r.userSettings.userId;t.ajax({url:e,type:"get",dataType:"json",data:{customerId:a,autoRandomNum:i(5).getRandomNum()}}).done(function(e){if(e){var t=e.disable,i={},a=["S","M","L","XL","XXL"];t.forEach(function(e){var t=e.color,r=e.measure;i[t]||(i[t]=new Object,i[t].options=new Array,i[t].isAllDisabled=!1),i[t].options.push(r),i[t].options.length>=a.length&&(i[t].isAllDisabled=!0)}),r.disableOptions=i}r.watches.isDisableOptionLoaded=!0})},getLocalTshirtDisableOptions:function(){var e="./assets/data/disableTshirt.json",a=r.userSettings.userId;t.ajax({url:e,
type:"get",dataType:"json",data:{customerId:a,autoRandomNum:i(5).getRandomNum()}}).done(function(e){if(e){var t=e.disable,i={},a=["S","M","L","XL","XXL"];t.forEach(function(e){var t=e.color,r=e.measure;i[t]||(i[t]=new Object,i[t].options=new Array,i[t].isAllDisabled=!1),i[t].options.push(r),i[t].options.length>=a.length&&(i[t].isAllDisabled=!0)}),r.disableOptions=i,r.watches.isDisableOptionLoaded=!0}})},deleteImageList:function(e){var i=r.userSettings.albumId,a=r.domains.baseUrl+"/web-api/album/deleteImages";r.deleImagelist&&r.deleImagelist.length>0?t.ajax({url:a,type:"post",dataType:"json",data:{data:JSON.stringify({albumId:i,images:r.deleImagelist})}}).done(function(t){r.deleImagelist=[],e&&e()}):e&&e()}}}).call(t,i(4),i(2))},function(e,t,i){(function(t,r){var a=i(17);e.exports={initProjectJson:function(){for(var e=i(1).getOptionIds(),o=t.projectSettings[t.currentSelectProjectIndex],n=r(t.spec.specXml).find("product-spec").attr("version"),s={},d=0;d<e.length;d++)s[e[d]]=o[e[d]];var l=[this.initPage()];return{project:{guid:"",version:n,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:a.formatDateTime(new Date),updatedDate:a.formatDateTime(new Date),summary:{},spec:s,pages:l,images:[]}}},initNewPrintProjectJson:function(){for(var e=i(1).getOptionIds(),o=t.projectSettings[t.currentSelectProjectIndex],n=r(t.spec.specXml).find("product-spec").attr("version"),s={},d=[],l=0;l<e.length;l++)s[e[l]]=o[e[l]];return{project:{version:n,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:a.formatDateTime(new Date),updatedDate:a.formatDateTime(new Date),summary:{defaultSetting:s},pages:d,images:[]}}},getCurrentProjectJson:function(){for(var e=i(1).getOptionIds(),o=t.projectSettings[t.currentSelectProjectIndex],n=r(t.spec.specXml).find("product-spec").attr("version"),s={},d=0;d<e.length;d++)s[e[d]]=o[e[d]];var l=this.getPages(),c=this.getImages();return{project:{guid:t.projectId,version:n,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:t.createdDate,updatedDate:a.formatDateTime(new Date),summary:{},spec:s,pages:l,images:c}}},getSkuJson:function(){for(var e=t.userSettings,a=i(1).getOptionIds(),o=r(t.spec.specXml).find("product-spec").attr("version"),n=t.projectSettings[t.currentSelectProjectIndex],s={project:{version:o,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:e.userId,artisan:e.userName}},d=0;d<a.length;d++)s.project[a[d]]=n[a[d]];return s},getBaseSize:function(e){var r="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=t.projectSettings[r],o=i(1).getOptionIds(),n=[];o.forEach(function(e){n.push({key:e,value:a[e]})});var s=i(1).getParameter("baseSizeInInch",n);return{width:s.width*i(1).getDPI(),height:s.height*i(1).getDPI()}},getBleedSize:function(e){var r="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=t.projectSettings[r],o=i(1).getDPI(),n=a.size,s=a.product,d=i(1).getParameter("bleedInInch",[{key:"product",value:s},{key:"size",value:n}]);return{top:d.top*o,right:d.right*o,bottom:d.bottom*o,left:d.left*o}},getLMCBaseSize:function(e){var r="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=t.projectSettings[r],o=a.size,n=a.product,s=a.frameStyle,d=a.orientation,l=i(1).getParameter("frameBaseSize",[{key:"product",value:n},{key:"frameStyle",value:s},{key:"size",value:o},{key:"orientation",value:d}]);return{width:parseFloat(l.widthInInch)*i(1).getDPI(),height:parseFloat(l.heightInInch)*i(1).getDPI()}},getLMCBleedSize:function(e){var r="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=t.projectSettings[r],o=a.size,n=a.product,s=i(1).getParameter("bleed",[{key:"product",value:n},{key:"size",value:o}]);return{top:parseFloat(s.top),right:parseFloat(s.right),bottom:parseFloat(s.bottom),left:parseFloat(s.left)}},getLMCCanvasBorder:function(e){var r="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=t.projectSettings[r],o=a.size,n=a.product,o=a.size,s=a.canvasBorderSize,d=i(1).getParameter("canvasBorderThickness",[{key:"product",value:n},{key:"size",value:o},{key:"canvasBorderSize",value:s}]);return{top:parseFloat(d.top),right:parseFloat(d.right),bottom:parseFloat(d.bottom),left:parseFloat(d.left)}},getCanvasBorder:function(){return{top:0,right:0,bottom:0,left:0}},getLMCPhotoLayer:function(e){var i="undefined"!=typeof e?e:t.currentSelectProjectIndex,r=t.projectSettings[i],a=(r.orientation,{}),o=this.getLMCBaseSize(i),n=this.getLMCCanvasBorder(i),s=n.top,d=n.bottom,l=n.left,c=n.right,p=this.getLMCBleedSize(i),h=p.top,g=p.bottom,u=p.left,m=p.right,f=o.width+l+c,v=o.height+s+d,S=0,y=0,w=0,x=0;"Portrait"===r.orientation?(S=-g,y=-u,w=f+h+g,x=v+u+m):(S=-u,y=-h,w=f+u+m,x=v+h+g);var I=S/w,b=y/x,P=w/w,j=x/x;return a.x=S,a.y=y,a.width=w,a.height=x,a.px=I,a.py=b,a.pw=P,a.ph=j,a},getLMCDefaultElement:function(e){var r="undefined"!=typeof e?e:t.currentSelectProjectIndex,o=this.getLMCPhotoLayer(r),n=this.getLMCCanvasBorder(r),s=this.getLMCBleedSize(r),d=s.left+n.left,l=s.top+n.top,c=o.width-n.left-n.right-s.left-s.right,p=o.height-n.top-n.bottom-s.top-s.bottom;return{id:i(6).guid(),type:"PhotoElement",elType:"image",x:d,y:l,width:c,height:p,px:d/o.width,py:l/o.height,pw:c/o.width,ph:p/o.height,imgFlip:!1,rot:0,imgRot:0,encImgId:"",imageid:"",dep:0,cropLUX:0,cropLUY:0,cropRLX:1,cropRLY:1,lastModified:a.formatDateTime(new Date)}},getDefaultElement:function(e,t){return{id:i(6).guid(),type:"PhotoElement",elType:"image",x:0,y:0,width:e,height:t,px:0,py:0,pw:1,ph:1,imgFlip:!1,rot:0,imgRot:0,encImgId:"",imageid:"",dep:0,cropLUX:0,cropLUY:0,cropRLX:1,cropRLY:1,lastModified:a.formatDateTime(new Date)}},initPage:function(){var e=this.getBaseSize(),t=this.getBleedSize(),r=e.width+t.left+t.right,a=e.height+t.top+t.right,o=[this.getDefaultElement(r,a)];return{id:i(6).guid(),width:r,height:a,type:"Page",bleed:t,elements:o,backend:{isPrint:!0}}},getPhotoLayer:function(e){var i="undefined"!=typeof e?e:t.currentSelectProjectIndex,r=t.projectSettings[i],a=(r.orientation,this.getBaseSize(i)),o=this.getBleedSize(),n=(a.width+o.left+o.right,a.height+o.top+o.right,0),s=0,d=0,l=0;return"Portrait"===r.orientation?(n=-o.bottom,s=-o.left,d=a.width+o.left+o.right,l=a.height+o.top+o.right):(n=-o.left,s=-o.top,d=a.width+o.left+o.right,l=a.height+o.top+o.right),{x:n,y:s,width:d,height:l,px:n/a.width,py:s/a.height,pw:d/a.width,ph:l/a.height}},getPages:function(){for(var e=[],i=this.getBleedSize(),r=this.getPhotoLayer(),a=r.width,o=r.height,n=(this.getElements(),0);n<t.pages.length;n++)e.push({width:a,height:o,type:"Page",bleed:i,elements:this.getElements(n),backend:{isPrint:!0}});return e},getImages:function(){for(var e=[],i=0;i<t.imageList.length;i++){var r=t.imageList[i];e.push({id:r.id,guid:r.guid,encImgId:r.encImgId,order:i,name:encodeURIComponent(r.name),width:r.width,height:r.height,shotTime:r.shotTime,orientation:r.orientation})}return e},getElements:function(e){for(var i="undefined"!=typeof e?e:t.currentSelectProjectIndex,r=(t.projectSettings[i],t.pages[i].canvas),a=r.params,o=[],n=0;n<a.length;n++){var s=a[n],d={x:s.x,y:s.y,px:s.x/r.oriWidth,py:s.y/r.oriHeight,width:s.width,height:s.height,pw:s.width/r.oriWidth,ph:s.height/r.oriHeight,dep:s.dep,rot:s.rotate};switch(s.elType){case"text":d.type="TextElement",d.color=s.fontColor,d.text=encodeURIComponent(s.text),d.fontWeight=s.fontWeight,d.textAlign=s.textAlign,d.fontFamily=encodeURIComponent(s.fontFamily),d.fontSize=parseFloat(s.fontSize)/r.oriHeight;break;case"image":var l=s.encImgId;l||t.imageList.some(function(e){if(e.id==s.imageId)return l=e.encImgId,!0}),d.type="PhotoElement",d.imageid=s.imageId,d.encImgId=l,d.imgRot=s.imageRotate,d.imgFlip=!1,d.cropLUX=parseFloat(s.cropPX).toString(),d.cropLUY=parseFloat(s.cropPY).toString(),d.cropRLX=(parseFloat(s.cropPX)+parseFloat(s.cropPW)).toString(),d.cropRLY=(parseFloat(s.cropPY)+parseFloat(s.cropPH)).toString(),d.style={brightness:s.style&&s.style.brightness?s.style.brightness:0,effectId:0,opacity:100},d.border={size:0,color:"#000000",opacity:100}}o.push(d)}return o},getPrintBaseSize:function(e){var t=!1,r=i(16).getParamsList();e.size&&(r=r.map(function(t){return"size"===t.key&&(t.value=e.size),t})),e.rotated&&(t=e.rotated);var a=i(1).getParameter("baseSizeInInch",r),o={};return t?(o.width=a.heightInInch*i(1).getDPI(),o.height=a.widthInInch*i(1).getDPI()):(o.width=a.widthInInch*i(1).getDPI(),o.height=a.heightInInch*i(1).getDPI()),o},getPrintBleed:function(e){var r=!1,a=i(1).getDPI(),o=i(16).getParamsList();o=o.map(function(i){return"size"===i.key&&(e&&e.size?i.value=e.size:i.value=t.baseProject.size),i}),e.rotated&&(r=e.rotated);var n=i(1).getParameter("bleedInInch",o),s={};return s.top=parseInt(n.top*a),s.bottom=parseInt(n.bottom*a),s.left=parseInt(n.left*a),s.right=parseInt(n.right*a),r&&(s.top=parseInt(n.left*a),s.bottom=parseInt(n.right*a),s.left=parseInt(n.top*a),s.right=parseInt(n.bottom*a)),s},getPrintCornerRadius:function(e){var r=i(1).getDPI(),a=i(16).getParamsList();a=a.map(function(i){return"size"===i.key&&(e&&e.size?i.value=e.size:i.value=t.baseProject.size),i});var o=i(1).getParameter("cornerRadiusInInch",a).value;return o=(o-0)*r},getNewPrintCurrentProjectJson:function(){for(var e=i(1).getOptionIds(),o=(t.projectSettings[t.currentSelectProjectIndex],r(t.spec.specXml).find("product-spec").attr("version")),n={},s=0;s<e.length;s++)n[e[s]]=t.baseProject[e[s]];var d=this.getNewPrintPages(),l=this.getImages();return{project:{guid:t.projectId,version:o,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:t.createdDate,updatedDate:a.formatDateTime(new Date),summary:{defaultSetting:n},pages:d,images:l}}},getNewPrintPages:function(){for(var e=[],r=t.projectSettings,a=t.pages,o=i(1).getOptionIds(),n=0;n<a.length;n++){for(var s=a[n].canvas,d=this.getNewPrinteElements(s,s.params),l=r[n],c=a[n].guid||i(6).guid(),p=l.quantity,h=(i(1).getVersion(),{}),g="Print",u=0;u<o.length;u++)h[o[u]]=l[o[u]];h.quantity=p;var m=this.getPrintBaseSize({size:l.size,rotated:l.rotated}),f=this.getPrintBleed({size:l.size,rotated:l.rotated}),v=a[n].canvas.borderLength?a[n].canvas.borderLength:0,S=a[n].canvas.borderColor?a[n].canvas.borderColor:"none";e.push({id:c,spec:h,width:m.width+f.left+f.right,height:m.height+f.top+f.bottom,type:g,bleed:f,border:{color:S,size:v},elements:d,backend:{isPrint:!0}})}return e},getNewPrinteElements:function(e,r){var a=r.map(function(r){var a=r.guid||i(6).guid(),o=r.x,n=r.y,s=r.width,d=r.height,l=o/e.oriWidth,c=n/e.oriHeight,p=d/e.oriHeight,h=s/e.oriWidth,g=r.rotate,u=r.dep,m=r.imageId,f=r.imageRotate,v=!1,S=r.cropPX,y=r.cropPY,w=r.cropPW,x=r.cropPH,I=r.style&&r.style.brightness?r.style.brightness:0,b=t.imageList.filter(function(e){return e.id===r.imageId}),P={id:a,x:o,y:n,width:s,height:d,px:l,py:c,pw:h,ph:p,rot:g,dep:u};return"text"===r.elType?(P.type="TextElement",P.color=r.fontColor,P.fontSize=parseFloat(r.fontSize)/e.oriHeight,P.fontFamily=encodeURIComponent(r.fontFamily),P.fontWeight=r.fontWeight,P.textAlign=r.textAlign,P.text=encodeURIComponent(r.text)):"logo"===r.elType?P.type="LogoElement":"image"===r.elType&&(P.type="PhotoElement",P.imageid=m,P.imgFlip=v,P.imgRot=f,P.encImgId=b.length?b[0].encImgId:"",P.cropLUX=S,P.cropLUY=y,P.cropRLX=S+w,P.cropRLY=y+x,P.style={brightness:I,effectId:0,opacity:100},P.border={size:0,color:"#000000",opacity:100}),P});return a},getNewPrintSkuJson:function(e){var t=e.project.pages,r=e.project.version,a=e.project.clientId,o=e.project.createAuthor,n=e.project.userId,s=e.project.artisan,d={},l=e.project.summary.defaultSetting,c=!!l&&"LPP"===l.product,p=!!l&&"LSC"===l.product,h=i(1).getOptionIds();return 0===t.length&&(l.id="defaultSetting",l.version=r,l.clientId=a,l.createAuthor=o,l.userId=n,l.artisan=s,l.quantity=1,d={defaultSetting:l}),t.forEach(function(e){if(!((c||p)&&Object.keys(d).length>0)){d[e.id]={id:e.id,version:r,clientId:a,createAuthor:o,userId:n,artisan:s,quantity:e.spec?e.spec.quantity:1};for(var t=0;t<h.length;t++)d[e.id][h[t]]=e.spec[h[t]]}}),d},getNewPrintRemarkPages:function(){for(var e=t.projectSettings,r=t.pages,a=[],o=[],n=i(1).getOptionIds(),s=0;s<e.length;s++)t.selectedSize?t.selectedPaper?e[s].size===t.selectedSize&&e[s].paper===t.selectedPaper&&(a.push(r[s]),a[a.length-1].oid=s):e[s].size===t.selectedSize&&(a.push(r[s]),a[a.length-1].oid=s):t.selectedPaper&&e[s].paper===t.selectedPaper&&(a.push(r[s]),a[a.length-1].oid=s);if(0===a.length){a=r;for(var s=0;s<a.length;s++)a[s].oid=s}for(var s=0;s<a.length;s++){for(var d=a[s].canvas,l=this.getNewPrinteElements(d,d.params),c=e[a[s].oid],p=a[s].guid||i(6).guid(),h=c.quantity,g=(i(1).getVersion(),{}),u="Print",m=0;m<n.length;m++)g[n[m]]=c[n[m]];g.quantity=h;var f=this.getPrintBaseSize({size:c.size,rotated:c.rotated}),v=this.getPrintBleed({size:c.size}),S=a[s].canvas.borderLength?a[s].canvas.borderLength:0,y=a[s].canvas.borderColor?a[s].canvas.borderColor:"none";h&&o.push({id:p,spec:g,width:f.width,height:f.height,type:u,quantity:h,bleed:v,border:{color:y,size:S},elements:l,backend:{isPrint:!0}})}return o},getNewPrintRemarkProject:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getNewPrintCurrentProjectJson()),i=this.getNewPrintRemarkPages(),r=this.getImages();return e.project.pages=i,e.project.images=r,e},getWallartsSkuJson:function(e){var t=e.project.pages,r=e.project.version,a=e.project.clientId,o=e.project.createAuthor,n=e.project.userId,s=e.project.artisan,d={},l=e.project.summary.defaultSetting;!!l&&"LPP"===l.product,!!l&&"LSC"===l.product,i(1).getOptionIds();return l.id=t[0].id,l.version=r,l.clientId=a,l.createAuthor=o,l.userId=n,l.artisan=s,l.quantity=1,d[t[0].id]=l,d}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={initProjectXml:function(){var e=i(27).analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size});console.log(e);var r=e.base,a=(e.background,e.logo,'<project clientId="web-h5" createAuthor="web-h5|1.0|1"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan/><title><![CDATA["+t.title+']]></title><description/><createdDate/><updatedDate></updatedDate><tshirts><tshirt id="tshirt-1"><spec version="1.0"><option id="product" value="'+t.projectSettings[t.currentSelectProjectIndex].product+'" /><option id="color" value="'+t.projectSettings[t.currentSelectProjectIndex].color+'" /><option id="size" value="'+t.projectSettings[t.currentSelectProjectIndex].size+'" /><option id="measure" value="'+t.projectSettings[t.currentSelectProjectIndex].measure+'" /></spec><tshirtSetting><setting id="count" value="1" /><setting id="pages" value="true,false"/></tshirtSetting><contents><content type="front" width="'+r.width+'" hight="'+r.height+'"><elements><element type="PhotoElement" elType="image" x="0" y="0" width="'+r.width+'" height="'+r.height+'" px="0" py="0" pw="1" ph="1" rot="0" dep="0" imageid="" imgRot="0" imgFlip="false" cropLUX="0" cropLUY="0" cropRLX="1" cropRLY="1" /></elements></content><content type="back" width="'+r.width+'" hight="'+r.height+'"><elements></elements></content></contents></tshirt></tshirts><images/></project>');return a},getCurrentProjectXml:function(){i(15).syncProjectData(),console.log(t.currentSelectProjectIndex),console.log(t.projectSettings[t.currentSelectProjectIndex].product),console.log(t.projectSettings[t.currentSelectProjectIndex].size);var e=i(27).analyseSpec({product:t.projectSettings[t.currentSelectProjectIndex].product,size:t.projectSettings[t.currentSelectProjectIndex].size});console.log(e);for(var r=e.base,a=(e.background,e.logo,'<project clientId="web-h5" createAuthor="web-h5|1.0|1"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan/><title><![CDATA["+t.title+"]]></title><description/><createdDate/><updatedDate></updatedDate><tshirts>"),o=t.projectSettings,n=0;n<o.length;n++){var s=o[n];a+='<tshirt id="tshirt-'+n+'"><spec version="1.0"><option id="product" value="'+s.product+'" /><option id="color" value="'+s.color+'" /><option id="size" value="'+s.size+'" /><option id="measure" value="'+s.measure+'" /></spec><tshirtSetting><setting id="count" value="'+s.count+'" />';for(var d=!1,l=t.projects[n].pages[0],c=0;c<l.canvas.params.length;c++){var p=l.canvas.params[c];"logo"===p.elType||"image"===p.elType?""!=p.imageId&&(d=!0):"text"===p.elType&&(d=!0)}for(var h=!1,g=t.projects[n].pages[1],c=0;c<g.canvas.params.length;c++){var p=g.canvas.params[c];"logo"===p.elType||"image"===p.elType?""!=p.imageId&&(h=!0):"text"===p.elType&&(h=!0)}a+='<setting id="pages" value="'+d+","+h+'" />',a+="</tshirtSetting><contents>";for(var u=t.projects[n].pages,m=0;m<u.length;m++){var f=0===m?"front":"back";a+='<content type="'+f+'" width="'+r.width+'" hight="'+r.height+'">';var v=u[m].canvas;a+="<elements>";for(var S=0;S<v.params.length;S++){console.log("spread which not inited");var y=v.params[S],w=y.width,x=y.height,I=y.x,b=y.y,P=I/v.oriWidth,j=b/v.oriHeight,C=w/v.oriWidth,T=x/v.oriHeight,k=y.rotate;if("logo"===v.params[S].elType||"image"===v.params[S].elType){var L=y.cropPX,D=y.cropPY,B=y.cropPW,R=y.cropPH;L<0?L=0:L,L>1?L=1:L,D<0?D=0:D,D>1?D=1:D,B<0?B=0:B,B>1?B=1:B,R<0?R=0:R,R>1?R=1:R}a+="text"===v.params[S].elType?'<element type="TextElement" elType="'+y.elType+'" x="'+I+'" y="'+b+'" width="'+w+'" height="'+x+'" px="'+P+'" py="'+j+'" pw="'+C+'" ph="'+T+'" rot="'+k+'" dep="'+y.dep+'" color="'+y.fontColor+'" fontSize="'+parseFloat(y.fontSize)/v.oriHeight+'" fontFamily="'+encodeURIComponent(y.fontFamily)+'" fontWeight="'+y.fontWeight+'" textAlign="'+y.textAlign+'" >'+encodeURIComponent(y.text)+"</element>":"logo"===v.params[S].elType?'<element type="LogoElement" elType="'+y.elType+'" x="'+I+'" y="'+b+'" width="'+w+'" height="'+x+'" px="'+P+'" py="'+j+'" pw="'+C+'" ph="'+T+'" rot="'+k+'" dep="'+y.dep+'" imageid="'+y.imageId+'" imgRot="'+(y.imageRotate||0)+'" imgFlip="false" cropLUX="'+L+'" cropLUY="'+D+'" cropRLX="'+(L+B)+'" cropRLY="'+(D+R)+'"/>':'<element type="PhotoElement" elType="'+y.elType+'" x="'+I+'" y="'+b+'" width="'+w+'" height="'+x+'" px="'+P+'" py="'+j+'" pw="'+C+'" ph="'+T+'" rot="'+k+'" dep="'+y.dep+'" imageid="'+y.imageId+'" imgRot="'+(y.imageRotate||0)+'" imgFlip="false" cropLUX="'+L+'" cropLUY="'+D+'" cropRLX="'+(L+B)+'" cropRLY="'+(D+R)+'"/>'}a+="</elements>",a+="</content>"}a+="</contents></tshirt>"}for(a+="</tshirts><images>",n=0;n<t.imageList.length;n++)a+='<image id="'+t.imageList[n].id+'" guid="'+t.imageList[n].guid+'" encImgId="'+t.imageList[n].encImgId+'" order="'+n+'" name="'+t.imageList[n].name+'" width="'+t.imageList[n].width+'" height="'+t.imageList[n].height+'" shotTime="'+t.imageList[n].shotTime+'"/>';return a+="</images></project>"},saveNewProject:function(e){var r=i(25).initProjectJson(),a=i(12).getNewPrintSkuJson(r);t.createdDate=i(17).formatDateTime(new Date),t.projectJson=r,i(21).insertProject(e,r,a)},saveOldProject:function(e,t){var r=i(25).getCurrentProjectJson(),a=i(12).getNewPrintSkuJson(r);t&&"function"==typeof t?i(21).saveProject(e,r,a,t):i(21).saveProject(e,r,a)},handledSaveOldProject:function(e,t){var r=i(25).getCurrentProjectJson(),a=i(12).getNewPrintSkuJson(r);i(21).handledSaveProject(e,r,a,t)},getOldProject:function(){t.isPreview?"self"!==t.source?i(21).getNewPrintProject("Share"):i(21).getNewPrintProject():t.isRemark?i(21).getNewPrintProject("Portal"):i(21).getNewPrintProject()},getProjectOrderedState:function(e){i(11).getProjectOrderedState(e)},addOrUpdateAlbum:function(e,t,r){i(11).addOrUpdateAlbum(e,t,r)},newProject:function(e,r,a){var o=i(19),n=o();return n.product=t.baseProject.product,n.size=t.baseProject.size,n.finish=t.baseProject.finish,n.rotated=!0,n.orientation="Landscape",n.quantity=1,n},orderProject:function(e){var t=i(16).getCurrentProjectXml();console.log(t);var r=0,a=0,o=1,n=1;i(11).orderProject(e,t,r,a,o,n)},cloneProject:function(e,r){var a=t.title;t.title=r;var o=i(25).getCurrentProjectJson();o.project.guid="";var n=i(12).getNewPrintSkuJson(o);i(21).cloneProject(e,a,r,o,n)},setDefaultValue:function(){var e=i(1),r=e.getOptionIds(),a=t.projectSettings[t.currentSelectProjectIndex];r=r.filter(function(e){return"product"!==e}),r.forEach(function(t){var i=e.getOptionsMapDefaultValue(t,[{key:"product",value:a.product}]);a[t]="none"!==a[t]&&a[t]?a[t]:i})},createProject:function(e,r){var a=t.title;t.title=r;var o=i(19),n=o(),s=i(7);n.product=s.getUrlParam("product")||"none",n.rotated=!0,t.projectSettings.length=0,t.projects.length=0,t.imageList.length=0;t.pages[t.selectedPageIdx].canvas;i(26).deleteImage(0),t.vm.$broadcast("notifyRefreshScreenshot"),t.projectSettings.push(n),this.setDefaultValue();var d=i(25).initProjectJson(),l=i(12).getNewPrintSkuJson(d);t.createdDate=i(17).formatDateTime(new Date),t.projectJson=d,i(21).createProjectSuccess(e,a,r,d,l)},changeProjectTitle:function(e,t,r){i(11).changeProjectTitle(e,t,r)},getMainProjectImages:function(e,t,r){i(11).getMainProject(e,t,r)},getMyPhotoImages:function(e,t,r){i(11).getMyPhotoImages(e,t,r)},initProjectSettings:function(){var e=t.projectJson.project,r=i(1).getOptionIds();r.forEach(function(i){t.baseProject[i]=e.pages[0].spec[i]}),t.projectSettings=[],t.LSCPageNum=e.pages.length,e.pages.forEach(function(e){for(var r=i(19),a=r(),o=e.spec,n=Object.keys(o),s=0;s<n.length;s++){var d=n[s];a[d]=o[d]}a.quantity=parseInt(o.quantity)||1,a.rotated="Landscape"===a.orientation,t.projectSettings.push(a)})},transformOldProjectToNew:function(){var e=t.projectJson.project;i(1).getOptionIds();e.spec&&(e.pages[0].spec=e.spec)}}}).call(t,i(2))},function(e,t,i){(function(t,i){e.exports={setPopWindowPosition:function(e){if(e&&e.width&&e.height&&e.selector){var i=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,r=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,a=(i-e.width)/2>0?(i-e.width)/2:0,o=(r-e.height)/2>0?(r-e.height)/2:0;t(e.selector).css("left",a).css("top",o)}},initImageListSize:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),r=i-208;r=r<200?200:r,t(e.selector).css("height",r)}},initImageListSizeWithCards:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),r=i-40-34-41-28-20-3-36;r=r<200?200:r,t(e.selector).css("height",r)}},initImageListSizeWithWallArts:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),r=i-215+40;r=r<200?200:r,t(e.selector).css("height",r)}},initImageListSizeWithCase:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),r=i-234;r=r<200?200:r,t(e.selector).css("height",r)}},initImageListSizeWithPadCase:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),r=i-240;r=r<200?200:r,t(e.selector).css("height",r)}},initImageListSizeWithLRB:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),r=i-40-35-10-32-10;r=r<200?200:r,t(e.selector).css("height",r)}},initDecorationListSize:function(e){if(e&&e.selector){var i=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),r=i-208;r=r<200?200:r,t(e.selector).css("height",r)}},getProjectListSize:function(e){var t=(window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight),i=t-122;return i=i<200?200:i},getBoxLimit:function(e){e=e||340;var t=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,i=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,r=t-e-20,a=i-50-2-160;return r>0?r:r=0,a>0?a:a=0,{width:r,height:a}},getCardBoxLimit:function(e,t){e=e||340;var i=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,r=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,a=i-e-20,o=r-76-60-80-20-t;return a>0?a:a=0,o>0?o:o=0,{width:a,height:o}},getBoxLimitWithCase:function(){var e=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,i=e-280-20-60,r=t-50-30-2-150;return i>0?i:i=0,r>0?r:r=0,{width:i,height:r}},getBoxBgSize:function(){var e=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,i=e-340-20,r=t-50-2;return i>0?i:i=0,r>0?r:r=0,{width:i,height:r}},getPreviewBoxLimit:function(e){e=e||!1;var t=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,i=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,r=t-50,a=i-30-60;return e?a:a-=80,r>0?r:r=0,a>0?a:a=0,{width:r,height:a}},getBoxLimitWithTmpl:function(){var e=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,t=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,r=e-340-20-60,a=t-50-2-160;return i.isWithTemplate&&(a-=40,i.isChangeTmplExpanded&&(a-=155)),r>0?r:r=0,a>0?a:a=0,{width:r,height:a}},getOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return e-80-60-4},getWallArtsOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return e-50-44-2},getCardsOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return e-41-35-36},getPhoneCaseOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return e-80-60-4},getPadCaseOptionHeight:function(){var e=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight;return console.log(e-80-200),e-80-90},getPrintBoxLimit:function(){if(i.limitWidth)return{width:i.limitWidth,height:i.limitWidth};var e=screen.availWidth,t=(e-240-60-30)/6-20;return t=t<235?235:t,{width:t,height:t}},getPrintPreviewBoxLimit:function(){var e=screen.availWidth,t=(e-80-100)/4;return t=t>=458?458:t-20,t=t<235?235:t,{width:t,height:t}},getCenterPreviewBoxLimit:function(e){e=e||!1;var t=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,i=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,r=t,a=i-30-60;return e?a:a-=80,r>0?r:r=0,a>0?a:a=0,{width:r,height:a}},getBoxWH:function(e,t){var i=window.innerWidth||window.document.documentElement.clientWidth||window.document.body.clientWidth,r=window.innerHeight||window.document.documentElement.clientHeight||window.document.body.clientHeight,a=e?i-e:i,o=t?r-t:r;return a>0?a:a=0,o>0?o:o=0,{width:a,height:o}}}}).call(t,i(4),i(2))},function(e,t,i){(function(t,r){var a=i(5),o=i(18),n=i(10),s=i(16),d=i(27),l=i(37),c=i(43),p=i(12),h=i(24),g=h.component("photo-element"),u=h.component("text-element");e.exports={createElement:function(e,i,r,a,o){var n=t.pages[i].canvas;if("text"===n.params[e].elType)var s=new u;else var s=new g;s.init(e,i,r,a),s.$mount().$appendTo("#container"+i+a),a?n.centerElements.push(s):n.elements.push(s)},editElement:function(e,i){var r=t.pages[t.selectedPageIdx].canvas;if(r.elements[e].$destroy(!0),"text"===r.params[e].elType)var a=new u;else var a=new g;a.init(e),a.$mount().$appendTo("#container"),r.elements.splice(e,1,a)},deleteElement:function(e,i,r){for(var a="undefined"!=typeof r?r:t.currentSelectProjectIndex,o=t.pages[a].canvas,n=0;n<o.elements.length;n++)if(o.elements[n].id===i){o.elements[n].$destroy(!0),o.elements.splice(n,1);break}},initElementData:function(e){var r=t.pages[t.selectedPageIdx].canvas;if("background"===r.params[e].elType||"image"===r.params[e].elType||"logo"===r.params[e].elType){var n="../../static/img/blank.png";if(""!==r.params[e].imageId){var s=r.params[e].cropPX,d=r.params[e].cropPY,l=r.params[e].cropPW,c=r.params[e].cropPH,p=r.params[e].width*r.ratio/l,h=r.params[e].height*r.ratio/c,g=i(6),u=g.getEncImgId(r.params[e].imageId),m=g.getQueryString({encImgId:u,px:s,py:d,pw:l,ph:c,width:Math.round(p),height:Math.round(h),rotation:r.params[e].imageRotate});n="/imgservice/op/crop?"+m+i(7).getSecurityString()}r.elements.$set(e,r.paper.image(n,r.params[e].x*r.ratio,r.params[e].y*r.ratio,r.params[e].width*r.ratio,r.params[e].height*r.ratio))}else if("text"===r.params[e].elType){var f=Math.round(a.getTextViewFontSize(r.params[e].fontSize)),v="../../static/img/blank.png";v=f>0?""===r.params[e].text?t.isPreview?"../../static/img/blank.png":t.domains.productBaseUrl+"/product/text/textImage?text="+encodeURIComponent("Enter text here")+"&font="+encodeURIComponent(r.params[e].fontFamily)+"&fontSize="+f+"&color="+r.params[e].fontColor+"&align=left":t.domains.productBaseUrl+"/product/text/textImage?text="+encodeURIComponent(r.params[e].text)+"&font="+encodeURIComponent(r.params[e].fontFamily)+"&fontSize="+f+"&color="+r.params[e].fontColor+"&align=left":"../../static/img/blank.png",r.elements.$set(e,r.paper.image(v,r.params[e].x*r.ratio,r.params[e].y*r.ratio,r.params[e].width*r.ratio,r.params[e].height*r.ratio)),r.elements[e].fontFamily=r.params[e].fontFamily,r.elements[e].fontSize=r.params[e].fontSize,r.elements[e].fontWeight=r.params[e].fontWeight,r.elements[e].textAlign=r.params[e].textAlign,r.elements[e].fontColor=r.params[e].fontColor,r.elements[e].text=r.params[e].text}r.elements[e].node.id="element-"+e,r.elements[e].elType=r.params[e].elType,r.elements[e].idx=e,r.elements[e].dep=r.params[e].dep,r.elements[e].vWidth=r.params[e].width*r.ratio,r.elements[e].vHeight=r.params[e].height*r.ratio,r.elements[e].sourceImageUrl=r.params[e].url||"",r.elements[e].imageId=r.params[e].imageId||"",r.elements[e].imageRotate=r.params[e].imageRotate||0;var S=o.getImageDetail(r.elements[e].imageId);if(S){if(r.elements[e].imageGuid=S.guid,r.elements[e].imageWidth=S.width,r.elements[e].imageHeight=S.height,90===Math.abs(r.elements[e].imageRotate))var y=r.elements[e].imageHeight,w=r.elements[e].imageWidth;else var y=r.elements[e].imageWidth,w=r.elements[e].imageHeight;r.elements[e].cropX=y*r.params[e].cropPX,r.elements[e].cropY=w*r.params[e].cropPY,r.elements[e].cropW=y*r.params[e].cropPW,r.elements[e].cropH=w*r.params[e].cropPH}else r.elements[e].imageGuid="",r.elements[e].imageWidth="",r.elements[e].imageHeight="",r.elements[e].cropX=0,r.elements[e].cropY=0,r.elements[e].cropW=1,r.elements[e].cropH=1},initElementHandles:function(e){var i=this,r=t.pages[t.selectedPageIdx].canvas;"text"===r.elements[e].elType?r.elements[e].dblclick(function(){t.watches.isChangeThisText=!0;
}):r.elements[e].dblclick(function(){t.watches.isCropThisImage=!0}),r.elements[e].attr({cursor:"move"}).click(function(){var e=this;i.changeClickDepth({idx:e.idx})})},initElementTransform:function(e,r){var o=this,s=t.pages[t.selectedPageIdx].canvas;if("image"===s.params[e].elType||"logo"===s.params[e].elType)var d={drag:["self"],rotate:!1,scale:["bboxCorners"],keepRatio:!0,snap:{rotate:1,scale:1,drag:1},draw:!1,range:{scale:[0,99999]},idx:e};else if("text"===s.params[e].elType)var d={drag:["self"],rotate:!1,scale:["bboxCorners"],keepRatio:!0,snap:{rotate:0,scale:1,drag:1},draw:!1,range:{scale:[0,99999]},idx:e};s.trans.$set(e,s.paper.freeTransform(s.elements[e],d,function(d,c){if("scale start"===c[0]||"rotate start"===c[0])o.showSpineLines(),l.deleteElement(e);else if("drag start"===c[0])t.ctrls.isDragStarted=!0,o.showSpineLines(),l.deleteElement(e);else if("drag end"===c[0]||t.ctrls.isDragStarted&&"apply"===c[0]&&"init"===t.ctrls.lastTranEvent)console.info("index"+e),t.ctrls.isDragStarted=!1,t.ctrls.lastTranEvent="",o.changeClickDepth({idx:d.opts.idx}),o.hideSpineLines(),s.warns[e]&&s.warns[e].isActive&&l.createElement(e),l.showBeforeElements(),console.info("index"+e);else if("scale end"===c[0]||"rotate end"===c[0]){var p=n.getParamsValueByElement(d.opts.idx);"text"===s.params[d.opts.idx].elType?(console.log("resize text"),p.fontSize<a.getPxByInch(.3)?p.fontSize=a.getPxByInch(.3):p.fontSize>a.getPxByInch(16)&&(p.fontSize=a.getPxByInch(16)),r.editText(p,d.opts.idx)):(s.params.splice(d.opts.idx,1,p),o.editElement(d.opts.idx),o.highlightSelection(d.opts.idx),o.spineLinesToTop(),o.hideSpineLines())}else if("apply"===c[0]){var h=i(10).getParamsValueByElement(e);if(h.x<-h.width||h.y<-h.height||h.x>s.oriWidth||h.y>s.oriHeight)if(console.info(h),h.x=0,h.y=0,"text"===h.elType){var g=i(32);g.editText(h,e)}else if("image"===h.elType||"logo"===h.elType){var u=i(26);u.editImage(h,e)}}t.ctrls.lastTranEvent=c[0]||""})),s.trans[e].attrs.rotate=s.params[e].rotate,s.trans[e].apply()},initElementDragEvent:function(e){var i=t.pages[t.selectedPageIdx].canvas;"background"!==i.params[e].elType&&"image"!==i.params[e].elType&&"logo"!==i.params[e].elType||(navigator.userAgent.indexOf("Trident")!==-1?(r("#element-"+e).attr("ondragover","event.preventDefault();"),r("#element-"+e).attr("ondrop","asFn.fnOndrop(event);")):(document.getElementById("element-"+e).ondragover=function(e){e.preventDefault()},document.getElementById("element-"+e).ondrop=function(e){var i={ev:e,newAdded:!1,isBg:!1};t.dropData.ev=i.ev,t.dropData.newAdded=i.newAdded,t.dropData.isBg=i.isBg,console.log("frop"),t.watches.isOnDrop=!0}))},initWarnTip:function(e){var r=t.pages[t.selectedPageIdx].canvas,a=o.getImageDetail(r.elements[e].imageId);if(r.warns[e]={isActive:!1,el:""},("background"===r.params[e].elType||"image"===r.params[e].elType||"logo"===r.params[e].elType)&&a){var n=a.width*r.params[e].cropPW,s=a.height*r.params[e].cropPH;console.log(a.width);var d=i(10).getParamsValueByElement(e),c=d.width/n,p=d.height/s,h=Math.max(c,p);console.log(h),h>t.warnSettings.resizeLimit?l.createElement(e):(l.deleteElement(e),r.warns[e].isActive=!1),l.showBeforeElements()}},createBackLayer:function(){var e=t.pages[t.selectedPageIdx].canvas;e.elementBg=e.paper.rect(.5,.5,e.width,e.height),e.elementBg.attr({fill:"rgba(255, 255, 255, 0)",stroke:"rgba(10, 10, 10, 0)"}),e.elementBg.node.id="element-bg"},createBleeding:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.paper.rect(0,0,e.bleedings.left*e.ratio,e.height);i.attr({fill:"rgba(255, 255, 255, .6)",stroke:"rgba(255, 255, 255, 0)"});var r=e.paper.rect(e.bleedings.left*e.ratio,0,(e.oriWidth-e.bleedings.left-e.bleedings.right)*e.ratio,e.bleedings.top*e.ratio);r.attr({fill:"rgba(255, 255, 255, .6)",stroke:"rgba(255, 255, 255, .2)"});var a=e.paper.rect(e.bleedings.left*e.ratio,(e.oriHeight-e.bleedings.bottom)*e.ratio,(e.oriWidth-e.bleedings.left-e.bleedings.right)*e.ratio,e.bleedings.bottom*e.ratio);a.attr({fill:"rgba(255, 255, 255, .6)",stroke:"rgba(255, 255, 255, 0.2)"});var o=e.paper.rect((e.oriWidth-e.bleedings.right)*e.ratio,0,e.bleedings.right*e.ratio,e.height);o.attr({fill:"rgba(255, 255, 255, .6)",stroke:"rgba(255, 255, 255, 0)"});var n=e.paper.rect(e.bleedings.left*e.ratio,e.bleedings.top*e.ratio,(e.oriWidth-e.bleedings.left-e.bleedings.right)*e.ratio,(e.oriHeight-e.bleedings.top-e.bleedings.bottom)*e.ratio);n.attr({fill:"rgba(255, 255, 255, 0)",stroke:"#646464"}),n.node.id="element-bg"},createOuterLine:function(){var e=t.pages[t.selectedPageIdx].canvas;e.outerLine=e.paper.path("M0.5 0.5L"+e.width+" 0.5L"+e.width+" "+e.height+"L0.5 "+e.height+"L0.5 0.5"),e.outerLine.attr({stroke:"#7b7b7b"})},createInnerLine:function(){var e=t.pages[t.selectedPageIdx].canvas,i=t.projectSettings[t.currentSelectProjectIndex],r=d.analyseSpec({size:i.size,product:i.product}),a=r.logo.x*e.ratio,o=r.logo.y*e.ratio,n=r.logo.width*e.ratio,s=r.logo.height*e.ratio;e.innerLine=e.paper.path("M"+a+" "+o+"L"+(a+n)+" "+o+"L"+(a+n)+" "+(o+s)+"L"+a+" "+(o+s)+"L"+a+" "+o),e.innerLine.attr({stroke:"#7b7b7b","stroke-dasharray":"-"})},createCenterLine:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.width/2;e.spineLeft=e.paper.path("M"+i+" 0L"+i+" "+e.height),e.spineLeft.attr({stroke:"#7b7b7b","stroke-dasharray":"-"})},createSpineLine:function(){var e=t.pages[t.selectedPageIdx].canvas;if(0!==e.oriSpineWidth){var i=e.oriSpineWidth*e.ratio,r=(e.width-i)/2,a=r+i;e.spineLeft=e.paper.path("M"+r+" 0L"+r+" "+e.height),e.spineLeft.attr({stroke:"#646464","stroke-dasharray":"-"}),e.spineRight=e.paper.path("M"+a+" 0L"+a+" "+e.height),e.spineRight.attr({stroke:"#646464","stroke-dasharray":"-"})}},changeClickDepth:function(e){if(e&&void 0!=e.idx){var i=t.pages[t.selectedPageIdx].canvas;i.selectedIdx=e.idx,this.changeDepthValue({idx:e.idx,targetDepth:i.elements.length-1}),this.freshElementDepth(),i.trans[e.idx].apply(),this.highlightSelection(e.idx)}},sendToBack:function(e){e&&void 0!=e.idx&&this.changeDepthValue({idx:e.idx,targetDepth:0})},changeDepthValue:function(e){if(e&&void 0!=e.idx&&void 0!=e.targetDepth){var i=t.pages[t.selectedPageIdx].canvas,r=i.params[e.idx].dep,a=e.targetDepth;if(a===r)return;if(a>r){for(var o=0;o<i.params.length;o++)i.params[o].dep>r&&i.params[o].dep<=a&&i.params[o].dep--;i.params[e.idx].dep=a}else{for(var o=0;o<i.params.length;o++)i.params[o].dep<r&&i.params[o].dep>=a&&i.params[o].dep++;i.params[e.idx].dep=a}}},freshElementDepth:function(){for(var e=t.pages[t.selectedPageIdx].canvas,i=[],r=0;r<e.elements.length;r++)i.push({idx:r,dep:e.elements[r].dep});for(i.sort(function(e,t){return e.dep-t.dep}),r=1;r<i.length;r++)e.elements[i[r].idx].toFront(),e.warns[i[r].idx]&&e.warns[i[r].idx].el&&e.warns[i[r].idx].el.toFront();this.spineLinesToTop()},freshDepth:function(e){for(var i=t.pages[t.selectedPageIdx].canvas,r=i.params[e].dep,a=0;a<i.params.length;a++)i.params[a].dep>r&&i.params[a].dep--},freshIdx:function(e){for(var i=t.pages[t.selectedPageIdx].canvas,r=0;r<i.elements.length;r++)i.elements[r].idx>e&&(i.elements[r].idx--,i.elements[r].node.id="element-"+(r-1))},spineLinesToTop:function(){var e=t.pages[t.selectedPageIdx].canvas;""!==e.innerLine&&e.innerLine.toFront(),""!==e.spineLeft&&e.spineLeft.toFront(),""!==e.spineRight&&e.spineRight.toFront()},showSpineLines:function(){var e=t.pages[t.selectedPageIdx].canvas;""!==e.outerLine&&e.outerLine.show(),""!==e.innerLine&&e.innerLine.show(),""!==e.spineLeft&&e.spineLeft.show(),""!==e.spineRight&&e.spineRight.show()},hideSpineLines:function(){var e=t.pages[t.selectedPageIdx].canvas;""!==e.outerLine&&e.outerLine.hide(),""!==e.innerLine&&e.innerLine.hide(),""!==e.spineLeft&&e.spineLeft.hide(),""!==e.spineRight&&e.spineRight.hide()},highlightSelection:function(e){var i=t.pages[t.selectedPageIdx].canvas;e?e:e=i.selectedIdx;for(var a=0;a<i.trans.length;a++)i.trans[a].setOpts({draw:!1});if("image"===i.elements[e].elType||"logo"===i.elements[e].elType)var o={drag:["self"],rotate:!1,scale:["bboxCorners"],keepRatio:!0,snap:{rotate:1,scale:1,drag:1},draw:["bbox"],range:{scale:[0,99999]},idx:e};else var o={drag:["self"],rotate:!1,scale:["bboxCorners"],keepRatio:!0,snap:{rotate:0,scale:1,drag:1},draw:["bbox"],range:{scale:[0,99999]},idx:e};i.trans[e].setOpts(o),i.trans[e].apply(),r("rect.handle.bbox.index-0").css("cursor","nw-resize"),r("rect.handle.bbox.index-1").css("cursor","ne-resize"),r("rect.handle.bbox.index-2").css("cursor","se-resize"),r("rect.handle.bbox.index-3").css("cursor","sw-resize")},blurSelection:function(e){var i=t.pages[t.selectedPageIdx].canvas;e?e:e=i.selectedIdx,i.trans[e].setOpts({draw:!1})},getDefaultNewElementPosition:function(e){if(e){e.x=e.x||0,e.y=e.y||0;var i,r,a=t.pages[t.selectedPageIdx].canvas,n=a.width/a.ratio,s=a.height/a.ratio,d=limitedHeight=150/a.ratio,l=e.x/a.ratio,c=e.y/a.ratio,p=t.dragData.imageId,h=o.getImageDetail(p);h?(i=h.width,r=h.height):(i=n/3,r=s/3);var g=i/r,u=d/limitedHeight;if(g>=u)var m=d/i;else var m=limitedHeight/r;i*=m,r*=m;var f=t.dragData.cursorX/a.ratio,v=t.dragData.cursorY/a.ratio;return console.log(f,v),l-=f,c-=v,{x:l,y:c,width:i,height:r}}return{x:0,y:0,width:300,height:300}},initCanvasData:function(){if(t.projectSettings&&t.projectJson){var e=t.projectJson;this.initImageList(e.project),this.initProject(e.project)}},initImageList:function(e){if(e){var r=e.images.length;if(t.imageList=[],r>0){for(var a=0;a<r;a++){var o=e.images[a];delete o.dep,o.usedCount=0,o.previewUrl="",t.imageList.push(o)}for(e.images[0].encImgId||c.getEncImageIds(),a=0;a<r;a++)t.imageList[a].url=t.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+t.imageList[a].encImgId+i(7).getSecurityString()+"&rendersize=fit",i(23).getBlobImagePreviewUrl(a)}}},initProject:function(e){var r=this;if(e){t.projects[0]={},t.projects[0].pages=[];for(var a=0;a<e.pages.length;a++){var n=e.pages[a];t.projects[0].pages.push({type:"Page",name:"",guid:n.id,isDeleted:!1,canvas:{oriWidth:0,oriHeight:0,oriX:0,oriY:0,oriBgWidth:0,oriBgHeight:0,oriSpineWidth:0,realBleedings:{},frameBaseSize:{},frameBorderThickness:{},boardInFrame:{},boardInMatting:{},mattingSize:{},expendSize:{},foreground:{},mirrorSize:{},photoLayer:{},params:[],pageItems:[],centerElements:[]}});var s=t.projects[0].pages[a].canvas;t.projectSettings[t.currentSelectProjectIndex].product&&(s.realBleedings=p.getBleedSize(a),s.frameBaseSize=p.getBaseSize(a),s.photoLayer=p.getPhotoLayer(a),s.foreground=r.getForeground(s.frameBaseSize,s.expendSize,s.photoLayer,a),s.oriWidth=s.photoLayer.width,s.oriHeight=s.photoLayer.height,s.oriBgWidth=s.foreground.width,s.oriBgHeight=s.foreground.height,s.oriX=s.foreground.x,s.oriY=s.foreground.y);for(var d=n.elements.length,l=0;l<d;l++){var c=n.elements[l],h=c.imageid||"",g=o.getImageDetail(h),u="";""!==g?u=t.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+g.encImgId+i(7).getSecurityString()+"&rendersize=fit":u;var m=c.x||0,f=c.y||0,v=c.width||0,S=c.height||0,y=c.px||0,w=c.py||0,x=c.pw||0,I=c.ph||0;m=y*s.photoLayer.width,f=w*s.photoLayer.height,v=x*s.photoLayer.width,S=I*s.photoLayer.height;var b="";"PhotoElement"===c.type?b="image":"TextElement"===c.type&&(b="text"),s.params.push({id:l,elType:b,url:"",isRefresh:!1,text:decodeURIComponent(c.text)||"",x:m,y:f,width:v,height:S,rotate:c.rot,dep:c.dep,imageId:h,imageGuid:g.guid||"",imageWidth:g.width||"",imageHeight:g.height||"",imageRotate:c.imgRot||0,cropPX:Number(c.cropLUX)||0,cropPY:Number(c.cropLUY)||0,cropPW:Number(c.cropRLX-c.cropLUX)||1,cropPH:Number(c.cropRLY-c.cropLUY)||1,fontFamily:decodeURIComponent(c.fontFamily)||"",fontSize:s.oriHeight*c.fontSize||0,fontWeight:c.fontWeight||"",textAlign:c.textAlign||"",fontColor:c.color||"",style:{brightness:c.style&&c.style.brightness?c.style.brightness:0}})}for(s.params.sort(function(e,t){return e.dep-t.dep}),l=0;l<s.params.length;l++)s.params[l].dep=l}}},loadProjectIntoPages:function(e){void 0!=e&&null!=e?e:e=t.currentSelectProjectIndex,t.pages=[];for(var i=t.projects[0],r=0;r<i.pages.length;r++)t.pages.push({type:i.pages[r].type||"",name:"",isDeleted:!1,guid:i.pages[r].guid||"",canvas:{isInited:!1,width:0,height:0,x:0,y:0,bgWidth:0,bgHeight:0,ratio:1,oriWidth:i.pages[r].canvas.oriWidth,oriHeight:i.pages[r].canvas.oriHeight,oriX:i.pages[r].canvas.oriX,oriY:i.pages[r].canvas.oriY,oriBgWidth:i.pages[r].canvas.oriBgWidth,oriBgHeight:i.pages[r].canvas.oriBgHeight,oriSpineWidth:i.pages[r].canvas.oriSpineWidth,bleedings:{},realBleedings:i.pages[r].canvas.realBleedings,frameBaseSize:i.pages[r].canvas.frameBaseSize,frameBorderThickness:i.pages[r].canvas.frameBorderThickness,canvasBordeThickness:i.pages[r].canvas.canvasBordeThickness,boardInFrame:i.pages[r].canvas.boardInFrame,boardInMatting:i.pages[r].canvas.boardInMatting,mattingSize:i.pages[r].canvas.mattingSize,expendSize:i.pages[r].canvas.expendSize,foreground:i.pages[r].canvas.foreground,mirrorSize:i.pages[r].canvas.mirrorSize,photoLayer:i.pages[r].canvas.photoLayer,selectedIdx:0,params:i.pages[r].canvas.params.slice(0),elements:[],outerLine:"",innerLine:"",bleedingRibbonLeft:"",bleedingRibbonRight:"",bleedingRibbonTop:"",bleedingRibbonBottom:"",spineLeft:"",spineRight:"",elementBg:"",pageItems:[],centerElements:[]}}),t.isPreview&&t.selectedPageGuid&&i.pages[r].guid===t.selectedPageGuid&&setTimeout(function(e){t.selectedPageIdx=e,t.currentSelectProjectIndex=e},300,r)},syncProjectData:function(e){void 0!=e&&null!=e?e:e=t.currentSelectProjectIndex;for(var i=0;i<t.pages.length;i++){var r=t.pages[i].canvas;t.projects[e].pages[t.selectedPageIdx].canvas.params=[],t.projects[e].pages[t.selectedPageIdx].canvas.params=r.params.slice(0)}},createProjectData:function(){t.projects.push(t.projects[0])},freshPageData:function(e){var i="undefined"!=typeof e?e:t.currentSelectProjectIndex,r=t.pages[i].canvas,a=this;t.projectSettings[i].product&&(r.realBleedings=p.getBleedSize(i),r.frameBaseSize=p.getBaseSize(i),r.photoLayer=p.getPhotoLayer(i),r.foreground=a.getForeground(r.frameBaseSize,r.expendSize,r.photoLayer,i),r.oriWidth=r.photoLayer.width,r.oriHeight=r.photoLayer.height,r.oriBgWidth=r.foreground.width,r.oriBgHeight=r.foreground.height,r.oriX=r.foreground.x,r.oriY=r.foreground.y)},autoLayout:function(){if(t.autoLayout){for(var e,r=t.pages[t.selectedPageIdx].canvas,a=[],o=0,n=0,s=0,d=0;d<r.params.length;d++){var l=r.params[d];"image"===l.elType&&(a.push(l),l.width>l.height?n++:s++)}o=a.length,e=this.getFitTemplate(o,n,s),e&&(t.imagesIndex=e.imageNum,i(28).getTemplateItemInfo(e.guid,e.designSize),t.projectSettings[t.currentSelectProjectIndex].tplGuid=e.guid,t.projectSettings[t.currentSelectProjectIndex].tplSuitId=e.suitId)}},fixRotatePhotoElement:function(e){for(var r="undefined"!=typeof e?e:t.currentSelectProjectIndex,a=t.pages[r].canvas,o=0;o<a.params.length;o++)if(console.log(a.params[o].width/a.oriWidth,a.params[o].height/a.oriHeight),a.params[o].width/a.oriWidth>.95&&a.params[o].height/a.oriHeight>.95){console.log("in fix");var n=a.params[o].width;if(a.params[o].width=a.params[o].height,a.params[o].height=n,a.params[o].imageId){var s=a.params[o].imageId,d=i(18).getImageDetail(s);if(90===Math.abs(a.params[o].imageRotate))var l=a.params[o].imageHeight,c=a.params[o].imageWidth;else var l=a.params[o].imageWidth,c=a.params[o].imageHeight;var p=i(22).getDefaultCrop(l,c,a.params[o].width,a.params[o].height),h=p.px,g=p.py,u=p.pw,m=p.ph;a.params[o].cropX=d.width*h,a.params[o].cropY=d.height*g,a.params[o].cropW=d.width*u,a.params[o].cropH=d.height*m,a.params[o].cropPX=h,a.params[o].cropPY=g,a.params[o].cropPW=u,a.params[o].cropPH=m}}},fixResizePhotoElement:function(){for(var e=t.pages[t.selectedPageIdx].canvas,r=s.getPhotoLayer(),a=0;a<e.params.length;a++)if(e.params[a].width/e.oriWidth>.95&&e.params[a].height/e.oriHeight>.95&&(e.params[a].width=r.width,e.params[a].height=r.height,e.params[a].imageId)){var o=e.params[a].imageId,n=i(18).getImageDetail(o),d=i(22).getDefaultCrop(e.params[a].imageWidth,e.params[a].imageHeight,e.params[a].width,e.params[a].height),l=d.px,c=d.py,p=d.pw,h=d.ph;e.params[a].cropX=n.width*l,e.params[a].cropY=n.height*c,e.params[a].cropW=n.width*p,e.params[a].cropH=n.height*h,e.params[a].cropPX=l,e.params[a].cropPY=c,e.params[a].cropPW=p,e.params[a].cropPH=h}},getTemplateParams:function(e){var a=[],o=t.pages[t.selectedPageIdx].canvas,n=[],s=[],d=[];console.log("0",o.params);for(var l=0;l<o.params.length;l++)console.log(o.params[l]),"image"===o.params[l].elType&&o.params[l].imageId?o.params[l].width>o.params[l].height?s.push({id:o.params[l].imageId,guid:o.params[l].imageGuid,width:o.params[l].imageWidth,height:o.params[l].imageHeight,rotate:o.params[l].imageRotate}):n.push({id:o.params[l].imageId,guid:o.params[l].imageGuid,width:o.params[l].imageWidth,height:o.params[l].imageHeight,rotate:o.params[l].imageRotate}):"text"===o.params[l].elType&&d.push(o.params[l]);console.log("1",s),console.log("2",n),console.log("3",d);for(var c=[],l=0;l<r(e).find("element").length;l++){var p=r(e).find("element").eq(l),h={};h.px=parseFloat(p.attr("px")),h.py=parseFloat(p.attr("py")),h.pw=parseFloat(p.attr("pw")),h.ph=parseFloat(p.attr("ph")),h.dep=parseFloat(p.attr("dep")),c.push(h)}c.sort(function(e,t){return e.dep-t.dep});for(var l=0;l<c.length;l++){var p=c[l],g=p.px*o.oriWidth,u=p.py*o.oriHeight,m=p.pw*o.oriWidth,f=p.ph*o.oriHeight,v=this.shiftTemplateSuitImage(n,s,m,f),S="",y="",w=0,x=0,I=0;if(v&&(S=v.id,y=v.guid,w=v.width,x=v.height,I=v.rotate),90===Math.abs(I))var b=x,P=w;else var b=w,P=x;console.log("crop",b,P,m,f);var j=i(22).getDefaultCrop(b,P,m,f),C={id:l,elType:"image",url:"",isRefresh:!1,x:g,y:u,width:m,height:f,rotate:0,dep:l,imageId:S,imageGuid:y,imageRotate:I,imageWidth:w,imageHeight:x,cropPX:j.px,cropPY:j.py,cropPW:j.pw,cropPH:j.ph};a.push(C)}if(d.length>0)for(var T=a.length,k=0;k<d.length;k++){var L=d[k];L.id=T,L.dep=T,a.push(L),T++}return console.log(a),a},shiftTemplateSuitImage:function(e,t,i,r){var a=null;return a=i>r?t.shift():e.shift(),"undefined"==typeof a&&(a=i>r?e.shift():t.shift()),"undefined"==typeof a&&(a=null),a},getTemplateBySize:function(e){for(var i=[],r=0;r<t.templateList.length;r++)t.templateList[r].designSize===e&&i.push(t.templateList[r]);return i},getTemplateByGuid:function(e){for(var i=0;i<t.templateList.length;i++)if(t.templateList[i].guid===e)return t.templateList[i]},getFitTemplate:function(e,i,r){var a=t.projectSettings[t.currentSelectProjectIndex].size,o=t.projectSettings[t.currentSelectProjectIndex].rotated,n=[],s=[],d=[];if(o&&(a=a.split("X")[1]+"X"+a.split("X")[0]),n=this.getTemplateBySize(a),n.length>0)for(var l in n)if(n[l].imageNum==e&&n[l].isCoverDefault&&"true"===n[l].isCoverDefault)return n[l];for(var l in n){var c=n[l];e==c.imageNum&&(i==c.horizontalNum?s.push(c):r==c.verticalNum?s.push(c):d.push(c))}if(s.length){if(1===s.length)return s[0];var p=Math.floor(Math.random()*s.length);return s[p]}if(d.length){var p=Math.floor(Math.random()*d.length);return d[p]}},getMattImageSize:function(){for(var e,r="matteSize",a=i(1),o=a.getParameterKeyPatternById(r).split("-"),n=[],s=t.projectSettings[t.currentSelectProjectIndex],d=0,l=o.length;d<l;d++){var c=s[o[d]];if(c){var p={key:o[d],value:c};n.push(p)}}if(e=a.getParameter(r,n),s.rotated)var h=parseFloat(e.rWidth),g=parseFloat(e.rHeight);else var h=parseFloat(e.width),g=parseFloat(e.height);return e?{width:h,height:g}:null},getForegroundVariable:function(e){for(var r,a="undefined"!=typeof e?e:t.currentSelectProjectIndex,o="foreground",n=i(1),s=n.getVariableKeyPatternById(o).split("-"),d=[],l=t.projectSettings[a],c=0,p=s.length;c<p;c++){var h=l[s[c]];if(h){var g={key:s[c],value:h};d.push(g)}}if(r=n.getVariable(o,d),l.rotated)var u=parseFloat(r.rWidth),m=parseFloat(r.rHeight),f=parseFloat(r.rPaddingLeft),v=parseFloat(r.rPaddingRight),S=parseFloat(r.rPaddingTop),y=parseFloat(r.rPaddingBottom);else var u=parseFloat(r.width),m=parseFloat(r.height),f=parseFloat(r.paddingLeft),v=parseFloat(r.paddingRight),S=parseFloat(r.paddingTop),y=parseFloat(r.paddingBottom);return r?{width:u,height:m,left:f,right:v,top:S,bottom:y}:null},getForeground:function(e,t,i,r){var a=this.getForegroundVariable(r);if(a){var o=e.width/(a.width-a.left-a.right),n=o*a.width,s=e.height/(a.height-a.top-a.bottom),d=s*a.height,l=i.x+a.left*o,c=i.y+a.top*s;return{width:n,height:d,x:l,y:c,ratioX:o,ratioY:s,left:a.left*o,top:a.top*s,right:a.right*o,bottom:a.bottom*s}}return{width:e.width,height:e.height,x:i.x,y:i.y,left:0,top:0,right:0,bottom:0}},changeBorderToMirror:function(e,r){var a=t.pages[t.selectedPageIdx].canvas,o=s.getPhotoLayer(),n=s.getCanvasBorderThickness(),d=s.getBleed();if(1===a.params.length&&"image"===a.params[0].elType){var l=n.left+d.left,c=n.top+d.top;if(e)(a.params[0].width==o.width||o.width-a.params[0].width<=2*l||r)&&(a.params[0].width=o.width,a.params[0].x=0),(a.params[0].height==o.height||o.height-a.params[0].height<=2*c||r)&&(a.params[0].height=o.height,a.params[0].y=0);else if((a.params[0].width==o.width||o.width-a.params[0].width<=2*l||r)&&(a.params[0].width=o.width-2*l,a.params[0].x=l),(a.params[0].height==o.height||o.height-a.params[0].height<=2*c||r)&&(a.params[0].height=o.height-2*c,a.params[0].y=c),a.params[0].imageId){if(90===Math.abs(a.params[0].imageRotate))var p=a.params[0].imageHeight,h=a.params[0].imageWidth;else var p=a.params[0].imageWidth,h=a.params[0].imageHeight;if(!t.firstRender){var g=i(22).getDefaultCrop(p,h,a.params[0].width,a.params[0].height),u=g.px,m=g.py,f=g.pw,v=g.ph;a.params[0].cropX=p*u,a.params[0].cropY=h*m,a.params[0].cropW=p*f,a.params[0].cropH=h*v,a.params[0].cropPX=u,a.params[0].cropPY=m,a.params[0].cropPW=f,a.params[0].cropPH=v}t.firstRender=!1}}}}}).call(t,i(2),i(4))},function(e,t,r){(function(t,a){e.exports={getFrameBaseSize:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,a=e.frameStyle,o=e.size,n=r(1).getParameter("frameBaseSize",[{key:"product",value:i},{key:"frameStyle",value:a},{key:"size",value:o}]),s={},d=e.rotated;return d?(s.width=n.heightInInch*r(1).getDPI(),s.height=n.widthInInch*r(1).getDPI()):(s.width=n.widthInInch*r(1).getDPI(),s.height=n.heightInInch*r(1).getDPI()),s},getCanvasBorderThickness:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,a=e.frameStyle,o=e.canvasBorderSize,n=r(1).getParameter("canvasBorderThickness",[{key:"product",value:i},{key:"canvasBorderSize",value:o},{key:"frameStyle",value:a}]),s={},d=e.rotated;return d?(s.top=parseInt(n.left),s.bottom=parseInt(n.right),s.left=parseInt(n.top),s.right=parseInt(n.bottom)):(s.top=parseInt(n.top),s.bottom=parseInt(n.bottom),s.left=parseInt(n.left),s.right=parseInt(n.right)),s},getFrameBorderThickness:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,a=e.frameStyle,o=r(1).getParameter("frameBorderThickness",[{key:"product",value:i},{key:"frameStyle",value:a}]),n={},s=e.rotated;return s?(n.top=parseInt(o.left),n.bottom=parseInt(o.right),n.left=parseInt(o.top),n.right=parseInt(o.bottom)):(n.top=parseInt(o.top),n.bottom=parseInt(o.bottom),n.left=parseInt(o.left),n.right=parseInt(o.right)),n},getBleed:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,a=e.size,o=e.frameStyle,n=r(1).getParameter("bleed",[{key:"product",value:i},{key:"frameStyle",value:o},{key:"size",value:a}]),s={},d=e.rotated;return d?(s.top=parseInt(n.left),s.bottom=parseInt(n.right),s.left=parseInt(n.top),s.right=parseInt(n.bottom)):(s.top=parseInt(n.top),s.bottom=parseInt(n.bottom),s.left=parseInt(n.left),s.right=parseInt(n.right)),s},getBoardInFrame:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,a=e.frameStyle,o=e.size,n=r(1).getParameter("boardInFrame",[{key:"product",value:i},{key:"frameStyle",value:a},{key:"size",value:o}]),s={},d=e.rotated;return d?(s.top=parseInt(n.left),s.bottom=parseInt(n.right),s.left=parseInt(n.top),s.right=parseInt(n.bottom)):(s.top=parseInt(n.top),s.bottom=parseInt(n.bottom),s.left=parseInt(n.left),s.right=parseInt(n.right)),s},getBoardInMatting:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.product,a=e.size,o=e.matte,n=e.frameStyle,s=r(1).getParameter("boardInMatting",[{key:"product",value:i},{key:"frameStyle",value:n},{key:"size",value:a},{key:"matte",value:o}]),d={},l=e.rotated;return l?(d.top=parseInt(s.left),d.bottom=parseInt(s.right),d.left=parseInt(s.top),d.right=parseInt(s.bottom)):(d.top=parseInt(s.top),d.bottom=parseInt(s.bottom),d.left=parseInt(s.left),d.right=parseInt(s.right)),d},getMatteSize:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.size,a=e.matte,o=e.product,n=e.frameStyle,s=r(1).getParameter("matteSize",[{key:"product",value:o},{key:"frameStyle",value:n},{key:"size",value:i},{key:"matte",value:a}]),d={},l=e.rotated;return l?(d.top=parseInt(s.left),d.bottom=parseInt(s.right),d.left=parseInt(s.top),d.right=parseInt(s.bottom)):(d.top=parseInt(s.top),d.bottom=parseInt(s.bottom),d.left=parseInt(s.left),d.right=parseInt(s.right)),d},getMatteStyleColor:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.matteStyle,a=r(1).getParameter("matteStyleColor",[{key:"matteStyle",value:i}]);return a&&"0"===a.color?0:16777215},getInitProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getBaseInfoXml()),i=this.getOptionXml(),o=this.getFrameBoardXml(),n=this.getMatteLayerXml(),s=this.getPhotoLayerXml(),d=this.getIntiElementXml(),l=this.getImagesXml();return a(e).find("photoFrame").append(i.firstChild.cloneNode(!0)),a(o).find("frameBoard").append(n.firstChild.cloneNode(!0)),a(s).find("photosLayer").append(d.firstChild.cloneNode(!0)),a(o).find("frameBoard").append(s.firstChild.cloneNode(!0)),a(e).find("photoFrame").append(o.firstChild.cloneNode(!0)),a(e).find("project").append(l.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getCurrentProjectXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=this.getBaseInfoXml(),o=this.getOptionXml(),n=this.getFrameBoardXml(),s=this.getMatteLayerXml(),d=this.getPhotoLayerXml(),l=this.getElementsXml(),c=this.getImagesXml();return a(i).find("photoFrame").append(o.firstChild.cloneNode(!0)),"none"!==e.matte&&a(n).find("frameBoard").append(s.firstChild.cloneNode(!0)),a(d).find("photosLayer").append(l.firstChild.cloneNode(!0)),a(n).find("frameBoard").append(d.firstChild.cloneNode(!0)),a(i).find("photoFrame").append(n.firstChild.cloneNode(!0)),a(i).find("project").append(c.firstChild.cloneNode(!0)),r(3).xmlToString(i)},getOptionXml:function(e){e||(e=t.currentSelectProjectIndex);for(var i=t.projectSettings[e],a='<spec version="'+r(1).getVersion()+'">',o=r(1).getOptionIds(),n=0;n<o.length;n++)a+='<option id="'+o[n]+'" value="'+i[o[n]]+'"/>';return a+="</spec>",r(3).stringToXml(a)},getElementsXml:function(e){e||(e=t.currentSelectProjectIndex);for(var i=(t.projectSettings[e],t.pages[e].canvas),a=i.params,o="<elements>",n=0;n<a.length;n++){var s=a[n].x,d=a[n].y,l=a[n].width,c=a[n].height,p=s/i.oriWidth,h=d/i.oriHeight,g=c/i.oriHeight,u=l/i.oriWidth,m=a[n].rotate,f=a[n].dep,v=a[n].imageId,S=a[n].imageRotate,y=!1,w=parseFloat(a[n].cropPX),x=parseFloat(a[n].cropPY),I=parseFloat(a[n].cropPW),b=parseFloat(a[n].cropPH);console.log(a[n]),"text"===a[n].elType?o+='<element type="TextElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+u+'" ph="'+g+'" rot="'+m+'" dep="'+f+'" color="'+a[n].fontColor+'" fontSize="'+parseFloat(a[n].fontSize)/i.oriHeight+'" fontFamily="'+encodeURIComponent(a[n].fontFamily)+'" fontWeight="'+a[n].fontWeight+'" textAlign="'+a[n].textAlign+'" ><![CDATA['+encodeURIComponent(a[n].text)+"]]></element>":"logo"===a[n].elType?o+='<element type="LogoElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+u+'" ph="'+g+'" rot="'+m+'" dep="'+f+'" imageid="'+v+'" imgRot="'+S+'" imgFlip="'+y+'" cropLUX="'+w.toString()+'" cropLUY="'+x.toString()+'" cropRLX="'+(w+I)+'" cropRLY="'+(x+b).toString()+'" />':"image"===a[n].elType&&(o+='<element type="PhotoElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+u+'" ph="'+g+'" rot="'+m+'" dep="'+f+'" imageid="'+v+'" imgRot="'+S+'" imgFlip="'+y+'" cropLUX="'+w.toString()+'" cropLUY="'+x.toString()+'" cropRLX="'+(w+I)+'" cropRLY="'+(x+b).toString()+'" />')}return o+="</elements>",r(3).stringToXml(o)},getIntiElementXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhotoLayer()),i=(e.width,e.height,"<elements></elements>");return r(3).stringToXml(i)},getBaseInfoXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],'<project schemaVersion="2.0" clientId="web-h5"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description></description><createdDate></createdDate><updatedDate></updatedDate><uiSetting><templateStrip><showTemplatePanel>false</showTemplatePanel><autoLayout>false</autoLayout></templateStrip></uiSetting><photoFrame></photoFrame></project>");return r(3).stringToXml(e)},getFrameBoardXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.rotated,a=this.getFrameBaseSize(),o=this.getFrameBorderThickness(),n=o.top,s=o.bottom,d=o.left,l=o.right,c=this.getCanvasBorderThickness(),p=c.top,h=c.bottom,g=c.left,u=c.right,m=this.getBoardInFrame(),f=m.top,v=m.bottom,S=m.left,y=m.right,w=this.getBoardInMatting(),x=w.top,I=w.bottom,b=w.left,P=w.right,j=a.width+g+u,C=a.height+p+h,T=t.bgColor+"";isNaN(T)&&(T="0");var k='<frameBoard rotated="'+i+'" height="'+C+'" width="'+j+'" frameBorderThicknessTop="'+n+'" frameBorderThicknessBottom="'+s+'" frameBorderThicknessLeft="'+d+'" frameBorderThicknessRight="'+l+'" canvasBorderThicknessTop="'+p+'" canvasBorderThicknessBottom="'+h+'" canvasBorderThicknessLeft="'+g+'" canvasBorderThicknessRight="'+u+'" boardInFrameTop="'+f+'" boardInFrameBottom="'+v+'" boardInFrameLeft="'+S+'" boardInFrameRight="'+y+'" boardInMattingTop="'+x+'" boardInMattingBottom="'+I+'" boardInMattingLeft="'+b+'" boardInMattingRight="'+P+'" canvasBorderColor="'+T+'"></frameBoard>';return r(3).stringToXml(k)},getMatteLayerXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.matte,a=this.getMatteStyleColor(),o=this.getMatteSize(),n=o.top,s=o.bottom,d=o.left,l=o.right,c='<matteLayer id="'+i+'" x="0" y="0" px="0" py="0" matteTop="'+n+'" matteBottom="'+s+'" matteLeft="'+d+'" matteRight="'+l+'" depth="1" color="'+a+'"/>';return r(3).stringToXml(c)},getPhotoLayerXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=this.getPhotoLayer(),a=this.getBleed(),o=a.top,n=a.bottom,s=a.left,d=a.right,l=i.x,c=i.y,p=i.px,h=i.py,g=i.pw,u=i.ph,m=i.width,f=i.height;console.log("color",t.bgColor);var v=e.tplGuid,S=e.tplSuitId,y="";return y=v&&S?'<photosLayer x="'+l+'" y="'+c+'" width="'+m+'" height="'+f+'" px="'+p+'" py="'+h+'" pw="'+g+'" ph="'+u+'" bleedTop="'+o+'" bleedBottom="'+n+'" bleedLeft="'+s+'" bleedRight="'+d+'" tplGuid="'+v+'" tplSuitId="'+S+'"></photosLayer>':'<photosLayer x="'+l+'" y="'+c+'" width="'+m+'" height="'+f+'" px="'+p+'" py="'+h+'" pw="'+g+'" ph="'+u+'" bleedTop="'+o+'" bleedBottom="'+n+'" bleedLeft="'+s+'" bleedRight="'+d+'"></photosLayer>',r(3).stringToXml(y)},getImagesXml:function(){var e="<images>";for(i=0;i<t.imageList.length;i++){var a=isNaN(t.imageList[i].orientation)?"":'orientation="'+t.imageList[i].orientation+'" ';e+='<image id="'+t.imageList[i].id+'" guid="'+t.imageList[i].guid+'" encImgId="'+t.imageList[i].encImgId+'" order="'+i+'" name="'+encodeURIComponent(t.imageList[i].name)+'" width="'+t.imageList[i].width+'" height="'+t.imageList[i].height+'" shotTime="'+t.imageList[i].shotTime+'" '+a+"/>"}return e+="</images>",r(3).stringToXml(e)},getPhotoLayer:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i={},a=(e.rotated,this.getFrameBaseSize()),o=this.getFrameBorderThickness(),n=(o.top,o.bottom,o.left,o.right,this.getCanvasBorderThickness()),s=n.top,d=n.bottom,l=n.left,c=n.right,p=this.getBoardInFrame(),h=(p.top,p.bottom,p.left,p.right,this.getBoardInMatting()),g=h.top,u=h.bottom,m=h.left,f=h.right,v=this.getBleed(),S=v.top,y=v.bottom,w=v.left,x=v.right,e=t.projectSettings[t.currentSelectProjectIndex],I=e.product,b=e.size,P=e.matte,I=e.product,j=e.frameStyle,C=r(1).getParameter("matteSize",[{
key:"product",value:I},{key:"frameStyle",value:j},{key:"size",value:b},{key:"matte",value:P}]),T=parseInt(C.top),k=parseInt(C.bottom),L=parseInt(C.left),D=parseInt(C.right),B=r(1).getParameter("floatBgSize",[{key:"product",value:I},{key:"size",value:b}]),R=B?parseInt(B.top):0,F=B?parseInt(B.left):0,U=B?parseInt(B.right):0,z=B?parseInt(B.bottom):0,M=a.width+l+c,H=a.height+s+d,O=0,E=0,A=0,N=0;e.rotated?(O=k-y-u+z,E=L-w-m+F,A=M+S+y-T-k+g+u-R-z,N=H+w+x-L-D+m+f-F-U):(O=L-w-m+F,E=T-S-g+R,A=M+w+x-L-D+m+f-F-U,N=H+S+y-T-k+g+u-R-z);var W=O/M,X=E/H,$=A/M,q=N/H;return i.x=O,i.y=E,i.width=A,i.height=N,i.px=W,i.py=X,i.pw=$,i.ph=q,i},getFrameBorderAsset:function(){var e=t.projectSettings[t.currentSelectProjectIndex];return r(1).getVariable("frameBorderAsset",[{key:"product",value:e.product},{key:"color",value:e.color}])},isSupportMatte:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=r(1).getVariable("availableOperation",[{key:"product",value:e.product},{key:"frameStyle",value:e.frameStyle}]);return"true"===i.supportMatte},isSupportGlass:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=r(1).getVariable("availableOperation",[{key:"product",value:e.product},{key:"frameStyle",value:e.frameStyle}]);return"true"===i.supportGlassStyle},getBaseSize:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=i.product,o=i.size,n=r(1).getParameter("baseSize",[{key:"product",value:a},{key:"size",value:o}]),s={},d=i.rotated;return d?(s.width=n.heightInInch*r(1).getDPI(),s.height=n.widthInInch*r(1).getDPI()):(s.width=n.widthInInch*r(1).getDPI(),s.height=n.heightInInch*r(1).getDPI()),s},getPageBleed:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=i.product,o=i.size,n=r(1).getParameter("pageBleed",[{key:"product",value:a},{key:"size",value:o}]),s={},d=i.rotated;return d?(s.top=parseInt(n.left),s.bottom=parseInt(n.right),s.left=parseInt(n.top),s.right=parseInt(n.bottom)):(s.top=parseInt(n.top),s.bottom=parseInt(n.bottom),s.left=parseInt(n.left),s.right=parseInt(n.right)),s},getProuctCode:function(){for(var e=t.projectSettings.length,i="|",r=0;r<e;r++){var a=t.projectSettings[r].product;i.indexOf("|"+a+"|")<0&&(i+=a+"|")}return i.substring(1,i.length-1)},getPosterBaseInfoXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=(e.product,'<project schemaVersion="3.0" createAuthor="web-h5|1.0|1" clientId="web-h5" productCode="'+this.getProuctCode()+'" categoryCode="'+t.category+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><products></products></project>");return r(3).stringToXml(i)},getPosterInitProjectXml:function(){var e=this.getPosterBaseInfoXml(),t=this.getInitPosterXml(),i=this.getImagesXml();return a(e).find("products").append(t.firstChild.cloneNode(!0)),a(e).find("project").append(i.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getInitPosterXml:function(){for(var e="",i=t.projectSettings.length,a=0;a<i;a++){var o=t.projectSettings[a];e+='<product type="'+o.product+'">';var n=this.getOptionXml(a);e+=r(3).xmlToString(n),e+="<productSetting/>",e+="<contents>";var s=this.getInitPosterContentXml();e+=r(3).xmlToString(s),e+="</contents>",e+="</product>"}return r(3).stringToXml(e)},getInitPosterContentXml:function(){var e=t.projectSettings[0],i=this.getContent(0),a=e.rotated,o="null",n="null",s='<content width="'+i.width+'" height="'+i.height+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="front"  tplGuid="'+o+'" tplSuitId="'+n+'" rotated="'+a+'">';return s+="<elememts>",s+='<element type="PhotoElement" x="0" y="0" width="'+i.width+'" height="'+i.height+'" px="0" py="0" pw="1" ph="1" rot="0" dep="0" imageid="" imgRot="0" imgFlip="false" cropLUX="0" cropLUY="0" cropRLX="1" cropRLY="1" />',s+="</elememts>",s+="</content>",r(3).stringToXml(s)},getPosterCurrentProjectXml:function(){var e=this.getPosterBaseInfoXml(),t=this.getProductXml(),i=this.getImagesXml();return a(e).find("products").append(t.firstChild.cloneNode(!0)),a(e).find("project").append(i.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getContent:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],r={},a=(i.rotated,this.getBaseSize()),o=a.width,n=a.height,s=this.getPageBleed(),d=s.top,l=s.bottom,c=s.left,p=s.right,h=o+c+p,g=n+d+l,r={};return r.width=h,r.height=g,r.bleedTop=d,r.bleedBottom=l,r.bleedLeft=c,r.bleedRight=p,r},getProductXml:function(){for(var e="",i=t.projectSettings.length,a=0;a<i;a++){var o=t.projectSettings[a];e+='<product type="'+o.product+'">';var n=this.getOptionXml(a);e+=r(3).xmlToString(n),e+="<productSetting/>",e+="<contents>";var s=this.getContentXml(a);e+=r(3).xmlToString(s),e+="</contents>",e+="</product>"}return r(3).stringToXml(e)},getInitProductXml:function(){for(var e="",i=t.projectSettings.length,a=0;a<i;a++){var o=t.projectSettings[a];e+='<product type="'+o.product+'">';var n=this.getOptionXml(a);e+=r(3).xmlToString(n),e+="<productSetting/>",e+="<contents>";var s=this.getInitContentXml();e+=r(3).xmlToString(s),e+="</contents>",e+="</product>"}return r(3).stringToXml(e)},getContentXml:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=this.getContent(e),o=i.rotated,n=i.tplGuid,s=i.tplSuitId,d='<content width="'+a.width+'" height="'+a.height+'" bleedTop="'+a.bleedTop+'" bleedBottom="'+a.bleedBottom+'" bleedLeft="'+a.bleedLeft+'" bleedRight="'+a.bleedRight+'" type="front"  tplGuid="'+n+'" tplSuitId="'+s+'" rotated="'+o+'">',l=this.getElementsXml(e);return d+=r(3).xmlToString(l),d+="</content>",r(3).stringToXml(d)},getInitContentXml:function(){var e=t.projectSettings[0],i=this.getContent(0),a=e.rotated,o="null",n="null",s='<content width="'+i.width+'" height="'+i.height+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="front"  tplGuid="'+o+'" tplSuitId="'+n+'" rotated="'+a+'">';return s+="<elememts>",s+="</elememts>",s+="</content>",r(3).stringToXml(s)},getPhonecaseBaseSize:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=i.product,o=i.deviceType,n=r(1).getDPI(),s=r(1).getParameter("baseSizeInInch",[{key:"product",value:a},{key:"deviceType",value:o}]),d={};return d.width=s.width*n,d.height=s.height*n,d},getPhonecaseSide:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=i.product,o=i.deviceType,n=r(1).getDPI(),s=r(1).getParameter("sideInInch",[{key:"product",value:a},{key:"deviceType",value:o}]),d={};return d.top=s.top*n,d.bottom=s.bottom*n,d.left=s.left*n,d.right=s.right*n,d},getPhonecaseEdge:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=i.product,o=i.deviceType,n=r(1).getDPI(),s=r(1).getParameter("edgeInInch",[{key:"product",value:a},{key:"deviceType",value:o}]),d={};return d.top=s.top*n,d.bottom=s.bottom*n,d.left=s.left*n,d.right=s.right*n,d},getPhonecaseBleed:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=i.product,o=i.deviceType,n=r(1).getDPI(),s=r(1).getParameter("bleedInInch",[{key:"product",value:a},{key:"deviceType",value:o}]),d={};return d.top=s.top*n,d.bottom=s.bottom*n,d.left=s.left*n,d.right=s.right*n,d},getPhonecaseForeground:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=i.product,o=i.deviceType,n=r(1).getVariable("foreground",[{key:"product",value:a},{key:"deviceType",value:o}]),s={};return s.width=n.width,s.height=n.height,s.top=n.paddingTop,s.right=n.paddingRight,s.left=n.paddingLeft,s.bottom=n.paddingBottom,s},getPhonecaseBaseInfoXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=(e.product,'<project schemaVersion="2.0" createAuthor="web-h5|1.0|1" clientId="web-h5" product="'+t.product+'" productType="'+t.projectType+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><endpointToken></endpointToken><phoneCase></phoneCase></project>");return r(3).stringToXml(i)},getPhonecasePhotoLayerXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhonecasePhotoLayer()),i=this.getPhonecaseBleed(),a=i.top,o=i.bottom,n=i.left,s=i.right,d=e.x,l=e.y,c=e.px,p=e.py,h=e.pw,g=e.ph,u=e.width,m=e.height;console.log("color",t.bgColor);var f='<photosLayer x="'+d+'" y="'+l+'" width="'+u+'" height="'+m+'" px="'+c+'" py="'+p+'" pw="'+h+'" ph="'+g+'" bleedTop="'+a+'" bleedBottom="'+o+'" bleedLeft="'+n+'" bleedRight="'+s+'"></photosLayer>';return r(3).stringToXml(f)},getPhonecasePhotoLayer:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],{}),i=this.getPhonecaseBaseSize(),r=i.width,a=i.height,o=this.getPhonecaseSide(),n=o.top,s=o.bottom,d=o.left,l=o.right,c=this.getPhonecaseEdge(),p=c.top,h=c.bottom,g=c.left,u=c.right,m=this.getPhonecaseBleed(),f=m.top,v=m.bottom,S=m.left,y=m.right,w=0,x=0,I=0,b=0;w=-(d+g+S),x=-(n+p+f),I=r+d+l+g+u+S+y,b=a+n+s+p+h+f+v;var P=w/r,j=x/a,C=I/r,T=b/a;return e.x=w,e.y=x,e.width=I,e.height=b,e.px=P,e.py=j,e.pw=C,e.ph=T,e},getPhonecaseInitProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhonecaseBaseInfoXml()),i=this.getOptionXml(),o=this.getFaceXml(),n=this.getPhonecasePhotoLayerXml(),s=this.getPhonecaseInitElemntsXml(),d=this.getImagesXml();return a(e).find("phoneCase").append(i.firstChild.cloneNode(!0)),a(e).find("phoneCase").append(o.firstChild.cloneNode(!0)),a(e).find("face").append(n.firstChild.cloneNode(!0)),a(e).find("photosLayer").append(s.firstChild.cloneNode(!0)),a(e).find("project").append(d.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getPhonecaseCurrentProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhonecaseBaseInfoXml()),i=this.getOptionXml(),o=this.getFaceXml(),n=this.getPhonecasePhotoLayerXml(),s=this.getElementsXml(),d=this.getImagesXml();return a(e).find("phoneCase").append(i.firstChild.cloneNode(!0)),a(e).find("phoneCase").append(o.firstChild.cloneNode(!0)),a(e).find("face").append(n.firstChild.cloneNode(!0)),a(e).find("photosLayer").append(s.firstChild.cloneNode(!0)),a(e).find("project").append(d.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getPhonecaseInitElemntsXml:function(){var e=this.getPhonecasePhotoLayer(),t="<elements>",i=0,a=0,o=e.width,n=e.height,s=i/e.width,d=a/e.height,l=n/e.height,c=o/e.width,p=0,h=0,g="",u=!1,m=!1,f=0,v=0,S=1,y=1;return t+='<element type="PhotoElement" x="'+i+'" y="'+a+'" width="'+o+'" height="'+n+'" px="'+s+'" py="'+d+'" pw="'+c+'" ph="'+l+'" rot="'+p+'" dep="'+h+'" imageid="'+g+'" imgRot="'+u+'" imgFlip="'+m+'" cropLUX="'+f+'" cropLUY="'+v+'" cropRLX="'+(f+S)+'" cropRLY="'+(v+y)+'" />',t+="</elements>",r(3).stringToXml(t)},getFaceXml:function(){for(var e=this.getPhonecaseBaseSize(),i=e.width,a=e.height,o=this.getPhonecaseSide(),n=o.top,s=o.bottom,d=o.left,l=o.right,c=this.getPhonecaseEdge(),p=c.top,h=c.bottom,g=c.left,u=c.right,m="",f=t.projectSettings.length,v=0;v<f;v++){t.projectSettings[v];m+='<face width="'+i+'" height="'+a+'" sideLeft="'+d+'" sideTop="'+n+'" sideRight="'+l+'" sideBottom="'+s+'" edgeLeft="'+g+'" edgeTop="'+p+'" edgeRight="'+u+'" edgeBottom="'+h+'">',m+="</face>"}return r(3).stringToXml(m)},getPhonecaseContent:function(e){e||(e=t.currentSelectProjectIndex);var i=(t.projectSettings[e],{}),r=this.getPhonecaseBaseSize(),a=r.width,o=r.height,n=this.getPhonecaseSide(),s=n.top,d=n.bottom,l=n.left,c=n.right,p=this.getPhonecaseEdge(),h=p.top,g=p.bottom,u=p.left,m=p.right,f=this.getPhonecaseBleed(),v=f.top,S=f.bottom,y=f.left,w=f.right,x=this.getPhonecaseForeground(),I=a+y+w+u+m+l+c,b=o+v+S+h+g+s+d,P=x.width-x.left-x.right,j=(x.height-x.top-x.bottom,a/P),C=x.width*j,T=x.height*j;return i.bgWidth=C,i.bgHeight=T,i.width=I,i.height=b,i.x=x.left*j-y-l-u,i.y=x.top*j-v-s-h,i.bleedTop=v,i.bleedBottom=S,i.bleedLeft=y,i.bleedRight=w,i.sideTop=s,i.sideBottom=d,i.sideLeft=l,i.sideRight=c,i.edgeTop=h,i.edgeBottom=g,i.edgeLeft=u,i.edgeRight=m,i},getWallArtsInitProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getBaseInfoXml()),i=this.getOptionXml(),o=this.getFrameBoardXml(),n=this.getMatteLayerXml(),s=this.getPhotoLayerXml(),d=this.getWallArtsIntiElementXml(),l=this.getImagesXml();return a(e).find("photoFrame").append(i.firstChild.cloneNode(!0)),a(o).find("frameBoard").append(n.firstChild.cloneNode(!0)),a(s).find("photosLayer").append(d.firstChild.cloneNode(!0)),a(o).find("frameBoard").append(s.firstChild.cloneNode(!0)),a(e).find("photoFrame").append(o.firstChild.cloneNode(!0)),a(e).find("project").append(l.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getWallArtsIntiElementXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPhotoLayer()),i=e.width,a=e.height,o='<elements><element type="PhotoElement" x="0" y="0" width="'+i+'" height="'+a+'" px="0" py="0" pw="1" ph="1" rot="0" dep="0" imageid="" imgRot="0" imgFlip="false" cropLUX="0" cropLUY="0" cropRLX="1" cropRLY="1" /></elements>';return r(3).stringToXml(o)},getPrintInitProjectXml:function(){return r(3).xmlToString(this.getPrintInitXml())},getPrintInitXml:function(){var e='<project schemaVersion="1" createAuthor="web-h5|1.0|1" clientId="web-h5" product="'+t.baseProject.product+'" productType="'+t.projectType+'" baseSize="'+t.baseProject.size+'" basePaper="'+t.baseProject.paper+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><endpointToken></endpointToken><prints></prints><images></images></project>";return r(3).stringToXml(e)},getPrintBaseProjectXml:function(){var e='<project schemaVersion="1" createAuthor="web-h5|1.0|1" clientId="web-h5" product="'+t.baseProject.product+'" productType="'+t.projectType+'" baseSize="'+t.baseProject.size+'" basePaper="'+t.baseProject.paper+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><endpointToken></endpointToken></project>";return r(3).stringToXml(e)},getPrintProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPrintBaseProjectXml()),i=this.getPrintContentXml(),o=this.getImagesXml();return a(e).find("project").append(i.firstChild.cloneNode(!0)),a(e).find("project").append(o.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getPrintContentXml:function(){var e=t.projectSettings,i=t.pages,a="";a+="<prints>";for(var o=0;o<i.length;o++){var n=i[o].canvas,s=n.params,d=e[o];a+='<print id="'+r(6).guid()+'" quantity="'+d.quantity+'" imageId="'+s[0].imageId+'">',a+='<spec version="'+r(1).getVersion()+'">',a+='<option id="paper" value="'+d.paper+'"/>',a+='<option id="size" value="'+d.size+'"/>',"undefined"!=typeof d.surfaceType&&"undefined"!==d.surfaceType&&(a+='<option id="surfaceType" value="'+d.surfaceType+'"/>'),a+="</spec>";var l=this.getPrintBaseSize({size:d.size,rotated:d.rotated}),c=this.getPrintBleed(d.size),p=i[o].canvas.borderLength?i[o].canvas.borderLength:0,h=i[o].canvas.borderColor?i[o].canvas.borderColor:"none";a+='<content id="'+r(6).guid()+'" width="'+l.width+'" height="'+l.height+'" bleedTop="'+c.top+'" bleedBottom="'+c.bottom+'" bleedLeft="'+c.left+'" bleedRight="'+c.right+'" borderLength="'+p+'" borderColor="'+h+'">',a+="<elements>";var g=s[0].x,u=s[0].y,m=s[0].width,f=s[0].height,v=g/n.oriWidth,S=u/n.oriHeight,y=f/n.oriHeight,w=m/n.oriWidth,x=s[0].rotate,I=s[0].dep,b=s[0].imageId,P=s[0].imageRotate,j=!1,C=s[0].cropPX,T=s[0].cropPY,k=s[0].cropPW,L=s[0].cropPH;"text"===s[0].elType?a+='<element type="TextElement" x="'+g+'" y="'+u+'" width="'+m+'" height="'+f+'" px="'+v+'" py="'+S+'" pw="'+w+'" ph="'+y+'" rot="'+x+'" dep="'+I+'" color="'+s[0].fontColor+'" fontSize="'+parseFloat(s[0].fontSize)/n.oriHeight+'" fontFamily="'+encodeURIComponent(s[0].fontFamily)+'" fontWeight="'+s[0].fontWeight+'" textAlign="'+s[0].textAlign+'" ><![CDATA['+encodeURIComponent(s[0].text)+"]]></element>":"logo"===s[0].elType?a+='<element type="LogoElement" x="'+g+'" y="'+u+'" width="'+m+'" height="'+f+'" px="'+v+'" py="'+S+'" pw="'+w+'" ph="'+y+'" rot="'+x+'" dep="'+I+'" imageid="'+b+'" imgRot="'+P+'" imgFlip="'+j+'" cropLUX="'+C+'" cropLUY="'+T+'" cropRLX="'+(C+k)+'" cropRLY="'+(T+L)+'" />':"image"===s[0].elType&&(a+='<element type="PhotoElement" x="'+g+'" y="'+u+'" width="'+m+'" height="'+f+'" px="'+v+'" py="'+S+'" pw="'+w+'" ph="'+y+'" rot="'+x+'" dep="'+I+'" imageid="'+b+'" imgRot="'+P+'" imgFlip="'+j+'" cropLUX="'+C+'" cropLUY="'+T+'" cropRLX="'+(C+k)+'" cropRLY="'+(T+L)+'" />'),a+="</elements>",a+="</content>",a+="</print>"}return a+="</prints>",r(3).stringToXml(a)},getRemarkProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPrintBaseProjectXml()),i=this.getRemarkContentXml(),o=this.getImagesXml();return a(e).find("project").append(i.firstChild.cloneNode(!0)),a(e).find("project").append(o.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getRemarkContentXml:function(){for(var e=t.projectSettings,i=t.pages,a=[],o=0;o<e.length;o++)t.selectedSize?t.selectedPaper?e[o].size===t.selectedSize&&e[o].paper===t.selectedPaper&&(a.push(i[o]),a[a.length-1].oid=o):e[o].size===t.selectedSize&&(a.push(i[o]),a[a.length-1].oid=o):t.selectedPaper&&e[o].paper===t.selectedPaper&&(a.push(i[o]),a[a.length-1].oid=o);if(0===a.length){a=i;for(var o=0;o<a.length;o++)a[o].oid=o}var n="";n+="<prints>";for(var o=0;o<a.length;o++){var s=a[o].canvas,d=s.params,l=e[a[o].oid];n+='<print id="'+a[o].guid+'" quantity="'+l.quantity+'" imageId="'+d[0].imageId+'">',n+='<spec version="'+r(1).getVersion()+'">',n+='<option id="paper" value="'+l.paper+'"/>',n+='<option id="size" value="'+l.size+'"/>',"undefined"!=typeof l.surfaceType&&"undefined"!==l.surfaceType&&(n+='<option id="surfaceType" value="'+l.surfaceType+'"/>'),n+="</spec>";var c=this.getPrintBaseSize({size:l.size,rotated:l.rotated}),p=this.getPrintBleed(l.size),h=i[o].canvas.borderLength?i[o].canvas.borderLength:0,g=i[o].canvas.borderColor?i[o].canvas.borderColor:"none";n+='<content id="'+s.guid+'" width="'+c.width+'" height="'+c.height+'" bleedTop="'+p.top+'" bleedBottom="'+p.bottom+'" bleedLeft="'+p.left+'" bleedRight="'+p.right+'" borderLength="'+h+'" borderColor="'+g+'">',n+="<elements>";var u=d[0].x,m=d[0].y,f=d[0].width,v=d[0].height,S=u/s.oriWidth,y=m/s.oriHeight,w=v/s.oriHeight,x=f/s.oriWidth,I=d[0].rotate,b=d[0].dep,P=d[0].imageId,j=d[0].imageRotate,C=!1,T=d[0].cropPX,k=d[0].cropPY,L=d[0].cropPW,D=d[0].cropPH;"text"===d[0].elType?n+='<element type="TextElement" x="'+u+'" y="'+m+'" width="'+f+'" height="'+v+'" px="'+S+'" py="'+y+'" pw="'+x+'" ph="'+w+'" rot="'+I+'" dep="'+b+'" color="'+d[0].fontColor+'" fontSize="'+parseFloat(d[0].fontSize)/s.oriHeight+'" fontFamily="'+encodeURIComponent(d[0].fontFamily)+'" fontWeight="'+d[0].fontWeight+'" textAlign="'+d[0].textAlign+'" ><![CDATA['+encodeURIComponent(d[0].text)+"]]></element>":"logo"===d[0].elType?n+='<element type="LogoElement" x="'+u+'" y="'+m+'" width="'+f+'" height="'+v+'" px="'+S+'" py="'+y+'" pw="'+x+'" ph="'+w+'" rot="'+I+'" dep="'+b+'" imageid="'+P+'" imgRot="'+j+'" imgFlip="'+C+'" cropLUX="'+T+'" cropLUY="'+k+'" cropRLX="'+(T+L)+'" cropRLY="'+(k+D)+'" />':"image"===d[0].elType&&(n+='<element type="PhotoElement" x="'+u+'" y="'+m+'" width="'+f+'" height="'+v+'" px="'+S+'" py="'+y+'" pw="'+x+'" ph="'+w+'" rot="'+I+'" dep="'+b+'" imageid="'+P+'" imgRot="'+j+'" imgFlip="'+C+'" cropLUX="'+T+'" cropLUY="'+k+'" cropRLX="'+(T+L)+'" cropRLY="'+(k+D)+'" />'),n+="</elements>",n+="</content>",n+="</print>"}return n+="</prints>",r(3).stringToXml(n)},getPrintBaseSize:function(e){var i,a;i=e.size?e.size:t.baseProject.size,a=!!e.rotated&&e.rotated;var o=r(1).getParameter("printsBaseSize",[{key:"product",value:"print"},{key:"size",value:i}]),n={};return a?(n.width=o.heightInInch*r(1).getDPI(),n.height=o.widthInInch*r(1).getDPI()):(n.width=o.widthInInch*r(1).getDPI(),n.height=o.heightInInch*r(1).getDPI()),n},getPrintBleed:function(e){e||(e=t.baseProject.size);var i=r(1).getParameter("bleed",[{key:"size",value:e}]),a={};return a.top=parseInt(i.left),a.bottom=parseInt(i.right),a.left=parseInt(i.top),a.right=parseInt(i.bottom),a},getCardSpread:function(e){e||(e=t.currentSelectProjectIndex);var i=(t.projectSettings[e],{}),r=this.getCardBaseSize(),a=r.width,o=r.height,n=this.getPageBleed(),s=n.top,d=n.bottom,l=n.left,c=n.right,p=a+l+c,h=o+s+d,i={};return i.width=p,i.height=h,i.bleedTop=s,i.bleedBottom=d,i.bleedLeft=l,i.bleedRight=c,i},getCardBaseSize:function(e){e||(e=t.currentSelectProjectIndex);var i=t.projectSettings[e],a=i.product,o=i.size,n=i.format,s=i.orientation,d=r(1).getParameter("baseSize",[{key:"product",value:a},{key:"size",value:o},{key:"orientation",value:s},{key:"format",value:n}]),l={};return l.width=d.widthInInch*r(1).getDPI(),l.height=d.heightInInch*r(1).getDPI(),l},getCardCurrentProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getCardsBaseProjectXml()),i=this.getCardsContentXml(),o=this.getImagesXml(),n=this.getDecorationXml();return a(e).find("project").append(i.firstChild.cloneNode(!0)),a(e).find("project").append(o.firstChild.cloneNode(!0)),a(e).find("project").append(n.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getCardsBaseProjectXml:function(){t.isPortal&&(t.deletedPhoto="false");var e=t.projectSettings[t.currentSelectProjectIndex],i=(e.product,'<project schemaVersion="1" clientId="web-h5" productType="'+e.product+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><deletedPhoto>"+t.deletedPhoto+"</deletedPhoto></project>");return r(3).stringToXml(i)},getCardsContentXml:function(){for(var e=t.projectSettings.length,i='<card id="'+t.cardId+'">',a=0;a<e;a++){var o=(t.projectSettings[a],this.getOptionXml(a));i+=r(3).xmlToString(o);var n=this.getCardContentXml(a);i+=r(3).xmlToString(n);var s=this.getCardSettingXml(a);i+=r(3).xmlToString(s)}return i+="</card>",r(3).stringToXml(i)},getCardSettingXml:function(e){var i=" <cardSetting >";return i+='<styleId value="'+t.cardSetting.styleId+'"/>',i+='<festival value="'+t.cardSetting.festival+'"/>',t.templateGuid&&(i+='<templateGuid value="'+t.templateGuid+'"/>'),i+="</cardSetting>",r(3).stringToXml(i)},getCardContentXml:function(e){e||(e=t.currentSelectProjectIndex);for(var i=(t.projectSettings[e],t.pages),a=this.getPageBleed(),o="<spreads>",n=(this.getCardSpread(e),0);n<i.length;n++){var s=i[n];o+='<spread id="'+s.id+'" width="'+s.width+'" height="'+s.height+'" bleedTop="'+a.top+'" bleedBottom="'+a.bottom+'" bleedLeft="'+a.left+'" bleedRight="'+a.right+'" type="'+s.type+'" month="0" year="0" tplGuid="'+s.tplGuid+'" pageNumber="'+s.pageNumber+'" styleId="'+s.styleId+'" styleItemId="'+s.styleItemId+'" w="'+s.width+'" h="'+s.height+'">';var d=this.getCardElementsXml(n);o+=r(3).xmlToString(d),o+="</spread>"}return o+="</spreads>",r(3).stringToXml(o)},getCardElementsXml:function(e){e||(e=t.currentSelectProjectIndex);for(var i=(t.projectSettings[e],t.pages[e].canvas),a=i.params,o="<elements>",n=0;n<a.length;n++){var e=a[n].index?' index="'+a[n].index+'" ':"",s=a[n].x,d=a[n].y,l=a[n].width,c=a[n].height,p=s/i.oriWidth,h=d/i.oriHeight,g=c/i.oriHeight,u=l/i.oriWidth,m=a[n].rotate,f=a[n].dep,v=a[n].imageId,S=a[n].imageRotate,y=!1,w=a[n].cropPX,x=a[n].cropPY,I=a[n].cropPW,b=a[n].cropPH,P=a[n].decorationid,j=a[n].decorationtype,C=a[n].styleGuid,T=a[n].styleId,k=a[n].styleItemId,L=a[n].styleImageId,D=a[n].isFamilyName||"false",B=a[n].textAlign||"left",R=a[n].textVAlign||"top",F=a[n].lineSpacing||"1",U=a[n].fontColor;U="string"==typeof U&&U.indexOf("#")>-1?r(5).hexToDec(U):U;var z=["tagName","tagType","mandatory","constant","isEdit","isDisableRemind","order"],M=[];z.forEach(function(e){e in a[n]&&"undefined"!=typeof a[n][e]&&"undefined"!=a[n][e]&&M.push(" "+e+'="'+a[n][e]+'"')});var H=M.join("");"style"===a[n].elType?o+='<element type="CalendarStyleElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+u+'" ph="'+g+'" rot="'+m+'" dep="'+f+'" styleId ="'+T+'" styleItemId ="'+k+'" styleGuid ="'+C+'" imageId="'+L+'"'+e+" />":"text"===a[n].elType?o+='<element type="TextElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+u+'" ph="'+g+'" rot="'+m+'" dep="'+f+'" color="'+U+'" fontSize="'+parseFloat(a[n].fontSize)/i.oriHeight+'" fontFamily="'+encodeURIComponent(a[n].fontFamily)+'" fontWeight="'+a[n].fontWeight+'" textAlign="'+B+'" textVAlign="'+R+'" lineSpacing="'+F+'" isFamilyName="'+D+'"'+H+e+" ><![CDATA["+encodeURIComponent(a[n].text)+"]]></element>":"image"===a[n].elType?o+='<element type="PhotoElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+u+'" ph="'+g+'" rot="'+m+'" dep="'+f+'" imageid="'+v+'" imgRot="'+S+'" imgFlip="'+y+'" cropLUX="'+w+'" cropLUY="'+x+'" cropRLX="'+(w+I)+'" cropRLY="'+(x+b)+'"'+e+" />":"decoration"===a[n].elType&&(isNaN(s)||isNaN(d)||isNaN(l)||isNaN(c)||(o+='<element type="DecorationElement" x="'+s+'" y="'+d+'" width="'+l+'" height="'+c+'" px="'+p+'" py="'+h+'" pw="'+u+'" ph="'+g+'" rot="'+m+'" dep="'+f+'" decorationid="'+P+'" decorationtype="'+j+'"'+e+" />"))}return o+="</elements>",r(3).stringToXml(o)},getDecorationXml:function(){for(var e="<decorations>",i=0;i<t.allDecorationList.length;i++)if(t.allDecorationList[i].count){var a=t.allDecorationList[i];e+='<decoration guid="'+a.guid+'" name="'+a.name+'" type="'+a.type+'" count="'+a.count+'" displayRatio="'+a.displayRatio+'" width="'+a.width+'" height="'+a.height+'"/>'}return e+="</decorations>",r(3).stringToXml(e)},getCardInitXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex];t.cardId=r(6).guid();var i='<project schemaVersion="1" clientId="web-h5" productType="'+e.product+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+']]></title><description/><createdDate></createdDate><updatedDate></updatedDate><deletedPhoto>false</deletedPhoto><card id="'+t.cardId+'"><spec version="1.0"><option id="size" value="'+e.size+'"/><option id="paper" value="'+e.paper+'"/><option id="product" value="'+e.product+'"/><option id="orientation" value="'+e.orientation+'"/><option id="trim" value="'+e.trim+'"/></spec>',a=this.getCardContentInitString();return i+=a,i+='<cardSetting><styleId value="'+t.styleId+'"/><festival value="'+t.festival+'"/></cardSetting></card><images></images><decorations></decorations></project>'},getCardContentInitString:function(){var e=t.projectSettings[t.currentSelectProjectIndex].product,i=this.getCardSpread(),i=r(16).getCardSpread(),a=t.projectSettings[t.selectedIdx].orientation,e=t.projectSettings[t.selectedIdx].product,o="FD"===e&&"PO"==a?i.width/2:i.width,n="FD"===e&&"LA"==a?i.height/2:i.height,s="<spreads>";return s+='<spread id="'+r(6).guid()+'" width="'+o+'" height="'+n+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="frontPage" month="0" year="0" tplGuid="null" pageNumber="0" styleId="'+t.styleId+'" styleItemId="0" w="'+o+'" h="'+n+'"><elements>'+(t.isBlankCard?"":'<element type="CalendarStyleElement" x="0" y="0" width="'+o+'" height="'+n+'" px="0" py="0" pw="1" ph="1" rot="0" dep="-999" styleId="'+t.styleId+'" styleItemId="0" styleGuid="'+t.styleGuid+'" imageId="0" />')+'</elements></spread><spread id="'+r(6).guid()+'" width="'+o+'" height="'+n+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="backPage" month="0" year="0" tplGuid="null" pageNumber="1" styleId="'+t.styleId+'" styleItemId="1" w="'+o+'" h="'+n+'"><elements>'+(t.isBlankCard?"":'<element type="CalendarStyleElement" x="0" y="0" width="'+o+'" height="'+n+'" px="0" py="0" pw="1" ph="1" rot="0" dep="-999" styleId="'+t.styleId+'" styleItemId="1" styleGuid="'+t.styleGuid+'" imageId="1" />')+"</elements></spread>","FD"===e&&(s+='<spread id="'+r(6).guid()+'" width="'+i.width+'" height="'+i.height+'" bleedTop="'+i.bleedTop+'" bleedBottom="'+i.bleedBottom+'" bleedLeft="'+i.bleedLeft+'" bleedRight="'+i.bleedRight+'" type="insidePage" month="0" year="0" tplGuid="null" pageNumber="2" styleId="'+t.styleId+'" styleItemId="2" w="'+i.width+'" h="'+i.height+'"><elements></elements></spread>'),s+="</spreads>"},getPadcaseBaseInfoXml:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=(e.product,'<project schemaVersion="2.0" createAuthor="web-h5|1.0|1" clientId="web-h5" product="'+t.product+'" productType="'+t.projectType+'"><guid>'+t.projectId+"</guid><userId>"+t.userSettings.userId+"</userId><artisan>"+t.userSettings.userName+"</artisan><title><![CDATA["+t.title+"]]></title><description/><createdDate></createdDate><updatedDate></updatedDate><endpointToken></endpointToken><padCase></padCase></project>");return r(3).stringToXml(i)},getPadcaseInitProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPadcaseBaseInfoXml()),i=this.getOptionXml(),o=this.getFaceXml(),n=this.getPhonecasePhotoLayerXml(),s=this.getPhonecaseInitElemntsXml(),d=this.getImagesXml();return a(e).find("padCase").append(i.firstChild.cloneNode(!0)),a(e).find("padCase").append(o.firstChild.cloneNode(!0)),a(e).find("face").append(n.firstChild.cloneNode(!0)),a(e).find("photosLayer").append(s.firstChild.cloneNode(!0)),a(e).find("project").append(d.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getPadcaseCurrentProjectXml:function(){var e=(t.projectSettings[t.currentSelectProjectIndex],this.getPadcaseBaseInfoXml()),i=this.getOptionXml(),o=this.getFaceXml(),n=this.getPhonecasePhotoLayerXml(),s=this.getElementsXml(),d=this.getImagesXml();return a(e).find("padCase").append(i.firstChild.cloneNode(!0)),a(e).find("padCase").append(o.firstChild.cloneNode(!0)),a(e).find("face").append(n.firstChild.cloneNode(!0)),a(e).find("photosLayer").append(s.firstChild.cloneNode(!0)),a(e).find("project").append(d.firstChild.cloneNode(!0)),r(3).xmlToString(e)},getProjectSettings:function(e){var i={},a=r(1).getOptionIds(),o=t.projectSettings[e||t.currentSelectProjectIndex];o||(o=t.baseProject);var n=Object.keys(o).filter(function(e){return a.some(function(t){return e===t})});return n.forEach(function(e){i[e]=o[e]}),i},getParamsList:function(e){var t=this.getProjectSettings(e);return Object.keys(t).map(function(e){return{key:e,value:t[e]}})},getSizedBgBorderParams:function(e){var i=document.getElementById(e),r=t.pages[t.selectedPageIdx].canvas,a=r.foreground,o=r.oriBgWidth,n=(r.oriBgHeight,r.oriWidth),s=r.oriHeight,d=i.width/o,l=Math.floor(a.left*d),c=Math.floor(a.top*d),p=Math.floor(n*d),h=Math.floor(s*d);return{x:l,y:c,width:p,height:h}},getWallArtsCurrentProjectJson:function(){for(var e=t.projectSettings[t.currentSelectProjectIndex],i=a(t.spec.specXml).find("product-spec").attr("version"),o=r(1).getOptionIds(),n={},s=0;s<o.length;s++)n[o[s]]=e[o[s]];n.orientation=e.rotated?"Landscape":"Portrait";var d=[this.getWallartsPages()],l={project:{version:i,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,title:t.title,updatedDate:r(17).formatDateTime(new Date),createdDate:r(17).formatDateTime(new Date),guid:t.projectId,summary:{defaultSetting:n},pages:d,images:this.getImages()}};return l},getWallArtsInitProjectJson:function(){for(var e=t.projectSettings[t.currentSelectProjectIndex],i=a(t.spec.specXml).find("product-spec").attr("version"),o=r(1).getOptionIds(),n={},s=0;s<o.length;s++)n[o[s]]=e[o[s]];
n.orientation="Landscape";var d=[this.getWallartsPages(!0)],l={project:{version:i,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,title:t.title,updatedDate:r(17).formatDateTime(new Date),createdDate:r(17).formatDateTime(new Date),guid:t.projectId,summary:{defaultSetting:n},pages:d,images:[]}};return l},getWallartsPages:function(e){for(var i=t.projectSettings[t.currentSelectProjectIndex],a=this.getPhotoLayer(),o=this.getBleed(),n=o.top,s=o.bottom,d=o.left,l=o.right,c=(a.x,a.y,a.width),p=a.height,h=(i.tplGuid,i.tplSuitId,this.getFrameBaseSize(),this.getFrameBorderThickness()),g=h.top,u=h.bottom,m=h.left,f=h.right,v=this.getCanvasBorderThickness(),S=v.top,y=v.bottom,w=v.left,x=v.right,I=this.getBoardInFrame(),b=I.top,P=I.bottom,j=I.left,C=I.right,T=this.getBoardInMatting(),k=T.top,L=T.bottom,D=T.left,B=T.right,R=t.bgColor+"",F=this.getMatteStyleColor(),U=this.getMatteSize(),z=U.top,M=U.bottom,H=U.left,O=U.right,E=r(1).getOptionIds(),A={},N=0;N<E.length;N++)A[E[N]]=i[E[N]];var W;return W=e?[{type:"PhotoElement",x:"0",y:"0",width:c,height:p,px:"0",py:"0",pw:"1",ph:"1",rot:"0",dep:"0",imageid:"",imgRot:"0",imgFlip:!1,cropLUX:"0",cropLUY:"0",cropRLX:"1",cropRLY:"1"}]:r(12).getElements(),i.product.indexOf("table_")>-1?{id:r(6).guid(),width:c,height:p,bgColor:"#FFFFFF",type:"Page",bleed:{top:n,bottom:s,left:d,right:l},elements:W,backend:{isPrint:!0,slice:!1},quantity:1,spec:A,frameBorder:{left:m,top:g,right:f,bottom:u},borderInFrame:{left:j,top:b,right:C,bottom:P}}:{id:r(6).guid(),width:c,height:p,bgColor:"#FFFFFF",type:"Page",bleed:{top:n,bottom:s,left:d,right:l},elements:W,backend:{isPrint:!0,slice:!1},quantity:1,spec:A,frameBorder:{left:m,top:g,right:f,bottom:u},borderInFrame:{left:j,top:b,right:C,bottom:P},boardInMatting:{left:D,top:k,right:B,bottom:L},matteLayer:{x:0,y:0,px:0,py:0,left:H,right:O,top:z,bottom:M,color:F,depth:1},canvasBorder:{left:w,top:S,right:x,bottom:y,color:R}}},getImages:function(){for(var e=[],i=0;i<t.imageList.length;i++){var r=t.imageList[i];e.push({id:r.id,guid:r.guid,encImgId:r.encImgId,order:i,name:encodeURIComponent(r.name),width:r.width,height:r.height,shotTime:r.shotTime,orientation:r.orientation})}return e},getPhonecaseCurrentProjectJson:function(){for(var e=t.projectSettings[t.currentSelectProjectIndex],i=a(t.spec.specXml).find("product-spec").attr("version"),o=r(1).getOptionIds(),n={},s=0;s<o.length;s++)n[o[s]]=e[o[s]];var d=[this.getPhoneCasePages()],l={project:{version:i,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,title:t.title,updatedDate:r(17).formatDateTime(new Date),createdDate:r(17).formatDateTime(new Date),guid:t.projectId,summary:{defaultSetting:n},pages:d,images:this.getImages()}};return l},getPhonecaseInitProjectJson:function(){for(var e=t.projectSettings[t.currentSelectProjectIndex],i=a(t.spec.specXml).find("product-spec").attr("version"),o=r(1).getOptionIds(),n={},s=0;s<o.length;s++)n[o[s]]=e[o[s]];var d=[this.getPhoneCasePages(!0)],l={project:{version:i,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,title:t.title,updatedDate:r(17).formatDateTime(new Date),createdDate:r(17).formatDateTime(new Date),guid:t.projectId,summary:{defaultSetting:n},pages:d,images:[]}};return l},getPhoneCasePages:function(e){for(var i=t.projectSettings[t.currentSelectProjectIndex],a=this.getPhonecasePhotoLayer(),o=this.getPhonecaseBleed(),n=o.top,s=o.bottom,d=o.left,l=o.right,c=(a.x,a.y,a.px,a.py,a.pw,a.ph,a.width),p=a.height,h=r(1).getOptionIds(),g={},u=0;u<h.length;u++)g[h[u]]=i[h[u]];var m;return m=e?[{type:"PhotoElement",x:"0",y:"0",width:c,height:p,px:"0",py:"0",pw:"1",ph:"1",rot:"0",dep:"0",imageid:"",imgRot:"0",imgFlip:!1,cropLUX:"0",cropLUY:"0",cropRLX:"1",cropRLY:"1"}]:r(12).getElements(),{id:r(6).guid(),width:c,height:p,bgColor:"#FFFFFF",type:"Page",bleed:{top:n,bottom:s,left:d,right:l},elements:m,backend:{isPrint:!0,slice:!1},quantity:1,spec:g}}}}).call(t,r(2),r(4))},function(e,t){e.exports={formatDate:function(e){var t=new Date(e),i=t.getFullYear(),r=String(t.getMonth()+1),a=String(t.getDate());return r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),[i,r,a].join("-")},formatTime:function(e){var t=new Date(e),i=String(t.getHours()),r=String(t.getMinutes()),a=String(t.getSeconds());return i.length<2&&(i="0"+i),r.length<2&&(r="0"+r),a.length<2&&(a="0"+a),[i,r,a].join(":")},formatDateTime:function(e){return e?this.formatDate(e)+" "+this.formatTime(e):""}}},function(e,t,i){(function(t,i){e.exports={getImageDetail:function(e){if(!e)return"";for(var i=0;i<t.imageList.length;i++)if(t.imageList[i].id===e)return t.imageList[i]},freshImageUsedCount:function(){for(var e=[],r=[],a=0;a<t.pages.length;a++)for(var o=t.pages[a].canvas,n=0;n<o.params.length;n++){if(o.elements[n]&&void 0!=o.elements[n].imageId&&""!==o.elements[n].imageId)var s=o.elements[n];else var s=o.params[n];if(s.imageId&&""!==s.imageId)if(i.inArray(s.imageId,e)===-1)e.push(s.imageId),r.push(1);else{var d=i.inArray(s.imageId,e);r[d]++}}for(a=0;a<t.imageList.length;a++)for(t.imageList[a].usedCount=0,n=0;n<e.length;n++)if(e[n]===t.imageList[a].id){t.imageList[a].usedCount=r[n];break}}}}).call(t,i(2),i(4))},function(e,t){e.exports=function(){return{projectId:"",userId:"",albumId:"",token:"",uploadTimestamp:"",title:"test-tshirt",projectXml:"",ordered:"",tplGuid:"",price:0}}},function(e,t,i){e.exports={drawImage:function(e,t,r,a,o,n,s,d,l,c,p){var h=document.getElementById(e),g=h.getContext("2d"),u=new Image;u.src=t,u.onload=function(e){n&&s?d?g.drawImage(u,d,l,c,p,r,a,n,s):g.drawImage(u,r,a,n,s):g.drawImage(u,r,a),o&&o()},u.onerror=function(){i(8)({ev:i(9).ImageLoadFail,imageUrl:t})}},createRotateElementCanvas:function(e,t){var i=document.createElement("canvas"),r=i.getContext("2d"),a=document.createElement("canvas"),o=a.getContext("2d"),n=this.getCanvasRotateSize(e,t);i.width=n.width<e.width?e.width:n.width,i.height=n.height<e.height?e.height:n.height,a.width=n.width<e.width?e.width:n.width,a.height=n.height<e.height?e.height:n.height;var s=n.width>e.width?n.width/2:e.width/2,d=n.height>e.height?n.height/2:e.height/2,l=s-e.width/2<0?0:s-e.width/2,c=d-e.height/2<0?0:d-e.height/2;return r.clearRect(0,0,i.width,i.height),o.clearRect(0,0,a.width,a.height),r.drawImage(e,l,c),o.translate(s,d),o.rotate(t*Math.PI/180),o.translate(-s,-d),o.drawImage(i,0,0),a},drawRotateCanvas:function(e){var t=e.tarCanvasId,i=e.sourceCanvasId,r=e.x,a=e.y,o=e.width,n=e.height,s=e.sx,d=e.sy,l=e.sw,c=e.sh,p=parseInt(e.rotate)||0,h=document.getElementById(t),g=h.getContext("2d"),u=document.getElementById(i);if(u){var m=(u.getContext("2d"),this.createRotateElementCanvas(u,p)),s=s||0,d=d||0,l=l||m.width,c=c||m.height,r=r||0,a=a||0,f=o||m.width,v=n||m.height;l>0&&c>0&&(r-=(m.width-u.width)/2,a-=(m.height-u.height)/2,g.drawImage(m,s,d,l,c,r,a,f,v))}},drawCanvas:function(e,t,i,r,a,o,n,s,d,l){var c=document.getElementById(e),p=c.getContext("2d"),h=document.getElementById(t);if(h){var n=(h.getContext("2d"),n||0),s=s||0,d=d||h.width,l=l||h.height,i=i||0,r=r||0,g=a||h.width,u=o||h.height;d>0&&l>0&&p.drawImage(h,n,s,d,l,i,r,g,u)}},drawText:function(e,t,i,r,a,o,n){var s=document.getElementById(e),d=s.getContext("2d");d.textBaseline="top";var l=d.fillStyle;d.fillStyle=a,d.font=o+" "+n,d.fillText(t,i,r),d.fillStyle=l},drawLine:function(e,t,i,r,a,o,n){var s=document.getElementById(e),d=s.getContext("2d"),l=d.strokeStyle;d.strokeStyle=t;var c=d.lineWidth;n?d.lineWidth=n:d.lineWidth=1,d.beginPath(),d.moveTo(i,r),d.lineTo(a,o),d.closePath(),d.stroke(),d.strokeStyle=l,d.lineWidth=c},drawDashedLine:function(e,t,i,r,a,o,n,s){var d=document.getElementById(e),l=d.getContext("2d"),c=l.strokeStyle;l.strokeStyle=t;var p=l.lineWidth;n?l.lineWidth=n:l.lineWidth=1,s||(s=5),l.beginPath();for(var h,g,u,m,f=this.getBeveling(a-i,o-r),v=Math.floor(f/s),S=0;S<v;S++)h=i+(a-i)/v*S,g=r+(o-r)/v*S,u=i+(a-i)/v*(S+1),m=r+(o-r)/v*(S+1),l[S%2==0?"moveTo":"lineTo"](i+(a-i)/v*S,r+(o-r)/v*S);v%2!=0&&l.lineTo(u,m),l.closePath(),l.stroke(),l.strokeStyle=c,l.lineWidth=p},getBeveling:function(e,t){return Math.sqrt(Math.pow(e,2)+Math.pow(t,2))},drawRect:function(e,t,i,r,a,o,n,s){var d=document.getElementById(e),l=d.getContext("2d");if(n){var c=l.lineWidth;s?l.lineWidth=s:l.lineWidth=1;var p=l.strokeStyle;l.strokeStyle=t,l.beginPath(),l.moveTo(i,r),l.strokeRect(i,r,a,o),l.closePath(),l.stroke(),l.strokeStyle=p,l.lineWidth=c}else{var p=l.fillStyle;l.fillStyle=t,l.beginPath(),l.moveTo(i,r),l.fillRect(i,r,a,o),l.closePath(),l.fillStyle=p}},drawCircular:function(e,t,i,r,a,o,n){var s=document.getElementById(e),d=s.getContext("2d");if(o){var l=d.lineWidth;n?d.lineWidth=n:d.lineWidth=1;var c=d.strokeStyle;d.strokeStyle=t,d.moveTo(i,r),d.beginPath(),d.arc(i,r,a,0,2*Math.PI),d.closePath(),d.stroke(),d.strokeStyle=c,d.lineWidth=l}else{var c=d.fillStyle;d.fillStyle=t,d.moveTo(i,r),d.beginPath(),d.arc(i,r,a,0,2*Math.PI),d.closePath(),d.fill(),d.fillStyle=c}},clear:function(e,t,i,r,a){var o=document.getElementById(e),n=o.getContext("2d"),t=t||0,i=i||0,r=r||o.width,a=a||o.height;n.clearRect(t,i,r,a)},getImageData:function(e,t,i,r,a){var o=document.getElementById(e),n=o.getContext("2d");return t=t||0,i=i||0,r=r||o.width,a=a||o.height,n.getImageData(t,i,r,a)},fillImageData:function(e,t,i,r,a,o){var n=document.getElementById(e),s=n.getContext("2d"),a=a||n.width,o=o||n.height,i=i||0,r=r||0;s.putImageData(t,i,r,0,0,a,o)},createImageData:function(e,t,i){var r=document.getElementById(e),a=r.getContext("2d"),t=t||r.width,i=i||r.height;return a.createImageData(t,i)},getClient:function(e){var t=document.getElementById(e);return{width:t.width,height:t.height,context:t.getContext("2d")}},imageDataVRevert:function(e,t){for(var i=0,r=e.height;i<r;i++)for(j=0,w=e.width;j<w;j++)t.data[i*w*4+4*j+0]=e.data[(r-i)*w*4+4*j+0],t.data[i*w*4+4*j+1]=e.data[(r-i)*w*4+4*j+1],t.data[i*w*4+4*j+2]=e.data[(r-i)*w*4+4*j+2],t.data[i*w*4+4*j+3]=e.data[(r-i)*w*4+4*j+3];return t},imageDataHRevert:function(e,t){for(var i=0,r=e.height;i<r;i++)for(j=0,w=e.width;j<w;j++)t.data[i*w*4+4*j+0]=e.data[i*w*4+4*(w-j)+0],t.data[i*w*4+4*j+1]=e.data[i*w*4+4*(w-j)+1],t.data[i*w*4+4*j+2]=e.data[i*w*4+4*(w-j)+2],t.data[i*w*4+4*j+3]=e.data[i*w*4+4*(w-j)+3];return t},canvasToBase64:function(e){var t=document.getElementById(e);return t.toDataURL("image/jpeg")},wrapBorder:function(e,t,i){var r=document.getElementById(e),a=document.createElement("canvas"),o=a.getContext("2d"),n=r.width,s=r.height,i=i||.5,t=t||"right",d={top:[1,0,-i,i,0,s/2],right:[-i,i,0,1,n/2,-n/2]};return n>s?(a.width=n+s/2,a.height=s):(a.width=n,a.height=s+n/2),CanvasRenderingContext2D.prototype.transform.apply(o,d[t]),n>s?o.drawImage(r,s/2,0):o.drawImage(r,0,n/2),o.getImageData(0,0,a.width,a.height)},setSize:function(e,t){var i=document.getElementById(e);t.width&&(i.width=t.width),t.height&&(i.height=t.height)},fillEmptyDataWithColor:function(e,t,i,r){for(var a=0;a<e.width*e.height;a++)0===e.data[4*a+3]&&(e.data[4*a]=t.r,e.data[4*a+1]=t.g,e.data[4*a+2]=t.b,e.data[4*a+3]=255);return e},replaceColor:function(e,t,i,r,a,o,n){var t=~~(t||0),i=~~(i||0),a=t+a||e.width,o=i+o||e.height;if(t<0||i<0||a>e.width||o>e.height)throw new Error("error params!");for(var s=i;s<o;s++)for(var d=t;d<a;d++){var l=s*e.width+d,c=e.data[4*l],p=e.data[4*l+1],h=e.data[4*l+2];c==r.r&&p==r.g&&h==r.b&&(n?(e.data[4*l]=n.r,e.data[4*l+1]=n.g,e.data[4*l+2]=n.b,e.data[4*l+3]=255):e.data[4*l+3]=0)}return e},resizeImage:function(e,t,i){var r=document.getElementById(e),a=(r.getContext("2d"),document.createElement("canvas")),o=a.getContext("2d"),t=t||r.width,i=i||r.height;if(t!==r.width||i!==r.height){var n;t>i?(n=r.width/t,i=r.height/n):t===i&&r.width>r.height?(n=r.width/t,i=r.height/n):(n=r.height/i,t=r.width/n)}return a.width=t,a.height=i,o.drawImage(r,0,0,t,i),a.toDataURL("image/png")},getCanvasRotateSize:function(e,t){var i=this.getCanvasRotatePoint(e,t),r=0,a=0;return i.forEach(function(e){r=e.x>r?e.x:r,a=e.y>a?e.y:a}),{width:2*r,height:2*a}},getCanvasRotatePoint:function(e,t){for(var i=Math.sqrt(e.width*e.width+e.height*e.height)/2,r=1,a=1,o=0,n=[],s=0;s<4;s++){switch(s){case 0:r=-1,a=1,o=360;break;case 1:r=1,a=1,o=0;break;case 2:r=1,a=-1,o=180;break;case 3:r=-1,a=-1,o=180}var d={x:e.width/2*r,y:e.height/2*a},l=Math.atan(d.y/d.x)/Math.PI*180+o,c=(l+t)/180*Math.PI;n.push({x:Math.cos(c)*i,y:Math.sin(c)*i})}return n},drawBorderRadius:function(e,t,i){var r=document.getElementById(e),a=r.getContext("2d"),o=r.width||0,n=r.height||0;a.fillStyle=i||"#fff",a.beginPath(),a.moveTo(0,0),a.lineTo(t,0),a.arcTo(0,0,0,t,t),a.lineTo(0,0),a.fill(),a.closePath(),a.beginPath(),a.moveTo(o,0),a.lineTo(o-t,0),a.arcTo(o,0,o,t,t),a.lineTo(o,0),a.fill(),a.closePath(),a.beginPath(),a.moveTo(0,n),a.lineTo(0,n-t),a.arcTo(0,n,t,n,t),a.lineTo(0,n),a.fill(),a.closePath(),a.fillStyle=i||"black",a.beginPath(),a.moveTo(o,n),a.lineTo(o-t,n),a.arcTo(o,n,o,n-t,t),a.lineTo(o,n),a.fill(),a.closePath(),a.fillStyle=i||"rgba(0,0,0,0.6)",a.beginPath(),a.moveTo(o-t,0),a.arcTo(o,0,o,t,t),a.lineTo(o,t/3),a.lineTo(o-t,0),a.fill(),a.closePath()},resizeImageWithShadow:function(e,t,i,r){var a=document.getElementById(e),o=(a.getContext("2d"),document.createElement("canvas")),n=o.getContext("2d"),t=a.width,i=a.height,s=t+20,d=i+20;return o.width=s,o.height=d,n.fillStyle="white",n.fillRect(0,0,s,d),n.shadowBlur=1,n.shadowOffsetX=3,n.shadowOffsetY=2,n.fillStyle="black",n.shadowColor="rgba(0,0,0,0.8)",n.beginPath(),n.moveTo(10+r,d-10),n.arcTo(10,d-10,10,d-10-r,r),n.lineTo(10+r,10),n.arcTo(s-10,10,s-10,10+r/2,r),n.lineTo(s-10,d-10-r),n.arcTo(s-10,d-10,s-10-r,d-10,r),n.lineTo(10+r/1.5,d-10),n.fill(),n.closePath(),n.shadowBlur=0,n.shadowColor="transparents",n.shadowOffsetX=0,n.shadowOffsetY=0,n.drawImage(a,10,10,t,i),o.toDataURL("image/png")},replaceColorOutOfArea:function(e,t,i,r,a,o,n,s,d){var t=~~(t||0),i=~~(i||0),a=t+a||e.width,o=i+o||e.height,l=e.width,c=e.height;if(t<0||i<0||a>e.width||o>e.height)return e;for(var p=0;p<c;p++)for(var h=0;h<l;h++){var g=!0,u=!0;switch(d){case"Round":var m=(a+t)/2,f=(o+i)/2,v=(a-t)/2;g=u=Math.sqrt(Math.pow(h-m,2)+Math.pow(p-f,2))<v;break;case"Square":default:g=h>=t&&h<a,u=p>=i&&p<o}var S=p*e.width+h,y=e.data[4*S],w=e.data[4*S+1],x=e.data[4*S+2],I=e.data[4*S+3];if(s&&255!==I&&(e.data[4*S+3]=255),g&&u)s&&255!==I&&(e.data[4*S]=s.r,e.data[4*S+1]=s.g,e.data[4*S+2]=s.b,e.data[4*S+3]=255);else{var b=y>r.r-50&&y<r.r+50,P=w>r.g-50&&w<r.g+50,j=x>r.b-50&&x<r.b+50;b&&P&&j&&(n?(e.data[4*S]=n.r,e.data[4*S+1]=n.g,e.data[4*S+2]=n.b,e.data[4*S+3]=255):e.data[4*S+3]=0)}}return e}}},function(e,t,i){(function(t,r){e.exports={insertProject:function(e,a,o){var n=t.projectSettings[t.currentSelectProjectIndex]||t.baseProject,s=n.product,d=t.domains.baseUrl+"/general/json/"+t.userSettings.userId+"/project/"+s,a=JSON.stringify(a),l=t.title,c=t.mainProjectUid?"cart":"",o=JSON.stringify(o);r.ajax({url:d,type:"post",dataType:"json",data:{projectJson:a,skuJson:o,crossSell:c,mainProjectUid:t.mainProjectUid,removeCart:t.fromCart,isFromMarketplace:t.isFromMarketplace,requestKey:i(7).getJSONRequestKey(),title:l}}).done(function(r){r&&"200"==r.errorCode?(console.log("new project successfully"+r),t.projectId=r.data.guid||i(7).getUrlParam("initGuid")||"",t.watches.isProjectLoaded=!0,t.isNewInsertProject=!0):"-103"==r.errorCode&&setTimeout(function(){e.$dispatch("dispatchShowProjectChooseWindow")})})},saveProject:function(e,a,o,n){var s=t.projectSettings[t.currentSelectProjectIndex]||t.baseProject,d=s.product,l=t.domains.baseUrl+"/general/json/"+t.userSettings.userId+"/project/"+t.projectId+"/"+d,c=t.title,p=JSON.stringify(a),h=JSON.stringify(o),g=this;r.ajax({url:l,type:"post",dataType:"json",error:function(i,r,a){e.$dispatch("dispatchShowPopup",{type:"save",status:-6}),t.isProjectSavePending=!1},data:{projectJson:p,skuJson:h,removeCart:t.fromCart,requestKey:i(7).getJSONRequestKey(),isFromMarketplace:t.isFromMarketplace,title:c}}).done(function(i){i&&"200"==i.errorCode?(t.projectJson=a,g.uploadCoverImage(e,n),t.isPrjSaved=!0,t.isProjectSavePending=!1):i?("-108"==i.errorCode?(e.$dispatch("dispatchShowPopup",{type:"save",status:-4}),t.vm.$broadcast("notifyCloseWindow")):"-111"==i.errorCode?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1}),t.isPageLoadingShow=!1,t.isProjectSavePending=!1):e.$dispatch("dispatchShowPopup",{type:"save",status:-1})})},saveProjectOnly:function(e,a,o){var n=t.projectSettings[t.currentSelectProjectIndex]||t.baseProject,s=n.product,d=t.domains.baseUrl+"/general/json/"+t.userSettings.userId+"/project/"+t.projectId+"/"+s,l=t.title,c=JSON.stringify(a),p=JSON.stringify(o),h=this;r.ajax({url:d,type:"post",dataType:"json",data:{projectJson:c,skuJson:p,removeCart:t.fromCart,requestKey:i(7).getJSONRequestKey(),isFromMarketplace:t.isFromMarketplace,title:l}}).done(function(i){i&&"200"==i.errorCode&&(t.projectJson=a,t.isPrjSaved=!0,t.isProjectSavePending=!1,setTimeout(function(){h.uploadCoverImage(e,function(){})},500))})},handledSaveProject:function(e,a,o,n){var s=t.projectSettings[t.currentSelectProjectIndex]||t.baseProject,d=s.product,l=t.domains.baseUrl+"/general/json/"+t.userSettings.userId+"/project/"+t.projectId+"/"+d,c=t.title,p=JSON.stringify(a),h=JSON.stringify(o),g=this;r.ajax({url:l,type:"post",dataType:"json",error:function(i,r,a){e.$dispatch("dispatchShowPopup",{type:"save",status:-6}),t.isProjectSavePending=!1},data:{projectJson:p,skuJson:h,removeCart:t.fromCart,requestKey:i(7).getJSONRequestKey(),isFromMarketplace:t.isFromMarketplace,title:c}}).done(function(i){i&&"200"==i.errorCode?(t.projectJson=a,t.isPrjSaved=!0,g.uploadCoverImage(null,function(){e.$dispatch(n,"success")})):i&&("-108"==i.errorCode?(e.$dispatch("dispatchShowPopup",{type:"save",status:-4}),t.vm.$broadcast("notifyCloseWindow")):"-111"==i.errorCode?e.$dispatch("dispatchShowPopup",{type:"login",status:0}):e.$dispatch("dispatchShowPopup",{type:"save",status:-1}))})},getShareProject:function(){r.ajax({url:t.domains.uploadUrl+"/upload/Preview/GetPhotobookXmlByProjectId?projectId="+encodeURIComponent(t.projectId),type:"get",dataType:"json",data:"webClientId=1&autoRandomNum="+i(5).getRandomNum()}).done(function(e){if(e){t.encProjectId=t.projectId,t.projectJson=e,t.projectId=e.project.guid||i(7).getUrlParam("initGuid")||"",t.createdDate=e.project.createdDate,t.projectSettings.length=0;for(var r=i(19),a=r(),o=e.project.spec,n=Object.keys(o),s=0;s<n.length;s++){var d=n[s];a[d]=o[d]}a.rotated="Landscape"===a.orientation,t.projectSettings.push(a),t.watches.isProjectLoaded=!0}})},getProject:function(){r.ajax({url:t.domains.baseUrl+"/userid/"+t.userSettings.userId+"/project/"+t.projectId,type:"get",dataType:"json",data:"webClientId=1&autoRandomNum="+i(5).getRandomNum()}).done(function(e){if(e){t.projectJson=e,t.projectId=e.project.guid||i(7).getUrlParam("initGuid"),t.createdDate=e.project.createdDate,t.projectSettings.length=0;for(var r=i(19),a=r(),o=e.project.spec,n=Object.keys(o),s=0;s<n.length;s++){var d=n[s];a[d]=o[d]}a.rotated="Landscape"===a.orientation,t.projectSettings.push(a),t.watches.isProjectLoaded=!0}})},uploadCoverImage:function(e,a){var o=t.projectJson.project,n="";0===o.pages.length?n=t.emptyImage:(n=i(11).getScreenshot().replace("data:image/jpeg;base64,","").replace("data:image/png;base64,",""),t.beforeUpgradeScreenshot=n);var s=t.domains.uploadUrl+"/upload/servlet/UploadCoverImgServlet",d=t.projectSettings[t.currentSelectProjectIndex]||t.baseProject,l=d.product;r.ajax({url:s,type:"post",dataType:"text",data:{projectid:t.projectId,encodeimage:n,projectType:l,webClientId:1,autoRandomNum:i(5).getRandomNum(),customerId:t.userSettings.userId,token:t.userSettings.token,timestamp:t.userSettings.uploadTimestamp}}).done(function(t){a&&"function"==typeof a?a():e&&e.$dispatch("dispatchShowPopup",{type:"save",status:0})})},cloneProject:function(e,a,o,n,s){var d=this,l=(new Date).valueOf(),c=t.projectSettings[t.currentSelectProjectIndex]||t.baseProject,p=c.product,h=t.domains.baseUrl+"/general/json/"+t.userSettings.userId+"/project/"+p,g=t.title,u=t.mainProjectUid?"cart":"",m=JSON.stringify(n),f=JSON.stringify(s);r.ajax({url:h,type:"post",dataType:"json",data:{projectJson:m,skuJson:f,crossSell:u,mainProjectUid:t.mainProjectUid,removeCart:t.fromCart,isFromMarketplace:t.isFromMarketplace,requestKey:i(7).getJSONRequestKey(),title:g}}).done(function(n){if(n&&"200"==n.errorCode){t.projectId=n.data.guid||i(7).getUrlParam("initGuid")||"",t.isPrjSaved=!0,t.vm.$broadcast("notifyHideCloneWindow"),r.ajax({url:"/userid/"+t.userSettings.userId+"/addOrUpdateAlbum",type:"get",data:"timestamp="+l+"&projectId="+t.projectId+"&albumName="+o+"&webClientId="+t.webClientId+"&autoRandomNum="+i(5).getRandomNum()}).done(function(e){if(e)if("success"==r(e).find("resultData").attr("state"))t.userSettings.albumId=r(e).find("albumId").text()||"";else if("fail"==r(e).find("resultData").attr("state")){var i,o=r(e).find("errorCode").text(),n=r(e).find("code").text();t.title=a,"1"===o?i="Title existed, please pick another one.":"2"===n?t.vm.$dispatch("dispatchShowPopup",{type:"login",status:0}):i="Save project name failed. errorInfo："+r(e).find("errorInfo").text(),t.vm.$broadcast("notifyShowInvalidTitle",i)}}),i(11).getProjectOrderedState(e),i(11).getProjectInfo(),d.uploadCoverImage(e);var s=window.location.href,c=s.split("index.html?")[0];window.history.pushState({},"",c+"index.html?initGuid="+t.projectId+"&webClientId=1")}else{var p="Clone failed";t.title=a,t.vm.$broadcast("notifyShowInvalidTitle",p)}})},createProjectSuccess:function(e,a,o,n,s){var d=t.projectSettings[t.currentSelectProjectIndex]||t.baseProject,l=d.product,c=t.domains.baseUrl+"/general/json/"+t.userSettings.userId+"/project/"+l,p=t.title,h=t.mainProjectUid?"cart":"",g=JSON.stringify(n),u=JSON.stringify(s);t.errCode=!0,r.ajax({url:c,type:"post",dataType:"json",data:{projectJson:g,skuJson:u,crossSell:h,mainProjectUid:t.mainProjectUid,removeCart:t.fromCart,isFromMarketplace:t.isFromMarketplace,requestKey:i(7).getJSONRequestKey(),title:p}}).done(function(e){if(e)if(e&&"200"==e.errorCode){t.projectId=e.data.guid||i(7).getUrlParam("initGuid")||"",t.watches.isProjectLoaded=!0,t.vm.$broadcast("notifyHideNewProjectWindow"),i(11).getProjectInfo()}else{var r="Create failed";t.title=a,t.vm.$broadcast("notifyShowNewProjectInvalidTitle",r)}})},getNewPrintProject:function(e){switch(e){case"Share":url=t.domains.uploadUrl+"/upload/Preview/GetPhotobookXmlByProjectId?projectId="+encodeURIComponent(t.projectId);break;case"Portal":url=t.domains.portalBaseUrl+"/portal/projectProcess/getProjectById.ep?projectId="+encodeURIComponent(t.projectId);break;case"Local":url="./assets/data/project.json",dataType=void 0;break;case"OldProject":default:url=t.domains.baseUrl+"/userid/"+t.userSettings.userId+"/project/"+t.projectId}r.ajax({url:url,type:"get",data:"webClientId=1&autoRandomNum="+i(5).getRandomNum(),complete:function(e){var a=i(30).isJSON(e.responseText),o={},n=!0;if(t.encProjectId=t.projectId,a)o=JSON.parse(e.responseText),t.projectJson=o;else{var s=i(3).stringToXml(e.responseText);n=r(s).find("content").eq(0).attr("id"),o=i(13).transformProjectXmlToJson(s),t.projectJson=o}t.encProjectId=t.projectId,t.projectId=o.project.guid||i(7).getUrlParam("initGuid")||"",t.createdDate=o.project.createdDate,t.projectSettings.length=[],!t.isRemark||t.isRemark&&n?t.watches.isProjectLoaded=!0:alert("This project cannot be remaked by user. Please connect engineer to remake.")}})},saveRemarkProject:function(e,a){var o=i(12).getNewPrintRemarkProject(),n=i(12).getNewPrintSkuJson(o),s=t.domains.portalBaseUrl+"/portal/h5-client/newPrintsRemake.ep";r.ajax({url:s,type:"post",data:{projectId:t.projectId,remarkProjectJson:JSON.stringify(n),orderNumber:t.orderNumber,timestamp:t.timestamp,token:t.token,pUser:t.pUser},statusCode:{504:function(){t.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Response timeout."})}},error:function(e){console.log(e),t.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"An Error has happened, please connect with engineer and check the status."})}}).done(function(i){console.log(i),i&&"success"===i.status?(e&&e(),t.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Reprint successfully"})):(a&&a(),t.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Failed to reprint, please try again later."}))})},getWallartsProject:function(e){switch(e){case"Share":url=t.domains.uploadUrl+"/upload/Preview/GetPhotobookXmlByProjectId?projectId="+encodeURIComponent(t.projectId);break;case"Portal":url=t.domains.portalBaseUrl+"/portal/projectProcess/getProjectById.ep?projectId="+encodeURIComponent(t.projectId);break;case"OldProject":default:url=t.domains.baseUrl+"/userid/"+t.userSettings.userId+"/project/"+t.projectId}r.ajax({url:url,type:"get",data:"webClientId=1&autoRandomNum="+i(5).getRandomNum(),complete:function(e){var a=i(30).isJSON(e.responseText),o={};if(t.projectSettings.length=[],t.encProjectId=t.projectId,a){o=JSON.parse(e.responseText),t.projectJson=o;var n=t.projectJson.project.summary.defaultSetting,s=i(1).getOptionIds(),d={};s.forEach(function(e){d[e]=n[e]||i(1).getOptionsMapDefaultValue(e,[{key:"product",value:n.product}])}),d.rotated="Landscape"==n.orientation,t.projectSettings.push(d),t.projectId=o.project.guid||i(7).getUrlParam("initGuid")||"",t.createdDate=o.project.createdDate}else{var l=i(3).stringToXml(e.responseText);t.title=r(l).find("title").text(),t.projectId=r(l).find("guid").text(),t.projectXml=l;for(var c=0;c<r(l).find("spec").length;c++){for(var p=r(l).find("spec").eq(c),h=i(19),g=h(),u=0;u<p.find("option").length;u++){var m=p.find("option").eq(u);g[m.attr("id")]=m.attr("value"),"None"===g[m.attr("id")]&&(g[m.attr("id")]="none")}"categoryFrame"!==g.category&&"categoryCanvas"!==g.category&&"categoryWallarts"!==g.category||(g.metalType=g.metalType||"none","undefined"===g.metalType?g.metalType="none":g.metalType,g.finish=g.finish||"none","undefined"===g.finish?g.finish="none":g.finish),r(l).find("frameBoard")&&(g.rotated="true"===r(l).find("frameBoard").attr("rotated"),t.bgColor=parseInt(r(l).find("frameBoard").attr("canvasBorderColor"))),t.projectSettings.push(g)}}t.watches.isProjectLoaded=!0}})},getPhonecaseProject:function(e){switch(e){case"Share":url=t.domains.uploadUrl+"/upload/Preview/GetPhotobookXmlByProjectId?projectId="+encodeURIComponent(t.projectId);break;case"Portal":url=t.domains.portalBaseUrl+"/portal/projectProcess/getProjectById.ep?projectId="+encodeURIComponent(t.projectId);break;case"OldProject":default:url=t.domains.baseUrl+"/userid/"+t.userSettings.userId+"/project/"+t.projectId}r.ajax({url:url,type:"get",data:"webClientId=1&autoRandomNum="+i(5).getRandomNum(),complete:function(e){var a=i(30).isJSON(e.responseText),o={};if(t.projectSettings.length=[],t.encProjectId=t.projectId,a){o=JSON.parse(e.responseText),t.projectJson=o;var n=t.projectJson.project.summary.defaultSetting,s=i(1).getOptionIds(),d={};s.forEach(function(e){d[e]=n[e]||i(1).getOptionsMapDefaultValue(e,[{key:"product",value:n.product}])}),t.projectSettings.push(d),t.projectId=o.project.guid||i(7).getUrlParam("initGuid")||t.projectId||"",t.createdDate=o.project.createdDate}else{var l=i(3).stringToXml(e.responseText);t.title=r(l).find("title").text(),t.projectId=r(l).find("guid").text(),t.projectXml=l;for(var c=0;c<r(l).find("spec").length;c++){for(var p=r(l).find("spec").eq(c),h=i(19),g=h(),u=0;u<p.find("option").length;u++){var m=p.find("option").eq(u);g[m.attr("id")]=m.attr("value"),"None"===g[m.attr("id")]&&(g[m.attr("id")]="none")}t.projectSettings.push(g)}}t.watches.isProjectLoaded=!0}})}}}).call(t,i(2),i(4))},function(e,t){e.exports={getDefaultCrop:function(e,t,i,r){if(e&&t&&i&&r){var a,o,n,s,d=e/t,l=i/r;if(d>l){var c=t,p=c*l,h=(e-p)/2;a=h/e,o=0,n=p/e,s=1}else{var p=e,c=p/l,h=(t-c)/2;a=0,o=h/t,n=1,s=c/t}return{px:Math.abs(a.toFixed(8)),py:Math.abs(o.toFixed(8)),pw:Math.abs(n.toFixed(8)),ph:Math.abs(s.toFixed(8))}}return{px:0,py:0,pw:1,ph:1}},getConformCrop:function(e,t,i,r,a,o,n,s,d,l){var c,p,h=i*e,g=r*t,u=a*e,m=o*t,f=d*u/n,v=l*m/s;f-u<v-m?(c=u,p=c/f*v):(p=m,c=p/v*f),f=c,v=p;var S=(f-u)/2,y=(v-m)/2,w=h-S,x=g-y,I=w+f,b=x+v;return w<0&&(w=0),x<0&&(x=0),I>e&&(w=e-f),b>t&&(x=t-v),(f>e||v>t)&&(f-u>v-m?(c=u,p=c/f*v):(p=m,c=p/v*f),f=c,v=p,S=(f-u)/2,y=(v-m)/2,w=h-S,x=g-y),{px:w/e,py:x/t,pw:f/e,ph:v/t}},getRotatedAngle:function(e,t){return void 0!=e&&null!=e?(t=isNaN(parseFloat(t))?90:parseFloat(t),e+=t,e>180?e-=360:e,e<-90?e+=360:e,e):0},stecheTo:function(e,t,i,r,a){a="meet";var o=e/t,n=i/r,s=1;return s=o>n?"slice"===a?r/t:i/e:"slice"===a?i/e:r/t,{width:e*s,height:t*s}}}},function(e,t,i){(function(t){e.exports={getExifDegree:function(e){switch(+e){case 6:return 90;case 8:return-90;case 3:return 180;default:return 0}},getBlobImagePreviewUrl:function(e){var i=t.imageList[e],r=+i.orientation,a=(r+360)%360/90,o=new Image;o.src=i.url+"350",o.crossOrigin="anonymous";var n=this,s=document.createElement("canvas"),d=s.getContext("2d");n.fetchImage(o.src,function(e){o.src=e.src,o.onload=function(){switch(a){case 1:s.width=o.height,s.height=o.width,d.rotate(90*Math.PI/180),d.drawImage(o,0,-o.height);break;case 2:s.width=o.width,s.height=o.height,d.rotate(180*Math.PI/180),d.drawImage(o,-o.width,-o.height);break;case 3:s.width=o.height,s.height=o.width,d.rotate(270*Math.PI/180),d.drawImage(o,-o.width,0);break;default:case 4:s.width=o.width,s.height=o.height,d.rotate(0),d.drawImage(o,0,0)}if(s.toBlob)s.toBlob(function(e){i.previewUrl=URL.createObjectURL(e)});else{var e=s.msToBlob();i.previewUrl=URL.createObjectURL(e)}}})},createXHR:function(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(!window.ActiveXObject)throw new Error("xhr not support");for(var e=["MSXML2.XMLHttp","Microsoft.XMLHTTP"],t=0,i=e.length;t<i;t++)try{return new ActiveXObject(version[t])}catch(r){}},fetchImage:function(e,t){if(RegExp(location.host+"|base64,").test(e)){var i=new window.Image;i.onload=function(){t(i)},i.onerror=function(){t()},i.src=e}else{var r=this.createXHR();r.open("GET",e,!0),r.responseType="blob",r.onload=function(){var e=new window.Image;e.onload=function(){t(e)},e.onerror=function(){t()},e.src=window.URL.createObjectURL(r.response)},r.onerror=function(){t()},r.send()}}}}).call(t,i(2))},,function(e,t,i){(function(t,r){var a=i(17);e.exports={initProjectJson:function(){for(var e=i(1).getOptionIds(),o=t.projectSettings[t.currentSelectProjectIndex],n=r(t.spec.specXml).find("product-spec").attr("version"),s={},d=r.extend(!0,[],this.initPages()),l=0;l<e.length;l++)s[e[l]]=o[e[l]];return{project:{version:n,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:a.formatDateTime(new Date),updatedDate:a.formatDateTime(new Date),summary:{defaultSetting:s},pages:d,images:[]}}},initPages:function(){for(var e=[],r=i(12).getBaseSize(),a=i(12).getBleedSize(),o=r.width+a.left+a.right,n=r.height+a.top+a.right,s=i(1).getOptionIds(),d=t.projectSettings[t.currentSelectProjectIndex],l={},c=0;c<s.length;c++)l[s[c]]=d[s[c]];l.quantity=1;for(var c=0;c<t.LSCPageNum;c++)e.push({id:i(6).guid(),width:o,height:n,type:"Page",bleed:a,spec:l,elements:[i(12).getDefaultElement(o,n)],backend:{isPrint:!0}});return e},getCurrentProjectJson:function(){for(var e=i(1).getOptionIds(),o={},n=0;n<e.length;n++)o[e[n]]=t.baseProject[e[n]];var s=r(t.spec.specXml).find("product-spec").attr("version"),d=this.getPages(),l=i(12).getImages();return{project:{guid:t.projectId,version:s,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:t.createdDate,updatedDate:a.formatDateTime(new Date),summary:{defaultSetting:o},pages:d,images:l}}},getPages:function(){for(var e=[],r=0;r<t.pages.length;r++)if(!t.pages[r].isDeleted&&0!==t.projectSettings[r].quantity){for(var a=i(12).getBleedSize(r),o=i(12).getPhotoLayer(r),n=o.width,s=o.height,d=(i(12).getElements(r),i(1).getOptionIds()),l=t.projectSettings[r],c={},p=0;p<d.length;p++)c[d[p]]=l[d[p]];
c.quantity=l.quantity;var h=t.pages[r].guid||i(6).guid();e.push({id:h,width:n,height:s,type:"Page",spec:c,bleed:a,elements:i(12).getElements(r),backend:{isPrint:!0}})}return e}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){var r=i(15);e.exports={createImage:function(e){e&&this.addImageInParams(e)},editImage:function(e,t){e&&void 0!=t&&null!=t&&this.changeImageInParams(e,t)},deleteImage:function(e,i){void 0!=e&&null!=e&&(this.removeImageFromParams(e,i),t.vm.$broadcast("notifyRefreshScreenshot"))},addImageInParams:function(e){var i=t.pages[t.selectedPageIdx].canvas,r=i.params.length;i.params.push(e),this.createImageElement(r)},changeImageInParams:function(e,i){var r=t.pages[t.selectedPageIdx].canvas;r.params.splice(i,1,e),this.editImageElement(i)},removeImageFromParams:function(e,i){var a=t.pages[t.selectedPageIdx].canvas;r.freshDepth(e);var o=a.params[e].id;i?(a.params[e].imageId="",a.params[e].url="",a.params[e].sourceImageUrl="",a.params[e].imageGuid="",a.params[e].imageWidth="",a.params[e].imageHeight="",a.params[e].imageRotate=0,a.params[e].cropPX=0,a.params[e].cropPY=0,a.params[e].cropPW=1,a.params[e].cropPH=1,a.params[e].isRefresh=!0):(a.params.splice(e,1),this.deleteImageElement(e,o))},createImageElement:function(e){r.createElement(e),r.spineLinesToTop()},editImageElement:function(e){r.editElement(e),r.spineLinesToTop()},deleteImageElement:function(e,t){r.deleteElement(e,t),r.spineLinesToTop()}}}).call(t,i(2))},function(e,t,i){(function(t,i){e.exports={analyseSpec:function(e){if(e&&e.size&&e.product){for(var r=e.size,a=e.product,o=(e.color,e.measure,0),n=0,s=0,d=0,l=0,c=0,p=0,h=0,g=0,u=0,m=(new DOMParser,t.spec.specXml),f=i(m).find('parameter[id="baseSize"]').find("entry"),v=0;v<f.length;v++)if(f.eq(v).attr("key").indexOf(a+"-"+r)!==-1){o=f.eq(v).attr("x"),n=f.eq(v).attr("y"),s=300*f.eq(v).attr("widthInInch"),d=300*f.eq(v).attr("heightInInch");break}for(var S=i(m).find('parameter[id="backgroundSize"]').find("entry"),v=0;v<S.length;v++)if(S.eq(v).attr("key").indexOf(a+"-"+r)!==-1){l=S.eq(v).attr("width"),c=S.eq(v).attr("height");break}for(var y=i(m).find('parameter[id="logoArea"]').find("entry"),v=0;v<y.length;v++)if(y.eq(v).attr("key").indexOf(a+"-"+r)!==-1){p=y.eq(v).attr("x"),h=y.eq(v).attr("y"),g=y.eq(v).attr("width"),u=y.eq(v).attr("height");break}var w={x:o,y:n,width:s,height:d},x={width:l,height:c},I={x:p,y:h,width:g,height:u};return console.log(w),console.log(x),console.log(I),{base:w,background:x,logo:I}}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){e.exports={loadAllTemplateList:function(e,a,o){var n=this,s=a,d=a.split("X")[1]+"X"+a.split("X")[0],l=a.split("X")[0],c=a.split("X")[1],p=t.domains.baseUrl+"/template/global/list?designSize="+s+"&imageNum=0&autoRandomNum="+i(5).getRandomNum()+"&webClientId=1&productType="+e;"CR"===t.projectType&&"true"!=t.isPortal&&(p=t.domains.baseUrl+"/template/global/getTemplateListByProductInfo?category=CARD&product=V2_FOLDEDCARD&size="+s+"&usePosition=inside&orientation="+t.projectSettings[t.selectedIdx].orientation),r.ajax({url:p,type:"get",dataType:"xml",async:!1}).done(function(a){if(a&&"success"===r(a).find("result").attr("state")){var s=n.analysisTemplateXml(a);t.templateList=s,l!==c?r.ajax({url:t.domains.baseUrl+"/template/global/list?designSize="+d+"&imageNum=0&autoRandomNum="+i(5).getRandomNum()+"&webClientId=1&productType="+e,type:"get",dataType:"xml",async:!1}).done(function(e){if(e&&"success"===r(e).find("result").attr("state")){var i=n.analysisTemplateXml(e);t.templateList=t.templateList.concat(i),o&&(t.watches.isApplyLayout=!0)}}):o&&(t.watches.isApplyLayout=!0)}})},getTemplateItemInfo:function(e,a){r.ajax({url:t.domains.baseUrl+"/template/global/item/guid/"+e+"/size/"+a+"/viewData?webClientId=1&autoRandomNum="+i(5).getRandomNum(),type:"get",dataType:"xml",async:!1}).done(function(e){e&&t.vm.$dispatch("dispatchTemplateItemInfo",e)})},getTemplateItemUrl:function(e,i){return"CR"!==t.projectType&&i.split("X")[0]===i.split("X")[1]&&(i="8X8"),t.domains.layoutTemplateServerBaseUrl+"/TemplateThumbnail/"+i+"/"+e+".jpg?size="+i},analysisTemplateXml:function(e){for(var t=[],i=0;i<r(e).find("template").length;i++){for(var a=r(e).find("template").eq(i),o={},n=0;n<r(a).children().length;n++){var s=r(a).children().eq(n);o[s[0].nodeName]=s.text()}o.url=this.getTemplateItemUrl(o.guid,o.designSize),t.push(o)}return t},loadDesignerTemplate:function(e){r.ajax({url:t.domains.baseUrl+"/card-template/getCardTemplateByTemplateGuid.ep?templateGuid="+t.templateGuid+"&autoRandomNum="+i(5).getRandomNum(),type:"get",dataType:"xml"}).done(function(i){t.templateXML=i,e&&e()})}}}).call(t,i(2),i(4))},function(e,t){e.exports={wallartsConfigList:[{product:"contemporary",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"frameStyle",title:"Style",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"matteStyle",title:"Matting",showHr:"true"},{type:"size",title:"Size",showHr:"true"},{type:"paper",title:"Print",showHr:"true",paperAlt:["Rich colors and fine texture","High-gloss metal sheen","High-contrast pop style"]},{type:"glassStyle",title:"Glass"}]},{product:"classicFrame",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"frameStyle",title:"Style",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"matteStyle",title:"Matting",showHr:"true"},{type:"size",title:"Size",showHr:"true"},{type:"paper",title:"Print",showHr:"true",paperAlt:["Rich colors and fine texture","High-gloss metal sheen","High-contrast pop style"]},{type:"glassStyle",title:"Glass"}]},{product:"rusticFrame",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"frameStyle",title:"Style",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"matteStyle",title:"Matting",showHr:"true"},{type:"size",title:"Size",showHr:"true"},{type:"paper",title:"Print",showHr:"true",paperAlt:["Rich colors and fine texture","High-gloss metal sheen","High-contrast pop style"]},{type:"glassStyle",title:"Glass"}]},{product:"metal",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"frameStyle",title:"Style",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"matteStyle",title:"Matting",showHr:"true"},{type:"size",title:"Size",showHr:"true"},{type:"paper",title:"Print",showHr:"true",paperAlt:["Rich colors and fine texture","High-gloss metal sheen","High-contrast pop style"]},{type:"glassStyle",title:"Glass"}]},{product:"canvas",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"canvasBorderSize",title:"Frame Thickness",showHr:"true"},{type:"size",title:"Size"}]},{product:"frameCanvas",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"size",title:"Size",showHr:"true"},{type:"frameStyle",title:"Style",hide:"true"}]},{product:"flushMountCanvas",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"frameStyle",title:"Style",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"size",title:"Size"}]},{product:"mountPrint",optionIds:[{type:"paper",title:"Paper",showHr:"true",paperAlt:["Rich colors and fine texture","High-gloss metal sheen","High-contrast pop style"]},{type:"size",title:"Size"}]},{product:"acrylicPrint",optionIds:[{type:"paper",title:"Paper",showHr:"true",paperAlt:["Rich colors and fine texture","High-gloss metal sheen","High-contrast pop style"]},{type:"size",title:"Size"}]},{product:"metalPrint",optionIds:[{type:"metalType",title:"Print Surface",showHr:"true"},{type:"finish",title:"Finish",showHr:"true"},{type:"size",title:"Size"}]},{product:"woodPrint",optionIds:[{type:"finish",title:"Print Options",showHr:"true"},{type:"size",title:"Size"}]},{product:"table_crystalPlaque",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"size",title:"Size"}]},{product:"table_metalPlaque",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"metalType",title:"Print Surface",showHr:"true"},{type:"finish",title:"Finish",showHr:"true"},{type:"size",title:"Size"}]},{product:"table_woodPlaque",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"finish",title:"Print Options",showHr:"true"},{type:"size",title:"Size"}]},{product:"table_metalCube",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"size",title:"Size"}]},{product:"table_modernFrame",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"size",title:"Size"}]},{product:"table_classicFrame",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"size",title:"Size"}]},{product:"floatFrame",optionIds:[{type:"frameStyle",title:"Style",showHr:"true"},{type:"color",title:"Color",showHr:"true"},{type:"size",title:"Size",showHr:"true"},{type:"paper",title:"Print",showHr:"true",paperAlt:["Rich colors and fine texture","High-gloss metal sheen","High-contrast pop style"]}]}],posterConfigList:[{product:"PO",optionIds:[{type:"size",title:"Size",showHr:"true"},{type:"paper",title:"Paper"}]},{product:"LPR",optionIds:[{type:"size",title:"Size",showHr:"true"},{type:"paper",title:"Paper"}]},{product:"AR",optionIds:[{type:"size",title:"Size",showHr:"true"},{type:"paper",title:"Paper"}]}],cardsConfigList:[{product:"FT",optionIds:[{type:"paper",title:"Paper",showHr:"true"},{type:"trim",title:"Trim",showHr:"true"}]},{product:"FD",optionIds:[{type:"paper",title:"Paper",showHr:"true"},{type:"trim",title:"Trim",showHr:"true"}]},{product:"FT",isBlankCardUse:"true",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"size",title:"Size",showHr:"true"},{type:"orientation",title:"Orientation",showHr:"true"},{type:"paper",title:"Paper",showHr:"true"},{type:"trim",title:"Trim",showHr:"true"}]},{product:"FD",isBlankCardUse:"true",optionIds:[{type:"product",title:"Product",showHr:"true"},{type:"size",title:"Size",showHr:"true"},{type:"orientation",title:"Orientation",showHr:"true"},{type:"format",title:"Formats",showHr:"true"},{type:"paper",title:"Paper",showHr:"true"},{type:"trim",title:"Trim",showHr:"true"}]}],colorUrlMap:[{key:"blackFM",url:"../../static/img/colors/Modernframe-Black.jpg"},{key:"whiteFM",url:"../../static/img/colors/Modernframe-White.jpg"},{key:"mapleFM",url:"../../static/img/colors/Modernframe-Maple.jpg"},{key:"espressoFM",url:"../../static/img/colors/Modernframe-Espresso.jpg"},{key:"metalBlack",url:"../../static/img/colors/Metal-Black.jpg"},{key:"metalSilver",url:"../../static/img/colors/Metal-Sliver.jpg"},{key:"metalGold",url:"../../static/img/colors/Metal-Gold.jpg"},{key:"gold",url:"../../static/img/colors/Classic-Curve-Baroque.jpg"},{key:"blackTT",url:"../../static/img/colors/Modernframe-Black.jpg"},{key:"whiteTT",url:"../../static/img/colors/Modernframe-White.jpg"},{key:"espressoTT",url:"../../static/img/colors/Modernframe-Espresso.jpg"},{key:"mapleTT",url:"../../static/img/colors/Modernframe-Maple.jpg"},{key:"blackCV",url:"../../static/img/colors/Modernframe-Black.jpg"},{key:"whiteCV",url:"../../static/img/colors/Modernframe-White.jpg"},{key:"mapleCV",url:"../../static/img/colors/Modernframe-Maple.jpg"},{key:"espressoCV",url:"../../static/img/colors/Modernframe-Espresso.jpg"},{key:"greyFM",url:"../../static/img/colors/Ruatic-Grey.jpg"},{key:"brownFM",url:"../../static/img/colors/Ruatic-Brown.jpg"},{key:"blackCurve",url:"../../static/img/colors/Classic-Curve-Black.jpg"},{key:"whiteCurve",url:"../../static/img/colors/Classic-Curve-White.jpg"},{key:"espressoCurve",url:"../../static/img/colors/Classic-Curve-Espresso.jpg"},{key:"mapleCurve",url:"../../static/img/colors/Classic-Curve-Maple.jpg"}]}},function(e,t){e.exports={isJSON:function(e,t){return!(!t||!isObject(e))||(e=e.replace(/\s/g,"").replace(/\n|\r/,""),/^\{(.*?)\}$/.test(e)?/"(.*?)":(.*?)/g.test(e):!!/^\[(.*?)\]$/.test(e)&&e.replace(/^\[/,"").replace(/\]$/,"").replace(/},{/g,"}\n{").split(/\n/).map(function(e){return isJSON(e)}).reduce(function(e,t){return!!t}))}}},function(e,t,i){(function(t){var r=i(20),a=i(47);e.exports={convertScreenshotToBase64:function(){var e=document.getElementById("real-screenshot");return e.width/t.screenshotSize.width<=1||e.height/t.screenshotSize.height<=1?r.resizeImage("real-screenshot",t.screenshotSize.width,t.screenshotSize.height):a.scale({width:t.screenshotSize.width,height:t.screenshotSize.height},e,"jpeg-src")}}}).call(t,i(2))},function(e,t,i){(function(t){var r=i(5),a=i(15);e.exports={createText:function(e){var i=this;if(e){var a=Math.round(r.getTextViewFontSize(e.fontSize));if(a>0){var o=new Image;if(""===e.text?o.src=t.domains.productBaseUrl+"/product/text/textImage?text="+encodeURIComponent("Enter text here")+"&font="+encodeURIComponent(e.fontFamily)+"&fontSize="+a+"&color="+e.fontColor+"&align=left":o.src=t.domains.productBaseUrl+"/product/text/textImage?text="+encodeURIComponent(e.text)+"&font="+encodeURIComponent(e.fontFamily)+"&fontSize="+a+"&color="+e.fontColor+"&align=left",o.complete)return void i.addTextInParams(e,o.width,o.height);o.onload=function(){i.addTextInParams(e,o.width,o.height)}}else i.addTextInParams(e,1,1)}},editText:function(e,i){var a=this;if(e&&void 0!=i&&null!=i){var o=(t.pages[t.selectedPageIdx].canvas,Math.round(r.getTextViewFontSize(e.fontSize)));if(o>0){var n=new Image;if(""===e.text?n.src=t.domains.productBaseUrl+"/product/text/textImage?text="+encodeURIComponent("Enter text here")+"&font="+encodeURIComponent(e.fontFamily)+"&fontSize="+o+"&color="+e.fontColor+"&align=left":n.src=t.domains.productBaseUrl+"/product/text/textImage?text="+encodeURIComponent(e.text)+"&font="+encodeURIComponent(e.fontFamily)+"&fontSize="+o+"&color="+e.fontColor+"&align=left",n.complete)return void a.changeTextInParams(e,n.width,n.height,i);n.onload=function(){a.changeTextInParams(e,n.width,n.height,i)}}else a.changeTextInParams(e,1,1,i)}},deleteText:function(e){void 0!=e&&null!=e&&(this.removeTextFromParams(e),t.vm.$broadcast("notifyRefreshScreenshot"))},addTextInParams:function(e,i,r){var a=t.pages[t.selectedPageIdx].canvas,o=a.params.length;e.width=i/a.ratio,e.height=r/a.ratio,e.dep=o,a.params.push(e),this.createTextElement(o)},changeTextInParams:function(e,i,r,a){var o=t.pages[t.selectedPageIdx].canvas;e.width=i/o.ratio,e.height=r/o.ratio,o.params.splice(a,1,e),this.editTextElement(a)},removeTextFromParams:function(e){var i=t.pages[t.selectedPageIdx].canvas;a.freshDepth(e);var r=i.params[e].id;i.params.splice(e,1),this.deleteTextElement(e,r)},createTextElement:function(e){var t=this;a.createElement(e,t),a.spineLinesToTop()},editTextElement:function(e){var t=this;a.editElement(e,t),a.spineLinesToTop()},deleteTextElement:function(e,t){a.deleteElement(e,t),a.spineLinesToTop()}}}).call(t,i(2))},function(e,t,i){(function(t,r){e.exports={getUserInfo:function(){t.ajax({url:r.domains.baseUrl+"/BigPhotoBookServlet/getSessionUserInfo?webClientId="+r.webClientId+"&autoRandomNum="+i(5).getRandomNum(),type:"get",dataType:"xml",async:!1}).done(function(e){r.userSettings.userId=t(e).find("user").attr("id"),r.userSettings.uploadTimestamp=t(e).find("user").find("timestamp").text(),r.userSettings.token=t(e).find("user").find("authToken").text(),r.userSettings.userName=t(e).find("user").find("firstName").text(),r.userSettings.email=t(e).find("user").find("email").text()})},keepAlive:function(){t.ajax({url:r.domains.baseUrl+"/userid/"+r.userSettings.userId+"/heartbeat",type:"get",dataType:"xml"}).done(function(e){})}}}).call(t,i(4),i(2))},,,function(e,t,i){(function(t,r){e.exports=function(e,a){if(e&&a&&a.fileSelector){var o=document.querySelector(a.fileSelector),n=o.files;n.length>0&&t.ajax({url:r.domains.uploadUrl+"/upload/UploadServer/GetBatchImageIds",type:"get",data:"imageIdCount="+n.length}).done(function(a){if(a){var o=a,s=t(o).find("id").length;r.oriImageIds=[],r.newUploadedImg||(r.newUploadedImg=[]),r.newUploadedImg.length=0;for(var d=0;d<s;d++){r.filesTotalInQueue=s,r.filesCountInQueue=0;var l=t(o).find("id").eq(d).text();r.oriImageIds.push(l),r.uploadProgress.push({percent:0}),function(a){var o=new FormData;o.append("uid",r.userSettings.userId),o.append("timestamp",r.userSettings.uploadTimestamp),o.append("token",r.userSettings.token),o.append("albumId",r.userSettings.albumId),o.append("albumName",r.title);var s=n[a];o.append("Filename",s.name),o.append("filename",s);var d=new XMLHttpRequest,c=r.domains.uploadUrl+"/upload/UploadServer/uploadImg?imageId="+l;d.upload.onprogress=function(e){if(e.loaded&&e.total){var t=e.loaded,i=e.total,o=Math.floor(t/i*100);o>=99&&(o=99),console.log("percent",o,a),r.uploadProgress.$set(a,{percent:o})}},d.onload=function(e){r.filesCountInQueue++;var o=this.responseText;o&&o.indexOf('state="success"')!==-1?(console.log("done"),r.imageList.push({id:t(o).find("id").text(),guid:t(o).find("guid").text()||"",encImgId:t(o).find("encImgId").text()||"",url:r.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+t(o).find("encImgId").text()+i(7).getSecurityString()+"&rendersize=fit",name:t(o).find("name").text(),width:parseFloat(t(o).find("width").text())||0,height:parseFloat(t(o).find("height").text())||0,shotTime:t(o).find("shotTime").text()||"",usedCount:0}),r.newUploadedImg.push({id:t(o).find("id").text(),guid:t(o).find("guid").text()||"",encImgId:t(o).find("encImgId").text()||"",url:r.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+t(o).find("encImgId").text()+i(7).getSecurityString()+"&rendersize=fit",name:t(o).find("name").text(),width:parseFloat(t(o).find("width").text())||0,height:parseFloat(t(o).find("height").text())||0,shotTime:t(o).find("shotTime").text()||"",usedCount:0}),r.uploadProgress.$set(a,{percent:"Done"})):o&&o.indexOf('state="fail"')!==-1&&r.uploadProgress.$set(a,{percent:"Error",info:t(o).find("errorInfo").text()||"Upload failed!"})},d.onerror=function(e){console.log("err"),r.filesCountInQueue++},d.open("post",c,!0),d.send(o),e.initImageUploadDom(a,{filename:s.name})}(d)}}})}}}).call(t,i(4),i(2))},function(e,t,i){(function(t,r){i(5),i(18),i(10),i(27);e.exports={createElement:function(e){this.initElement(e)},editElement:function(e){this.deleteElement(e),this.initElement(e)},deleteElement:function(e){var i=t.pages[t.selectedPageIdx].canvas;i.warns[e]&&(i.warns[e].el&&i.warns[e].el.remove(),i.warns[e].el=""),this.showBeforeElements()},initElement:function(e){var a=t.pages[t.selectedPageIdx].canvas,o="../../static/img/warn_big_icon.png",n=i(10).getParamsValueByElement(e);a.warns[e].isActive=!0,a.warns[e].el=a.paper.image(o,n.x*a.ratio+5,(n.y+n.height)*a.ratio-15,t.warnSettings.warnImageWidth,t.warnSettings.warnImageHeight),a.warns[e].el.node.id="warn-tip-"+e,r("#warn-tip-"+e).attr("title",t.warnSettings.resizeWarnMsg)},showBeforeElements:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.warns;i.map(function(e){e.el&&e.el.toFront()})},refreshLaterTips:function(e){for(var i=t.pages[t.selectedPageIdx].canvas,r=e,a=i.warns.length;r<a;r++)i.warns[r]&&i.warns[r].isActive&&(i.warns[r].el.node.id="warn-tip-"+r)}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){var r=i(15);e.exports={events:{dispatchImageUpload:function(){this.$broadcast("notifyShowImageUpload")},dispatchImageList:function(){this.$broadcast("notifyImageList")},dispatchImageCrop:function(){this.$broadcast("notifyImageCrop")},dispatchShowAddText:function(){this.$broadcast("notifyShowAddText")},dispatchAddText:function(e){this.$broadcast("notifyAddText",e)},dispatchShowMattingGlassEdit:function(){this.$broadcast("notifyShowMattingGlassEdit")},dispatchModifyText:function(e){this.$broadcast("notifyModifyText",e)},dispatchResetCanvas:function(){this.$broadcast("notifyResetCanvas")},dispatchShowSpineLines:function(){this.$broadcast("notifyShowSpineLines")},dispatchHideSpineLines:function(){this.$broadcast("notifyHideSpineLines")},dispatchShowOptionWindow:function(){this.$broadcast("notifyShowOptionWindow")},dispatchUpdateAlbumResponse:function(e,t){this.$broadcast("notifyUpdateAlbumResponse",e,t)},dispatchShowOrderWindow:function(){this.$broadcast("notifyShowOrderWindow")},dispatchShowContactUsWindow:function(){this.$broadcast("notifyShowContactUsWindow")},dispatchPreviewSave:function(e){this.$broadcast("notifyPreviewSave",e)},dispatchShowPopup:function(e){this.$broadcast("notifyShowPopup",e)},dispatchReorder:function(e){this.$broadcast("notifyReorder",e)},dispatchRedirectHome:function(){this.$broadcast("notifyRedirectHome")},dispatchShowWarnTip:function(e){this.$broadcast("notifyShowWarnTip",e)},dispatchHideWarnTip:function(e){this.$broadcast("notifyHideWarnTip",e)},dispatchShowOptionsWindow:function(){this.$broadcast("notifyShowOptionsWindow")},dispatchRotate:function(){this.$broadcast("notifyRotate")},dispatchRepaintProject:function(){this.$broadcast("notifyRepaintProject")},dispatchAddImage:function(e){this.$broadcast("notifyAddImage",e)},dispatchRefreshMirror:function(){this.$broadcast("notifyRefreshMirror")},dispatchRefreshBorder:function(e){this.$broadcast("notifyRefreshBorder",e)},dispatchRefreshScreenshot:function(){this.$broadcast("notifyRefreshScreenshot")},dispatchShowEditBorder:function(){this.$broadcast("notifyShowEditBorder")},dispatchShowBorder:function(){this.$broadcast("notifyShowBorder")},dispatchShowCloneWindow:function(){this.$broadcast("notifyShowCloneWindow")},dispatchCanvasPriceChange:function(){this.$broadcast("notifyCanvasPriceChange")},dispatchResetProjectInfo:function(){if(i(6).getIsShowProjectInfoView()){i(6).getProjectInfoViewText()}else this.$broadcast("notifyResetProjectInfo",!0)},dispatchOptionItemSelect:function(e,t){this.$broadcast("notifyOptionItemSelect",e,t)},dispatchShowMattingChange:function(e,t){this.$broadcast("notifyShowMattingChange",e,t)},dispatchClearScreen:function(e){e=!!e,t.isLostFocus=!0},dispatchSingleImageUploadComplete:function(e){var i=t.pages[t.selectedPageIdx].canvas,r=i.selectedIdx;i.elements[r].setImageById(e)},dispatchApplyTemplate:function(e,a,o){i(28).getTemplateItemInfo(e,o),t.projectSettings[t.currentSelectProjectIndex].tplGuid=e,t.projectSettings[t.currentSelectProjectIndex].tplSuitId=a,"categoryCanvas"===t.projectSettings[t.currentSelectProjectIndex].category&&(this.sharedStore.isImageBorder?r.changeBorderToMirror(!0):r.changeBorderToMirror()),this.$broadcast("notifyFreshCrop"),this.$dispatch("dispatchRepaintProject"),this.$dispatch("dispatchRefreshScreenshot"),this.$broadcast("notifyFreshCrop")},dispatchTemplateItemInfo:function(e){console.log(e),this.$broadcast("notifyApplyTemplate",e)},dispatchRotateTemplate:function(){if("categoryTableTop"===t.projectSettings[t.currentSelectProjectIndex].category){var e=t.pages[t.selectedPageIdx].canvas,r=e.selectedIdx;this.elementData=e.params[r],this.elementData.width=e.width/e.ratio,this.elementData.height=e.height/e.ratio,this.$broadcast("notifyFreshCrop"),this.$dispatch("dispatchRepaintProject")}else{var a=t.projectSettings[t.currentSelectProjectIndex].tplGuid;for(var o in t.templateList)if(a===t.templateList[o].guid){var n=t.templateList[o].rotateTemplateGuid;for(var s in t.templateList)if(t.templateList[s].guid===n)return void this.$dispatch("dispatchApplyTemplate",t.templateList[s].guid,t.templateList[s].suidId,t.templateList[s].designSize)}}i(15).autoLayout()},dispatchRefreshScreenshot:function(){this.$broadcast("notifyRefreshScreenshot")},dispatchShowProjectChooseWindow:function(){t.fromCart=!0,t.watches.isProjectLoaded=!1,t.isPageLoadingShow=!1,i(11).getProjectIdByTitle(t.title),this.$broadcast("notifyShowCartReturnWindow")},dispatchGetProjectIdByTitleSuccess:function(){""!==t.userSettings.userId&&""!==t.projectId&&(i(11).getProjectInfo(),i(13).getOldProject())},dispatchShowNewProjectWindow:function(){this.$broadcast("notifyShowNewProjectWindow")},dispatchSaveScreenshotDelay:function(e){var t=this,r=i(7).getUrlParam("initGuid");r||setTimeout(function(){t.$broadcast("notifySaveScreenshot")},e)},dispatchOrderedPreview:function(){var e=!!t.projectId,i=t.projectInfo.isOrdered||t.projectInfo.isInCart,r=!t.checkFailed,a=!t.isPreview,o=!t.isRemark,n=!t.fromCart;e&&i&&r&&a&&o&&n&&(this.$broadcast("notifyOrderedPreview"),t.isPreview=!0)}}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={methods:{fixPosition:function(){var e=t.pages[t.selectedPageIdx].canvas,r=i(10).getBorderHiddenSize(),a=r.top,o=r.bottom,n=r.left,s=r.right;"image"===t.projectSettings[t.currentSelectProjectIndex].canvasBorder&&(this.elementData.x*this.ratio+this.elementData.width*this.ratio<n&&this.elementData.y*this.ratio+this.elementData.height*this.ratio<a&&(this.elementData.x=0,this.elementData.y=0),this.elementData.x*this.ratio>e.width-s&&this.elementData.y*this.ratio+this.elementData.height*this.ratio<a&&(this.elementData.x=e.width/this.ratio-this.elementData.width,this.elementData.y=0),this.elementData.x*this.ratio+this.elementData.width*this.ratio<n&&this.elementData.y*this.ratio>e.height-o&&(this.elementData.x=0,this.elementData.y=e.height/this.ratio-this.elementData.height),this.elementData.x*this.ratio>e.width-s&&this.elementData.y*this.ratio>e.height-o&&(this.elementData.x=e.width/this.ratio-this.elementData.width,this.elementData.y=e.height/this.ratio-this.elementData.height),a=0,o=0,n=0,s=0),this.elementData.x*this.ratio<-this.elementData.width*this.ratio+n&&(this.elementData.x=0,this.elementData.y*this.ratio<-this.elementData.height*this.ratio*.8&&(this.elementData.y=0)),this.elementData.y*this.ratio<-this.elementData.height*this.ratio+a&&(this.elementData.y=0,this.elementData.x*this.ratio<-this.elementData.width*this.ratio*.8&&(this.elementData.x=0)),this.elementData.x*this.ratio>e.width-s&&(this.elementData.x=e.width/this.ratio-this.elementData.width,this.elementData.y*this.ratio>.8*e.height&&(this.elementData.y=e.height/this.ratio-this.elementData.height)),this.elementData.y*this.ratio>e.height-o&&(this.elementData.y=e.height/this.ratio-this.elementData.height,this.elementData.x*this.ratio>.8*e.width&&(this.elementData.x=e.width/this.ratio-this.elementData.width))}},events:{dispatchRotate:function(){},dispatchMove:function(e){this.elementData.x+=e.x/this.ratio,this.elementData.y+=e.y/this.ratio},dispatchDragEnd:function(){this.fixPosition()},dispatchScaleEnd:function(){this.fixPosition()},dispatchCornerClick:function(){this.setIndex(),t.isEditLayerShow=!1},dispatchSideClick:function(){this.setIndex(),t.isEditLayerShow=!1}}}}).call(t,i(2))},function(e,t,i){(function(t,i){e.exports={methods:{handleResize:function(){""!==t.ctrls.tcResize&&(clearTimeout(t.ctrls.tcResize),t.ctrls.tcResize=""),t.ctrls.tcResize=setTimeout(function(){t.watches.flagRepaint=!0,clearTimeout(t.ctrls.tcResize),t.ctrls.tcResize=""},500)}},events:{resize:function(){this.handleResize()}},created:function(){var e=this;i.window.addEventListener("resize",function(){e.$emit("resize")}),e.$watch("sharedStore.watches.flagRepaint",function(){e.sharedStore.watches.flagRepaint&&(e.sharedStore.watches.flagRepaint=!1,t.isImageCropShow&&t.vm.$broadcast("notifyImageCrop"),t.watches.isSpecLoaded&&t.watches.isProjectLoaded&&e.$broadcast("notifyRepaintCenterContainer",t.currentSelectProjectIndex))})}}}).call(t,i(2),function(){return this}())},function(e,t){e.exports={dpi:300,imageQualityBufferPercent:30,products:[],colors:[],sizes:[],measures:[],specXml:null,specXml2:null}},function(e,t,i){(function(t,r){e.exports={loadDomainUrls:function(){t.ajax({url:"/userid/getEnv?webClientId=1&autoRandomNum="+i(5).getRandomNum(),type:"get",async:!1}).done(function(e){e&&(r.domains.baseUrl=t(e).find("baseUrl").text().substr(0,t(e).find("baseUrl").text().length-1)||"",r.domains.proxyFontBaseUrl=r.domains.baseUrl+"/api",r.domains.calendarBaseUrl=t(e).find("calendarBaseUrl").text().substr(0,t(e).find("calendarBaseUrl").text().length-1)||"",r.domains.uploadUrl=t(e).find("uploadBaseUrl").text().substr(0,t(e).find("uploadBaseUrl").text().length-1)||"",r.domains.productBaseUrl=t(e).find("productBaseURL").text().substr(0,t(e).find("productBaseURL").text().length-1)||"",r.domains.portalBaseUrl=t(e).find("portalBaseURL").text().substr(0,t(e).find("portalBaseURL").text().length-1)||"",r.domains.layoutTemplateServerBaseUrl=t(e).find("layoutTemplateServerBaseUrl").text().substr(0,t(e).find("layoutTemplateServerBaseUrl").text().length-1)||"",r.domains.backendBaseUrl=t(e).find("backendBaseURL").text().substr(0,t(e).find("backendBaseURL").text().length-1)||"")})}}}).call(t,i(4),i(2))},function(e,t,i){(function(t,i){e.exports={getEncImageIds:function(){if(t.imageList.length>0){for(var e="",r=0;r<t.imageList.length;r++)e+=0===r?t.imageList[r].id:","+t.imageList[r].id;e&&i.ajax({url:"/userid/getEncImgIds",type:"post",async:!1,data:{imageIds:e}}).done(function(e){if(e)if("success"===i(e).find("result").attr("state")){for(var r=0;r<t.imageList.length;r++)for(var a=0;a<i(e).find("image").length;a++)if(t.imageList[r].id==i(e).find("image").eq(a).attr("id")){t.imageList[r].encImgId=i(e).find("image").eq(a).attr("encImgId")||"";break}}else console.warn("Error: "+i(e).find("errorInfo").text()||"invalid ajax permission");else console.warn("Error: server returns nothing when getEncImageIds")}).fail(function(e){console.warn("Error: server error when getEncImageIds")})}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){var a={book:1,frame:2,poster:9,cards:5,phonecase:10};e.exports={loadSpec:function(e){var i=this;t.ajax({url:r.domains.productBaseUrl+"/product/spec/product-spec?productType=7",type:"get",dataType:"text"}).done(function(r){if(r=t.parseXML(r),r&&"success"===t(r).find("resultData").attr("state")){var a=t(r).find("availableVersionPath").text();t.ajax({url:a,type:"get",dataType:"text"}).done(function(e){e=t.parseXML(e),i.parseSpecXml(e)})}else e.$dispatch("dispatchShowPopup",{type:"spec",status:0})})},loadLocalSpec:function(){t.ajax({url:"./assets/data/spec.xml?requestKey="+i(7).getRequestKey(),type:"get",dataType:"text"}).done(function(e){e=t.parseXML(e),r.spec.specXml=e,r.watches.isSpecLoaded=!0})},parseSpecXml:function(e){r.spec.specXml=e;for(var i=t(e).find('optionGroup[id="product"]').find("option"),a=0;a<i.length;a++)r.spec.products.push({id:i.eq(a).attr("id"),title:i.eq(a).find("title").text()});for(var o=t(e).find('optionGroup[id="size"]').find("option"),a=0;a<o.length;a++)r.spec.sizes.push({id:o.eq(a).attr("id"),name:o.eq(a).attr("name"),"default":o.eq(a).attr("default")});for(var n=t(e).find('optionGroup[id="color"]').find("option"),a=0;a<n.length;a++)r.spec.colors.push({id:n.eq(a).attr("id"),name:n.eq(a).attr("name")});for(var s=t(e).find('optionGroup[id="measure"]').find("option"),a=0;a<s.length;a++)r.spec.measures.push({id:s.eq(a).attr("id"),name:s.eq(a).attr("name")});r.watches.isSpecLoaded=!0},loadProductSpec:function(e,i){t.ajax({url:r.domains.productBaseUrl+"/product/spec/product-spec?productType="+a[e],type:"get",dataType:"text"}).done(function(e){if(e=t.parseXML(e),console.log(e),e&&"success"===t(e).find("resultData").attr("state")){var a=t(e).find("availableVersionPath").text();t.ajax({url:a,type:"get",dataType:"text"}).done(function(e){e=t.parseXML(e),r.spec.specXml=e,i(),r.watches.isSpecLoaded=!0})}else console.log("load spec failed")})}}}).call(t,i(4),i(2))},function(e,t,i){(function(t,r){e.exports=function(e,a,o){if(e&&a&&a.fileSelector){var n=document.querySelector(a.fileSelector),s=n.files;s=Array.prototype.slice.call(s),s.sort(function(e){var t=e.name.toLowerCase().indexOf(".jpeg")!==-1||e.name.toLowerCase().indexOf(".png")!==-1||e.name.toLowerCase().indexOf(".jpg")!==-1,i=e.size/1048576;return!!(t&&i<100&&0!==i)}),t.retryId>=0&&(s=[],s.push(t.errorUploadedFiles[t.errorUploadedFiles.length-1-t.retryId])),t.maxPageNum&&t.pages.length+s.length>t.maxPageNum&&"number"!=typeof t.watchData.replacePageId&&(s.length=t.maxPageNum-t.pages.length),s.length>0&&r.ajax({url:t.domains.uploadUrl+"/upload/UploadServer/GetBatchImageIds",type:"get",data:"imageIdCount="+s.length+"&timestamp="+Date.now(),error:function(e){t.vm.$dispatch("dispatchShowPopup",{type:"noInterenet",status:0})}}).done(function(a){if(a){var n=a,d=r(n).find("id").length;t.retryId<0&&(t.prevFilesTotal=t.filesTotal,t.filesTotal=t.filesTotal?t.filesTotal+d:d);
for(var l=0;l<d;l++){t.filesTotalInQueue=d,t.filesCountInQueue=0;var c=r(n).find("id").eq(l).text(),p=new XMLHttpRequest;t.retryId<=0&&(t.oriImageIds.push(c),t.uploadProgress.push({percent:0,imgId:c,xhr:p}));var h=s[l].name.toLowerCase().indexOf(".jpeg")!==-1||s[l].name.toLowerCase().indexOf(".png")!==-1||s[l].name.toLowerCase().indexOf(".jpg")!==-1,g=s[l].size/1048576;if(h&&g<100&&0!==g)!function(a,n,l){var c=new FormData;c.append("uid",t.userSettings.userId),c.append("timestamp",t.userSettings.uploadTimestamp),c.append("token",t.userSettings.token),c.append("albumId",t.userSettings.albumId),c.append("albumName",t.title);var p=s[a];c.append("Filename",p.name),c.append("filename",p),t.oriImageNames.push({filename:p.name,imgId:n});var h=t.domains.uploadUrl+"/upload/UploadServer/uploadImg?imageId="+n,g=a;o||(g+=t.prevFilesTotal),t.retryId>=0&&(g=t.retryId),l.upload.onprogress=function(i){if(i.loaded&&i.total)if(e.isWindowOpen()){var r=i.loaded,o=i.total,s=Math.floor(r/o*100);s>=99&&(s=99),console.log("percent",s,a);for(var d=0;d<t.uploadProgress.length;d++){var c=t.uploadProgress[d];if(c.imgId===n){g=d;break}}var h=t.uploadProgress[g].startUploadAt||0;t.uploadProgress[g].successUploadAt||0;t.uploadProgress.$set(g,{percent:s,imgId:n,xhr:l,file:p,startUploadAt:h})}else l.onload=null,l.error=null,l.upload.onprogress=null},l.onreadystatechange=function(){if(4==l.readyState&&413==l.status){t.errorUploaded++,t.filesCountInQueue++,t.errorExt++,t.uploadProgress.$set(g,{percent:"File exceeds maximum size of 100M",imgId:n,info:"Failed: File exceeds maximum size of 100M"}),r("#retry-"+g).show(),r("#progress-c-"+g).hide(),r("#delete-"+g).hide();var i=t.uploadProgress.splice(g,1);t.uploadProgress.unshift(i[0]),t.filesCountInQueue==d&&(t.vm.$dispatch("dispatchSaveProject",!0),t.vm.$broadcast("notifyAddNewUploadedImgIntoPages"),t.isLostFocus=!0),e.refreshImageUploadDom()}},l.onload=function(a){var o=this.responseText;if(console.log(o),!(t.cancelledImgIds.indexOf(r(o).find("id").text())>=0)){t.filesCountInQueue++;for(var s=0;s<t.uploadProgress.length;s++){var c=t.uploadProgress[s];if(c.imgId===n){g=s;break}}if(o&&o.indexOf('state="success"')!==-1){console.log("done");var h=t.uploadProgress[g].startUploadAt||0,u=t.uploadProgress[g].successUploadAt||0;if(t.uploadProgress.$set(g,{percent:"Done",imgId:n,xhr:l,file:p,startUploadAt:h,successUploadAt:u}),r("#delete-"+g).hide(),t.currentUploadCount++,t.successfullyUploaded++,t.currentSuccessUpload++,t.filesTotal===t.successfullyUploaded+t.errorUploaded){var m=-1;t.startUploadTime&&(m=new Date-t.startUploadTime,t.startUploadTime=0),t.isUploading=!1,i(8)({ev:i(9).UploadComplete,uploadTimes:++t.uploadTimes,success:t.currentSuccessUpload,failed:t.currentErrorUpload,spendTime:m})}t.retryId>=0&&t.errorUploaded--,t.imageList.push({id:r(o).find("id").text(),guid:r(o).find("guid").text()||"",encImgId:r(o).find("encImgId").text()||"",url:t.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+r(o).find("encImgId").text()+i(7).getSecurityString()+"&rendersize=fit",name:r(o).find("name").text(),width:parseFloat(r(o).find("width").text())||0,height:parseFloat(r(o).find("height").text())||0,shotTime:r(o).find("shotTime").text()||"",createTime:p.lastModified,uploadTime:new Date(r(o).find("insertTime").text()).valueOf()||0,orientation:i(23).getExifDegree(r(o).find("exifOrientation").text()),usedCount:0,previewUrl:""}),i(23).getBlobImagePreviewUrl(t.imageList.length-1),"undefined"==typeof t.newUploadedImg&&(t.newUploadedImg=[]),t.newUploadedImg.push({id:r(o).find("id").text(),guid:r(o).find("guid").text()||"",encImgId:r(o).find("encImgId").text()||"",url:t.domains.uploadUrl+"/upload/UploadServer/PicRender?qaulityLevel=0&puid="+r(o).find("encImgId").text()+i(7).getSecurityString()+"&rendersize=fit",name:r(o).find("name").text(),width:parseFloat(r(o).find("width").text())||0,height:parseFloat(r(o).find("height").text())||0,shotTime:r(o).find("shotTime").text()||"",createTime:p.lastModified,uploadTime:new Date(r(o).find("insertTime").text()).valueOf()||0,orientation:i(23).getExifDegree(r(o).find("exifOrientation").text()),usedCount:0,previewUrl:""}),t.vm.$broadcast("notifyAddNewUploadedImgIntoPages"),t.successfullyUploaded==t.filesTotal&&(e.handleSaveAndHideUpload(!0),t.vm.$broadcast("notifyHidePopup")),t.retryId=-1,console.log(t.imageList),e.$dispatch("dispatchImageList")}else if(o&&o.indexOf('state="fail"')!==-1){if(t.cancelledImgIds.indexOf(r(o).find("id").text())>=0)return void(t.retryId>=0&&(t.retryId=-1));if(t.errorUploaded++,t.retryId<0){t.currentUploadCount++,t.currentErrorUpload++,t.filesTotal===t.successfullyUploaded+t.errorUploaded&&(t.isUploading=!1,i(8)({ev:i(9).UploadComplete,uploadTimes:++t.uploadTimes,success:t.currentSuccessUpload,failed:t.currentErrorUpload}));var f=t.uploadProgress.splice(g,1);t.uploadProgress.unshift(f[0]),t.errorUploadedFiles.push(p),t.filesCountInQueue==d&&(t.vm.$dispatch("dispatchSaveProject",!0),t.vm.$broadcast("notifyAddNewUploadedImgIntoPages"),t.isLostFocus=!0),e.refreshImageUploadDom()}var v=t.retryId>=0?t.retryId:0;t.uploadProgress.$set(v,{percent:r(o).find("errorInfo").text(),imgId:n,xhr:l,info:"Failed: "+r(o).find("errorInfo").text()||"Upload failed!"}),t.retryId=-1,r("#retry-"+v).show(),r("#progress-c-"+v).hide(),r("#delete-"+v).hide()}}},l.onerror=function(i){console.log("err"),t.errorUploaded++,t.currentUploadCount++,t.currentErrorUpload++,t.filesCountInQueue++,t.uploadProgress.$set(g,{percent:"File exceeds maximum size of 100M",imgId:n,info:"Failed: File exceeds maximum size of 100M"}),r("#retry-"+g).show(),r("#progress-c-"+g).hide(),r("#delete-"+g).hide();var a=t.uploadProgress.splice(g,1);t.uploadProgress.unshift(a[0]),t.filesCountInQueue==d&&(t.vm.$dispatch("dispatchSaveProject",!0),t.vm.$broadcast("notifyAddNewUploadedImgIntoPages"),t.isLostFocus=!0),e.refreshImageUploadDom()},l.open("post",h,!0),l.send(c),t.retryId<0&&e.initImageUploadDom(g,p.name)}(l,c,p);else{index=l,index+=t.prevFilesTotal,t.errorUploaded++,t.errorExt++,t.oriImageNames.push({filename:s[l].name,imgId:c}),e.initImageUploadDom(index,s[l].name),r("#retry-"+index).show(),r("#progress-c-"+index).hide(),r("#delete-"+index).hide();var u="Only .jpg .jpeg and .png files are supported",m="Only .jpg .jpeg and .png files are supported";0===g&&(u="Invalid image file, please select another file",m="Failed: Invalid image file, please select another file"),g>=100&&(u="File exceeds maximum size of 100M",m="Failed: File exceeds maximum size of 100M"),t.uploadProgress.$set(index,{percent:u,imgId:c,info:m});var f=t.uploadProgress.splice(index,1);t.uploadProgress.unshift(f[0]),e.refreshImageUploadDom()}}}})}}}).call(t,i(2),i(4))},function(e,t){e.exports={baseUrl:"",uploadUrl:"",productBaseUrl:"",proxyFontBaseUrl:"",portalBaseUrl:"",layoutTemplateServerBaseUrl:"",assetBaseUrl:"",calendarBaseUrl:"",backendBaseUrl:""}},function(e,t,i){(function(){function i(e,t,i,a){function o(){W="object"==typeof i?i:t.src||a?d:document.createElement("canvas"),W.width=g,W.height=u,X=W.getContext("2d")}function n(e){if(e){var t,i=X.getImageData(0,0,g,u),r=i.data;for(t=0;ae>t;t+=4)r[t]=e[t]*oe|0,r[t+1]=e[t+1]*oe|0,r[t+2]=e[t+2]*oe|0,r[t+3]=e[t+3]*oe|0;return delete e,i}return X.getImageData(0,0,g,u)}function s(e,t,i,r,a){return.5*(r-t+(2*t-5*i+4*r-a+(3*(i-r)+a-t)*e)*e)*e+i}t||(t=e.input,i=e.output,a=e.inputRemovable,e.scale&&(e=e.scale));var d,l;if(t.src)if(d=document.createElement("canvas"),null!=t.naturalWidth)d.width=t.naturalWidth,d.height=t.naturalHeight;else if(null!=t.runtimeStyle){var c=t.runtimeStyle,p=c.width,h=c.height;c.width="auto",c.height="auto",d.width=t.width,d.height=t.height,c.width=p,c.height=h}else{var p=t.width,h=t.height;t.removeAttribute&&(t.removeAttribute("width"),t.removeAttribute("height")),d.width=t.width,d.height=t.height,t.width=p,t.height=h}else d=t;l=d.getContext("2d"),t.src&&l.drawImage(t,0,0);var g,u,m,f=d.width,v=d.height,S=l.getImageData(0,0,f,v).data;if(!f||!v)return!1;(t.src||a)&&d.clearRect(0,0,f,v),f>v?(m=e.width/f,g=e.width,u=Math.ceil(v*m)):(m=e.height/v,g=Math.ceil(f*m),u=e.height);var y,w,x,I,b,P,j,C,T,k,L,D,B,R,F,U,z,M,H,O,E,A,N,W,X,$,q,Y,V,J,_,G,Q,K,Z,ee=g<<2,te=f<<2,ie=0,re=0,ae=ee*u,oe=255.99/255,ne=g/f,se=u/v,de=ne*se;if(ne>1||se>1)for(o(),$=n(),q=$.data,I=0;u>I;I++)for(w=I/se,T=0|w,A=w-T,V=T*te,Y=1>T?V:V-te,v-2>T?(J=V+te,_=(T+2)*te):J=_=T>v-2?V:V+te,x=0;g>x;x++,re+=4)y=x/ne,C=0|y,N=y-C,Q=C<<2,G=1>C?Q:Q-4,f-2>C?(K=Q+4,Z=Q+8):K=Z=C>f-2?Q:Q+4,M=s(A,s(N,S[Y+G],S[Y+Q],S[Y+K],S[Y+Z]),s(N,S[V+G],S[V+Q],S[V+K],S[V+Z]),s(N,S[J+G],S[J+Q],S[J+K],S[J+Z]),s(N,S[_+G],S[_+Q],S[_+K],S[_+Z]))*oe|0,++G,++Q,++K,++Z,H=s(A,s(N,S[Y+G],S[Y+Q],S[Y+K],S[Y+Z]),s(N,S[V+G],S[V+Q],S[V+K],S[V+Z]),s(N,S[J+G],S[J+Q],S[J+K],S[J+Z]),s(N,S[_+G],S[_+Q],S[_+K],S[_+Z]))*oe|0,++G,++Q,++K,++Z,O=s(A,s(N,S[Y+G],S[Y+Q],S[Y+K],S[Y+Z]),s(N,S[V+G],S[V+Q],S[V+K],S[V+Z]),s(N,S[J+G],S[J+Q],S[J+K],S[J+Z]),s(N,S[_+G],S[_+Q],S[_+K],S[_+Z]))*oe|0,q[re]=M>=0?256>M?M:255:0,q[re+1]=H>=0?256>H?H:255:0,q[re+2]=O>=0?256>O?O:255:0,++G,++Q,++K,++Z,E=s(A,s(N,S[Y+G],S[Y+Q],S[Y+K],S[Y+Z]),s(N,S[V+G],S[V+Q],S[V+K],S[V+Z]),s(N,S[J+G],S[J+Q],S[J+K],S[J+Z]),s(N,S[_+G],S[_+Q],S[_+K],S[_+Z]))*oe|0,q[re+3]=E>=0?256>E?E:255:0;else{if(r.Float32Array)z=new Float32Array(ae);else for(z=[],re=0;ae>re;++re)z[re]=0;for(w=0;v>w;w++)for(I=w*se,j=0|I,b=j*ee,U=!!((j-(I+se|0))*(v-1-w))<<1,U&&(B=j+1-I,R=I+se-j-1),y=0;f>y;y++,ie+=4)switch(x=y*ne,P=0|x,re=b+(P<<2),F=!!((P-(x+ne|0))*(f-1-y)),F&&(L=P+1-x,D=x+ne-P-1),M=S[ie],H=S[ie+1],O=S[ie+2],E=S[ie+3],F+U){case 0:z[re]+=M*de,z[re+1]+=H*de,z[re+2]+=O*de,z[re+3]+=E*de;break;case 1:k=L*se,z[re]+=M*k,z[re+1]+=H*k,z[re+2]+=O*k,z[re+3]+=E*k,k=D*se,z[re+4]+=M*k,z[re+5]+=H*k,z[re+6]+=O*k,z[re+7]+=E*k;break;case 2:k=ne*B,z[re]+=M*k,z[re+1]+=H*k,z[re+2]+=O*k,z[re+3]+=E*k,k=ne*R,re+=ee,z[re]+=M*k,z[re+1]+=H*k,z[re+2]+=O*k,z[re+3]+=E*k;break;default:k=L*B,z[re]+=M*k,z[re+1]+=H*k,z[re+2]+=O*k,z[re+3]+=E*k,k=D*B,z[re+4]+=M*k,z[re+5]+=H*k,z[re+6]+=O*k,z[re+7]+=E*k,k=L*R,re+=ee,z[re]+=M*k,z[re+1]+=H*k,z[re+2]+=O*k,z[re+3]+=E*k,k=D*R,z[re+4]+=M*k,z[re+5]+=H*k,z[re+6]+=O*k,z[re+7]+=E*k}delete S,o(),$=n(z)}if(X.putImageData($,0,0),"string"==typeof i){if("png"===i||"jpeg"===i){var le;return le=a&&t.src?t:new Image,le.width=g,le.height=u,le.src=W.toDataURL("image/"+i,1),le}if("png-src"===i||"jpeg-src"===i)return W.toDataURL("image/"+i.split("-")[0],1)}return W}var r=this;"undefined"!=typeof e&&e.exports&&(t=e.exports=i),t.scale=i}).call(this)},function(e,t,i){var r,a,o;!function(n){"use strict";a=[i(4)],r=n,o="function"==typeof r?r.apply(t,a):r,!(void 0!==o&&(e.exports=o))}(function(e,t){"use strict";function i(t,i,r,a){for(var o=[],n=0;n<t.length;n++){var s=t[n];if(s){var d=tinycolor(s),l=d.toHsl().l<.5?"sp-thumb-el sp-thumb-dark":"sp-thumb-el sp-thumb-light";l+=tinycolor.equals(i,s)?" sp-thumb-active":"";var c=d.toString(a.preferredFormat||"rgb"),p=f?"background-color:"+d.toRgbString():"filter:"+d.toFilter();o.push('<span title="'+c+'" data-color="'+d.toRgbString()+'" class="'+l+'"><span class="sp-thumb-inner" style="'+p+';" /></span>')}else{var h="sp-clear-display";o.push(e("<div />").append(e('<span data-color="" style="background-color:transparent;" class="'+h+'"></span>').attr("title",a.noColorSelectedText)).html())}}return"<div class='sp-cf "+r+"'>"+o.join("")+"</div>"}function r(){for(var e=0;e<u.length;e++)u[e]&&u[e].hide()}function a(t,i){var r=e.extend({},g,t);return r.callbacks={move:l(r.move,i),change:l(r.change,i),show:l(r.show,i),hide:l(r.hide,i),beforeShow:l(r.beforeShow,i)},r}function o(o,s){function l(){if(Y.showPaletteOnly&&(Y.showPalette=!0),Oe.text(Y.showPaletteOnly?Y.togglePaletteMoreText:Y.togglePaletteLessText),Y.palette){ge=Y.palette.slice(0),ue=e.isArray(ge[0])?ge:[ge],me={};for(var t=0;t<ue.length;t++)for(var i=0;i<ue[t].length;i++){var r=tinycolor(ue[t][i]).toRgbString();me[r]=!0}}be.toggleClass("sp-flat",V),be.toggleClass("sp-input-disabled",!Y.showInput),be.toggleClass("sp-alpha-enabled",Y.showAlpha),be.toggleClass("sp-clear-enabled",Ge),be.toggleClass("sp-buttons-disabled",!Y.showButtons),be.toggleClass("sp-palette-buttons-disabled",!Y.togglePaletteOnly),be.toggleClass("sp-palette-disabled",!Y.showPalette),be.toggleClass("sp-palette-only",Y.showPaletteOnly),be.toggleClass("sp-initial-disabled",!Y.showInitial),be.addClass(Y.className).addClass(Y.containerClassName),A()}function g(){function t(t){return t.data&&t.data.ignore?(F(e(t.target).closest(".sp-thumb-el").data("color")),M()):(F(e(t.target).closest(".sp-thumb-el").data("color")),M(),E(!0),Y.hideAfterPaletteSelect&&B()),!1}if(m&&be.find("*:not(input)").attr("unselectable","on"),l(),Ne&&xe.after(We).hide(),Ge||Me.hide(),V)xe.after(be).hide();else{var i="parent"===Y.appendTo?xe.parent():e(Y.appendTo);1!==i.length&&(i=e("body")),i.append(be)}y(),Xe.bind("click.spectrum touchstart.spectrum",function(t){Ie||T(),t.stopPropagation(),e(t.target).is("input")||t.preventDefault()}),(xe.is(":disabled")||Y.disabled===!0)&&$(),be.click(d),Re.change(C),Re.bind("paste",function(){setTimeout(C,1)}),Re.keydown(function(e){13==e.keyCode&&C()}),ze.text(Y.cancelText),ze.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),R(),B()}),Me.attr("title",Y.clearText),Me.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),_e=!0,M(),V&&E(!0)}),He.text(Y.chooseText),He.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),m&&Re.is(":focus")&&Re.trigger("change"),z()&&(E(!0),B())}),Oe.text(Y.showPaletteOnly?Y.togglePaletteMoreText:Y.togglePaletteLessText),Oe.bind("click.spectrum",function(e){e.stopPropagation(),e.preventDefault(),Y.showPaletteOnly=!Y.showPaletteOnly,Y.showPaletteOnly||V||be.css("left","-="+(Pe.outerWidth(!0)+5)),l()}),c(De,function(e,t,i){he=e/ne,_e=!1,i.shiftKey&&(he=Math.round(10*he)/10),M()},P,j),c(Te,function(e,t){le=parseFloat(t/ae),_e=!1,Y.showAlpha||(he=1),M()},P,j),c(je,function(e,t,i){if(i.shiftKey){if(!ye){var r=ce*te,a=ie-pe*ie,o=Math.abs(e-r)>Math.abs(t-a);ye=o?"x":"y"}}else ye=null;var n=!ye||"x"===ye,s=!ye||"y"===ye;n&&(ce=parseFloat(e/te)),s&&(pe=parseFloat((ie-t)/ie)),_e=!1,Y.showAlpha||(he=1),M()},P,j),qe?(F(qe),H(),Ve=Y.preferredFormat||tinycolor(qe).format,w(qe)):H(),V&&k();var r=m?"mousedown.spectrum":"click.spectrum touchstart.spectrum";Fe.delegate(".sp-thumb-el",r,t),Ue.delegate(".sp-thumb-el:nth-child(1)",r,{ignore:!0},t)}function y(){if(_&&window.localStorage){try{var t=window.localStorage[_].split(",#");t.length>1&&(delete window.localStorage[_],e.each(t,function(e,t){w(t)}))}catch(i){}try{fe=window.localStorage[_].split(";")}catch(i){}}}function w(t){if(J){var i=tinycolor(t).toRgbString();if(!me[i]&&e.inArray(i,fe)===-1)for(fe.push(i);fe.length>ve;)fe.shift();if(_&&window.localStorage)try{window.localStorage[_]=fe.join(";")}catch(r){}}}function x(){var e=[];if(Y.showPalette)for(var t=0;t<fe.length;t++){var i=tinycolor(fe[t]).toRgbString();me[i]||e.push(fe[t])}return e.reverse().slice(0,Y.maxSelectionSize)}function I(){var t=U(),r=e.map(ue,function(e,r){return i(e,t,"sp-palette-row sp-palette-row-"+r,Y)});y(),fe&&r.push(i(x(),t,"sp-palette-row sp-palette-row-selection",Y)),Fe.html(r.join(""))}function b(){if(Y.showInitial){var e=Ye,t=U();Ue.html(i([e,t],t,"sp-palette-row-initial",Y))}}function P(){(ie<=0||te<=0||ae<=0)&&A(),ee=!0,be.addClass(Se),ye=null,xe.trigger("dragstart.spectrum",[U()])}function j(){ee=!1,be.removeClass(Se),xe.trigger("dragstop.spectrum",[U()])}function C(){var e=Re.val();if(null!==e&&""!==e||!Ge){var t=tinycolor(e);t.isValid()?(F(t),E(!0)):Re.addClass("sp-validation-error")}else F(null),E(!0)}function T(){Z?B():k()}function k(){var t=e.Event("beforeShow.spectrum");return Z?void A():(xe.trigger(t,[U()]),void(Q.beforeShow(U())===!1||t.isDefaultPrevented()||(r(),Z=!0,e(we).bind("keydown.spectrum",L),e(we).bind("click.spectrum",D),e(window).bind("resize.spectrum",K),We.addClass("sp-active"),be.removeClass("sp-hidden"),A(),H(),Ye=U(),b(),Q.show(Ye),xe.trigger("show.spectrum",[Ye]))))}function L(e){27===e.keyCode&&B()}function D(e){2!=e.button&&(ee||(Je?E(!0):R(),B()))}function B(){Z&&!V&&(Z=!1,e(we).unbind("keydown.spectrum",L),e(we).unbind("click.spectrum",D),e(window).unbind("resize.spectrum",K),We.removeClass("sp-active"),be.addClass("sp-hidden"),Q.hide(U()),xe.trigger("hide.spectrum",[U()]))}function R(){F(Ye,!0)}function F(e,t){if(tinycolor.equals(e,U()))return void H();var i,r;!e&&Ge?_e=!0:(_e=!1,i=tinycolor(e),r=i.toHsv(),le=r.h%360/360,ce=r.s,pe=r.v,he=r.a),H(),i&&i.isValid()&&!t&&(Ve=Y.preferredFormat||i.getFormat())}function U(e){return e=e||{},Ge&&_e?null:tinycolor.fromRatio({h:le,s:ce,v:pe,a:Math.round(100*he)/100},{format:e.format||Ve})}function z(){return!Re.hasClass("sp-validation-error")}function M(){H(),Q.move(U()),xe.trigger("move.spectrum",[U()])}function H(){Re.removeClass("sp-validation-error"),O();var e=tinycolor.fromRatio({h:le,s:1,v:1});je.css("background-color",e.toHexString());var t=Ve;he<1&&(0!==he||"name"!==t)&&("hex"!==t&&"hex3"!==t&&"hex6"!==t&&"name"!==t||(t="rgb"));var i=U({format:t}),r="";if($e.removeClass("sp-clear-display"),$e.css("background-color","transparent"),!i&&Ge)$e.addClass("sp-clear-display");else{var a=i.toHexString(),o=i.toRgbString();if(f||1===i.alpha?$e.css("background-color",o):($e.css("background-color","transparent"),$e.css("filter",i.toFilter())),Y.showAlpha){var n=i.toRgb();n.a=0;var s=tinycolor(n).toRgbString(),d="linear-gradient(left, "+s+", "+a+")";m?Le.css("filter",tinycolor(s).toFilter({gradientType:1},a)):(Le.css("background","-webkit-"+d),Le.css("background","-moz-"+d),Le.css("background","-ms-"+d),Le.css("background","linear-gradient(to right, "+s+", "+a+")"))}r=i.toString(t)}Y.showInput&&Re.val(r),Y.showPalette&&I(),b()}function O(){var e=ce,t=pe;if(Ge&&_e)Be.hide(),ke.hide(),Ce.hide();else{Be.show(),ke.show(),Ce.show();var i=e*te,r=ie-t*ie;i=Math.max(-re,Math.min(te-re,i-re)),r=Math.max(-re,Math.min(ie-re,r-re)),Ce.css({top:r+"px",left:i+"px"});var a=he*ne;Be.css({left:a-se/2+"px"});var o=le*ae;ke.css({top:o-de+"px"})}}function E(e){var t=U(),i="",r=!tinycolor.equals(t,Ye);t&&(i=t.toString(Ve),w(t)),Ee&&xe.val(i),e&&r&&(Q.change(t),xe.trigger("change",[t]))}function A(){Z&&(te=je.width(),ie=je.height(),re=Ce.height(),oe=Te.width(),ae=Te.height(),de=ke.height(),ne=De.width(),se=Be.width(),V||(be.css("position","absolute"),Y.offset?be.offset(Y.offset):be.offset(n(be,Xe))),O(),Y.showPalette&&I(),xe.trigger("reflow.spectrum"))}function N(){xe.show(),Xe.unbind("click.spectrum touchstart.spectrum"),be.remove(),We.remove(),u[Qe.id]=null}function W(i,r){return i===t?e.extend({},Y):r===t?Y[i]:(Y[i]=r,"preferredFormat"===i&&(Ve=Y.preferredFormat),void l())}function X(){Ie=!1,xe.attr("disabled",!1),Xe.removeClass("sp-disabled")}function $(){B(),Ie=!0,xe.attr("disabled",!0),Xe.addClass("sp-disabled")}function q(e){Y.offset=e,A()}var Y=a(s,o),V=Y.flat,J=Y.showSelectionPalette,_=Y.localStorageKey,G=Y.theme,Q=Y.callbacks,K=p(A,10),Z=!1,ee=!1,te=0,ie=0,re=0,ae=0,oe=0,ne=0,se=0,de=0,le=0,ce=0,pe=0,he=1,ge=[],ue=[],me={},fe=Y.selectionPalette.slice(0),ve=Y.maxSelectionSize,Se="sp-dragging",ye=null,we=o.ownerDocument,xe=(we.body,e(o)),Ie=!1,be=e(S,we).addClass(G),Pe=be.find(".sp-picker-container"),je=be.find(".sp-color"),Ce=be.find(".sp-dragger"),Te=be.find(".sp-hue"),ke=be.find(".sp-slider"),Le=be.find(".sp-alpha-inner"),De=be.find(".sp-alpha"),Be=be.find(".sp-alpha-handle"),Re=be.find(".sp-input"),Fe=be.find(".sp-palette"),Ue=be.find(".sp-initial"),ze=be.find(".sp-cancel"),Me=be.find(".sp-clear"),He=be.find(".sp-choose"),Oe=be.find(".sp-palette-toggle"),Ee=xe.is("input"),Ae=Ee&&"color"===xe.attr("type")&&h(),Ne=Ee&&!V,We=Ne?e(v).addClass(G).addClass(Y.className).addClass(Y.replacerClassName):e([]),Xe=Ne?We:xe,$e=We.find(".sp-preview-inner"),qe=Y.color||Ee&&xe.val(),Ye=!1,Ve=Y.preferredFormat,Je=!Y.showButtons||Y.clickoutFiresChange,_e=!qe,Ge=Y.allowEmpty&&!Ae;g();var Qe={show:k,hide:B,toggle:T,reflow:A,option:W,enable:X,disable:$,offset:q,set:function(e){F(e),E()},get:U,destroy:N,container:be};return Qe.id=u.push(Qe)-1,Qe}function n(t,i){var r=0,a=t.outerWidth(),o=t.outerHeight(),n=i.outerHeight(),s=t[0].ownerDocument,d=s.documentElement,l=d.clientWidth+e(s).scrollLeft(),c=d.clientHeight+e(s).scrollTop(),p=i.offset();return p.top+=n,p.left-=Math.min(p.left,p.left+a>l&&l>a?Math.abs(p.left+a-l):0),p.top-=Math.min(p.top,p.top+o>c&&c>o?Math.abs(o+n-r):r),p}function s(){}function d(e){e.stopPropagation()}function l(e,t){var i=Array.prototype.slice,r=i.call(arguments,2);return function(){return e.apply(t,r.concat(i.call(arguments)))}}function c(t,i,r,a){function o(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault(),e.returnValue=!1}function n(e){if(c){if(m&&l.documentMode<9&&!e.button)return d();var r=e.originalEvent&&e.originalEvent.touches&&e.originalEvent.touches[0],a=r&&r.pageX||e.pageX,n=r&&r.pageY||e.pageY,s=Math.max(0,Math.min(a-p.left,g)),f=Math.max(0,Math.min(n-p.top,h));u&&o(e),i.apply(t,[s,f,e])}}function s(i){var a=i.which?3==i.which:2==i.button;a||c||r.apply(t,arguments)!==!1&&(c=!0,h=e(t).height(),g=e(t).width(),p=e(t).offset(),e(l).bind(f),e(l.body).addClass("sp-dragging"),n(i),o(i))}function d(){c&&(e(l).unbind(f),e(l.body).removeClass("sp-dragging"),setTimeout(function(){a.apply(t,arguments)},0)),c=!1}i=i||function(){},r=r||function(){},a=a||function(){};var l=document,c=!1,p={},h=0,g=0,u="ontouchstart"in window,f={};f.selectstart=o,f.dragstart=o,f["touchmove mousemove"]=n,f["touchend mouseup"]=d,e(t).bind("touchstart mousedown",s)}function p(e,t,i){var r;return function(){var a=this,o=arguments,n=function(){r=null,e.apply(a,o)};i&&clearTimeout(r),!i&&r||(r=setTimeout(n,t))}}function h(){return e.fn.spectrum.inputTypeColorSupport()}var g={beforeShow:s,move:s,change:s,show:s,hide:s,color:!1,flat:!1,showInput:!1,allowEmpty:!1,showButtons:!0,clickoutFiresChange:!0,showInitial:!1,showPalette:!1,showPaletteOnly:!1,hideAfterPaletteSelect:!1,togglePaletteOnly:!1,showSelectionPalette:!0,localStorageKey:!1,appendTo:"body",maxSelectionSize:7,cancelText:"cancel",chooseText:"choose",togglePaletteMoreText:"more",togglePaletteLessText:"less",clearText:"Clear Color Selection",noColorSelectedText:"No Color Selected",preferredFormat:!1,className:"",containerClassName:"",replacerClassName:"",showAlpha:!1,theme:"sp-light",palette:[["#ffffff","#000000","#ff0000","#ff8000","#ffff00","#008000","#0000ff","#4b0082","#9400d3"]],selectionPalette:[],disabled:!1,offset:null},u=[],m=!!/msie/i.exec(window.navigator.userAgent),f=function(){function e(e,t){return!!~(""+e).indexOf(t)}var t=document.createElement("div"),i=t.style;return i.cssText="background-color:rgba(0,0,0,.5)",e(i.backgroundColor,"rgba")||e(i.backgroundColor,"hsla")}(),v=["<div class='sp-replacer'>","<div class='sp-preview'><div class='sp-preview-inner'></div></div>","<div class='sp-dd'>&#9660;</div>","</div>"].join(""),S=function(){var e="";if(m)for(var t=1;t<=6;t++)e+="<div class='sp-"+t+"'></div>";return["<div class='sp-container sp-hidden'>","<div class='sp-palette-container'>","<div class='sp-palette sp-thumb sp-cf'></div>","<div class='sp-palette-button-container sp-cf'>","<button type='button' class='sp-palette-toggle'></button>","</div>","</div>","<div class='sp-picker-container'>","<div class='sp-top sp-cf'>","<div class='sp-fill'></div>","<div class='sp-top-inner'>","<div class='sp-color'>","<div class='sp-sat'>","<div class='sp-val'>","<div class='sp-dragger'></div>","</div>","</div>","</div>","<div class='sp-clear sp-clear-display'>","</div>","<div class='sp-hue'>","<div class='sp-slider'></div>",e,"</div>","</div>","<div class='sp-alpha'><div class='sp-alpha-inner'><div class='sp-alpha-handle'></div></div></div>","</div>","<div class='sp-input-container sp-cf'>","<input class='sp-input' type='text' spellcheck='false'  />","</div>","<div class='sp-initial sp-thumb sp-cf'></div>","<div class='sp-button-container sp-cf'>","<a class='sp-cancel' href='#'></a>","<button type='button' class='sp-choose'></button>","</div>","</div>","</div>"].join("")}(),y="spectrum.id";e.fn.spectrum=function(t,i){if("string"==typeof t){var r=this,a=Array.prototype.slice.call(arguments,1);return this.each(function(){var i=u[e(this).data(y)];if(i){var o=i[t];if(!o)throw new Error("Spectrum: no such method: '"+t+"'");"get"==t?r=i.get():"container"==t?r=i.container:"option"==t?r=i.option.apply(i,a):"destroy"==t?(i.destroy(),e(this).removeData(y)):o.apply(i,a)}}),r}return this.spectrum("destroy").each(function(){var i=e.extend({},t,e(this).data()),r=o(this,i);e(this).data(y,r.id)})},e.fn.spectrum.load=!0,e.fn.spectrum.loadOpts={},e.fn.spectrum.draggable=c,e.fn.spectrum.defaults=g,e.fn.spectrum.inputTypeColorSupport=function w(){if("undefined"==typeof w._cachedResult){var t=e("<input type='color'/>")[0];w._cachedResult="color"===t.type&&""!==t.value}return w._cachedResult},e.spectrum={},e.spectrum.localization={},e.spectrum.palettes={},e.fn.spectrum.processNativeColorInputs=function(){var t=e("input[type=color]");t.length&&!h()&&t.spectrum({preferredFormat:"hex6"})},function(){function e(e){var i={r:0,g:0,b:0},a=1,n=!1,s=!1;return"string"==typeof e&&(e=R(e)),"object"==typeof e&&(e.hasOwnProperty("r")&&e.hasOwnProperty("g")&&e.hasOwnProperty("b")?(i=t(e.r,e.g,e.b),n=!0,s="%"===String(e.r).substr(-1)?"prgb":"rgb"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("v")?(e.s=L(e.s),e.v=L(e.v),i=o(e.h,e.s,e.v),n=!0,s="hsv"):e.hasOwnProperty("h")&&e.hasOwnProperty("s")&&e.hasOwnProperty("l")&&(e.s=L(e.s),e.l=L(e.l),i=r(e.h,e.s,e.l),n=!0,s="hsl"),e.hasOwnProperty("a")&&(a=e.a)),a=I(a),{ok:n,format:e.format||s,r:O(255,E(i.r,0)),g:O(255,E(i.g,0)),b:O(255,E(i.b,0)),a:a}}function t(e,t,i){return{r:255*b(e,255),g:255*b(t,255),b:255*b(i,255)}}function i(e,t,i){e=b(e,255),t=b(t,255),i=b(i,255);var r,a,o=E(e,t,i),n=O(e,t,i),s=(o+n)/2;if(o==n)r=a=0;else{var d=o-n;switch(a=s>.5?d/(2-o-n):d/(o+n),o){case e:r=(t-i)/d+(t<i?6:0);break;case t:r=(i-e)/d+2;break;case i:r=(e-t)/d+4}r/=6}return{h:r,s:a,l:s}}function r(e,t,i){function r(e,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?e+6*(t-e)*i:i<.5?t:i<2/3?e+(t-e)*(2/3-i)*6:e}var a,o,n;if(e=b(e,360),t=b(t,100),i=b(i,100),0===t)a=o=n=i;else{var s=i<.5?i*(1+t):i+t-i*t,d=2*i-s;a=r(d,s,e+1/3),o=r(d,s,e),n=r(d,s,e-1/3)}return{r:255*a,g:255*o,b:255*n}}function a(e,t,i){e=b(e,255),t=b(t,255),i=b(i,255);var r,a,o=E(e,t,i),n=O(e,t,i),s=o,d=o-n;if(a=0===o?0:d/o,o==n)r=0;else{switch(o){case e:r=(t-i)/d+(t<i?6:0);break;case t:r=(i-e)/d+2;break;case i:r=(e-t)/d+4}r/=6}return{h:r,s:a,v:s}}function o(e,t,i){e=6*b(e,360),t=b(t,100),i=b(i,100);var r=M.floor(e),a=e-r,o=i*(1-t),n=i*(1-a*t),s=i*(1-(1-a)*t),d=r%6,l=[i,n,o,o,s,i][d],c=[s,i,i,n,o,o][d],p=[o,o,s,i,i,n][d];return{r:255*l,g:255*c,b:255*p}}function n(e,t,i,r){var a=[k(H(e).toString(16)),k(H(t).toString(16)),k(H(i).toString(16))];return r&&a[0].charAt(0)==a[0].charAt(1)&&a[1].charAt(0)==a[1].charAt(1)&&a[2].charAt(0)==a[2].charAt(1)?a[0].charAt(0)+a[1].charAt(0)+a[2].charAt(0):a.join("")}function s(e,t,i,r){var a=[k(D(r)),k(H(e).toString(16)),k(H(t).toString(16)),k(H(i).toString(16))];return a.join("")}function d(e,t){t=0===t?0:t||10;var i=N(e).toHsl();return i.s-=t/100,i.s=P(i.s),N(i)}function l(e,t){t=0===t?0:t||10;var i=N(e).toHsl();return i.s+=t/100,i.s=P(i.s),N(i)}function c(e){return N(e).desaturate(100)}function p(e,t){t=0===t?0:t||10;var i=N(e).toHsl();return i.l+=t/100,i.l=P(i.l),N(i)}function h(e,t){t=0===t?0:t||10;var i=N(e).toRgb();return i.r=E(0,O(255,i.r-H(255*-(t/100)))),i.g=E(0,O(255,i.g-H(255*-(t/100)))),i.b=E(0,O(255,i.b-H(255*-(t/100)))),N(i)}function g(e,t){t=0===t?0:t||10;var i=N(e).toHsl();return i.l-=t/100,i.l=P(i.l),N(i)}function u(e,t){var i=N(e).toHsl(),r=(H(i.h)+t)%360;return i.h=r<0?360+r:r,N(i)}function m(e){var t=N(e).toHsl();return t.h=(t.h+180)%360,N(t)}function f(e){var t=N(e).toHsl(),i=t.h;return[N(e),N({h:(i+120)%360,s:t.s,l:t.l}),N({h:(i+240)%360,s:t.s,l:t.l})]}function v(e){var t=N(e).toHsl(),i=t.h;return[N(e),N({h:(i+90)%360,s:t.s,l:t.l}),N({h:(i+180)%360,s:t.s,l:t.l}),N({h:(i+270)%360,s:t.s,l:t.l})]}function S(e){var t=N(e).toHsl(),i=t.h;return[N(e),N({h:(i+72)%360,s:t.s,l:t.l}),N({h:(i+216)%360,s:t.s,l:t.l})]}function y(e,t,i){t=t||6,i=i||30;var r=N(e).toHsl(),a=360/i,o=[N(e)];for(r.h=(r.h-(a*t>>1)+720)%360;--t;)r.h=(r.h+a)%360,o.push(N(r));return o}function w(e,t){t=t||6;for(var i=N(e).toHsv(),r=i.h,a=i.s,o=i.v,n=[],s=1/t;t--;)n.push(N({h:r,s:a,v:o})),o=(o+s)%1;return n}function x(e){var t={};for(var i in e)e.hasOwnProperty(i)&&(t[e[i]]=i);return t}function I(e){return e=parseFloat(e),(isNaN(e)||e<0||e>1)&&(e=1),e}function b(e,t){C(e)&&(e="100%");var i=T(e);return e=O(t,E(0,parseFloat(e))),i&&(e=parseInt(e*t,10)/100),M.abs(e-t)<1e-6?1:e%t/parseFloat(t)}function P(e){return O(1,E(0,e))}function j(e){return parseInt(e,16)}function C(e){return"string"==typeof e&&e.indexOf(".")!=-1&&1===parseFloat(e)}function T(e){return"string"==typeof e&&e.indexOf("%")!=-1}function k(e){return 1==e.length?"0"+e:""+e}function L(e){return e<=1&&(e=100*e+"%"),e}function D(e){return Math.round(255*parseFloat(e)).toString(16)}function B(e){return j(e)/255}function R(e){e=e.replace(F,"").replace(U,"").toLowerCase();var t=!1;if(W[e])e=W[e],t=!0;else if("transparent"==e)return{r:0,g:0,b:0,a:0,format:"name"};var i;return(i=$.rgb.exec(e))?{r:i[1],g:i[2],b:i[3]}:(i=$.rgba.exec(e))?{r:i[1],g:i[2],b:i[3],a:i[4]}:(i=$.hsl.exec(e))?{h:i[1],s:i[2],l:i[3]}:(i=$.hsla.exec(e))?{h:i[1],s:i[2],l:i[3],a:i[4]}:(i=$.hsv.exec(e))?{h:i[1],s:i[2],v:i[3]}:(i=$.hsva.exec(e))?{h:i[1],s:i[2],v:i[3],a:i[4]}:(i=$.hex8.exec(e))?{a:B(i[1]),r:j(i[2]),g:j(i[3]),b:j(i[4]),format:t?"name":"hex8"}:(i=$.hex6.exec(e))?{r:j(i[1]),g:j(i[2]),b:j(i[3]),format:t?"name":"hex"}:!!(i=$.hex3.exec(e))&&{r:j(i[1]+""+i[1]),g:j(i[2]+""+i[2]),b:j(i[3]+""+i[3]),format:t?"name":"hex"}}var F=/^[\s,#]+/,U=/\s+$/,z=0,M=Math,H=M.round,O=M.min,E=M.max,A=M.random,N=function(t,i){if(t=t?t:"",i=i||{},t instanceof N)return t;if(!(this instanceof N))return new N(t,i);var r=e(t);this._originalInput=t,this._r=r.r,this._g=r.g,this._b=r.b,this._a=r.a,this._roundA=H(100*this._a)/100,this._format=i.format||r.format,this._gradientType=i.gradientType,this._r<1&&(this._r=H(this._r)),this._g<1&&(this._g=H(this._g)),this._b<1&&(this._b=H(this._b)),this._ok=r.ok,this._tc_id=z++};N.prototype={isDark:function(){return this.getBrightness()<128},isLight:function(){return!this.isDark()},isValid:function(){return this._ok},getOriginalInput:function(){return this._originalInput},getFormat:function(){return this._format},getAlpha:function(){return this._a},getBrightness:function(){var e=this.toRgb();return(299*e.r+587*e.g+114*e.b)/1e3},setAlpha:function(e){return this._a=I(e),this._roundA=H(100*this._a)/100,this},toHsv:function(){var e=a(this._r,this._g,this._b);return{h:360*e.h,s:e.s,v:e.v,a:this._a}},toHsvString:function(){var e=a(this._r,this._g,this._b),t=H(360*e.h),i=H(100*e.s),r=H(100*e.v);return 1==this._a?"hsv("+t+", "+i+"%, "+r+"%)":"hsva("+t+", "+i+"%, "+r+"%, "+this._roundA+")"},toHsl:function(){var e=i(this._r,this._g,this._b);return{h:360*e.h,s:e.s,l:e.l,a:this._a}},toHslString:function(){var e=i(this._r,this._g,this._b),t=H(360*e.h),r=H(100*e.s),a=H(100*e.l);return 1==this._a?"hsl("+t+", "+r+"%, "+a+"%)":"hsla("+t+", "+r+"%, "+a+"%, "+this._roundA+")"},toHex:function(e){return n(this._r,this._g,this._b,e)},toHexString:function(e){return"#"+this.toHex(e)},toHex8:function(){return s(this._r,this._g,this._b,this._a)},toHex8String:function(){return"#"+this.toHex8()},toRgb:function(){return{r:H(this._r),g:H(this._g),b:H(this._b),a:this._a}},toRgbString:function(){return 1==this._a?"rgb("+H(this._r)+", "+H(this._g)+", "+H(this._b)+")":"rgba("+H(this._r)+", "+H(this._g)+", "+H(this._b)+", "+this._roundA+")"},toPercentageRgb:function(){return{r:H(100*b(this._r,255))+"%",g:H(100*b(this._g,255))+"%",b:H(100*b(this._b,255))+"%",a:this._a}},toPercentageRgbString:function(){return 1==this._a?"rgb("+H(100*b(this._r,255))+"%, "+H(100*b(this._g,255))+"%, "+H(100*b(this._b,255))+"%)":"rgba("+H(100*b(this._r,255))+"%, "+H(100*b(this._g,255))+"%, "+H(100*b(this._b,255))+"%, "+this._roundA+")";
},toName:function(){return 0===this._a?"transparent":!(this._a<1)&&(X[n(this._r,this._g,this._b,!0)]||!1)},toFilter:function(e){var t="#"+s(this._r,this._g,this._b,this._a),i=t,r=this._gradientType?"GradientType = 1, ":"";if(e){var a=N(e);i=a.toHex8String()}return"progid:DXImageTransform.Microsoft.gradient("+r+"startColorstr="+t+",endColorstr="+i+")"},toString:function(e){var t=!!e;e=e||this._format;var i=!1,r=this._a<1&&this._a>=0,a=!t&&r&&("hex"===e||"hex6"===e||"hex3"===e||"name"===e);return a?"name"===e&&0===this._a?this.toName():this.toRgbString():("rgb"===e&&(i=this.toRgbString()),"prgb"===e&&(i=this.toPercentageRgbString()),"hex"!==e&&"hex6"!==e||(i=this.toHexString()),"hex3"===e&&(i=this.toHexString(!0)),"hex8"===e&&(i=this.toHex8String()),"name"===e&&(i=this.toName()),"hsl"===e&&(i=this.toHslString()),"hsv"===e&&(i=this.toHsvString()),i||this.toHexString())},_applyModification:function(e,t){var i=e.apply(null,[this].concat([].slice.call(t)));return this._r=i._r,this._g=i._g,this._b=i._b,this.setAlpha(i._a),this},lighten:function(){return this._applyModification(p,arguments)},brighten:function(){return this._applyModification(h,arguments)},darken:function(){return this._applyModification(g,arguments)},desaturate:function(){return this._applyModification(d,arguments)},saturate:function(){return this._applyModification(l,arguments)},greyscale:function(){return this._applyModification(c,arguments)},spin:function(){return this._applyModification(u,arguments)},_applyCombination:function(e,t){return e.apply(null,[this].concat([].slice.call(t)))},analogous:function(){return this._applyCombination(y,arguments)},complement:function(){return this._applyCombination(m,arguments)},monochromatic:function(){return this._applyCombination(w,arguments)},splitcomplement:function(){return this._applyCombination(S,arguments)},triad:function(){return this._applyCombination(f,arguments)},tetrad:function(){return this._applyCombination(v,arguments)}},N.fromRatio=function(e,t){if("object"==typeof e){var i={};for(var r in e)e.hasOwnProperty(r)&&("a"===r?i[r]=e[r]:i[r]=L(e[r]));e=i}return N(e,t)},N.equals=function(e,t){return!(!e||!t)&&N(e).toRgbString()==N(t).toRgbString()},N.random=function(){return N.fromRatio({r:A(),g:A(),b:A()})},N.mix=function(e,t,i){i=0===i?0:i||50;var r,a=N(e).toRgb(),o=N(t).toRgb(),n=i/100,s=2*n-1,d=o.a-a.a;r=s*d==-1?s:(s+d)/(1+s*d),r=(r+1)/2;var l=1-r,c={r:o.r*r+a.r*l,g:o.g*r+a.g*l,b:o.b*r+a.b*l,a:o.a*n+a.a*(1-n)};return N(c)},N.readability=function(e,t){var i=N(e),r=N(t),a=i.toRgb(),o=r.toRgb(),n=i.getBrightness(),s=r.getBrightness(),d=Math.max(a.r,o.r)-Math.min(a.r,o.r)+Math.max(a.g,o.g)-Math.min(a.g,o.g)+Math.max(a.b,o.b)-Math.min(a.b,o.b);return{brightness:Math.abs(n-s),color:d}},N.isReadable=function(e,t){var i=N.readability(e,t);return i.brightness>125&&i.color>500},N.mostReadable=function(e,t){for(var i=null,r=0,a=!1,o=0;o<t.length;o++){var n=N.readability(e,t[o]),s=n.brightness>125&&n.color>500,d=3*(n.brightness/125)+n.color/500;(s&&!a||s&&a&&d>r||!s&&!a&&d>r)&&(a=s,r=d,i=N(t[o]))}return i};var W=N.names={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"0ff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000",blanchedalmond:"ffebcd",blue:"00f",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",burntsienna:"ea7e5d",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"0ff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkgrey:"a9a9a9",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkslategrey:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dimgrey:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"f0f",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",grey:"808080",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgray:"d3d3d3",lightgreen:"90ee90",lightgrey:"d3d3d3",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"789",lightslategrey:"789",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"0f0",limegreen:"32cd32",linen:"faf0e6",magenta:"f0f",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370db",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"db7093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",rebeccapurple:"663399",red:"f00",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",slategrey:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"fff",whitesmoke:"f5f5f5",yellow:"ff0",yellowgreen:"9acd32"},X=N.hexNames=x(W),$=function(){var e="[-\\+]?\\d+%?",t="[-\\+]?\\d*\\.\\d+%?",i="(?:"+t+")|(?:"+e+")",r="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?",a="[\\s|\\(]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")[,|\\s]+("+i+")\\s*\\)?";return{rgb:new RegExp("rgb"+r),rgba:new RegExp("rgba"+a),hsl:new RegExp("hsl"+r),hsla:new RegExp("hsla"+a),hsv:new RegExp("hsv"+r),hsva:new RegExp("hsva"+a),hex3:/^([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex8:/^([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/}}();window.tinycolor=N}(),e(function(){e.fn.spectrum.load&&e.fn.spectrum.processNativeColorInputs()})})},function(e,t,i){!function(t,i){e.exports=i()}(this,function(){"use strict";function e(e){var t=null,i=document.cookie.split(";");if(i)for(var r=0;r<i.length;r++){var a=i[r].split("=");if(a.length>1&&e==a[0]){t=unescape(a[1]);break}}return t}function t(t,r,a,o,n){var s=window.location.hostname+"",r=r||e(" JSESSIONID")||e("JSESSIONID"),d=a||e(" AS_UID")||e("AS_UID");t=r+","+d+","+(new Date).getTime()+","+t;var l="https://venus.zno.com/b.htm?"+t;"www.zno.com"!=s&&(l="https://log.zno.com.t/b.htm?"+t),i(l,o,n)}function i(e,t,i){var r=new XMLHttpRequest;r.onload=function(e){t&&"function"==typeof t&&t(e||window.event)},r.onerror=function(e){i&&"function"==typeof i&&i(e||window.event)},r.open("GET",e),r.send()}return{go:t}})},function(e,t,i){(function(t,r){e.exports={saveRemarkProject:function(e,a){var o=i(51).getCurrentProjectJson();if(!o.project.pages.length)return t.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Please select one block at least."}),a&&a();var n=i(12).getNewPrintSkuJson(o),s=t.domains.backendBaseUrl+"/backend/orderSync/newPrintsRemake.ep";r.ajax({url:s,type:"post",data:{projectId:t.projectId,remarkProjectJson:JSON.stringify(n),orderNumber:t.orderNumber,timestamp:t.timestamp,token:t.token,pUser:t.pUser}}).done(function(i){console.log(i),i&&"success"===i.status?(e&&e(),t.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Reprint successfully"})):(a&&a(),t.vm.$dispatch("dispatchShowPopup",{type:"checkFailed",status:0,info:"Failed to reprint, please try again later."}))})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){var a=i(17);e.exports={initProjectJson:function(){for(var e=i(1).getOptionIds(),o=t.projectSettings[t.currentSelectProjectIndex],n=r(t.spec.specXml).find("product-spec").attr("version"),s={},d=r.extend(!0,[],this.initPages()),l=0;l<e.length;l++)s[e[l]]=o[e[l]];return{project:{version:n,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:a.formatDateTime(new Date),updatedDate:a.formatDateTime(new Date),summary:{defaultSetting:s},pages:d,images:[]}}},initPages:function(){for(var e=[],r=i(12).getBaseSize(),a=i(12).getBleedSize(),o=r.width+a.left+a.right,n=r.height+a.top+a.right,s=i(1).getOptionIds(),d=t.projectSettings[t.currentSelectProjectIndex],l={},c=0;c<s.length;c++)l[s[c]]=d[s[c]];l.quantity=1;for(var c=0;c<t.LSCPageNum;c++)e.push({id:i(6).guid(),width:o,height:n,type:"Page",bleed:a,spec:l,elements:[i(12).getDefaultElement(o,n)],backend:{isPrint:!0}});return e},getCurrentProjectJson:function(){for(var e=i(1).getOptionIds(),o={},n=0;n<e.length;n++)o[e[n]]=t.baseProject[e[n]];var s=r(t.spec.specXml).find("product-spec").attr("version"),d=this.getPages(),l=i(12).getImages();return{project:{guid:t.projectId,version:s,clientId:"web-h5",createAuthor:"web-h5|1.1|1",userId:t.userSettings.userId,artisan:t.userSettings.userName,createdDate:t.createdDate,updatedDate:a.formatDateTime(new Date),summary:{defaultSetting:o},pages:d,images:l}}},getPages:function(){for(var e=[],r=0;r<t.pages.length;r++)if(!t.pages[r].isDeleted&&0!==t.projectSettings[r].quantity){for(var a=i(12).getBleedSize(r),o=i(12).getPhotoLayer(r),n=o.width,s=o.height,d=(i(12).getElements(r),i(1).getOptionIds()),l=t.projectSettings[r],c={},p=0;p<d.length;p++)c[d[p]]=l[d[p]];c.quantity=l.quantity;var h=t.pages[r].guid||i(6).guid();e.push({id:h,width:n,height:s,type:"Page",spec:c,bleed:a,elements:i(12).getElements(r),backend:{isPrint:!0}})}return e}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={template:'<div class="bed-actionpanel-top"><div style="height: 66px;text-align: center;"><div class="button action-item" style="margin: 30px 40px 20px 0; width: 120px;height: 28px;line-height: 28px;border-radius: 14px;text-align: center;font-size: 12px; font-weight: 500;display:none;" v-on:click="handleAddText()">Add Text</div><div v-show="showRotate" v-bind:class="{button:rotated,\'button-white\':!rotated}" class="action-item font-normal" style="border:1px solid #393939;margin: 30px 0 10px 0; width: 120px;height: 24px;line-height: 24px;border-radius: 14px 0 0 14px ;text-align: center;font-size: 12px;" v-on:click="handleRotate(\'H\')">Landscape</div><div v-show="showRotate" v-bind:class="{button:!rotated,\'button-white\':rotated}" class="action-item font-normal" style="border:1px solid #393939;;margin: 30px 0 10px 0; width: 120px;height: 24px;line-height: 24px;border-radius: 0 14px 14px 0;text-align: center;font-size: 12px;" v-on:click="handleRotate(\'V\')">Portrait</div><div class="button action-item" style="margin-top: 30px; margin-bottom: 20px; width: 120px;height: 28px;line-height: 28px;border-radius: 14px;text-align: center;font-size: 12px; font-weight: 500;display:none;" id="show-edit-matt" v-on:click="handleEdit()">Setting</div></div></div>',data:function(){return{privateStore:{showRotate:!0},sharedStore:t,rotated:""}},computed:{rotated:function(){return this.sharedStore.projectSettings[this.sharedStore.currentSelectProjectIndex].rotated},showRotate:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.size;return i.split("X")[0]!==i.split("X")[1]}},methods:{handleAddText:function(){this.$dispatch("dispatchShowAddText")},handleRotate:function(e){var r=t.projectSettings[t.currentSelectProjectIndex];(r.rotated&&"Landscape"===r.orientation&&"V"===e||!r.rotated&&"Portrait"===r.orientation&&"H"===e)&&(this.sharedStore.isSwitchLoadingShow=!0,r.rotated=!r.rotated,r.orientation="Landscape"===r.orientation?"Portrait":"Landscape",i(8)({ev:i(9).SwitchOrientation,orientation:"Landscape"===r.orientation?"Landscape":"Portrait"}),this.$dispatch("dispatchRotate"),this.sharedStore.pages[t.selectedPageIdx].canvas.pageItems[0].handleRepaint(),this.$dispatch("dispatchRotateTemplate"))},handleEdit:function(){this.$dispatch("dispatchShowMattingGlassEdit")}}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={template:'<div v-show="sharedStore.watches.isProjectLoaded" v-bind:style="topStyle" class="bed-actionpanel-bottom"><div style="height: 34px;text-align: center;"><div class="action-item" v-on:click="changePage(currentPage !== \'Front\')" v-bind:style="{ marginTop:marginTop }" style="cursor: pointer;background:white;border:1px solid #d6d6d6; width: 140px;height: 22px;line-height: 22px;border-radius: 4px;overflow:hidden;"><span style="width:20px;margin-right: 6px;margin-top:6px;font-size: 0px;"><img src="./assets/img/icon/fresh.svg" height="12" width="13" alt="Change Page" title="Change Page" style="position: relative; transform: translateY(1px);" /></span><span class="font-book" style="font-size:12px;color:#7b7b7b;">{{ currentPage }}</span></div></div></div>',data:function(){return{privateStore:{},sharedStore:t}},computed:{marginTop:function(){return 0},currentPage:function(){return this.sharedStore.isFrontPage?"Front":"Back"},topStyle:function(){return this.sharedStore.isPreview?{position:"relative",top:"0px",zIndex:99999}:{top:"0"}}},methods:{changePage:function(e){var t=this.sharedStore.isFrontPage,r=this.sharedStore.isPreview?"SwitchSideInPreview":"SwitchSide";t&&!e&&(this.sharedStore.isFrontPage=!1,i(8)({ev:i(9)[r],side:"back",isFromFactory:this.sharedStore.isFromFactory})),!t&&e&&(this.sharedStore.isFrontPage=!0,i(8)({ev:i(9)[r],side:"front",isFromFactory:this.sharedStore.isFromFactory}))}}}}).call(t,i(2))},function(e,t,i){(function(t){var r=i(16),a=i(20);i(29);e.exports={template:'<!-- background --><canvas id="bg-part{{idx}}{{main ? \'Main\':\'\'}}" v-bind:style="{zIndex:Zindex}" v-bind:width="width" v-bind:height="height" style="position: absolute; left: 0; top: 0;width: 100%;height:100%;background-size:cover;background-position: 50% 50%;pointer-events: none;"></canvas><canvas id="bg-layer" v-bind:width="width" v-bind:height="height" style="display:none;position: absolute; left: 0; top: 0;width: 100%;height:100%;background-size:cover;background-position: 50% 50%;pointer-events: none;"></canvas><img v-bind:src="imageUrl" v-bind:style="{zIndex:Zindex}" style="display:none;position: absolute; left: 0; top: 0;width:100%;height:100%;pointer-events: none;" /><!-- mattings --><canvas id="matting-part" v-show="!sharedStore.isCanvas" v-bind:style="{ zIndex: mattingZindex,top : matteTop, left : matteLeft}" style="position: absolute;pointer-events:none; "></canvas>',props:["idx","main","ratio","width","height"],data:function(){return{upLeft:0,upTop:0,rightRight:0,rightTop:0,downLeft:0,downBottom:0,leftLeft:0,leftTop:0,timer:null,imageUrl:"",sharedStore:t}},computed:{mattingZindex:function(){var e=t.pages[this.idx].canvas,i=e.params.length||0;return 100*(i+2)},bgZindex:function(){var e=t.pages[this.idx].canvas,i=e.params.length||0;return 100*(i+3)},Zindex:function(){var e=t.pages[this.idx].canvas,i=e.params.length||0;return 101*(i+9)},matteLeft:function(){var e=t.pages[this.idx].canvas,i=e.ratio,r=e.foreground.left+e.expendSize.left;return i*r+"px"},matteRight:function(){var e=t.pages[this.idx].canvas,i=e.ratio,r=e.foreground.right+e.expendSize.right;return i*r+"px"},matteTop:function(){var e=t.pages[this.idx].canvas,i=e.ratio,r=e.foreground.top+e.expendSize.top;return i*r+"px"},matteBottom:function(){var e=t.pages[this.idx].canvas,i=e.ratio,r=e.foreground.bottom+e.expendSize.bottom;return i*r+"px"}},methods:{initBg:function(){var e=t.pages[this.idx].canvas;t.projectSettings[t.currentSelectProjectIndex].matte&&"none"!==t.projectSettings[t.currentSelectProjectIndex].matte?this.initMatting():this.idleMatting();var i=this,r=i.currentBgImage(),e=t.pages[this.idx].canvas;a.clear("bg-part"+this.idx+this.main),a.drawImage("bg-part"+this.idx+this.main,r.src,-1,0,function(){i.main&&(t.vm.$broadcast("notifyRefreshScreenshot",i.idx,i.ratio),t.vm.$broadcast("notifyRefreshRealScreenshot",i.idx,i.ratio)),i.sharedStore.cycleLock=!1,i.sharedStore.isBgLoaded=!1,i.sharedStore.queueKey&&(i.sharedStore.queueKey=!1,i.initBg()),t.isPageLoadingShow=!1,i.imageUrl=r.src},e.oriBgWidth*this.ratio,e.oriBgHeight*this.ratio)},currentBgImage:function(){var e={},i=t.projectSettings[this.idx],r=i.size.toLowerCase(),a=i.product,o=this.getPrefix(),n="",s=i.rotated;if(s&&(r=r.split("x")[1]+"x"+r.split("x")[0]),o+="woodPrint"===a?i.finish+"/":r+"/",this.main?e.src=o+r+".png?version=21":e.src=o+r+"_white.png?version=21",n&&(e.layer=o+n),"M"===this.sharedStore.projectSettings[t.currentSelectProjectIndex].matte){var d=this.sharedStore.projectSettings[t.currentSelectProjectIndex].matteStyle.replace("matteStyle","");"none"!==d&&(e.mattePath="assets/img/matting/"+r+"/"+d+".png")}return e},getPrefix:function(){var e="foreground",r=i(1),a=t.projectSettings[this.idx],o=r.getVariableKeyPatternById(e).split("-"),n=o.indexOf("size"),s="assets/img/types/";o.splice(n,1);for(var d=0;d<o.length;d++){var l=a[o[d]];if(l&&"none"!==l.toLowerCase()){if("canvasBorderSize"===o[d]&&"canvas"!=a.product)continue;s+=l+"/"}}return s},idleMatting:function(){var e=(t.pages[this.idx].canvas,document.getElementById("matting-part"));e.width=e.height=0},initMatting:function(){var e=this,r=t.pages[this.idx].canvas;if(this.sharedStore.mattCycleLock)return void(this.sharedStore.mattQueueKey=!0);this.sharedStore.mattCycleLock=!0;var a=document.getElementById("matting-part"),o=a.getContext("2d"),n=i(15).getMattImageSize(),s=(r.oriBgWidth-r.foreground.left-r.foreground.right-r.expendSize.left-r.expendSize.right)*r.ratio,d=(r.oriBgHeight-r.foreground.top-r.foreground.bottom-r.expendSize.top-r.expendSize.bottom)*r.ratio,l=this.currentBgImage();if(a.width=s,a.height=d,l.mattePath){var c=new Image;c.onload=function(){o.drawImage(c,0,0,n.width,n.height,0,0,s,d),e.sharedStore.mattCycleLock=!1,e.sharedStore.isMattLoaded=!1,e.sharedStore.mattQueueKey&&(e.sharedStore.mattQueueKey=!1,e.initMatting())},c.src=l.mattePath}},initBgImage:function(){var e=this,i=t.pages[this.idx].canvas,a=r.getFrameBorderAsset(),o=document.getElementById("bg-part-up"),n=document.getElementById("bg-part-right"),s=document.getElementById("bg-part-down"),d=document.getElementById("bg-part-left"),l=o.getContext("2d"),c=n.getContext("2d"),p=s.getContext("2d"),h=d.getContext("2d"),g=i.frameBorderThickness.top*i.ratio,u=i.frameBorderThickness.right*i.ratio,m=i.frameBorderThickness.bottom*i.ratio,f=i.frameBorderThickness.left*i.ratio,v=(i.frameBorderThickness.top-i.boardInFrame.top)*i.ratio,S=(i.frameBorderThickness.right-i.boardInFrame.right)*i.ratio,y=(i.frameBorderThickness.bottom-i.boardInFrame.bottom)*i.ratio,w=(i.frameBorderThickness.left-i.boardInFrame.left)*i.ratio;o.width=s.width=e.width+w+S,o.height=g,n.width=u,n.height=d.height=e.height+v+y,s.height=m,d.width=f,this.upLeft=this.downLeft=this.leftLeft=-1*w,this.upTop=this.rightTop=this.leftTop=-1*v,this.rightRight=-1*S,this.downBottom=-1*y,l.clearRect(-1,-1,o.width+2,o.height+2),l.beginPath(),l.moveTo(0,0),l.lineTo(e.width+w+S,0),l.lineTo(e.width+w+S-u,g),l.lineTo(f,g),l.closePath(),l.stroke(),l.clip();var x=new Image;x.src=a.assetUpUrl,x.onload=function(){l.drawImage(x,0,0,e.width+w+S,g)},c.clearRect(-1,-1,n.width+2,n.height+2),c.beginPath(),c.moveTo(u,0),c.lineTo(u,e.height+v+y),c.lineTo(0,e.height+v+y-m),c.lineTo(0,g),c.closePath(),c.stroke(),c.clip();var I=new Image;I.src=a.assetRightUrl,I.onload=function(){c.drawImage(I,0,0,u,e.height+v+y)},p.clearRect(-1,-1,s.width+2,s.height+2),p.beginPath(),p.moveTo(0,m),p.lineTo(e.width+w+S,m),p.lineTo(e.width+w+S-u,0),p.lineTo(f,0),p.closePath(),p.stroke(),p.clip();var b=new Image;b.src=a.assetDownUrl,b.onload=function(){p.drawImage(b,0,0,e.width+w+S,m)},h.clearRect(-1,-1,d.width+2,d.height+2),h.beginPath(),h.moveTo(0,0),h.lineTo(0,e.height+v+y),h.lineTo(f,e.height+v+y-m),h.lineTo(f,g),h.closePath(),h.stroke(),h.clip();var P=new Image;P.src=a.assetLeftUrl,P.onload=function(){h.drawImage(P,0,0,f,e.height+v+y)}},initBgLines:function(){var e=this,r=t.pages[this.idx].canvas,a=i(15).getForegroundVariable(),o=document.getElementById("bgline-part-up"),n=document.getElementById("bgline-part-right"),s=document.getElementById("bgline-part-down"),d=document.getElementById("bgline-part-left"),l=o.getContext("2d"),c=n.getContext("2d"),p=s.getContext("2d"),h=d.getContext("2d"),g=r.frameBorderThickness.top*r.ratio,u=r.frameBorderThickness.right*r.ratio,m=r.frameBorderThickness.bottom*r.ratio,f=r.frameBorderThickness.left*r.ratio,v=(r.frameBorderThickness.top-r.boardInFrame.top+a.top)*r.ratio,S=(r.frameBorderThickness.right-r.boardInFrame.right+a.right)*r.ratio,y=(r.frameBorderThickness.bottom-r.boardInFrame.bottom+a.bottom)*r.ratio,w=(r.frameBorderThickness.left-r.boardInFrame.left+a.left)*r.ratio;o.width=s.width=e.width+w+S,o.height=g,n.width=u,n.height=d.height=e.height+v+y,s.height=m,d.width=f,this.upLeft=this.downLeft=this.leftLeft=-1*w,this.upTop=this.rightTop=this.leftTop=-1*v,this.rightRight=-1*S,this.downBottom=-1*y,l.clearRect(-1,-1,o.width+2,o.height+2),l.beginPath(),l.moveTo(0,0),l.lineTo(f,Math.floor(g)),l.lineTo(e.width+w+S-u,Math.floor(g)),l.lineTo(e.width+w+S,0),l.stroke(),c.clearRect(-1,-1,n.width+2,n.height+2),c.beginPath(),c.moveTo(0,g),c.lineTo(0,e.height+v+y-m),c.stroke(),p.clearRect(-1,-1,s.width+2,s.height+2),p.beginPath(),p.moveTo(0,m),p.lineTo(f,0),p.lineTo(e.width+w+S-u,0),p.lineTo(e.width+w+S,m),p.stroke(),h.clearRect(-1,-1,d.width+2,d.height+2),h.beginPath(),h.moveTo(Math.floor(f),g),h.lineTo(Math.floor(f),e.height+v+y-m),h.stroke()}},events:{notifyRefreshBackground:function(){this.initBg()},notifyChangeBgImage:function(){},notifyChangeMatting:function(){this.initMatting()}},ready:function(){var e=this;e.$watch("width",function(){e.initBg()}),e.$watch("height",function(){e.initBg()})}}}).call(t,i(2))},function(e,t,i){(function(t){i(10);e.exports={template:'<div class="box-bar"  v-bind:style="{left: boxLeft + \'px\', top: boxTop + \'px\', zIndex: windowZindex }" style="width:122px;"><!-- image bars --><span class="button" v-show="type === \'image\' && hasImage" v-on:click="handleEditImage()" title="Click to Edit image" style="display: inline-block;width:100%; height: 26px;line-height: 26px;padding-left: 8px;text-align:left;font-size:12px;border-radius: 5px 5px 0 0;">Edit Image</span><span class="button" v-show="type === \'image\' && hasImage" v-on:click="handleRotate(90)" title="Rotate image" style="display: inline-block;width:100%; height: 26px;line-height: 26px;padding-left: 8px;text-align:left;font-size:12px;border-top: 1px solid #7b7b7b;">Rotate Image</span><span class="button" v-show="type === \'image\' && hasImage" v-on:click="handleReplace(90)" title="Replace image" style="display: inline-block;width:100%; height: 26px;line-height: 26px;padding-left: 8px;text-align:left;font-size:12px;border-top: 1px solid #7b7b7b;">Replace Image</span><span class="button" v-show="type === \'image\' && hasImage" v-on:click="handleRemoveImage()" title="Delete image or layer" style="display: inline-block;width: 100%; height: 26px;padding-left: 8px;line-height: 26px;text-align:left;font-size:12px;border-radius: 0 0 5px 5px;border-top: 1px solid #7b7b7b;">Remove Image</span></div>',data:function(){return{boxHeight:30,id:0,sharedStore:t}},computed:{boxWidth:function(){var e=t.pages[t.selectedPageIdx].canvas;return"image"===e.params[e.selectedIdx].elType?134:"text"===e.params[e.selectedIdx].elType?105:0},idx:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.selectedIdx},hasImage:function(){var e=t.pages[t.selectedPageIdx].canvas;return!!e.params[this.idx].imageId},boxLeft:function(){var e=t.pages[t.selectedPageIdx].canvas,r=e.selectedIdx,a=e.params[r],o=(i(16),this.sharedStore.barPosition.ratio);return a.x*o>this.sharedStore.barPosition.x?a.x*o:-e.x+e.oriBgWidth*o-130<this.sharedStore.barPosition.x?this.sharedStore.barPosition.x-130:e.oriWidth*o-130<this.sharedStore.barPosition.x?e.oriWidth*o-130:this.sharedStore.barPosition.x},boxTop:function(){var e=t.pages[t.selectedPageIdx].canvas,r=e.selectedIdx,a=e.params[r],o=(i(16),this.sharedStore.barPosition.ratio);return a.y*o>this.sharedStore.barPosition.y?a.y*o:e.oriHeight*o-107<this.sharedStore.barPosition.y?this.sharedStore.barPosition.y-107:-e.oriY*o+e.oriBgHeight*o-107<this.sharedStore.barPosition.y?this.sharedStore.barPosition.y-107:this.sharedStore.barPosition.y},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)},type:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.params[e.selectedIdx].elType?e.params[e.selectedIdx].elType:""}},methods:{handleRemoveImage:function(){var e=t.pages[t.selectedPageIdx].canvas,r=e.selectedIdx;t.watchData.removeElementIdx=r,t.watchData.removeElementType="image",t.watches.isRemoveElement=!0,i(8)({ev:i(9).ClickRemoveImage})},handleRotate:function(e){var r=t.pages[t.selectedPageIdx].canvas,a=r.selectedIdx;t.vm.$broadcast("notifyRotateImage",{idx:a,nDegree:e}),i(8)({ev:i(9).ClickRotateImage})},handleEditImage:function(){var e=t.pages[t.selectedPageIdx].canvas,r=e.selectedIdx;t.watchData.cropImageIdx=r,t.watches.isCropThisImage=!0,i(8)({ev:i(9).ClickCropImage})},handleReplace:function(){this.sharedStore.watchData.replacePageId=t.selectedPageIdx,i(8)({ev:i(9).ClickReplacePrint}),t.vm.$broadcast("notifyShowImageUpload",!0)},handleLayer:function(){this.sharedStore.isEditLayerShow=!this.sharedStore.isEditLayerShow},handleEditText:function(){t.watches.isChangeThisText=!0},handleRemoveText:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.selectedIdx;t.watchData.removeElementIdx=i,t.watchData.removeElementType="text",t.watches.isRemoveElement=!0}},events:{},ready:function(){}}}).call(t,i(2))},function(e,t,i){(function(t,r){e.exports={template:'<div v-show="sharedStore.isShowContactUs"><div class="shadow-bg"></div><div id="contactUsWindow" class="box-order" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" draggable="false" width="16" height="16" v-on:click="handleHideView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Contact Us</div></div><div style="margin: 50px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Have a question?</label><div class="box-textarea"><textarea v-model="privateStore.question" class="font-textarea"  style="height: 80px; width: 533px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[0]}}"></textarea></div></div><div style="margin: 60px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Have a feature request?</label><div class="box-textarea"><textarea v-model="privateStore.featureRequest" class="font-textarea" style="height: 80px; width: 533px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[1]}}"></textarea></div></div><div style="margin: 60px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Want to report a bug?</label><div class="box-textarea"><textarea v-model="privateStore.bug" class="font-textarea" style="height: 80px; width: 533px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[2]}}"></textarea></div></div><div class="texteditor-button" style="margin-top: 50px;"><div id="emptyLabel" style="width: 200px;text-align: center;height: 40px;line-height: 40px;font-size: 14px;color:red;margin-left:auto;margin-right:auto;opacity:0;">Please enter something.</div><div><div class="button t-center" v-on:click="submit" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; margin-left: 245px;font-size: 14px;">Done</div></div></div></div>',data:function(){return{privateStore:{width:655,height:655,question:"",featureRequest:"",bug:"",selector:"#contactUsWindow",marks:["input your question here","input your feature request here","input the bug description here"]},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideView:function(){this.sharedStore.isShowContactUs=!1},checkWords:function(e){for(var t=0;t<this.privateStore.marks.length;t++)e.target.value===this.privateStore.marks[t]&&(e.target.value="")},submit:function(){if(""===this.privateStore.question.trim()&&""===this.privateStore.featureRequest.trim()&&""===this.privateStore.bug.trim())r("#emptyLabel").css("opacity",1);else{var e=this.privateStore.question,t=this.privateStore.featureRequest,a=this.privateStore.bug,o=navigator.platform,n="[appName:"+navigator.appName+";userAgent:"+navigator.userAgent+";appVersion:"+navigator.appVersion+"]";i(11).sentContactUs(this,e,t,a,o,n),this.sharedStore.isShowContactUs=!1,this.privateStore.question="",this.privateStore.featureRequest="",this.privateStore.bug=""}}},ready:function(){},events:{notifyShowContactUsWindow:function(){console.log("ShowContactUsWindow");var e=i(14);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.sharedStore.isShowContactUs=!0,r("#emptyLabel").css("opacity",0)}},created:function(){}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){var a=i(22),o=i(14),n=i(18),s=i(10),d=i(15),l=i(26);e.exports={template:'<div class="flip-container" v-bind:style="topStyle" @mouseenter="toogleDeleteIcon(true)" @mouseleave="toogleDeleteIcon(false)" style="position:relative;vertical-align:middle;"><span v-if="sharedStore.isPreview" class="preview-blockName font-normal" >{{previewBlockIndex}} / {{totalPageNum}}</span><span v-if="!main" class="blockName font-light" v-bind:class="{active: idx == sharedStore.selectedPageIdx}">Card {{showIndex}}</span><div v-if="main &&　sharedStore.isSwitchLoadingShow && !sharedStore.isPageLoadingShow" style="width: 98px;height: 98px;background: #fff;border: 1px solid #7b7b7b;border-radius: 12px;position: absolute;top: 50%;left: 50%;margin: -42.5px 0 0 -42.5px;z-index: 9999;text-align: center;"><img src="assets/img/Loading.gif" width="50px" height="50px" title="Switching" alt="Switching" style="margin-top:15px;"><span class="font-light" style="position: relative;top: -8px;color: #7d7d7d;font-size: 12px;">Loading...</span></div><div class="flipper" v-bind:style="flipperStyle"><div v-show="!main || isFrontPageShow" id="box-canvasbg{{idx}}{{main ? \'Main\' : \'\'}}" v-bind:style="frontPageStyle" style="position: absolute;overflow: hidden;z-index:2;"><div style="position: relative;width: 100%; height: 100%; overflow: hidden;"><div class="bed-operation" id="container{{idx}}{{main ? \'Main\' : \'\'}}" v-bind:style="{ top: privateStore.canvasTop + \'px\', left: privateStore.canvasLeft + \'px\', cursor: !sharedStore.isPreview ? \'pointer\' : \'default\' }" style="position: relative; overflow: hidden;background: #fff;"><bar-panel v-show="!sharedStore.isPreview && isShowHandle && main"></bar-panel><handle v-if="!sharedStore.isPreview" v-bind:id="privateStore.handleId" v-bind:main="main" v-bind:is-Show-Handles="privateStore.isShowHandle" v-bind:is-Corner-Handles="privateStore.isCornerHandles" v-bind:is-Side-Handles="privateStore.isSideHandles" /></div></div><bg-layer v-show="!sharedStore.isCanvas" v-bind:idx="idx" v-bind:ratio="privateStore.ratio" v-bind:main="main" v-bind:width="privateStore.operationWidth" v-bind:height="privateStore.operationHeight"></bg-layer><mirror-element v-show="sharedStore.isCanvas"></mirror-element></div><div v-bind:style="backPageStyle" style="position: absolute;overflow: hidden;background-size:100% 100%;transform: rotateY(180deg);z-index:1;"><img v-if="privateStore.isShowBackLogo && main" src="assets/img/back-logo.svg" v-bind:style="backLogoStyle"></div><div class="flip-remark" v-if="!main && sharedStore.isRemark"><input type="checkbox" v-el:remark-input @click="onToggleRemark"></div></div></div>',
props:["main","idx"],data:function(){return{privateStore:{ratio:1,operationWidth:0,operationHeight:0,operationPaddingTop:0,operationPaddingLeft:0,canvasTop:0,canvasLeft:0,handleId:"bg",isShowHandle:!0,isCornerHandles:!1,isSideHandles:!1,oriLogoImage:{width:86,height:32,bottom:82},isShowBackLogo:!1,hoverShowDeleteIcon:!1},idx:0,sharedStore:t,isFrontPageShow:!0,isCategoryCanvas:!1,containerRotateAngel:t.isFrontPage?0:-180}},computed:{backLogoStyle:function(){var e=this.privateStore.oriLogoImage,i=t.pages[t.selectedPageIdx].canvas,r=e.width*i.foreground.ratioX*this.privateStore.ratio,a=e.height*i.foreground.ratioY*this.privateStore.ratio,o=e.bottom*i.foreground.ratioY*this.privateStore.ratio,n=this.privateStore.operationWidth/2-r/2;return{width:r+"px",height:a+"px",bottom:o+"px",position:"absolute",left:n+"px",margin:"0 auto"}},containerRotateAngel:function(){return this.sharedStore.isFrontPage||!this.main?0:-180},flipperStyle:function(){return{width:this.privateStore.operationWidth+(this.main?2*this.operationPaddingRight:0)+"px",height:this.privateStore.operationHeight+"px",transform:"rotateY("+this.containerRotateAngel+"deg)",opacity:this.opacity,top:this.main?0:(84-this.privateStore.operationHeight)/2+"px"}},backfaceVisibility:function(){var e=navigator.userAgent,t=e.indexOf("MSIE")!=-1||e.indexOf("Trident/")!=-1;if(!t)return"hidden"},frontPageStyle:function(){return{width:this.privateStore.operationWidth+"px",height:this.privateStore.operationHeight+"px",margin:this.main?this.operationMarginTop+"px "+this.privateStore.operationPaddingRight+"px 0 "+this.operationMarginLeft+"px":0,opacity:this.opacity,backfaceVisibility:this.backfaceVisibility}},backPageStyle:function(){var e=navigator.userAgent,t=e.indexOf("MSIE")!=-1||e.indexOf("Trident/")!=-1;return{width:this.privateStore.operationWidth+"px",height:this.privateStore.operationHeight+"px",margin:this.main?this.operationMarginTop+"px "+this.privateStore.operationPaddingRight+"px 0 "+this.operationMarginLeft+"px":0,opacity:this.opacity,backgroundImage:this.backPageUrl?"url("+this.backPageUrl+")":void 0,backfaceVisibility:t?void 0:"hidden"}},operationMarginTop:function(){return this.privateStore.operationPaddingTop},operationMarginLeft:function(){return this.privateStore.operationPaddingLeft},backPageUrl:function(){if(this.sharedStore.watches.isProjectLoaded){var e="foreground",r=i(1),a=t.projectSettings[t.currentSelectProjectIndex],o=r.getVariableKeyPatternById(e).split("-"),n=o.indexOf("size"),s=a.size.toLowerCase(),d=a.rotated,l="assets/img/types/";o.splice(n,1);for(var c=0;c<o.length;c++){var p=a[o[c]];p&&"none"!==p.toLowerCase()&&(l+=p+"/")}return d&&(s=s.split("x")[1]+"x"+s.split("x")[0]),l+s+"/"+s+"_back.png?version=21"}},opacity:function(){return this.main&&this.sharedStore.isSwitchLoadingShow?"0":"1"},isShowHandle:function(){t.pages[t.selectedPageIdx].canvas;return!t.isLostFocus},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)-10},topStyle:function(){return this.sharedStore.isPreview?{display:this.main?"block":"inline-block",margin:this.main?"":"0 8px",width:this.privateStore.operationWidth+(this.main?this.operationMarginLeft+this.privateStore.operationPaddingRight:0)+"px",height:this.privateStore.operationHeight+"px"}:this.sharedStore.isRemark?{display:this.main?"block":"inline-block",margin:this.main?"66px 0 0 0":"0 8px",width:this.privateStore.operationWidth+(this.main?2*this.operationMarginLeft:0)+"px",height:this.privateStore.operationHeight+"px"}:{display:this.main?"block":"inline-block",margin:this.main?"":"0 8px",width:this.privateStore.operationWidth+(this.main?this.operationMarginLeft+this.privateStore.operationPaddingRight:0)+"px",height:this.main?this.privateStore.operationHeight+"px":"84px"}},isShowDeleteIcon:function(){var e=0;return this.sharedStore.pages.forEach(function(t){t.isDeleted||e++}),e>1},previewBlockIndex:function(){for(var e=0,t=0;t<=this.sharedStore.selectedPageIdx;t++)this.sharedStore.pages[t].isDeleted||e++;return e},totalPageNum:function(){var e=0;return this.sharedStore.pages.forEach(function(t){t.isDeleted||e++}),e}},methods:{setId:function(e,t,i){this.idx=e,this.main=t,this.showIndex=i},initCanvas:function(){var e=this,i=e.sharedStore,a=i.pages[this.idx].canvas;t.pages.length>1&&(t.isChangePageShow=!0),e.initWindow(),r("#container"+this.idx+(this.main?"Main":"")).css("width",a.oriWidth*this.privateStore.ratio).css("height",a.oriHeight*this.privateStore.ratio);for(var o=this.main?"Main":"",l=0;l<a.params.length;l++)d.createElement(l,this.idx,this.privateStore.ratio,o);a.selectedIdx=s.getFrontElementIndex(),n.freshImageUsedCount()},clearCanvas:function(e){for(var i="undefined"!=typeof e?e:t.currentSelectProjectIndex,r=t.pages[i].canvas,a=r.params.length-1;a>=0;a--){var o=r.params[a].id;d.deleteElement(a,o,i)}},clearCenterElement:function(){for(var e=0;e<t.pages.length;e++)for(var i=t.pages[e].canvas,r=0;r<i.centerElements.length;r++)i.centerElements[r].$destroy(!0),i.centerElements.splice(r,1)},initWindow:function(){var e=this,t=e.sharedStore,i=t.pages[this.idx].canvas;if(t.isPreview)var r=o.getBoxWH(0,150);else var a=1===this.sharedStore.LSCPageNum?135:270,r=o.getBoxWH(280,a);if(this.main||(r.width=100,r.height=84),r.width>0&&r.height>0){var n=i.oriBgWidth,s=i.oriBgHeight,d=0,l=0,c=r.width/n,p=r.height/s;c>p?(this.privateStore.ratio=p,this.main||(i.ratio=p,i.width=i.oriWidth*i.ratio,i.height=i.oriHeight*i.ratio,i.x=i.oriX*i.ratio,i.y=i.oriY*i.ratio,i.bgWidth=i.oriBgWidth*i.ratio,i.bgHeight=i.oriBgHeight*i.ratio),e.privateStore.operationPaddingLeft=(r.width-i.oriWidth*this.privateStore.ratio)/2-i.oriX*this.privateStore.ratio,e.privateStore.operationPaddingRight=r.width/2-(i.oriBgWidth-i.oriWidth/2-i.oriX)*this.privateStore.ratio):(this.privateStore.ratio=c,this.main||(i.ratio=c,i.width=i.oriWidth*i.ratio,i.height=i.oriHeight*i.ratio,i.x=i.oriX*i.ratio,i.y=i.oriY*i.ratio,i.bgWidth=i.oriBgWidth*i.ratio,i.bgHeight=i.oriBgHeight*i.ratio),e.privateStore.operationPaddingLeft=0+d*this.privateStore.ratio),e.privateStore.operationPaddingTop=0+l*this.privateStore.ratio,e.privateStore.operationWidth=i.oriBgWidth*this.privateStore.ratio,e.privateStore.operationHeight=i.oriBgHeight*this.privateStore.ratio,e.privateStore.canvasTop=i.oriY*this.privateStore.ratio,e.privateStore.canvasLeft=i.oriX*this.privateStore.ratio}else t.isPreview?console.log("Window size is too small!"):alert("Window size is too small!")},handleOndrop:function(e){this.sharedStore.isShowProgress=!0;var r=this,o=r.sharedStore,s=o.pages[o.selectedPageIdx].canvas;if(t.isLostFocus=!0,e){var d,l=e.newAdded,c=e.isBg,p=o.dragData.imageId,h=o.dragData.sourceImageUrl;d=l?s.params.length-1:c?0:e.idx;var g=n.getImageDetail(p);s.params[d].imageId=p,s.params[d].imageRotate=g?g.orientation:0;var u=Math.abs(s.params[d].imageRotate)/90%2===1;if(g&&(s.params[d].imageGuid=g.guid,s.params[d].imageWidth=g.width,s.params[d].imageHeight=g.height),u)var m=s.params[d].imageHeight,f=s.params[d].imageWidth;else var m=s.params[d].imageWidth,f=s.params[d].imageHeight;var v=t.projectSettings[t.selectedPageIdx],S=v.orientation;if(m>f&&"Portrait"===S||f>m&&"Landscape"===S){var r=this;setTimeout(function(){r.sharedStore.isSwitchLoadingShow=!0,v.rotated=!v.rotated,v.orientation="Landscape"===v.orientation?"Portrait":"Landscape",r.$dispatch("dispatchRotate"),r.sharedStore.pages[t.selectedPageIdx].canvas.pageItems[0].handleRepaint(),r.$dispatch("dispatchRotateTemplate")})}else{var y=a.getDefaultCrop(m,f,s.params[d].width,s.params[d].height),w=y.px,x=y.py,I=y.pw,b=y.ph,P=s.params[d].width*s.ratio/I,j=s.params[d].height*s.ratio/b;s.params[d].cropX=g.width*w,s.params[d].cropY=g.height*x,s.params[d].cropW=g.width*I,s.params[d].cropH=g.height*b,s.params[d].cropPX=w,s.params[d].cropPY=x,s.params[d].cropPW=I,s.params[d].cropPH=b;var C=i(6),T=C.getEncImgId(p),k=C.getQueryString({encImgId:T,px:w,py:x,pw:I,ph:b,width:Math.round(P),height:Math.round(j)});s.params[d].url="/imgservice/op/crop?"+k+i(7).getSecurityString(),s.params[d].isRefresh=!0,s.params[d].sourceImageUrl=h}n.freshImageUsedCount(),r.freshImageList()}},freshImageList:function(){this.$dispatch("dispatchImageList")},addImage:function(e){if(e&&void 0!=e.id&&null!=e.id){e.x=e.x||0,e.y=e.y||0;var i=t.pages[t.selectedPageIdx].canvas,r=d.getDefaultNewElementPosition({x:e.x,y:e.y});if(i.params.length)var a=parseInt(i.params[i.params.length-1].id)+1;else var a=0;var o={id:a,elType:"image",url:"",isRefresh:!1,x:r.x,y:r.y,width:r.width,height:r.height,rotate:0,dep:i.params.length,imageId:"",cropPX:0,cropPY:0,cropPW:1,cropPH:1};l.createImage(o);var n={newAdded:!0,isBg:!1};t.dropData.newAdded=n.newAdded,t.dropData.isBg=n.isBg,t.watches.isOnDrop=!0,d.autoLayout()}},removeImage:function(e){l.deleteImage(e,!0),n.freshImageUsedCount(),this.freshImageList()},removeText:function(e){TextController.deleteText(e)},refreshCanvas:function(){this.$broadcast("notifyRefreshBackground"),this.clearCanvas(this.idx),this.freshImageList(),this.initCanvas()},refreshCanvasWithDelay:function(){var e=this;setTimeout(function(){e.$broadcast("notifyRefreshBackground"),e.clearCenterElement(),e.freshImageList(),e.initCanvas()},2e3)},handleDeleteProject:function(){var e=this.sharedStore.pages[this.idx].canvas,t=e.params.some(function(e){return"image"===e.elType&&e.imageId});t?this.sharedStore.vm.$dispatch("dispatchShowPopup",{type:"deleteProject",status:0,pageIdx:this.idx}):this.sharedStore.vm.$broadcast("notifyDeleteProject",this.idx),i(8)({ev:i(9).RemoveBlock,hasImage:t})},handleRepaint:function(){this.clearCanvas(this.idx),this.freshImageList(),this.initCanvas()},onToggleRemark:function(e){t.projectSettings[this.idx].quantity=1===t.projectSettings[this.idx].quantity?0:1,this.$els.remarkInput.checked=1===t.projectSettings[this.idx].quantity},toogleDeleteIcon:function(e){this.privateStore.hoverShowDeleteIcon=e}},events:{notifyRotate:function(){d.fixRotatePhotoElement(),d.freshPageData(),this.clearCenterElement(),this.initCanvas()},notifyRepaintProject:function(){this.main&&(d.freshPageData(),this.refreshCanvas())},notifyPaint:function(){d.loadProjectIntoPages(),this.freshImageList(),this.initCanvas()},notifyRepaint:function(e){void 0!=e&&null!=e&&!t.isPreview,this.clearCanvas(),this.freshImageList(),this.initCanvas()},notifyRepaintCenterContainer:function(){this.main&&(this.clearCenterElement(),this.freshImageList(),this.initCanvas())},notifyRefreshCanvas:function(){this.refreshCanvas()},notifyRemoveImage:function(e){this.removeImage(e)},notifyAddImage:function(e){this.addImage(e)},dispatchDepthFront:function(e){if(void 0!=e&&null!=e){var i=t.pages[t.selectedPageIdx].canvas;d.changeDepthValue({idx:e,targetDepth:i.params.length-1})}},dispatchDrop:function(e){this.addImage(e)},notifyApplyTemplate:function(e){this.clearCenterElement();var i=t.pages[this.idx].canvas;i.params=d.getTemplateParams(e),this.initCanvas()}},ready:function(){var e=this;e.$watch("sharedStore.watches.isChangeDepthFront",function(){if(e.sharedStore.watches.isChangeDepthFront){e.sharedStore.watches.isChangeDepthFront=!1;var i=e.sharedStore.watchData.changeDepthIdx;if(e.sharedStore.watchData.changeDepthIdx="",null!=i&&""!==i){var r=t.pages[t.selectedPageIdx].canvas;d.changeDepthValue({idx:i,targetDepth:r.params.length-1})}}}),e.$watch("sharedStore.watches.isOnDrop",function(){e.sharedStore.watches.isOnDrop&&(e.sharedStore.watches.isOnDrop=!1,e.handleOndrop(e.sharedStore.dropData))}),e.$watch("sharedStore.watches.isProjectComplete",function(){if(e.sharedStore.watches.isProjectComplete){var t=e.sharedStore.projectSettings[e.sharedStore.currentSelectProjectIndex];"categoryCanvas"===t.category?e.isCategoryCanvas=!0:e.isCategoryCanvas=!1,"LSC"===t.product&&(e.privateStore.isShowBackLogo=!0)}}),e.$watch("sharedStore.isReprintAll",function(){e.main||(t.projectSettings[e.idx].quantity=t.isReprintAll?1:0,e.$els.remarkInput.checked=t.isReprintAll)}),e.$watch("sharedStore.watches.isRemoveElement",function(){if(e.sharedStore.watches.isRemoveElement){e.sharedStore.watches.isRemoveElement=!1;var t=e.sharedStore.watchData.removeElementIdx,i=e.sharedStore.watchData.removeElementType;e.sharedStore.watchData.removeElementIdx="",e.sharedStore.watchData.removeElementType="",null!=t&&""!==t&&("image"===i?e.removeImage(t):e.removeText(t))}}),e.$watch("sharedStore.isFrontPage",function(){e.sharedStore.isFrontPage?e.isFrontPageShow=!0:setTimeout(function(){e.isFrontPageShow=!1},150)}),this.main&&e.$watch("idx",function(){this.sharedStore.watches.isProjectLoaded&&(e.sharedStore.isSwitchLoadingShow=!0,e.clearCenterElement(),e.freshImageList(),e.initCanvas())})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){var a=i(24),o=a.extend(i(52)),n=a.extend(i(53)),s=a.extend(i(57)),d=(i(12),i(15));e.exports={template:'<div v-on:click="blurFocus()" v-bind:style="usedStyle"><!-- action panel component --><action-panel v-if="!sharedStore.isPreview && !sharedStore.isRemark"></action-panel><!-- operation area --><div id="main-container-wrap" style="position:relative;"><operation-area key="centerContainer" v-bind:idx="sharedStore.selectedPageIdx"  main="Main"></operation-area><div @click="changeSelectedProject(-1)" style="width:44px;height:100%;position:absolute;top:0;left:0;"><span :class="{disabled: isFirstUsefullPage}" class="changePageIcon left" /></div><div @click="changeSelectedProject(+1)" style="width:44px;height:100%;position:absolute;top:0;right:0;"><span :class="{disabled: isLastUsefullPage}" class="changePageIcon right" /></div></div><action-panel-bottom></action-panel-bottom><div v-show="!sharedStore.isPreview" style="height:130px;border-top:1px solid #d6d6d6;border-left:1px solid #d6d6d6;background-color:#f6f6f6;box-sizing:border-box;overflow-x:auto;overflow-y:hidden;"><div style="display:inline-block;min-width:100%;height:130px;padding:34px 16px 0 16px;box-sizing:border-box;white-space:nowrap;"><div v-show="isAddBottonShow" class="add-photo-button" id="add-photos" @click="addProject"><div style="position: absolute;width:100%;left: 0;top: 50%;transform:translate(0,-50%); text-align:center;"><span class="font-normal" style="font-size:12px;color:#7b7b7b;">+ Add Block</span></div></div></div></div><screenshot-element></screenshot-element></div>',data:function(){return{privateStore:{first:0,pages:[],isAddBottonShow:!1},sharedStore:t}},computed:{usedStyle:function(){return this.sharedStore.isPreview?{}:{position:"absolute",top:"38px",bottom:"0",left:"280px",right:0,overflow:"hidden"}},shouldChangePageShow:function(){return!!this.sharedStore.isChangePageShow},isFirstUsefullPage:function(){for(var e=!0,t=0;t<this.sharedStore.selectedPageIdx;t++)this.sharedStore.pages[t].isDeleted||(e=!1);return e},isLastUsefullPage:function(){for(var e=!0,t=this.sharedStore.selectedPageIdx+1;t<this.sharedStore.pages.length;t++)this.sharedStore.pages[t].isDeleted||(e=!1);return e},totalPageNum:function(){var e=0;return this.sharedStore.pages.forEach(function(t){t.isDeleted||e++}),e}},components:{"action-panel":o,"action-panel-bottom":n,"operation-area":s},methods:{showItem:function(e){var t=this,i=1;0==t.privateStore.first++,e&&(t.privateStore.pages.length=0);for(var r=0;r<t.sharedStore.pages.length;r++)!function(e,r){if(!t.sharedStore.pages[e].isDeleted){var a=new s;a.setId(e,"",i),a.$mount().$before("#add-photos"),t.$nextTick(function(){a.initCanvas(),t.sharedStore.pages[e].canvas.pageItems.push(a)}),i++}}(r)},clearItemElement:function(){this.privateStore.pages.length=0;for(var e=0;e<this.sharedStore.pages.length;e++){var t=this.sharedStore.pages[e].canvas;t.pageItems.length&&(t.pageItems[0].$destroy(!0),t.pageItems.length=0,t.elements[0].$destroy(!0),t.elements.length=0)}},blurFocus:function(){this.$dispatch("dispatchClearScreen")},addProject:function(){return""},deleteProject:function(e){var t=0;this.clearItemElement(),this.sharedStore.projectSettings[e].isDeleted=!0,this.sharedStore.pages[e].isDeleted=!0,this.sharedStore.pages[e].canvas.params[0].imageId="",this.sharedStore.pages.some(function(e,i){if(!e.isDeleted)return t=i,!0}),this.sharedStore.selectedPageIdx===e&&(this.sharedStore.selectedPageIdx=t,this.sharedStore.currentSelectProjectIndex=t),this.showItem()},freshItemIndexes:function(){for(var e=0;e<this.sharedStore.pages.length;e++)this.sharedStore.pages[e].idx=e},broadcastChangePage:function(e){t.vm.$broadcast("notifyChangePage",e)},changeSelectedProject:function(e){if(!this.sharedStore.isSwitchLoadingShow){var t=this.sharedStore.pages.length,r=this.sharedStore.selectedPageIdx,a=r;do a+=e;while(this.sharedStore.pages[a]&&this.sharedStore.pages[a].isDeleted);if(a>=0&&a<t){var o=this.sharedStore.isPreview?"SwitchBlocksInPreview":"SwitchBlocks";this.sharedStore.selectedPageIdx=a,this.sharedStore.currentSelectProjectIndex=a,i(8)({ev:i(9)[o],isFromFactory:this.sharedStore.isFromFactory})}}},fillImageIntoBlankPage:function(e){var r=e[0],a=this,o=r?r.orientation:0,n=Math.abs(o)/90%2===1;if(n)var s=r.height,l=r.width;else var s=r.width,l=r.height;this.sharedStore.pages.some(function(e,n){var c=t.projectSettings[n],p=c.orientation,h=e.canvas,g=0;h.params.some(function(e,t){if("image"===e.type)return void(g=t)});var u=h.params[g];if(!u.imageId){u.imageId=r.id,u.imageRotate=o,u.imageGuid=r.guid,u.imageWidth=r.width,u.imageHeight=r.height,(s>l&&"Portrait"===p||l>s&&"Landscape"===p)&&setTimeout(function(){a.sharedStore.isSwitchLoadingShow=!0,c.rotated=!c.rotated,c.orientation="Landscape"===c.orientation?"Portrait":"Landscape",d.fixRotatePhotoElement(n),d.freshPageData(n),n===a.sharedStore.selectedPageIdx&&a.sharedStore.vm.$broadcast("notifyRepaintCenterContainer"),a.sharedStore.pages[n].canvas.pageItems[0].handleRepaint()});var m=i(22).getDefaultCrop(s,l,u.width,u.height),f=m.px,v=m.py,S=m.pw,y=m.ph,w=u.width*h.ratio/S,x=u.height*h.ratio/y;u.cropX=s*f,u.cropY=l*v,u.cropW=s*S,u.cropH=l*y,u.cropPX=f,u.cropPY=v,u.cropPW=S,u.cropPH=y;var I=i(6),b=I.getEncImgId(r.id),P=I.getQueryString({encImgId:b,px:f,py:v,pw:S,ph:y,width:Math.round(w),height:Math.round(x)});return u.url="/imgservice/op/crop?"+P+i(7).getSecurityString(),u.isRefresh=!0,!0}})},replacePageImage:function(e){var r=this,a=t.watchData.replacePageId,o=Array.isArray(e)&&e[0],n=o?o.orientation:0,s=Math.abs(n)/90%2===1;if(s)var l=o.height,c=o.width;else var l=o.width,c=o.height;var p=t.projectSettings[a],h=p.orientation,g=t.pages[a],u=g.canvas,m=u.params[u.selectedIdx];this.sharedStore.isShowProgress=!0,m.imageId=o.id,m.imageRotate=n,m.imageGuid=o.guid,m.imageWidth=o.width,m.imageHeight=o.height,(l>c&&"Portrait"===h||c>l&&"Landscape"===h)&&(p.rotated=!p.rotated,p.orientation="Landscape"===p.orientation?"Portrait":"Landscape",d.fixRotatePhotoElement(a),d.freshPageData(a));var f=i(22).getDefaultCrop(l,c,m.width,m.height),v=f.px,S=f.py,y=f.pw,w=f.ph,x=m.width*u.ratio/y,I=m.height*u.ratio/w;m.cropX=o.width*v,m.cropY=o.height*S,m.cropW=o.width*y,m.cropH=o.height*w,m.cropPX=v,m.cropPY=S,m.cropPW=y,m.cropPH=w;var b=i(6),P=b.getEncImgId(o.id),j=b.getQueryString({encImgId:P,px:v,py:S,pw:y,ph:w,width:Math.round(x),height:Math.round(I)});m.url="/imgservice/op/crop?"+j+i(7).getSecurityString(),setTimeout(function(e,t){r.sharedStore.vm.$broadcast("notifyRepaintCenterContainer"),r.sharedStore.pages[e].canvas.pageItems[t].handleRepaint()},100,t.watchData.replacePageId,u.selectedIdx),t.watchData.replacePageId=null}},events:{notifyShowItem:function(e){this.showItem(e)},notifyRefreshItems:function(e){this.clearItemElement(),this.showItem(!0)},notifyDeleteProject:function(e){this.deleteProject(e)},notifyAddNewUploadedImgIntoPages:function(){this.sharedStore.newUploadedImg.length&&("number"!=typeof t.watchData.replacePageId?(console.log(this.sharedStore.newUploadedImg[0]),this.fillImageIntoBlankPage(this.sharedStore.newUploadedImg)):this.replacePageImage(this.sharedStore.newUploadedImg),this.sharedStore.newUploadedImg.length=0)}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){var r=i(10);e.exports={template:'<div class="box-handle" id="handles-{{pagedd}}{{ id }}{{main}}" v-bind:style="{ opacity: isShowHandles? 1: 0 }" title="{{ handleTitle }}"><!-- center layer --><div class="handle-center-layer" draggable="true"></div><!-- top left corner handle --><div class="handle-icon" id="" style="top: -4px; left: -4px;" v-if="isCornerHandles"></div><div class="handle handle-corner handle-top-left" id="" draggable="true" style="top: -4px; left: -4px;" v-if="isCornerHandles"></div><!-- top side handle --><div class="handle-icon" id="" style="top: -4px; left: {{ halfLeft }};" v-if="isSideHandles"></div><div class="handle handle-side handle-top-side" id="" draggable="true" style="top: -4px; left: {{ halfLeft }};" v-if="isSideHandles"></div><!-- top right corner handle --><div class="handle-icon" id="" style="top: -4px; right: -4px;" v-if="isCornerHandles"></div><div class="handle handle-corner handle-top-right" id="" draggable="true" style="top: -4px; right: -4px;" v-if="isCornerHandles"></div><!-- right side handle --><div class="handle-icon" id="" style="top: {{ halfTop }}; right: -4px;" v-if="isSideHandles"></div><div class="handle handle-side handle-right-side" id="" draggable="true" style="top: {{ halfTop }}; right: -4px;" v-if="isSideHandles"></div><!-- bottom right corner handle --><div class="handle-icon" id="" style="bottom: -4px; right: -4px;" v-if="isCornerHandles"></div><div class="handle handle-corner handle-bottom-right" id="" draggable="true" style="bottom: -4px; right: -4px;" v-if="isCornerHandles"></div><!-- bottom side handle --><div class="handle-icon" id="" style="bottom: -4px; left: {{ halfLeft }};" v-if="isSideHandles"></div><div class="handle handle-side handle-bottom-side" id="" draggable="true" style="bottom: -4px; left: {{ halfLeft }};" v-if="isSideHandles"></div><!-- bottom left corner handle --><div class="handle-icon" id="" style="bottom: -4px; left: -4px;" v-if="isCornerHandles"></div><div class="handle handle-corner handle-bottom-left" id="" draggable="true" style="bottom: -4px; left: -4px;" v-if="isCornerHandles"></div><!-- left side handle --><div class="handle-icon" id="" style="top: {{ halfTop }}; left: -4px;" v-if="isSideHandles"></div><div class="handle handle-side handle-left-side" id="" draggable="true" style="top: {{ halfTop }}; left: -4px;" v-if="isSideHandles"></div></div>',props:["pagedd","id","main","isCornerHandles","isSideHandles","isShowHandles"],data:function(){return{}},computed:{halfLeft:function(){var e=t.pages[t.selectedPageIdx].canvas,i=r.getIndexById(this.id);return e.params[i].width/2*e.ratio-4+"px"},halfTop:function(){var e=t.pages[t.selectedPageIdx].canvas,i=r.getIndexById(this.id);return e.params[i].height/2*e.ratio-4+"px"},handleTitle:function(){if("bg"!==this.id){var e=t.pages[t.selectedPageIdx].canvas,i=r.getIndexById(this.id);if("image"===e.params[i].elType&&""===e.params[i].imageId)return"Click to add a photo"}return""}},methods:{bindHandleEvents:function(e,t,i){this.bindLayerEvents(e,t,i),this.isCornerHandles&&this.bindCornerEvents(e,t,i),this.isSideHandles&&this.bindSideEvents(e,t,i)},bindLayerEvents:function(e,i,r){var a=this;if(null!=i){var o,n,s,d,l,c,p=document.getElementById("handles-"+e+i+r),h=p.querySelector(".handle-center-layer"),g=!1;"bg"===i?(h.ondrop=function(e){e.preventDefault(),!g&&t.dragData.isFromList&&(console.log("drop",e),a.$dispatch("dispatchDrop",{id:a.id,x:e.offsetX||e.layerX||0,y:e.offsetY||e.layerY||0}))},h.ondragover=function(e){e.preventDefault()},h.onclick=function(e){console.log("click",e)},h.ondblclick=function(e){console.log("dbclick",e)},h.onmouseover=function(e){},h.onmouseout=function(e){}):(h.onmousedown=function(e){e.preventDefault(),g=!0,o=e.screenX||0,n=e.screenY||0,t.operateMode="drag",a.$dispatch("dispatchDragStart"),l=function(e){e.preventDefault(),s=e.screenX||0,d=e.screenY||0;var i=s-o,r=d-n;0===s&&0===d?i=r=0:(o=s,n=d),t.operateMode="drag",a.$dispatch("dispatchMove",{x:i,y:r})},c=function(e){e.preventDefault(),document.removeEventListener("mouseup",c),document.removeEventListener("mousemove",l),g=!1,s=e.screenX||0,d=e.screenY||0,console.log(e,s,d);var i=s-o,r=d-n;0===s&&0===d?i=r=0:(o=s,n=d),(Math.abs(i)>8||Math.abs(r)>8)&&(i=0,r=0),a.$dispatch("dispatchMove",{x:i,y:r}),a.$dispatch("dispatchDragEnd"),t.operateMode="idle"},document.addEventListener("mouseup",c),document.addEventListener("mousemove",l)},h.ondrop=function(e){e.preventDefault(),!g&&t.dragData.isFromList&&(console.log("drop",e),a.$dispatch("dispatchDrop",{id:a.id,x:e.offsetX||e.layerX||0,y:e.offsetY||e.layerY||0}))},h.ondragover=function(e){e.preventDefault(),g||a.$dispatch("dispatchDragOver")},h.onclick=function(e){e.stopPropagation(),console.log("click",e),a.$dispatch("dispatchClick",{id:a.id,x:e.offsetX||e.layerX||0,y:e.offsetY||e.layerY||0})},h.ondblclick=function(e){console.log("dbclick",e),a.$dispatch("dispatchDblClick")},h.onmouseover=function(e){a.$dispatch("dispatchMouseOver")},h.onmouseout=function(e){a.$dispatch("dispatchMouseOut")}),document.onkeypress=function(e){console.log("key press",e)}}},bindCornerEvents:function(e,i,a){if(null!=i){var o,n,s,d,l,c,p=this,h=t.pages[t.selectedPageIdx].canvas,g=document.getElementById("handles-"+e+i+a),u=g.querySelectorAll(".handle-corner");for(var m in u){var f=u[m];f.onmousedown=function(e){e.stopPropagation(),e.preventDefault(),o=e.screenX||0,n=e.screenY||0,t.operateMode="scale",p.$dispatch("dispatchScaleStart");var i=e.target.className;l=function(e){e.preventDefault(),s=e.screenX||0,d=e.screenY||0;var a=s-o,l=d-n;0===s&&0===d?a=l=0:(o=s,n=d);var c=r.getIndexById(p.id);if(i.indexOf("top-left")!==-1){var g=a*h.params[c].height/h.params[c].width;p.$dispatch("dispatchMove",{x:a,y:g}),p.$dispatch("dispatchScale",{width:-1*a,height:-1*g})}else if(i.indexOf("top-right")!==-1){var g=a*h.params[c].height/h.params[c].width;p.$dispatch("dispatchMove",{x:0,y:-1*g}),p.$dispatch("dispatchScale",{width:a,height:g})}else if(i.indexOf("bottom-left")!==-1){var g=a*h.params[c].height/h.params[c].width;p.$dispatch("dispatchMove",{x:a,y:0}),p.$dispatch("dispatchScale",{width:-1*a,height:-1*g})}else if(i.indexOf("bottom-right")!==-1){var g=a*h.params[c].height/h.params[c].width;p.$dispatch("dispatchScale",{width:a,height:g})}t.operateMode="scale"},c=function(e){e.preventDefault(),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",c),s=e.screenX||0,d=e.screenY||0;var a=s-o,g=d-n;0===s&&0===d?a=g=0:(o=s,n=d);var u=r.getIndexById(p.id);if(i.indexOf("top-left")!==-1){var m=a*h.params[u].height/h.params[u].width;p.$dispatch("dispatchMove",{x:a,y:m}),p.$dispatch("dispatchScaleEnd",{width:-1*a,height:-1*m})}else if(i.indexOf("top-right")!==-1){var m=a*h.params[u].height/h.params[u].width;p.$dispatch("dispatchMove",{x:0,y:-1*m}),p.$dispatch("dispatchScaleEnd",{width:a,height:m})}else if(i.indexOf("bottom-left")!==-1){var m=a*h.params[u].height/h.params[u].width;p.$dispatch("dispatchMove",{x:a,y:0}),p.$dispatch("dispatchScaleEnd",{width:-1*a,height:-1*m})}else if(i.indexOf("bottom-right")!==-1){var m=a*h.params[u].height/h.params[u].width;p.$dispatch("dispatchScaleEnd",{width:a,height:m})}t.operateMode="idle"},document.addEventListener("mousemove",l),document.addEventListener("mouseup",c)},f.onclick=function(e){e.stopPropagation(),console.log("cornerClick",e),p.$dispatch("dispatchCornerClick")}}}},bindSideEvents:function(e,i,r){if(null!=i){var a,o,n,s,d,l,c=this,p=(t.pages[t.selectedPageIdx].canvas,document.getElementById("handles-"+e+i+r)),h=p.querySelectorAll(".handle-side");for(var g in h){var u=h[g];u.onmousedown=function(e){e.preventDefault(),e.stopPropagation();var i=e.target.className;a=e.screenX||0,o=e.screenY||0,t.operateMode="scale",c.$dispatch("dispatchScaleStart"),d=function(e){e.preventDefault(),n=e.screenX||0,s=e.screenY||0;var r=n-a,d=s-o;if(0===n&&0===s?r=d=0:(a=n,o=s),i.indexOf("top")!==-1){var l=0;c.$dispatch("dispatchMove",{x:l,y:d}),c.$dispatch("dispatchScale",{width:-1*l,height:-1*d})}else if(i.indexOf("left")!==-1){var p=0;c.$dispatch("dispatchMove",{x:r,y:p}),c.$dispatch("dispatchScale",{width:-1*r,height:-1*p})}else if(i.indexOf("right")!==-1){var p=0;c.$dispatch("dispatchScale",{width:r,height:p})}else if(i.indexOf("bottom")!==-1){var l=0;c.$dispatch("dispatchScale",{width:l,height:d})}t.operateMode="scale"},l=function(e){e.preventDefault(),document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",l),n=e.screenX||0,s=e.screenY||0;var r=n-a,p=s-o;if(0===n&&0===s?r=p=0:(a=n,o=s),i.indexOf("top")!==-1){var h=0;c.$dispatch("dispatchMove",{x:h,y:p}),c.$dispatch("dispatchScaleEnd",{width:-1*h,height:-1*p})}else if(i.indexOf("left")!==-1){var g=0;c.$dispatch("dispatchMove",{x:r,y:g}),c.$dispatch("dispatchScaleEnd",{width:-1*r,height:-1*g})}else if(i.indexOf("right")!==-1){var g=0;c.$dispatch("dispatchScaleEnd",{width:r,height:g})}else if(i.indexOf("bottom")!==-1){var h=0;c.$dispatch("dispatchScaleEnd",{width:h,height:p})}t.operateMode="idle"},document.addEventListener("mousemove",d),document.addEventListener("mouseup",l)},u.onclick=function(e){e.stopPropagation(),console.log("sideClick",e),c.$dispatch("dispatchSideClick")}}}}},ready:function(){var e=this;this.bindHandleEvents(this.pagedd,this.id,this.main),e.$watch("pagedd",function(){this.bindHandleEvents(this.pagedd,this.id,this.main)})}}}).call(t,i(2))},function(e,t,i){(function(t,r){var a=i(24),o=(i(31),i(29),a.extend(i(83)));e.exports={mixins:[i(11)],template:'<div class="bed-header" v-on:click="blurFocus"><div style="display: inline-block; height: 38px;"><div id="logo" v-on:click="handleLogoClicked()" style="margin-left: 30px;float: left;cursor: pointer;width:100px;" title="Home"><img src="../../static/img/new-logo-white.svg" height="16" width="79" draggable="false" alt="Logo" style="display:block;margin: 11px 20px 11px 0;" /></div><title-edit></title-edit></div><div style="float: right; height: 38px;margin-top: 0px;"><span class="menu-item" v-show="sharedStore.isRemark" style="height: 38px;line-height: 38px;margin-right: 40px;"> <input type="checkbox" id="reprint-all" style="vertical-align:middle;" v-model="sharedStore.isReprintAll"/> <label for="reprint-all">Reprint All</label></span><span id="reprintButton" class="menu-item" v-show="sharedStore.isRemark" v-on:click="handlePrint()" style="height: 38px;line-height: 38px;margin-right: 40px;">Reprint</span><span class="menu-item" v-show="!sharedStore.isRemark" v-on:click="handlePreview()" style="height: 38px;line-height: 38px;margin-right: 40px;">Preview</span><span v-show="!sharedStore.fromCart && !sharedStore.isRemark" id="saveButton" class="menu-item" v-on:click="handleSave()" style="height: 38px;line-height: 38px;margin-right: 40px;">Save</span><span id="saleButton" v-show="!sharedStore.isRemark" v-if="isInMarket" class="menu-item" v-on:click="handlePostToSale()" style="height: 38px;line-height: 38px;margin-right: 40px;">Post to Marketplace</span><span id="orderButton" v-show="!sharedStore.isRemark" v-if="!isInMarket" class="menu-item" v-on:click="handleOrder()" style="height: 38px;line-height: 38px;margin-right: 40px;">{{orderLabel}}</span></div><div v-on:click="handleHideHelp()" v-show="sharedStore.isShowHelp" style="position: fixed;width: 100%;height: 100%;top: 0px;" v-bind:style="{zIndex: windowZindex-2}"></div><div class="help-popup" v-show="sharedStore.isShowHelp" v-bind:style="{zIndex: windowZindex-1}"><span class="poptip-arrow-top" style="left:50%;"><em class="poptip-arrow-top-em">◆</em><i class="poptip-arrow-top-i">◆</i></span><div class="help-item" v-on:click="handleFAQ()">FAQ</div><div class="help-item" style="margin-top: 0px;" v-on:click="handleContactUs()">Contact Us</div></div></div>',data:function(){return{privateStore:{},sharedStore:t,prj:{}}},computed:{orderLabel:function(){return this.sharedStore.fromCart||this.sharedStore.checkFailed?"Submit":"Order"},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)},isInMarket:function(){return!!t.isShowPostToSale},prj:function(){var e=this.sharedStore.projectSettings[t.currentSelectProjectIndex];
return e}},components:{"title-edit":o},methods:{handleFAQ:function(){window.open("/support.html#/Software","_blank"),this.sharedStore.isShowHelp=!1},handleContactUs:function(){this.$dispatch("dispatchShowContactUsWindow"),this.sharedStore.isShowHelp=!1},handleHelp:function(){this.sharedStore.isShowHelp=!this.sharedStore.isShowHelp},handleDownloadSpec:function(){t.isPopSave=!1,window.open("assets/data/14X16SPEC_TS.zip","_parent")},handleLogoClicked:function(){this.$dispatch("dispatchShowPopup",{type:"logo",status:-1})},handlePreview:function(){i(6).getIsShowProjectInfoView()?t.isInnerPreviewShow=!0:i(13).handledSaveOldProject(this,"dispatchPreviewSave"),i(8)({ev:i(9).ClickPreview})},handleSave:function(e,t,r){var a=this;if(i(6).getIsShowProjectInfoView()){var o=i(6).getProjectInfoViewText();this.$dispatch("dispatchShowPopup",{type:"saveAs",status:0,info:o})}else i(13).saveOldProject(a,function(){a.$dispatch("dispatchShowPopup",{type:"save",status:0}),i(11).deleteImageList()});i(8)({ev:i(9).ClickSave})},handleOrder:function(){var e=this,r=this.checkImageNumber();if(t.checkFailed)i(13).saveOldProject(e,function(){i(11).updateCheckStatus()});else if(i(6).getIsShowProjectInfoView()){var a=i(6).getProjectInfoViewText();this.$dispatch("dispatchShowPopup",{type:"saveAs",status:0,info:a})}else if(r.emptyPageNum){var o="Little Scribble Card style you are ordering can contain up to "+this.sharedStore.LSCPageNum+" photo(s). Currently it contains only "+(this.sharedStore.LSCPageNum-r.emptyPageNum)+" photo(s). You have "+r.emptyPageNum+(r.emptyPageNum>1?" blank cards.":" blank card.");this.$dispatch("dispatchShowPopup",{type:"alertMessage",message:o,height:250})}else i(13).saveOldProject(e,function(){t.isPrjSaved=!0,t.isPopSave=!1,window.location="/"+t.orderType+"/addShoppingCart.html?projectGUID="+t.projectId+"&quantity=1"});i(8)({ev:i(9).ClickOrder,emptyPageNum:r.emptyPageNum})},checkImageExist:function(){for(var e=t.pages[t.currentSelectProjectIndex].canvas,i=e.params,r=0;r<i.length;r++)if("image"===i[r].elType&&i[r].imageId)return!0;return!1},checkImageNumber:function(){var e=0,t=0;return this.sharedStore.pages.forEach(function(i){if(!i.isDeleted){e++;var r=i.canvas,a=r.params,o=a.some(function(e){return"image"===e.elType&&e.imageId});o||t++}}),{pageNum:e,emptyPageNum:t}},handleOptions:function(){this.$dispatch("dispatchShowOptionsWindow")},redirectHome:function(){window.location="/",alert("in")},handlePostToSale:function(){var e=this;if(i(6).getIsShowProjectInfoView()){var r=i(6).getProjectInfoViewText();this.$dispatch("dispatchShowPopup",{type:"saveAs",status:0,info:r})}else"true"===t.userSettings.ordered?(t.isPopSave=!1,window.location="/marketplace-listing-info.html?projectId="+t.projectId):i(13).saveOldProject(e,function(){t.isPopSave=!1,window.location="/marketplace-listing-info.html?projectId="+t.projectId})},handleClone:function(){this.$dispatch("dispatchShowCloneWindow")},handleHideHelp:function(){this.sharedStore.isShowHelp=!1},blurFocus:function(){this.$dispatch("dispatchClearScreen")},enableReprint:function(){r("#reprintButton").css("pointer-events","auto"),r("#reprintButton").css("opacity",1)},disableReprint:function(){r("#reprintButton").css("pointer-events","none"),r("#reprintButton").css("opacity",.4)},handlePrint:function(){this.disableReprint(),i(50).saveRemarkProject(this.disableReprint,this.enableReprint)}},events:{notifyPreviewSave:function(e){console.log("save-"+e),"success"===e?t.isInnerPreviewShow=!0:this.$dispatch("dispatchShowPopup",{type:"save",status:-1})},notifyResetProjectInfo:function(e){e?(r("#saveButton").css("pointer-events","auto"),r("#saveButton").css("opacity",1),r("#saleButton").css("pointer-events","auto"),r("#saleButton").css("opacity",1)):(r("#saveButton").css("pointer-events","none"),r("#saveButton").css("opacity",.4),r("#saleButton").css("pointer-events","none"),r("#saleButton").css("opacity",.4))}},ready:function(){var e=this;e.$watch("sharedStore.watches.isProjectComplete",function(){if(e.sharedStore.watches.isProjectComplete){var r=e.sharedStore.projectSettings[t.currentSelectProjectIndex].product,a=i(1).getOptions("product");for(idx in a){var o=a[idx];o.id==r&&(t.productTitle=o.title)}}})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){var a=(i(35),i(22)),o=i(14),n=i(18),s=i(26),d=i(15);e.exports={template:'<div class="bed-image-crop" v-show="sharedStore.isImageCropShow"><div class="shadow-bg" v-bind:style="{ zIndex: windowZindex-1 }"></div><div class="box-image-crop" v-bind:style="{ zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 700px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="hideImageCrop()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Edit Image</div><div class="font-desc t-left">Image - {{ imageName }}</div></div><div style="margin: 30px auto 20px;width: 680px;"><div id="box-crop"><img id="image-tobecrop" src="" /></div></div><div style="height: 46px;"><span class="button-circle" v-on:click="doRotate(-90) | debounce" style="display: inline-block; margin-left: 291px;height:46px;" title="rotate left"><img src="../../static/img/rotate_left.png" onmouseover="this.src = \'../../static/img/rotate_left_hover.png\';" onmouseout="this.src = \'../../static/img/rotate_left.png\';" width="46" height="46" alt="rotate left" /></span><span class="button-circle" v-on:click="doRotate(90) | debounce" style="display: inline-block; margin-left: 70px;" title="rotate right"><img src="../../static/img/rotate_right.png" onmouseover="this.src = \'../../static/img/rotate_right_hover.png\';" onmouseout="this.src = \'../../static/img/rotate_right.png\';" width="46" height="46" alt="rotate right" /></span></div><div style="height: 20px;"><span style="display: inline-block; width: 46px; height: 20px; line-height: 20px; text-align: center; margin-left: 291px; font-size: 12px; color: #7a7a7a;">- 90°</span><span style="display: inline-block; width: 46px; height: 20px; line-height: 20px; text-align: center; margin-left: 70px; font-size: 12px; color: #7a7a7a;">+ 90°</span></div><div class="button" v-on:click="doImageCrop()" style="display: inline-block; width: 160px;height: 40px;line-height: 40px;margin:25px 0 0 290px;text-align: center;font-size: 14px;" title="Click to crop image">Done</div></div></div>',data:function(){return{privateStore:{jcrop_api:"",isCanRotate:!1,cropWindowParams:{width:740,height:698,selector:".box-image-crop"},isRemoveButtonShow:!0},init:[],sharedStore:t,firstTime:!0,selectedIdx:"",imageId:null,imageRotate:0,cropInfo:{px:0,py:0,pw:0,ph:0,width:0,height:0}}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{initPrivateData:function(e,t){var a=this.sharedStore.pages[e].canvas,o=a.params[t];this.borderLengthInch=i(5).getInchByPx(a.borderLength||0),this.borderColor=a.borderColor||"none",this.cropInfo.px=o.cropPX,this.cropInfo.py=o.cropPY,this.cropInfo.pw=o.cropPW,this.cropInfo.ph=o.cropPH,this.imageId=o.imageId,this.imageRotate=o.imageRotate,"none"==this.borderColor&&(r("#border-size-selector").css("pointer-events","none"),r("#border-size-selector").css("opacity",.4))},hideImageCrop:function(){this.selectedIdx="",this.sharedStore.isImageCropShow=!1},handleSendToBack:function(){var e=t.pages[t.selectedPageIdx].canvas;d.sendToBack({idx:e.selectedIdx}),this.hideImageCrop()},doRotate:function(e){if(this.privateStore.isCanRotate){var i=t.pages[t.selectedPageIdx].canvas,r=""!==this.selectedIdx?this.selectedIdx:i.selectedIdx,o=i.params[r];this.imageRotate=a.getRotatedAngle(this.imageRotate,e);var s=n.getImageDetail(this.imageId),d=90===Math.abs(this.imageRotate),l=d?s.height:s.width,c=d?s.width:s.height,p=a.getDefaultCrop(l,c,o.width,o.height);this.cropInfo.px=p.px,this.cropInfo.py=p.py,this.cropInfo.pw=p.pw,this.cropInfo.ph=p.ph,this.triggerImageCrop(r)}},triggerImageCrop:function(e){var t=this.sharedStore,i=t.pages[t.selectedPageIdx].canvas;""!==this.selectedIdx&&(i.selectedIdx=this.selectedIdx),null!=e&&""!==e?e:e=i.selectedIdx,this.imageId&&(this.handleCropInit(e),o.setPopWindowPosition(this.privateStore.cropWindowParams),t.isImageCropShow=!0)},handleCropInit:function(e){var t=this,a=t.sharedStore,o=a.pages[a.selectedPageIdx].canvas;t.privateStore.isCanRotate=!1,null!=e&&""!==e?e:e=o.selectedIdx;var s=n.getImageDetail(this.imageId),d=90===Math.abs(this.imageRotate),l=d?s.height:s.width,c=d?s.width:s.height,p=l*this.cropInfo.px,h=c*this.cropInfo.py,g=l*this.cropInfo.pw,u=c*this.cropInfo.ph,m=680,f=400;this.privateStore.cropWindowParams.height>window.innerHeight&&(f=window.innerHeight-300);var v=m/f,S=l/c;v>S?a.cropImageRatio=f/c:a.cropImageRatio=m/l;var y=l*a.cropImageRatio,w=c*a.cropImageRatio,x=(m-y)/2,I=(f-w)/2;r("#box-crop").css("margin-left",x).css("padding-top",I),""!==t.privateStore.jcrop_api&&t.privateStore.jcrop_api.destroy();var b=i(6),P=b.getEncImgId(this.imageId),j=b.getQueryString({encImgId:P,px:0,py:0,pw:1,ph:1,width:Math.round(y),height:Math.round(w),rotation:this.imageRotate});r("#image-tobecrop").attr("src","/imgservice/op/crop?"+j+i(7).getSecurityString()).attr("width",y).attr("height",w).css("width",y).css("height",w).Jcrop({aspectRatio:o.params[e].width/o.params[e].height,setSelect:[p*a.cropImageRatio,h*a.cropImageRatio,(p+g)*a.cropImageRatio,(h+u)*a.cropImageRatio],bgColor:"black",allowSelect:!1,bgOpacity:.4,onSelect:function(e){if(t.sharedStore.isImageBorder&&"canvas"===t.sharedStore.projectSettings[t.sharedStore.selectedPageIdx].product){var o=a.projectSettings[a.selectedPageIdx].size,n=t.sharedStore.pages[a.selectedPageIdx].canvas,s=Math.max(o.split("X")[0],o.split("X")[1]),d=i(5).getInchByPx(n.mirrorSize.top||0),l=i(5).getInchByPx(n.mirrorSize.right||0),c=i(5).getInchByPx(n.mirrorSize.bottom||0),p=i(5).getInchByPx(n.mirrorSize.left||0),h=d/(s+2*d),g=l/(s+2*l),u=c/(s+2*c),m=p/(s+2*p),f=Math.max(e.w,e.h)*h-2+"px",v=Math.max(e.w,e.h)*g-2+"px",S=Math.max(e.w,e.h)*u-2+"px",y=Math.max(e.w,e.h)*m-2+"px";t.firstTime||(r(".t-border").css("height",f),r(".r-border").css("width",v),r(".b-border").css("height",S),r(".l-border").css("width",y)),a.cropParams={x:e.x,y:e.y,w:e.w,h:e.h,realTop:f,realRight:v,realBottom:S,realLeft:y},t.firstTime=!1}else a.cropParams={x:e.x,y:e.y,w:e.w,h:e.h}}},function(){if(t.privateStore.jcrop_api=this,t.privateStore.isCanRotate=!0,t.sharedStore.isImageBorder&&"canvas"===t.sharedStore.projectSettings[t.sharedStore.selectedPageIdx].product){var e=r(r(".jcrop-vline")[0]),i=r("<div />").css({position:"absolute",width:"100%",top:"1px",left:0,"border-bottom":"1px solid #000"}).addClass("t-border"),o=r("<div />").css({position:"absolute",height:"100%",top:0,right:"1px","border-left":"1px solid #000"}).addClass("r-border"),n=r("<div />").css({position:"absolute",width:"100%",bottom:"1px",left:0,"border-top":"1px solid #000"}).addClass("b-border"),s=r("<div />").css({position:"absolute",height:"100%",top:0,left:"1px","border-right":"1px solid #000"}).addClass("l-border");e.after(i),e.after(o),e.after(n),e.after(s),r(".t-border").css("height",a.cropParams.realTop),r(".r-border").css("width",a.cropParams.realRight),r(".b-border").css("height",a.cropParams.realBottom),r(".l-border").css("width",a.cropParams.realLeft),r(".t-border,.r-border,.b-border,.l-border").css("background","rgba(255,255,255,0.5)")}})},doImageCrop:function(){var e=this.sharedStore,t=e.pages[e.selectedPageIdx].canvas,i=t.selectedIdx,r=n.getImageDetail(this.imageId),a=90===Math.abs(this.imageRotate),o=a?r.height:r.width,s=a?r.width:r.height,d=(t.params[i].imageId,e.cropParams.x/e.cropImageRatio/o),l=e.cropParams.y/e.cropImageRatio/s,c=e.cropParams.w/e.cropImageRatio/o,p=e.cropParams.h/e.cropImageRatio/s;t.params[i].width*t.ratio/c,t.params[i].height*t.ratio/p;t.params[i].cropX=e.cropParams.x/e.cropImageRatio,t.params[i].cropY=e.cropParams.y/e.cropImageRatio,t.params[i].cropW=e.cropParams.w/e.cropImageRatio,t.params[i].cropH=e.cropParams.h/e.cropImageRatio,t.params[i].cropPX=d,t.params[i].cropPY=l,t.params[i].cropPW=c,t.params[i].cropPH=p,t.params[i].imageRotate=this.imageRotate,t.params[i].isRefresh=!0,this.hideImageCrop()},handleRemoveImage:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;s.deleteImage(e.selectedIdx),n.freshImageUsedCount(),this.sharedStore.isImageCropShow=!1}},props:["imageName"],events:{notifyImageCrop:function(){this.triggerImageCrop()},notifyRotateImage:function(e){var t=this,i=t.sharedStore,r=i.pages[i.selectedPageIdx].canvas;void 0!=e.idx&&null!=e.idx&&""!==e.idx?e.idx:e.idx=r.selectedIdx,void 0!=e.nDegree&&null!=e.nDegree?e.nDegree:e.nDegree=0;var o=e.idx,n=e.nDegree,s=a.getRotatedAngle(r.params[o].imageRotate,n);if(r.params[o].imageRotate=s,90===Math.abs(r.params[o].imageRotate))var d=r.params[o].imageHeight,l=r.params[o].imageWidth;else var d=r.params[o].imageWidth,l=r.params[o].imageHeight;var c=a.getDefaultCrop(d,l,r.params[o].width,r.params[o].height),p=c.px,h=c.py,g=c.pw,u=c.ph;r.params[o].width*r.ratio/g,r.params[o].height*r.ratio/u;r.params[o].cropX=d*p,r.params[o].cropY=l*h,r.params[o].cropW=d*g,r.params[o].cropH=l*u,r.params[o].cropPX=p,r.params[o].cropPY=h,r.params[o].cropPW=g,r.params[o].cropPH=u,r.params[o].isRefresh=!0},notifyFreshCrop:function(){var e=this,t=e.sharedStore,i=t.pages[t.selectedPageIdx].canvas,r=i.selectedIdx;if(90===Math.abs(i.params[r].imageRotate))var o=i.params[r].imageHeight,n=i.params[r].imageWidth;else var o=i.params[r].imageWidth,n=i.params[r].imageHeight;var s=a.getDefaultCrop(o,n,i.params[r].width,i.params[r].height),d=s.px,l=s.py,c=s.pw,p=s.ph;i.params[r].width*i.ratio/c,i.params[r].height*i.ratio/p;i.params[r].cropX=o*d,i.params[r].cropY=n*l,i.params[r].cropW=o*c,i.params[r].cropH=n*p,i.params[r].cropPX=d,i.params[r].cropPY=l,i.params[r].cropPW=c,i.params[r].cropPH=p}},created:function(){var e=this;e.$watch("sharedStore.watches.isCropThisImage",function(){if(e.sharedStore.watches.isCropThisImage){var i=e.sharedStore.watchData.cropImageIdx;e.selectedIdx=i,e.sharedStore.watches.isCropThisImage=!1,e.sharedStore.watchData.cropImageIdx="",e.initPrivateData(t.selectedPageIdx,i),e.triggerImageCrop(i)}})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){e.exports={template:'<div style="text-align: center;" v-on:click="blurFocus"><div class="button" v-on:click="triggerImageUpload()" style="width: 260px;height: 32px;line-height: 32px;margin: 10px auto 0px;font-size: 13px;">Add Photos</div><div id="list-image" v-bind:style="{overflow: newImageList.length ? \'auto\': \'\' }"><div class="list-image-container"><div v-show="newImageList.length" class="item-image" v-for="item in newImageList" v-on:mouseover="handleShowDeleteIcon($index)" v-on:mouseout="handleHideDeleteIcon($index)"><div class="wrap-image"><div class="loaded-image"><img class="preview-image" id="ori-image-{{ $index }}" :imageid="item.id" :imageurl="item.url" :src="item.previewUrl" :alt="item.name" draggable="true"/><div class="box-preview-image" v-bind:style="{opacity: item.usedCount > 0? 1: 0 }"  draggable="false" ><span>{{ item.usedCount }}</span></div><div><img class="icon-delete" id="icon-delete-{{ $index }}" src="./assets/img/delete.svg" v-on:click="handleDeleteImage($index)" v-show="item.usedCount <= 0" alt="delete" title="delete" style=" opacity: 0; cursor: pointer;" draggable="false"/><img class="icon-delete" src="./assets/img/delete.svg" v-else alt="delete" style=" opacity: 0; cursor: pointer;" draggable="false" /></div></div></div></div><div style="clear: both;"></div></div><div v-show="!newImageList.length" class="item-empty" v-on:click="triggerImageUpload()"><div class="item-empty-arrow"></div><div class="item-empty-title">Click here to select photo(s)</div></div></div></div>',data:function(){return{privateStore:{imageList:[],isHideUsed:!1,imageListParams:{selector:"#list-image"}},sharedStore:t}},computed:{newImageList:function(){for(var e=[],i=0;i<this.sharedStore.imageList.length;i++)(this.privateStore.isHideUsed===!1||this.privateStore.isHideUsed===!0&&this.sharedStore.imageList[i].usedCount<=0)&&(e.push(this.sharedStore.imageList[i]),e[e.length-1].previewUrl=t.imageList[i].previewUrl,e[e.length-1].imageTip=this.chopImageTip(this.sharedStore.imageList[i].name,this.sharedStore.imageList[i].width,this.sharedStore.imageList[i].height));var r=this.selected;if(e&&e.length>0)switch(r){case"uploadTimeN2O":e.sort(function(e,t){return t.uploadTime-e.uploadTime});break;case"uploadTimeO2N":e.sort(function(e,t){return e.uploadTime-t.uploadTime});break;case"createTimeN2O":e.sort(function(e,t){return t.createTime-e.createTime});break;case"createTimeO2N":e.sort(function(e,t){return e.createTime-t.createTime});break;case"nameA2Z":e.sort(function(e,t){return e.name.localeCompare(t.name)});break;case"nameZ2A":e.sort(function(e,t){return t.name.localeCompare(e.name)})}return this.bindImageDragEvent(),e},isImageListShow:function(){return this.sharedStore.imageList.length>0}},methods:{triggerImageUpload:function(e){for(var a=0;a<this.sharedStore.uploadProgress.length;a++)"Error"===this.sharedStore.uploadProgress[a].percent&&r("#single-upload-row-item-"+a).remove();this.sharedStore.isSingleUploadButton?t.vm.$broadcast("notifyShowImageUpload",!0):t.vm.$broadcast("notifyShowImageUpload"),e||i(8)({ev:i(9).AddPhotos})},chopImageTip:function(e,t,i){e=e||"",t=t||0,i=i||0;var r="",a="",o="",n="";if(t>0&&i>0&&(o=r=" ("+t+"x"+i+")"),e.length+r.length>20)if(r.length>14){var s=t+"x"+i;if(o=" ("+s.substr(0,9)+"...)",e.length>6){var d=6,l=d-4;a=e,n=a.substr(0,l)+"..."+a.substr(a.length-3)}else n=a=e}else{var d=20-r.length,l=d-4;a=e,n=a.substr(0,l)+"..."+a.substr(a.length-3)}else n=a=e;return{longTip:a,shortTip:n}},handleHideUsedToggle:function(){},handleShowDeleteIcon:function(e){r("#icon-delete-"+e).css("opacity",1)},handleHideDeleteIcon:function(e){r("#icon-delete-"+e).css("opacity",0)},handleDeleteImage:function(e){if(void 0!=e){var t=r("#ori-image-"+e).attr("imageid")||"";if(""!==t)for(var i=0;i<this.sharedStore.imageList.length;i++)if(t==this.sharedStore.imageList[i].id){this.sharedStore.deleImagelist.push(this.sharedStore.imageList[i].encImgId),this.sharedStore.imageList.splice(i,1);break}}},bindImageDragEvent:function(){var e=this;e.$nextTick(function(){console.log("binding events now");for(var i=0;i<r(".item-image").length;i++)r(".item-image")[i].ondragstart=function(i){t.isImageDrag=!0,console.log("trigger event now "+r(i.target).attr("imageid")),e.$dispatch("dispatchShowSpineLines"),e.sharedStore.elementDragged=i.target,e.sharedStore.dragData.imageId=r(i.target).attr("imageid"),e.sharedStore.dragData.sourceImageUrl=r(i.target).attr("imageurl"),e.sharedStore.dragData.cursorX=i.offsetX||0,e.sharedStore.dragData.cursorY=i.offsetY||0,e.sharedStore.dragData.isFromList=!0,e.sharedStore.operateMode="drag"},r(".item-image")[i].ondragend=function(t){console.log("dragging ends now"),e.sharedStore.dragData.isFromList=!1,e.sharedStore.operateMode="idle",e.$dispatch("dispatchHideSpineLines")}})},blurFocus:function(){this.$dispatch("dispatchClearScreen"),this.sharedStore.isTotalPriceShow=!1}},events:{notifyImageList:function(){console.log("notify image list event");var e=i(14);e.initImageListSizeWithLRB(this.privateStore.imageListParams)},notifyTriggerImageUpload:function(){this.triggerImageUpload(!0)}},created:function(){}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={template:'<div id="frame" v-show="sharedStore.isInnerPreviewShow" style="position: fixed; z-index: 9999999; left: 0; top: 0; width: 100%; height: 100%; background-color: white;"><img v-show="!privateStore.orderedPreview" src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHidePreview()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="position: absolute; top: 18px; right: 44px; cursor: pointer;" /></div>',data:function(){return{privateStore:{previewUrl:"",orderedPreview:!1},sharedStore:t}},computed:{},events:{notifyOrderedPreview:function(){this.sharedStore.isInnerPreviewShow=!0,this.privateStore.orderedPreview=!0}},methods:{handleHidePreview:function(){this.sharedStore.isInnerPreviewShow=!1}},ready:function(){var e=this;e.$watch("sharedStore.isInnerPreviewShow",function(){if(e.sharedStore.isInnerPreviewShow){document.getElementById("inner-preview")&&document.getElementById("frame").removeChild(document.getElementById("inner-preview"));for(var i=window.location.href,r=i.split("index.html?")[0],a=e.privateStore.orderedPreview?"&orderedPreview=true":"",o=-1,n=0;n<=this.sharedStore.selectedPageIdx;n++)this.sharedStore.pages[n].isDeleted||o++;o<=0&&(o=0),i=r+"preview.html?initGuid="+t.projectId+"&isPreview=true&source=self"+a+"&selectedPageIdx="+o,e.privateStore.previewUrl=i;var s=document.createElement("iframe");s.src=i,s.id="inner-preview",s.style.width="100%",s.style.height="100%",document.getElementById("frame").appendChild(s)}else e.privateStore.previewUrl=""})}}}).call(t,i(2))},function(e,t,i){(function(t){var r=i(24),a=r.extend(i(62));e.exports={template:'<div class="bed-list-tab" v-show="!sharedStore.isPreview" v-on:click="blurFocus" style="border-right: 1px solid rgba(232, 232, 232, 1);border-top: 1px solid rgba(232, 232, 232, 1);"><div style="height: 34px;"><div class="t-center" v-bind:class="list1Class" v-on:click="handleChangeTab(1)" style="width: 140px; border-right: 1px solid rgba(232, 232, 232, 1);">Photos</div><div class="t-center" v-bind:class="list2Class" style="width: 139px;cursor: default;"></div></div><image-list v-show="privateStore.currentView === \'image-list\'"></image-list><layout-list v-show="privateStore.currentView === \'layout-list\'"></layout-list></div>',data:function(){return{privateStore:{currentView:"image-list"},sharedStore:t}},computed:{list0Class:function(){return"option-list"===this.privateStore.currentView?"list-tab-selected":"list-tab"},list1Class:function(){return"image-list"===this.privateStore.currentView?"list-tab-selected":"list-tab"},list2Class:function(){return"layout-list"===this.privateStore.currentView?"list-tab-selected":"list-tab"}},components:{"image-list":a},methods:{handleChangeTab:function(e){switch(e){case 0:this.privateStore.currentView="option-list";break;case 1:this.privateStore.currentView="image-list";break;case 2:this.privateStore.currentView="layout-list"}},blurFocus:function(){this.$dispatch("dispatchClearScreen")}}}}).call(t,i(2))},function(e,t,i){(function(t){i(5);e.exports={template:'<div class="bed-matting-change" v-show="privateStore.isMattingChangeShow"><div class="shadow-bg" v-bind:style="{zIndex:windowZindex}"></div><div class="box-matting-change fix-center" v-bind:style="{zIndex:windowZindex}" style="background-color: #fff;width: 520px;padding-bottom: 30px;overflow:visible" ><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 480px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="hideMattingChange" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 30px;"><div class="font-normal t-center" style="font-size: 20px;color: #3a3a3a;">Matting requires the glass frame option</div></div><div class="font-light t-center" style="margin:14px 100px 24px;font-size:14px;color:#7b7b7b;line-height:1.5;">Option for matting will also change your frame from "glassless" to "glass".</div><div style="margin: 24px 0 0; text-align:center;"><div class="button-white t-center" v-on:click="hideMattingChange" style="margin-right: 40px;border: 1px solid #7b7b7b;text-align: center;width: 135px;height: 40px;line-height: 40px;display: inline-block;font-size: 14px;">Cancel</div><div class="button-white t-center" v-on:click="handleMattingChange" style="border: 1px solid #7b7b7b;text-align: center;width: 135px;height: 40px;line-height: 40px;display: inline-block;font-size: 14px;">OK</div></div></div></div>',data:function(){return{privateStore:{id:"",value:"",isMattingChangeShow:!1},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+99)}},methods:{hideMattingChange:function(){this.privateStore.isMattingChangeShow=!1,this.$dispatch("dispatchOptionItemSelect","matteStyle","none")},handleMattingChange:function(){this.privateStore.isMattingChangeShow=!1,this.sharedStore.isSwitchLoadingShow=!0,this.$dispatch("dispatchOptionItemSelect","matteStyle",this.privateStore.value)}},events:{notifyShowMattingChange:function(e,t){this.privateStore.id=e,this.privateStore.value=t,this.privateStore.isMattingChangeShow=!0}}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={props:["measure","id","num"],template:'<div style="display: inline-block;margin-right:40px;margin-bottom:20px"><label style="display:inline-block;width:40px;text-align:right;color:#7b7b7b;font-size:14px;">{{measure}}:</label><a style="margin-left: 5px;width: 26px;height: 26px;" href="javascript:" v-on:click="numDown()"><img style="position: relative;top:6px;" src="assets/img/down.png" draggable="false"></a><div  v-bind:class="{ \'firefox-order\': privateStore.isFireFox}" style="position:relative;display:inline-block;background:#f4f4f4;width:30px;height:26px;margin-left:4px;bottom:7px;"><input v-on:blur="handleTextBlur()" style="position:relative;display:block;width:100%;text-align:center;color:#7b7b7b;font-size:14px;top:5px;background:transparent;border-style:none" v-model="num"/></div><a style="margin-left: 3px;width: 26px;height: 26px;" href="javascript:" v-on:click="numUp()"><img style="position: relative;top:6px;" src="assets/img/up.png" draggable="false" ></a></div>',data:function(){return{privateStore:{isFireFox:!1},sharedStore:t}},methods:{numUp:function(){this.num++,this.num>99999&&(this.num=99999)},numDown:function(){this.num--,this.num<0&&(this.num=0)},handleTextBlur:function(){var e=Math.round(this.num);isNaN(e)&&(e=1),e<0?e=0:e>99999&&(e=99999),this.num=e}},ready:function(){var e=navigator.userAgent;e.indexOf("Firefox")!=-1&&(this.privateStore.isFireFox=!0)},events:{}}}).call(t,i(2))},function(e,t,i){(function(t,r){var a=i(20),o=(i(16),i(5));e.exports={template:'<div v-show="sharedStore.isCanvas" class="box-mirror"><canvas id="mirror-top" height="{{ vMirrorLength+1 }}px" width="{{ w  }}px" v-bind:style="{top: top + \'px\', left: left +\'px\', zIndex: windowZindex}" style="position:absolute;"></canvas><canvas id="mirror-right" width="{{ vMirrorLength+1 }}px" height="{{ h  }}px" v-bind:style="{top : vMirrorLength/2 + top - vMirrorLength +  \'px\', left: rLeft +\'px\', zIndex: windowZindex-1}" style="position:absolute;background: #fff;"></canvas></div>',data:function(){return{sharedStore:t,borderShow:!1,mirrorShow:!1}},computed:{w:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.width},h:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.height},left:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.oriX*e.ratio},top:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.oriY*e.ratio},rLeft:function(){var e=t.pages[t.selectedPageIdx].canvas;return(e.oriX+e.frameBaseSize.width)*e.ratio+this.vMirrorLength},vMirrorLength:function(){var e=t.pages[t.selectedPageIdx].canvas;return this.sharedStore.mirrorLength*e.ratio},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+9)}},methods:{createMirror:function(){var e,i,n,s=a.getClient("screenshot"),d=this.w,l=this.h,c=(s.context,t.pages[t.selectedPageIdx].canvas),p=(r("#container"),r("#screenshot"));n=this.sharedStore.mirrorLength*c.ratio,e=a.getImageData("screenshot",0,0,p.get(0).width,p.get(0).height),a.fillImageData("screenshot",e);var d=p.get(0).width,l=p.get(0).height;if(this.sharedStore.isMirrorBorder)e=a.getImageData("screenshot",0,n,d-n,n),i=a.createImageData("mirror-top",d-n,n),i=a.imageDataVRevert(e,i),a.fillImageData("mirror-top",i,0,0,d-n,n),e=a.getImageData("screenshot",d-2*n,n,n,Math.floor(l-n/2)),i=a.createImageData("mirror-right",n,Math.floor(l-n/2)),a.fillImageData("mirror-right",e,0,n,n,Math.floor(l-n/2)),r("#overlay-top,#overlay-bottom").width=this.w,r("#overlay-left,#overlay-right").height=this.h;else if(this.sharedStore.isColorBorder){var h=o.decToHex(this.sharedStore.bgColor);a.drawRect("mirror-top",h,0,0,d-n,n),a.drawRect("mirror-right",h,0,0,n,l),r("#overlay-top,#overlay-bottom").width=this.w,r("#overlay-left,#overlay-right").height=this.h}else{r("#overlay-top,#overlay-bottom").width=this.w,r("#overlay-left,#overlay-right").height=this.h;var g=a.getImageData("screenshot",d-n,0,n,l),u=a.getImageData("screenshot",0,0,d-n,n);i=a.createImageData("mirror-right",n,Math.floor(l-n/2)),i=a.imageDataHRevert(g,i),a.fillImageData("mirror-right",i,0,n-this.vMirrorLength,n,l),a.fillImageData("mirror-top",u,0,0,d,n)}e=a.wrapBorder("mirror-top","top"),a.clear("mirror-top"),e=a.fillEmptyDataWithColor(e,{r:255,g:255,b:255}),e=a.replaceColor(e,e.width-n-n/2+2,0,{r:255,g:255,b:255}),a.fillImageData("mirror-top",e,0,0,e.width,e.height),e=a.wrapBorder("mirror-right","right"),a.clear("mirror-right"),e=a.fillEmptyDataWithColor(e,{r:255,g:255,b:255}),a.fillImageData("mirror-right",e,0,0,e.width,e.height),t.vm.$broadcast("notifyRefreshRealScreenshot")},refreshMirror:function(){a.clear("mirror-top"),a.clear("mirror-right"),this.createMirror()}},events:{notifyRefreshMirror:function(){}},ready:function(){}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){var a=i(29),o=i(5),n=(i(48),i(15));e.exports={template:'<div style="width:380px;overflow-x:hidden;overflow-y:auto;background-color:rgb(246,246,247)" v-bind:style="{ height: privateStore.minHeight + \'px\' }"><div v-show="isShowMatte" style="margin:38px 0 38px 35px;width:340px;overflow: hidden;"><div style="font-size:14px;font-weight:600;margin-bottom:10px;margin-left: 5px">Select Matting & Glass</div><div style="float: left;min-height:70px;border-right: solid 1px;border-color: #dedede;width: 147px;"><p v-for="item in privateStore.matteList" class="matteMargin" style="min-width:150px;"><input id="matte-{{item.id}}" value="{{item.id}}" v-model="privateStore.matteStyle" type="radio" v-on:change="matteOptionChange"><label for="matte-{{item.id}}" v-bind:class="{ \'radio-pressed\': (privateStore.matteStyle===item.id), \'radio-normal\': (privateStore.matteStyle!==item.id) }">{{item.title}}</label></p></div><div style="float: left;min-height:70px;margin: 0 0 0 8px;"><p v-for="item in privateStore.glassList" style="min-width:150px;margin: 0 0 18px 0;"><input id="glass-{{item.id}}" value="{{item.id}}" v-model="privateStore.glassStyle" type="radio" v-on:change="glassOptionChange"><label for="glass-{{item.id}}" v-bind:class="{ \'radio-pressed\': (privateStore.glassStyle===item.id), \'radio-normal\': (privateStore.glassStyle!==item.id) }">{{item.title}}</label></p></div></div><div v-if="allCategory.length" style="width: 340px; margin: 0 0px 35px 35px; overflow: hidden; height: auto;"><div style="width:310px;overflow:hidden;"><p v-show="item.value !==\'Other\' || !sharedStore.isFromMarketplace" v-for="item in allCategory" style="float: left;min-width:135px;height:20px;font-size:13px;margin:20px 0 0 0;"><input id={{item.id}} type="radio" name="category" value="{{item.id}}" v-model="privateStore.category" v-on:change="categoryOptionChange" ><label class="radio-pressed" for={{item.id}} style="cursor:pointer;">{{ item.value }}</label></p><p v-show="privateStore.category === \'categoryWallarts\' && !sharedStore.isFromMarketplace" style="float: left;min-width:135px;height:20px;font-size:13px;margin:20px 0 0 -70px;"><select v-on:change="moreCategoryOptionChange" v-model="privateStore.selectedMoreCategory" style="height:20px;"><option v-for="item in privateStore.moreCategory" value="{{ item.id }}">{{ item.value }}</option></select></p></div></div><hr v-if="allCategory.length" style="width:96%" color="#DEDEDE" size="1"/><option-item v-for="data in privateStore.optionList" v-bind:id="data.id"  v-bind:title="data.title" v-bind:options.sync="data.options" v-bind:selected.sync="data.selected" v-bind:line="data.isShowHr" v-bind:item="data.showItem"></option-item><hr v-show="sharedStore.isCanvas" style="width:96%" color="#DEDEDE" size="1"/><div v-show="sharedStore.isCanvas" style="width:340px;margin:25px 0 25px 35px;overflow:hidden;" id="select-border"><div style="width:200px;font-size:14px;font-weight:600;margin:0 0 -5px 5px">Border</div><div style="width:310px;overflow:hidden;"><p v-for="item in privateStore.borderList" class="borderMargin" style="min-width:150px;" title="{{item.alt}}"><input id="border-{{item.id}}" value="{{item.id}}" name="border" v-model="canvasBorder" type="radio" v-on:change="borderOptionChange()" ><label for="border-{{item.id}}" v-bind:class="{ \'radio-pressed\': (canvasBorder===item.id), \'radio-normal\': (canvasBorder!==item.id) }" style="cursor:pointer;">{{item.title}}</label>&nbsp;&nbsp;&nbsp;<input id="select-color" v-if="item.id===\'color\'" style="margin-top:-10px;" name="color" v-model="borderColor" type="text" v-on:change="colorChange"/></p></div></div></div>',
data:function(){return{privateStore:{optionList:[],borderList:[{title:"Image Wrap",id:"image",alt:"Your image will continue to wrap around the canvas"},{title:"Mirror Wrap",id:"mirror",alt:"Your image will stop along the edge and then reflect like a mirror as it wraps around the sides"},{title:"Colored Wrap",id:"color",alt:"Your image will stop along the edge with a solid color border of your choice"}],matteStyle:"none",glassStyle:"none",matteList:[],glassList:[],minHeight:500,category:null,moreCategory:[],selectedMoreCategory:null,product:null,tempSettingMap:{},tempCategoryProduct:{}},sharedStore:t,title:""}},computed:{isShowMatte:function(){return!1},canvasBorder:function(){var e=this.sharedStore.projectSettings[this.sharedStore.currentSelectProjectIndex].canvasBorder;return r(".sp-replacer").length&&("color"!==e?r(".sp-replacer").addClass("sp-disabled").css("pointerEvents","none"):r(".sp-replacer").removeClass("sp-disabled").css("pointerEvents","auto")),e},borderColor:function(){var e=o.decToHex(this.sharedStore.bgColor);return r("#select-color").length&&r("#select-color").spectrum("set",e),e},selectColorDisabled:function(){return"color"!==this.canvasBorder},allCategory:function(){var e=r(this.sharedStore.spec.specXml),t=[];return e.find("#category option").each(function(){"categoryTableTop"!==r(this).attr("id")&&t.push({id:r(this).attr("id"),value:r(this).find("title").text().trim()})}),this.sharedStore.isShowCategoryOptions?t:[]}},methods:{getList:function(e){for(var r,a=i(1),o=a.getOptionMapKeyPatternById(e).split("-"),n=[],s=t.projectSettings[t.currentSelectProjectIndex],d=0,l=o.length;d<l;d++){var c=s[o[d]];if(c){var p={key:o[d],value:c};n.push(p)}}return r=a.getOptionsMap(e,n),r?r.split(","):[]},fixList:function(e,r){if(e&&r){for(var o=i(1).getOptions(e),n=[],s=0;s<r.length;s++)if("tableTop"!==r[s])for(var d=0;d<o.length;d++)if(r[s]===o[d].id){for(var l=r[s],c=o[d].name||o[d].title||"",p="",h=0;h<a.colorUrlMap.length;h++)if(a.colorUrlMap[h].key===l){p=a.colorUrlMap[h].url;break}for(var g=i(1),u=g.getOptionMapKeyPatternById(e).split("-"),m=[],f=t.projectSettings[t.currentSelectProjectIndex],v=0,S=u.length;v<S;v++){var y=f[u[v]];if(y){var w={key:u[v],value:y};m.push(w)}}var x,I=g.getDisableOptionsMap(e,m);null!=I&&(x=I.split(",")),(t.disableArray.indexOf(e)>-1||!I||x&&x.indexOf(l)==-1)&&n.push({id:l,title:c,url:p});break}return n}},resetOptionList:function(){this.privateStore.optionList=[];for(var e in a.wallartsConfigList){var i=t.projectSettings[t.currentSelectProjectIndex];if(i.product===a.wallartsConfigList[e].product)for(var r in a.wallartsConfigList[e].optionIds){var o=a.wallartsConfigList[e].optionIds[r].type,n=a.wallartsConfigList[e].optionIds[r].title,s=a.wallartsConfigList[e].optionIds[r].showHr,d=a.wallartsConfigList[e].optionIds[r].hide,l=this.fixList(o,this.getList(o)),c=a.wallartsConfigList[e].optionIds[r].paperAlt,p=new Object;if(p.title=n,p.id=o,p.options=l,c&&"paper"==o)for(var h=0;h<p.options.length;h++)p.options[h].paperAlt=c[h];p.isShowHr="true"===s,p.showItem="true"===d,console.log("option id = "+p.id+" selected = "+p.selected+" title = "+p.title+" options = "+p.options),this.privateStore.optionList.push(p)}}this.privateStore.matteList=this.fixList("matteStyle",this.getList("matteStyle")),this.privateStore.glassList=this.fixList("glassStyle",this.getList("glassStyle"))},resetOptionSelected:function(){var e=!1,i=t.projectSettings[t.currentSelectProjectIndex];for(var r in this.privateStore.optionList){var a=this.privateStore.optionList[r];if(i[a.id]){var o=!1;for(var n in a.options)if(a.options[n].id==i[a.id]&&a.selected!=a.options[n].id){a.selected=a.options[n].id,i[a.id]=a.selected,o=!0;break}!o&&a.options.length>0&&!a.selected&&(a.selected=a.options[0].id,i[a.id]=a.selected,e=!0)}}return this.privateStore.matteStyle!==i.matteStyle&&(this.privateStore.matteStyle=i.matteStyle,i.matteStyle=this.privateStore.matteStyle),this.privateStore.glassStyle!==i.glassStyle&&(this.privateStore.glassStyle=i.glassStyle,i.glassStyle=this.privateStore.glassStyle),e},matteOptionChange:function(e){this.sharedStore.isSwitchLoadingShow=!0,this.submitOptionValue("matteStyle",this.privateStore.matteStyle)},glassOptionChange:function(e){this.sharedStore.isSwitchLoadingShow=!0,this.submitOptionValue("glassStyle",this.privateStore.glassStyle)},categoryOptionChange:function(e){this.sharedStore.isSwitchLoadingShow=!0,this.submitOptionValue("category",this.privateStore.category)},moreCategoryOptionChange:function(e){this.sharedStore.isSwitchLoadingShow=!0,this.submitOptionValue("moreCategory",this.privateStore.selectedMoreCategory)},colorChange:function(){this.sharedStore.isSwitchLoadingShow=!0,this.sharedStore.bgColor=o.hexToDec(r('[name="color"]').val()),t.vm.$broadcast("notifyRefreshMirror")},borderOptionChange:function(e,a,s,d){this.sharedStore.isSwitchLoadingShow=!0;var l=r('[name="border"]:checked').val()||this.canvasBorder;if("categoryCanvas"===t.projectSettings[t.currentSelectProjectIndex].category&&("mirror"===l?(this.sharedStore.isBorderShow=!0,this.sharedStore.isMirrorBorder=!0,this.sharedStore.isColorBorder=!1,this.sharedStore.isImageBorder=!1,n.changeBorderToMirror(!1,s)):"image"===l?(this.sharedStore.isBorderShow=!1,this.sharedStore.isMirrorBorder=!1,this.sharedStore.isColorBorder=!1,this.sharedStore.isImageBorder=!0,n.changeBorderToMirror(!0,s)):"color"===l&&(this.sharedStore.isBorderShow=!0,this.sharedStore.isMirrorBorder=!1,this.sharedStore.isColorBorder=!0,this.sharedStore.isImageBorder=!1,n.changeBorderToMirror(!1,s))),e)r('[name="color"]').val(o.decToHex(this.sharedStore.bgColor));else{/#\d{6}/.test(r('[name="color"]').val())&&(this.sharedStore.bgColor=o.hexToDec(r('[name="color"]').val()));var c=t.pages[t.selectedPageIdx].canvas,p=c.params[0].imageId,h=i(18).getImageDetail(p);if(90===Math.abs(c.params[0].imageRotate))var g=h.height,u=h.width;else var g=h.width,u=h.height;var m=i(22).getDefaultCrop(g,u,c.params[0].width,c.params[0].height),f=m.px,v=m.py,S=m.pw,y=m.ph;c.params[0].cropX=g*f,c.params[0].cropY=u*v,c.params[0].cropW=g*S,c.params[0].cropH=u*y,c.params[0].cropPX=f,c.params[0].cropPY=v,c.params[0].cropPW=S,c.params[0].cropPH=y}this.$dispatch("dispatchRepaintProject"),this.$dispatch("dispatchRefreshScreenshot"),this.sharedStore.isEditBorderShow=!1,a||this.submitOptionValue("canvasBorder",r('[name="border"]:checked').val())},submitOptionValue:function(e,a,o){var n=this,s=(t.pages[t.selectedPageIdx].canvas,i(1)),d=i(13),l=t.projectSettings[t.currentSelectProjectIndex],c=this.privateStore.tempSettingMap,p=this.privateStore.tempCategoryProduct;switch(e){case"category":case"moreCategory":case"product":c[l.category]||(c[l.category]={}),c[l.category][l.product]=r.extend({},l),p[l.category]=l.product}if("category"===e?(l.category=a,p[a]?l.product=p[a]:l.product=s.getOptionsMapDefaultValue("product",[{key:"category",value:a}]),this.privateStore.selectedMoreCategory=l.product,d.setDefaultValue()):"moreCategory"===e&&(l.product=a,d.setDefaultValue()),l[e]=a,"categoryTableTop"===l.category&&"product"===e){var h=s.getOptionsMapDefaultValue("size",[{key:"product",value:l.product}]);l.size=h?h:"none";var g=s.getOptionsMapDefaultValue("metalType",[{key:"product",value:l.product}]);l.metalType=g?g:"none";var u=s.getOptionsMapDefaultValue("color",[{key:"product",value:l.product},{key:"frameStyle",value:l.frameStyle}]);l.color=u?u:"none";var m=s.getOptionsMapDefaultValue("finish",[{key:"product",value:l.product}]);l.finish=m?m:"none"}if("TP"!==l.paper&&"MP"!==l.paper&&"CP"!==l.paper||(l.matte="none",l.matteStyle="none",l.glassStyle="none"),"none"===l.glassStyle&&(l.matte="none"),"none"===l.matteStyle?l.matte="none":(l.matte="M",l.glassStyle="glass"),"canvas"===l.product?("none"===l.canvasBorder&&(l.canvasBorder="image"),"none"===l.canvasBorderSize&&(l.canvasBorderSize="standard"),l.frameStyle="none",l.color="none",l.matte="none",l.matteStyle="none",l.glassStyle="none",this.sharedStore.isCanvas=!0,this.isFrame=!1):(["contemporary","metal","classicFrame","rusticFrame","table_classicFrame","table_crystalPlaque","table_modernFrame","table_metalCube","table_metalPlaque","table_woodPlaque","flushMountCanvas"].indexOf(l.product)>=0?l.canvasBorderSize="none":l.canvasBorderSize="standard",this.sharedStore.isCanvas=!1,this.isFrame=!0),"frameCanvas"===l.product&&(l.frameStyle="frameCanvasModernStyle",l.matte="none",l.matteStyle="none",l.glassStyle="none",l.canvasBorder="mirror"),"category"!==e&&"moreCategory"!==e&&"product"!==e||!this.privateStore.tempSettingMap[l.category]||t.projectSettings.$set(t.currentSelectProjectIndex,r.extend({},l,this.privateStore.tempSettingMap[l.category][l.product],{size:l.size,rotated:l.rotated})),setTimeout(function(){var t=!1;do n.resetOptionList(),t=n.resetOptionSelected();while(t);n.borderOptionChange(!1,!0,o,e)}),setTimeout(function(){"size"!==e&&"matteStyle"!==e&&"product"!==e&&"paper"!==e&&"category"!==e&&"moreCategory"!==e&&"canvasBorderSize"!==e&&"frameStyle"!==e||i(28).loadAllTemplateList(2,l.size,!0)},200),this.$dispatch("dispatchCanvasPriceChange"),"product"===e||"moreCategory"===e||"category"===e){var f=l.product,v=i(1).getOptions("product");for(idx in v){var S=v[idx];S.id==f&&(t.productTitle=S.title)}}}},events:{notifyOptionItemSelect:function(e,t){this.submitOptionValue(e,t,!0)},notifyImageList:function(){this.privateStore.minHeight=i(14).getOptionHeight()}},created:function(){},ready:function(){var e=this;this.privateStore.minHeight=i(14).getOptionHeight(),e.$watch("sharedStore.watches.isProjectLoaded",function(){e.sharedStore.watches.isProjectLoaded&&(e.resetOptionList(),e.resetOptionSelected())}),e.$watch("sharedStore.watches.isProjectLoaded",function(){if(e.sharedStore.watches.isProjectLoaded){if("categoryCanvas"===e.sharedStore.projectSettings[e.sharedStore.currentSelectProjectIndex].category&&"canvas"===e.sharedStore.projectSettings[e.sharedStore.currentSelectProjectIndex].product){e.sharedStore.OptionType="canvas";var r=t.pages[t.selectedPageIdx].canvas;e.sharedStore.mirrorLength=r.mirrorSize.top,e.borderOptionChange(1,!0)}var a=i(1),o=a.getOptionsMap("product",[{key:"category",value:"categoryWallarts"}]),n=o.split(","),s=[];n.map(function(e,t){s.push({id:e,value:a.getElementById(e).find("title").text().trim()})}),this.privateStore.moreCategory=s}}),e.$watch("sharedStore.watches.isProjectComplete",function(){var e=this.sharedStore.projectSettings[this.sharedStore.currentSelectProjectIndex];this.privateStore.category=e.category,this.privateStore.selectedMoreCategory=e.product}),r("#select-color").spectrum({change:function(i){e.sharedStore.bgColor=o.hexToDec(i.toHexString()),t.vm.$broadcast("notifyRefreshMirror")}})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={template:'<div v-show="isShow" style="width:340px;margin:37px 0 35px 35px;overflow:hidden;" v-bind:style="{height:itemHeight}"><div style="width:200px;font-size:14px;font-weight:600;margin:0 0 -11px 5px">{{title}}</div><div style="width:310px;overflow:hidden;"><p v-for="item in options"  v-show="!isColor" v-bind:style="{minWidth:minWidth}" style="float: left;height:20px;font-size:13px;margin:15px 0 0 0;"><input type="radio" id={{item.id}} value={{item.id}} v-model="selected"  v-on:change="optionChange" ><label for="{{item.id}}" title="{{item.paperAlt}}" v-bind:class="{ \'radio-pressed\': (selected===item.id), \'radio-normal\': (selected!==item.id) }" style="cursor:pointer;">{{item.title.trim()}}</label></p><p v-for="item in options" v-show="isColor"  style="float: left;width:40px;height:40px;margin:28px 12px 11px 0;margin-left:0px;cursor:pointer;"><img :src="item.url" id={{item.id}} v-bind:class="{ \'image-selected\': (selected===item.id), \'image-no-selected\': (selected!==item.id) }" title="{{item.title.trim()}}" v-on:click="optionChange"></p></div></div><hr v-show="isShowHr" style="width:96%" color="#DEDEDE" size="1"/>',props:["id","title","options","selected","line","item"],data:function(){return{privateStore:{},sharedStore:t}},computed:{isColor:function(){return"color"===this.id},minWidth:function(){return"Frame Thickness"===this.title?"100%":"135px"},itemHeight:function(){return this.item?"0px":"auto"},isShow:function(){var e=t.projectSettings[t.currentSelectProjectIndex];return("matteStyle"!=this.id&&"glassStyle"!=this.id||"CP"!==e.paper&&"MP"!==e.paper)&&((!t.isFromMarketplace||"categoryCanvas"!==e.category||"product"!==this.id)&&this.shouldShowOptions())},isShowHr:function(){return!(!this.line||!this.isShow)}},methods:{optionChange:function(e){this.sharedStore.isSwitchLoadingShow=!0;var t=e.target.id;console.log(t),this.selected=t,this.submitData()},shouldShowOptions:function(){var e=this.options.some(function(e){return"none"===e.id});return!(e&&1===this.options.length)},submitData:function(){var e=t.projectSettings[t.currentSelectProjectIndex];"matteStyle"===this.id&&"none"!==this.selected&&"coating"===e.glassStyle?this.$dispatch("dispatchShowMattingChange",this.id,this.selected):this.$dispatch("dispatchOptionItemSelect",this.id,this.selected)}},events:{},created:function(){},ready:function(){}}}).call(t,i(2))},function(e,t,i){(function(t,r){e.exports={template:'<div  v-show="sharedStore.isOrderViewShow"><div class="shadow-bg"></div><div id="order-window" class="box-order" style="overflow-x: hidden; overflow-y: hidden;" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }" ><div style="height: 40px:line-height: 40px;"><div id="closeButton" style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHideOptionsView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Select Your Quantity</div></div><div style="width:100%;height:320px;overflow:hidden;overflow-y: auto;margin: 40px 0px 0px 0px;" ><div style="display:inline-block;width:100%;margin-left:30px;margin-top:14px;margin-bottom:14px" v-for="item in newImageList"><span style="display:inline-block;"><img class="order-project-image" style="width:auto;" v-bind:class="{ \'order-select-image\': item.isEmpty}"  id="project-item-{{ $index }}" :imageid="item.id" :imageurl="item.url" :src="item.previewUrl" :alt="item.color"/></span><div style="position:relative;display:inline-block;width:530px;bottom:19px"><measure-option v-for="measure in item.measures"  v-bind:measure="measure.measure" v-bind:id="item.id" v-bind:num.sync="measure.num"></measure-option></div></div></div><div style="width: 180px;text-align: center;height: 40px;line-height: 40px;margin:0 auto;font-size: 14px;color:red;" v-show="privateStore.isShowEmptyLabel">Please select quantity</div><div><div id="submitButton" class="button t-center" v-on:click="handleSubmitOrder()" style="width: 160px;height: 40px;line-height: 40px;margin:0 auto;font-size: 14px;">Order</div></div></div></div>',data:function(){return{privateStore:{width:670,height:550,selector:"#order-window",measure:["XS","S","M","L","XL","XXL"],isShowEmptyLabel:!1},sharedStore:t}},computed:{newImageList:function(){for(var e=[],t=[],i=0;i<this.sharedStore.projectSettings.length;i++){var r=this.sharedStore.projectSettings[i].color,a=this.sharedStore.projectSettings[i].count,o=this.sharedStore.projectSettings[i].measure;if(e.indexOf(r)==-1){e.push(r);for(var n=this.getColorAssets(r),s={id:i,name:r,color:r,isEmpty:!1,url:n.backgroundImage,previewUrl:n.backgroundImage},d=[],l=0;l<this.privateStore.measure.length;l++){var c=new Object,p=0;this.privateStore.measure[l]===o&&(p=a),c.measure=this.privateStore.measure[l],c.num=p,d.push(c)}s.measures=d,t.push(s)}else for(var h=0;h<t.length;h++)if(r===t[h].color)for(var g=0;g<t[h].measures.length;g++)t[h].measures[g].measure===o&&(t[h].measures[g].num=a)}return t},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideOptionsView:function(){this.sharedStore.isOrderViewShow=!1,this.initOrders()},handleSubmitOrder:function(){for(var e=!1,t=[],r=0;r<this.newImageList.length;r++){for(var a=!0,o=0;o<this.newImageList[r].measures.length;o++)0!==this.newImageList[r].measures[o].num&&(a=!1,t.push({color:this.newImageList[r].color,measure:this.newImageList[r].measures[o].measure,count:this.newImageList[r].measures[o].num}));this.newImageList[r].isEmpty=a,a&&(e=!0)}if(e)this.privateStore.isShowEmptyLabel=!0;else{this.privateStore.isShowEmptyLabel=!1;this.sharedStore.projectSettings=[];for(var r=0;r<t.length;r++){var n=t[r],s=i(13).newProject(n.color,n.measure,n.count);this.sharedStore.projectSettings.push(s)}this.disabledSubmitButton(),i(13).orderProject(this)}},handleCanelOptions:function(){this.sharedStore.isOrderViewShow=!1,this.initOrders()},initOrders:function(){this.privateStore.isShowEmptyLabel=!1},getColorAssets:function(e){for(var t=0;t<this.sharedStore.colorOptionList.length;t++)if(this.sharedStore.colorOptionList[t].type===e)return this.sharedStore.colorOptionList[t]},disabledSubmitButton:function(){r("#submitButton").css("pointer-events","none"),r("#submitButton").css("opacity",.4),r("#closeButton").css("pointer-events","none"),r("#closeButton").css("opacity",.4)},abledSubmitButton:function(){r("#submitButton").css("pointer-events","auto"),r("#submitButton").css("opacity",1),r("#closeButton").css("pointer-events","auto"),r("#closeButton").css("opacity",1)}},ready:function(){this.initOrders()},events:{notifyShowOrderWindow:function(){console.log("showOrderWindow");var e=i(14);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.sharedStore.isOrderViewShow=!0,this.initOrders(),this.abledSubmitButton()},notifyReorder:function(){i(13).orderProject(this)}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){i(20);e.exports={template:'<div class="bed-page-loading" v-show="sharedStore.isPageLoadingShow"><div class="shadow-bg" style="z-index:1500;background-color:rgba(240, 240, 240, 1)"></div><div class="box-page-loading  fix-center" style="z-index:1501;width:96px;height:96px;border-radius:12px;border:1px solid #969696;"><div style="font-size: 0;width: 28px;height: 28px;margin: 25px auto 8px;"><img style="width: 50px;height: 50px;margin: -11px 0 0 -11px;" src="data:image/gif;base64,R0lGODdhZABkAMQAAAAAABcXFxwcHCQkJCwsLDQ0NDs7O0RERE1NTVVVVVtbW2NjY2pqanR0dH19fYWFhYqKipKSkpqamqOjo////wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh+QQJBwAVACwAAAAAZABkAAAF/2AljmRpnmiqrmzrvnAsz3Rt33iu73zv/8CgcEgsGo/IpHLJbDqf0Kh0Sq1ar9isdsvter/gsHhMLpvBk8lZl06vcW31e2Woo+IpiWReN9zbKHp6b31+JngmgntvBX0Fh4CJgnMVhZBuJYqUIo4liCSCEZuVfZ6RI5qjpHYjnxWpY4Yolq2nr5NjB7oHKbQimCKwJhARxVi7urIlpSkReqInxdJYBsi6KI80xNLGWdbXOdvcXt+8NdzFEGHVyDbo6rm77tNn4Oeq+Pn6TuX2OQ8AAwakgqCgwYMGcQCEwLChwwdSEEosqNChRYYQo0xEqEOgx4H7QoocuSNBAhsOHLusMalAwUkaKVOSYdnyJcyYMsEkaFnT5k2cKrnQdOkTJdCgWIbuPNGyRYMTR5FW2ckTxYKrClY02IoCaNKaKRRgJbGAAQkGW592jUlG7NWzDOKSSKtW1dUFWUfElTuXqyq3C0rsNdvX76a7efXuNUH38FjBi0s0nnM3sInBJyavQXwCM+O0lN92jvy57pm7KDxnNq1PNcnRDCy/Tk14tu3buHPr3s27t+/fwIMLH068uPHjyJMrX868+ZMQACH5BAkHABUALBkAGQAyADIAAAX/YCWOZGmOx3GubOuKafrO9BmrdU4i7M0aBp0JQeTZYisgUFgqrnymgpLZdJqgJWWQurOSsCMtt0q8IrPTcbf8PYfT6lHRiHKLxPE1vRLb3uE1CQoJCSxeMDgiUksrE44nCpGRhUNsLIt+JBKOnJCSgyeWP5kjnJ0rhJKEeRWmpy2DqpRUro+Bn7M6tUypoEyuY6tctqzFxsfIXJ/LCgusERES0tHTEhUL2Nna2Apx1NLg4RLN29vdceLp1pLckQuRz9XyEhHJ9vf49gwMahBq+wycUYEGjQnAfQKZEIzgr8aCgwHHQFhY0MVDiM8oNjwBkR+VByso1jMBMWGJBihbaTyAAPLExIUc97FAmXKEAwckVrJkAVMHzQYlbuIcAaGoi405fpIQOlRE0Z3GlC4VWkJnS1ZSbVLNWfRqnKxab5p46pUL2LBNR1jNc1YE0xNr1dBc8RYu1DE1T9QdWzbZ3nx0twJmIZhKCAAh+QQJBwAVACwZABkAMgAyAAAF/2AljmRpjklyrmzriomiqG9tm/F876SysDmaCYHgrRYLxSq4IhaNJWTyxBw6oSUfkioTjpxPLEmqLFVJYHFWiuuW0uoom3QWwePjOcz9veLXWyh8dkQuBisMDD9HehUpaH4nB5MHJomXK1plTYUnBpSTJguXmCYyL2EloJOHJ6SleKuhLq+KarKVNrVislCjiYtGn5Rqo7e5f8nKy8zJDc/QDQzPywUG1gXW1wUV0d7QDHgG4+Tl5N/o4ubrh+jRyezl3M309fb3FQ5xExNxDv9i+AmE8q+gPigCB94wWFBNQoUtGAL885AfC4kHSTx4EPDhCYknHkCA8EKCyRMSPGSWMMhiJMkWJk+ugLiyhciRJCLoLBFTArObHHPqfCmi58+RQUdAGMozprKbREfo3NlUJh6gJqZGLer0KtITSyNs5SohAp6vYJlm7SoG6wmtK9iqSWoi7Fiy+Ozic6F3b0uqakIAACH5BAkHABUALBkAGQAyADIAAAX/YCWOZGmODHOubOuKS6q+dG3Ks62LTcPiq4Vwd+r5TsCTcEE0GY+lZGnJbJKeSJlyaS1ho9qSgtu9Gm/h0XhY9p5JUphQ0Xb2wCnSulo331FpFUt0Ow6GDixGORUMfBVrhCcJCQoJJoeGK28seyuUCpWXmJlONKAnlaCVliejpHWTqpMurohlsbI2rreyrDqYXZ+zXa9Nw33IycrLfQ/Oz9DOyAjU1dbUDxDa29wQD3XX4djd3dJt4uEi0dDKB+7v78zy8/T1JBFt7mUR/Phd8EQg9ONXBt4BAzYEDvRnxaA+FwsjQEDm8MCKiBOtFFjhEGGJhSskiGR4woDJFQYMY5rol/GESJEkJkwgYfIkx3g7XkqIKXPmiJoeUTbRyVMmzZrLiBb1+RMpsggvTfRkKqKA0z5Kl5oAijWq1J4mrJrc2OYlyRFTS161krVEWrVBu8Bc8XarTXp17dEFq7eF0TYhAAAh+QQJBwAVACwZABkAMgAyAAAF/2AljmRpik56rmzroqnzzvQZy3VOPtB6s42G7sR7+GKroHBY4kGMpp9JuWTuIM8ocqq0NrG9kpRE9Zqc0NFYVDZ/s6R1pe2+wmGqET0XZoHjeXpdOhGFESxogGSDJwyOJ4aFfV9pJ4wlC46akJGHRF6amysQnZ51oY4LL6WTQ5mhqjWdXq+iOqSFtLZWrUOPdcDBwsPEIhESyMfIy6ZuCs8L0NHPFcvW18AKC9vc3dHX4BLNVtre5tXK17nA08/u7sXx8vP0IxMTZgkJZvf9VgnP9DHp548JQHf7ahAs+O+gAoAvFt4Lpg9hwhMSTxgw8AIBghMOqZlYKEHjxgIuPGR+NBFSAcaJKzYaQDniwIESKllUvFhDJscRBmzeHKFypTCfJYQOJZrzqMykQnE2BYYUqk0TRYNVJaEU61QzW7lG9eqxjkyaVpdKNWolrNirJ7KC/Xmi6wq28uzWY6F37wq4ZkIAACH5BAkHABUALBkAGQAyADIAAAX/YCWOZGmOUQSdbOu+FZSucG2bsnrvpOSzqVSLxjP5JMAg6wGBPIqlY+SUI5aYVmglcqTOTtinttct5abXpng8OiJLQTSp6WRHy6Nqum6///JKJGF9fm8oQiODLQ4sE44tbi90iw6VJo6YhmSaLGonlaCMl5iPWg9rI6GgLaSYhBWqli+tpVqxoja0tqpQrWOrbLW2r8TFxsdsBQbLzM0Grw3R0tMNFc7Xy33U29HY130M3NTWzAXKBsrF4tHI7e7v7gcHbAwLbPLyz1ALDP32RfjwjelHkMGNgALH8Cto8AVCea8Y1mNh4CELBDAUKDgh8R8JhPpMIBjpQsGCBRs5ZBY0EbDFSJIjEiQgcfJki4UUX7wkkUDjzBE1UxZ7iTGmT5o1jREt0VPBT6BJiS3lebRE0FdTqTo1UdOjnaxGt3I9KXQM2LBPSZi0+RWmiaZp1bJtywLuzbLI7MJzoXdvC5l9QgAAIfkECQcAFQAsGQAZADIAMgAABf9gJY5kaY7TdK5s64pp+s70Gat1Phr8erMSie7EM/hiq2BwWCoaTT+TUsgkFYoFKFKqrDaLWllp6jVhS1GSMlL+9khpEbntfsK28u7QTgSj8BVzOQeEByxOcDh5SysQEY8mhYR8JH4rEUFsJ4+cZpKEK1lVjpyQJ5+gdBWkpS+ohl6ljxA1Bp9lsrQ6kridXqmxqsLDxMXFr8CqD8vMzCII0NHS0XTLENfY2Q/T3NDV2eDX293Sws3nzsbq6+ztFQkJZQ4OZfAKCvFV8/ND9vf5+vbxo5Hg3j+AAQXSa+EPH0J5CheaaFjwxL0ZDU5ElDiioMEVC0IqcNGg5AqFE/9jsVAgksQCBiQYlMx4ct8QliFjMthJYiZNYiEXjByxk2dPk8RwLihRFOZRpMKCDiVa1ITPqC2ZVi1xlU7QpSaanuhaRuoJsVZnes15dmvan16CrkA7Fq46uu7m7gSbl4XRMiEAADs=" /></div><span class="font-light" style="margin-left: 23px;font-size: 12px;color:#7b7b7b;">Loading...</span></div></div>',data:function(){return{privateStore:{els:"",printPreviewpram:{width:96,height:96,selector:".box-page-loading"}},sharedStore:t,isPageShow:!0}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+15)}},methods:{},events:{},created:function(){},ready:function(){}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={template:'<div style="position:absolute; box-sizing: border-box;" @click="changePageIdx" v-bind:style="usedStyle"><div v-show="!sharedStore.isPreview && sharedStore.isShowProgress && sharedStore.selectedPageIdx === this.pageIdx" style="position: absolute;z-index:2;left:0;top: 0;width:100%;height:100%;background:#f5f5f5;"><img src="assets/img/Loading.gif" width="36px" height="36px" title="uploading" alt="uploading" style="position:absolute;top:50%;left:50%;margin:-18px 0 0 -18px;"></div><img v-bind:src="photoSrc" style="position:absolute;left:0;top:0;opacity:0.2;" v-bind:style="{width: elementData.width*ratio + \'px\',height:elementData.height*ratio + \'px\'}" v-show="backImgShow" /><canvas id="photoElementCanvas{{pageIdx}}{{id}}{{extraName}}" style="position:absolute;top:0;left:0;" width="{{width}}" height="{{height}}"></canvas><div v-if="extraName && !sharedStore.isPreview"  style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);text-align:center;"  v-show="isShowUploadButton" ><img src="../../static/img/upload-icon.svg" width="{{uploadIconSize.width}}" height="{{ uploadIconSize.width * 150/181 }}" style="display:block;margin:0 auto;"/><span v-show="width > 100" class="add-photo-text font-light" v-show="isClickTipShow">Click to add a photo</span></div><warntip-element v-bind:id="id" v-bind:pagedd="pageIdx" v-bind:main="extraName" v-if="!sharedStore.isPreview" v-bind:ratio="ratio" v-bind:width="elementData.width*ratio" v-bind:height="elementData.height*ratio" v-bind:x="elementData.x*ratio" v-bind:y="elementData.y*ratio"></warntip-element><handle v-if="!sharedStore.isPreview && extraName"  v-bind:pagedd="pageIdx" v-bind:id="id" v-bind:main="extraName" v-bind:is-Show-Handles="isShowHandle" v-bind:is-Corner-Handles="false" v-bind:is-Side-Handles="false"></handle></div>',data:function(){return{sharedStore:t,elementData:Object,ratio:0,id:0,isCornerHandles:!0,isSideHandles:!0,imageData:null,photoSrc:"",type:"image",pageIdx:0,extraName:"",backImgShow:!1,isElementHovered:!1,isClickTipShow:!0}},computed:{isShowHandle:function(){var e=t.pages[this.pageIdx].canvas;return e.selectedIdx===i(10).getIndexById(this.id)&&!t.isLostFocus},bgColor:function(){return this.elementData.imageId||t.isPreview?"rgba(255,255,255,0)":"#fff"},addPhotoTextFontsize:function(){var e=t.projectSettings[t.currentSelectProjectIndex],i=e.orientation;return"Landscape"===i?"18px":"12px"},width:function(){return this.elementData.width*this.ratio},height:function(){return this.elementData.height*this.ratio},usedStyle:function(){if(this.sharedStore.isPreview);else if(this.isElementHovered);else;return{backgroundColor:this.bgColor,left:this.elementData.x*this.ratio+"px",top:this.elementData.y*this.ratio+"px",width:this.elementData.width*this.ratio+"px",height:this.elementData.height*this.ratio+"px",zIndex:100*(this.elementData.dep+1)}},isShowUploadButton:function(){return!this.elementData.imageId},uploadIconSize:function(){var e=t.pages[this.pageIdx].canvas,i={};i.width=e.oriWidth*this.ratio*.17,i.height=e.oriWidth*this.ratio*.17;var r=Math.floor(Math.min(this.elementData.width*this.ratio,this.elementData.height*this.ratio))-2;return r<1?r=1:r,i.width>r&&(i.width=r,i.height=r),i.width<50&&(i.width=50,i.height=50),i},isClickTipShow:function(){var e=t.pages[this.pageIdx].canvas;return e.width>150}},methods:{init:function(e,i,r,a){this.pageIdx=i,this.ratio=r;var o=t.pages[this.pageIdx].canvas;this.elementData=o.params[e],this.id=this.elementData.id,this.extraName=a},destroy:function(){},refreshImage:function(e){var r=this;i(20).clear("photoElementCanvas"+this.pageIdx+this.id+this.extraName),i(20).drawImage("photoElementCanvas"+this.pageIdx+this.id+this.extraName,e,0,0,function(){r.sharedStore.selectedPageIdx===r.pageIdx?r.extraName&&(r.sharedStore.isShowProgress=!1):r.sharedStore.isShowProgress=!1,r.sharedStore.isSwitchLoadingShow=!1,r.extraName&&(t.vm.$broadcast("notifyRefreshScreenshot",r.pageIdx,r.ratio),setTimeout(function(){t.vm.$broadcast("notifyRefreshRealScreenshot",r.pageIdx,r.ratio)},100))},this.elementData.width*this.ratio,this.elementData.height*this.ratio),this.photoSrc=e},onDragOver:function(){},setCrop:function(){if(90===Math.abs(this.elementData.imageRotate))var e=i(18).getImageDetail(this.elementData.imageId).height,t=i(18).getImageDetail(this.elementData.imageId).width;else var e=i(18).getImageDetail(this.elementData.imageId).width,t=i(18).getImageDetail(this.elementData.imageId).height;var r=this.elementData.cropPX,a=this.elementData.cropPY,o=this.elementData.cropPW,n=this.elementData.cropPH,s=this.elementData.width,d=this.elementData.height,l=r,c=r+o,p=a,h=a+n,g=d/s,u=e,m=t,f=l+(c-l)/2,v=p+(h-p)/2,S=f*u,y=v*m,w=(c-l)*u/s,x=(h-p)*m/d,I=s*w,b=d*x;I>u&&(I=u),b>m&&(b=m);var P,j,C,T;I*g>b?(T=b,C=b/g):(C=I,T=I*g),P=S-C/2,P=P>0?P:0,P+C>u&&(P-=P+C-u,P=P>0?P:0),j=y-T/2,j=j>0?j:0,j+T>m&&(j-=j+T-m,j=j>0?j:0),this.elementData.cropPX=P/u||0,this.elementData.cropPY=j/m||0,this.elementData.cropPW=C/u||1,this.elementData.cropPH=T/m||1},setIndex:function(){var e=t.pages[this.pageIdx].canvas;e.selectedIdx=i(10).getIndexById(this.id),t.isLostFocus=!1},refreshImageById:function(e){t.dropData.isBg=!1,t.dropData.newAdded=!1,t.dropData.idx=i(10).getIndexById(this.id),t.watches.isOnDrop=!0},cacuBarPosition:function(e){var r=t.pages[this.pageIdx].canvas,a=i(10).getIndexById(e.id),o=r.params[a];this.sharedStore.barPosition.x=o.x*this.ratio+e.x-2,this.sharedStore.barPosition.y=o.y*this.ratio+e.y-2,this.sharedStore.barPosition.ratio=this.ratio},setImageById:function(e){var r=t.pages[this.pageIdx].canvas,a=r.selectedIdx;t.dropData.isBg=!1,t.dropData.newAdded=!1,t.dragData.imageId=e.toString(),t.dragData.sourceImageUrl=r.params[a].url,t.dropData.idx=i(10).getIndexById(this.id),t.watches.isOnDrop=!0},changePageIdx:function(){this.extraName||(this.sharedStore.selectedPageIdx=this.pageIdx,this.sharedStore.currentSelectProjectIndex=this.pageIdx,i(8)({ev:i(9).SwitchBlocksByNav}))}},events:{refreshHandler:function(e){this.refreshImage(i(10).getCropImageUrl(i(10).getIndexById(this.id,this.pageIdx)))},dispatchClick:function(e){return this.extraName?(this.setIndex(),this.cacuBarPosition(e),this.sharedStore.isEditLayerShow=!1,void(this.isShowUploadButton&&(i(8)({ev:i(9).ClickCloudUploadImage}),this.sharedStore.watchData.replacePageId=this.pageIdx,t.vm.$broadcast("notifyTriggerImageUpload")))):(this.sharedStore.selectedPageIdx=this.pageIdx,void(this.sharedStore.currentSelectProjectIndex=this.pageIdx))},dispatchDblClick:function(){console.log("dispatchDblClick"),t.watchData.cropImageIdx=i(10).getIndexById(this.id),t.watches.isCropThisImage=!0},dispatchDrop:function(e){this.elementData.imageId?(t.dropData.idx=i(10).getIndexById(this.id),t.watches.isReplaceImage=!0,this.refreshImageById(t.dropData.imageId)):(t.dropData.isBg=!1,t.dropData.newAdded=!1,t.dropData.idx=i(10).getIndexById(this.id),t.watches.isOnDrop=!0)},dispatchMouseOver:function(){this.isElementHovered=!0},dispatchMouseOut:function(){this.isElementHovered=!1}},created:function(){},ready:function(){var e=this;this.elementData.imageId?this.refreshImage(i(10).getCropImageUrl(i(10).getIndexById(this.id,this.pageIdx),this.pageIdx,this.ratio)):setTimeout(function(){e.sharedStore.isSwitchLoadingShow=!1},300),this.$watch("elementData.isRefresh",function(){e.elementData.isRefresh&&(e.sharedStore.pages[e.pageIdx].canvas.pageItems[0].handleRepaint(),console.log("refreshUrl"),e.pageIdx===e.sharedStore.selectedPageIdx&&e.refreshImage(i(10).getCropImageUrl(i(10).getIndexById(e.id,e.pageIdx),e.pageIdx,e.ratio)),setTimeout(function(){e.elementData.isRefresh=!1},100))})}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={mixins:[i(11)],template:'<div class="preview-bed-header"><div style="float: right; height: 48px;margin-top: 2px;"></div><div v-if="sharedStore.isOrderedPreview" class="preview-back-tip">The item was already ordered or added to cart.</div></div>',data:function(){return{privateStore:{},sharedStore:t}},computed:{productText:function(){switch(this.sharedStore.projectSettings[t.currentSelectProjectIndex].category){case"categoryFrame":return"Frame";case"categoryCanvas":return"Canvas";default:return"[ERR PRODUCT]"}}},methods:{handleCloseView:function(){navigator.userAgent;window.close()}},events:{}}}).call(t,i(2))},function(e,t,i){(function(t,i){e.exports={template:'<div style="margin-top:10px;width:16px;z-index:100;position: fixed;right:200px;top:40px;"><div style="min-height:130px" id="project-div-{{item.id}}" v-on:click="projectItemClick(item.id)" v-for="item in newImageList"><div style="height:130px;margin-top:30px"><span style="display:inline-block;margin-left:0;margin-top:30px"><img class="preview-project-image" style="border: 1px solid rgba(250, 250, 250, 1);" id="project-item-{{ item.id }}" :imageid="item.id" :imageurl="item.url" :src="item.previewUrl" :alt="item.color"/></span></div></div></div>',data:function(){return{privateStore:{selectedColor:[]},sharedStore:t}},computed:{newImageList:function(){for(var e=[],t=[],i=0;i<this.sharedStore.projectSettings.length;i++){var r=this.sharedStore.projectSettings[i].color;if(e.indexOf(r)==-1){e.push(r);var a=this.getColorAssets(r),o={id:i,name:r,color:r,url:a.backgroundImage,
previewUrl:a.backgroundImage};t.push(o)}}return this.sharedStore.itemListNum=t.length,t}},methods:{projectItemClick:function(e){this.sharedStore.currentSelectProjectIndex=e;for(var t=0;t<this.sharedStore.projectSettings.length;t++)t==e?i("#project-item-"+e).css("border-color","#7b7b7b"):i("#project-item-"+t).css("border-color","#ffffff")},getColorAssets:function(e){for(var t=0;t<this.sharedStore.colorOptionList.length;t++)if(this.sharedStore.colorOptionList[t].type===e)return this.sharedStore.colorOptionList[t]}},events:{},ready:function(){setTimeout(function(){i("#project-item-0").css("border-color","#7b7b7b")},300)}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){var r=["albumId","ordered","price","projectId","projectXml","rotated","title","token","tplGuid","tplSuitId","uploadTimestamp","userId","product","category"];e.exports={template:'<div v-if="!sharedStore.isPortal && !sharedStore.isPreview && oriPrice && !sharedStore.isRemark" v-bind:style="{zIndex:windowZindex}" style="position:absolute;right:40px;top:60px;"><div style="height:16px;line-height:16px;"><img v-show="isShowDetail" src="./assets/img/title-price.svg" style="width:13px;height:13px;margin:1px 20px 0 0;cursor:pointer;float:right;" v-on:click="showTotalPrice()"/><span class="font-medium" style="font-size:13px;color:#3a3a3a;margin-left:0px;float:right;">&nbsp;USD</span><span class="font-medium" v-show="discount" style="font-size:13px;margin-left:10px;color:#3a3a3a;margin-right:0;float:right;">{{"$" + toFixed(totalPrice, 2)}}</span><span class="font-medium" style="font-size:13px;float:right;margin-left:10px;" v-bind:style="{textDecoration:priceStyle, color: discount ? \'#7b7b7b\' : \'#3a3a3a\'}" >{{preMessage + "$" + toFixed(totalOriprice, 2)}}</span><span class="font-medium" style="font-size:13px;float:right;color:#3a3a3a;margin-left:20px;" >{{productMessage}}</span></div><div v-show="sharedStore.isTotalPriceShow && typeof oriPrice !==\'undefined\'" v-bind:style="{zIndex:windowZindex}" style="position:absolute;right:0px;top:43px;width:180px;box-sizing:border-box;border:1px solid #d6d6d6;box-shadow:0 3px 6px rgba(0,0,0,.16);background:#fff;"><div class="border-style"></div><div style="margin-top:15px;height:15px;line-height:15px;"><span class="price-item font-light" style="width:80px;">Unit price:</span><span class="price-num font-normal" style="float:left;padding-left:20px;">{{"$" + toFixed(oriPrice, 2)}}<span></div><div v-for="priceOption in priceOptionList" style="margin-top:5px;height:15px;line-height:15px;"><span class="price-item font-light" style="width:80px;white-space:nowrap;">{{priceOption.title}}</span><span class="price-num font-normal" style="float:left;padding-left:20px;">{{"$" + toFixed(priceOption.oriPrice, 2)}}</span></div><div style="margin-top:5px;height:15px;line-height:15px;"><span class="price-item font-light" style="width:80px;">Quantity:</span><span class="price-num font-normal" style="float:left;padding-left:20px;">{{quantity}}</span></div><div v-show="discount" style="margin-top:5px;height:15px;line-height:15px;width:180px;"><div style="width:80px;float:left;margin-left:20px;"><span class="font-light" style="float:left;font-size:12px;color:#3a3a3a;">Discount:</span></div><div class="price-num font-normal" style="float:left;padding-left:16px;">{{"-$" + toFixed(discount, 2)}}</div></div><hr style="width:140px;margin:10px auto 12px;"/><div style="margin-bottom:15px;height:15px;line-height:15px;"><span class="price-item" style="width:80px;">Total:</span><span class="font-medium" style="font-size:12px;color:#3a3a3a;float:left;padding-left:20px;">{{"$" + toFixed(totalPrice, 2)}}<span></div></div></div>',data:function(){return{privateStore:{priceShowNum:0},prj:{},sharedStore:t,rotated:"",oriPrice:0,sPrice:0,priceStyle:"",quantity:0,priceOptions:{},productDisplayName:"",isOnSale:!1,isShowDetail:!1}},computed:{quantity:function(){return 1},prj:function(){var e=this.sharedStore.projectSettings[t.currentSelectProjectIndex];return e},productMessage:function(){var e=this.sharedStore.projectSettings[t.currentSelectProjectIndex];return"LRB"===e.product?this.quantity+(1===this.quantity?" Block, ":" Blocks, "):""},preMessage:function(){var e=this.sharedStore.projectSettings[t.currentSelectProjectIndex],i=1===this.sharedStore.LSCPageNum?" photo":" photos";return"LSC"!==e.product||this.discount?"":"10 cards made from "+this.sharedStore.LSCPageNum+i+", "},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 101*(i+9)+1},priceOptionList:function(){var e=(this.priceOptions,[]);return e},discount:function(){var e=(this.sharedStore.projectSettings[t.currentSelectProjectIndex],this.quantity||1),i=0,r=0;return this.isOnSale&&(i=(this.oriPrice-this.sPrice)*e),this.priceOptionList.length>0&&(r=this.priceOptionList.map(function(e){return e.isOnSale?e.oriPrice-e.sPrice:0}),r=r.reduce(function(t,i){return t+i*e})),i+r},totalOriprice:function(){var e=(this.sharedStore.projectSettings[t.currentSelectProjectIndex],this.quantity||1),i=0;return this.priceOptionList.length>0&&(i=this.priceOptionList.reduce(function(e,t){return e+t.oriPrice},0)),(this.oriPrice+i)*e},totalPrice:function(){this.sharedStore.projectSettings[t.currentSelectProjectIndex],this.quantity||1;return this.totalOriprice-this.discount}},methods:{toFixed:function(e,t){return i(5).round(e,t).toFixed(2)},handleAddText:function(){this.$dispatch("dispatchShowAddText")},showTotalPrice:function(){this.sharedStore.isTotalPriceShow=!0},setProductName:function(){var e=this,t=i(1).getOptions("product");t.forEach(function(t){t.id===e.prj.product&&(e.productDisplayName=t.title)})},handleCanvasPriceChange:function(){var e=[],t=this,a=t.prj.product,o=t.sharedStore.userSettings.userId,n=Object.keys(t.prj).filter(function(e){return r.indexOf(e)===-1});n.forEach(function(i){t.prj[i]&&"none"!==t.prj[i]&&e.push(t.prj[i])}),e=e.join(","),i(11).getCanvasPrice(a,e,o)}},events:{notifyCanvasPriceChange:function(){this.handleCanvasPriceChange()}},ready:function(){var e=this;e.$watch("sharedStore.priceChange",function(){e.$set("oriPrice",e.sharedStore.photoPrice.oriPrice-0),e.$set("sPrice",e.sharedStore.photoPrice.sPrice-0),e.$set("isOnSale",!!e.sharedStore.photoPrice.couponId),e.$set("priceOptions",e.sharedStore.photoPrice.options),e.isOnSale?e.priceStyle="line-through":e.priceStyle="none",e.sharedStore.priceChange=!1})}}}).call(t,i(2))},function(e,t,i){(function(t,r){var a=i(20);i(16);e.exports={template:'<canvas id="screenshot" v-bind:style="{ left: mirrorLeft + \'px\', top: mirrorTop + \'px\' }" style="display:none;position:absolute;"></canvas><canvas id="real-screenshot" v-bind:style="{ left: mirrorLeft + \'px\', top: mirrorTop + \'px\' }" style="display:none;position:absolute;"></canvas>',data:function(){return{privateStore:{ratio:0,timer:null,isInitScreenshotSaved:!1},sharedStore:t}},computed:{width:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;return e.bgWidth},height:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;return e.bgHeight},mirrorLeft:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;return e.ratio*this.sharedStore.mirrorLength},mirrorTop:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;return e.ratio*this.sharedStore.mirrorLength}},methods:{createScreenshot:function(e){var i=t.pages[e].canvas,a=i.params,o=r("#container0Main"),n=r("#screenshot").get(0);n.width=o.width(),n.height=o.height(),a=this.sortByDepth(a.slice(0)),this.drawElems(a,e),this.$dispatch("dispatchRefreshMirror")},createRealScreenShot:function(e){var i=t.pages[e].canvas,o=i.params,n=r("#real-screenshot").get(0);n.width=i.oriBgWidth*this.privateStore.ratio,n.height=i.oriBgHeight*this.privateStore.ratio,o=this.sortByDepth(o.slice(0)),a.drawRect("real-screenshot","#fff",0,0,n.width,n.height),this.copyScreenshot(e),this.drawLayer(e)},refreshScreenshot:function(e){var e=e||0;a.clear("screenshot"),this.createScreenshot(e)},sortByDepth:function(e){return e.sort(function(e,t){return e.dep>t.dep})},drawElems:function(e,i){for(var r=(t.pages[i].canvas,0),o=e.length;r<o;r++){var n=e[r],s=("text"===n.elType?"textElementCanvas":"photoElementCanvas")+i+n.id+"Main";a.drawCanvas("screenshot",s,0,0)}},drawMatte:function(){var e=t.pages[t.selectedPageIdx].canvas;a.drawCanvas("real-screenshot","matting-part",(e.foreground.left+e.expendSize.left)*e.ratio,(e.foreground.top+e.expendSize.top)*e.ratio)},copyScreenshot:function(e){var i=t.pages[e].canvas;a.drawCanvas("real-screenshot","photoElementCanvas"+e+"0Main",i.oriX*this.privateStore.ratio,i.oriY*this.privateStore.ratio)},draw3DBorder:function(){var e=t.pages[t.selectedPageIdx].canvas;this.sharedStore.isCanvas?(a.drawCanvas("real-screenshot","mirror-top",e.oriX*e.ratio,e.oriY*e.ratio),a.drawCanvas("real-screenshot","mirror-right",(e.oriX+e.frameBaseSize.width)*e.ratio+this.mirrorLeft,e.oriY*e.ratio+this.mirrorTop/2-this.mirrorTop)):(a.drawCanvas("real-screenshot","mirror-right",r("#screenshot").width()+this.mirrorLeft,-this.mirrorLeft/2),a.drawCanvas("real-screenshot","mirror-top",0,0))},drawLayer:function(e){var t=this.sharedStore.pages[e].canvas;a.drawCanvas("real-screenshot","bg-part"+e+"Main",0,0,t.oriBgWidth*this.privateStore.ratio,t.oriBgHeight*this.privateStore.ratio)},drawBackLayer:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;a.drawCanvas("real-screenshot","bg-layer",0,0,e.bgWidth,e.bgHeight)},getFirstIndex:function(){var e=0;return this.sharedStore.pages.some(function(t,i){if(!t.isDeleted)return e=i,!0}),e}},events:{notifyRefreshScreenshot:function(e,t){if(!this.sharedStore.isPreview){var i=this;i.privateStore.ratio=t||1,i.privateStore.timer&&clearTimeout(i.privateStore.timer),i.privateStore.timer=setTimeout(function(){i.refreshScreenshot(e),i.sharedStore.isNewInsertProject&&(i.$dispatch("dispatchSaveScreenshotDelay",500),i.sharedStore.isNewInsertProject=!1)},100)}},notifyRefreshRealScreenshot:function(e,t){this.sharedStore.isPreview||(this.privateStore.ratio=t||1,this.createRealScreenShot(e))},notifySaveScreenshot:function(){this.privateStore.isInitScreenshotSaved||(i(13).saveOldProject(this,function(){}),this.privateStore.isInitScreenshotSaved=!0)}},ready:function(){var e=document.getElementById("real-screenshot");e.width=t.screenshotSize.width,e.height=t.screenshotSize.height,i(20).drawRect("real-screenshot","#fff",0,0,t.screenshotSize.width,t.screenshotSize.height);var r=new Image,a=window.location.href,o=a.split("index.html?")[0];r.src=o+"/assets/img/noimage_pc.png",r.onload=function(){var e=document.createElement("canvas");e.width=r.width,e.height=r.height;var i=e.getContext("2d");i.drawImage(r,0,0,r.width,r.height),t.emptyImage=e.toDataURL("image/png").replace("data:image/png;base64,","")}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){e.exports={template:'<div class="bed-image-upload" v-show="sharedStore.isSingleImageUploadShow"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div class="box-single-image-upload" v-bind:style="{ zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 600px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="hideSingleImageUpload()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Upload Images</div></div><div style="margin: 30px 40px 0;"><div class="upload-row-title"><span class="upload-status-head">File</span><span class="upload-status-sub">File Progress</span></div></div><div id="box-single-upload-list" style="margin: 0 40px;height: 230px; overflow: auto;"></div><div style="margin-top: 20px;"><div class="button-white t-center" v-on:click="handleUploadClick()" style="width: 260px;height: 40px;line-height: 40px;margin-left: 95px;display: inline-block;font-size: 14px;">Select Images</div><div class="button t-center" v-on:click="handleSingleSaveAndHideUpload()" style="width: 160px;height: 40px;line-height: 40px;margin-left: 23px;display: inline-block;font-size: 14px;">Done</div><input type="file" name="" id="single-files" accept="image/jpeg,image/png,image/x-png" v-on:change="handleDoUpload()" style="display: none;" /></div></div></div>',data:function(){return{privateStore:{els:"",uploadWindowParams:{width:640,height:460,selector:".box-single-image-upload"},imageListObj:{},uploadParams:{fileSelector:"#single-files"}},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{showImageUpload:function(){var e=i(14);e.setPopWindowPosition(this.privateStore.uploadWindowParams),this.resetImageUploadDom(),this.sharedStore.isSingleImageUploadShow=!0},hideSingleImageUpload:function(){return this.sharedStore.filesCountInQueue>=this.sharedStore.filesTotalInQueue?(this.sharedStore.isSingleImageUploadShow=!1,void(this.sharedStore.filesCountInQueue>0&&this.$dispatch("dispatchSingleImageUploadComplete",t.oriImageIds[0]))):!!window.confirm("Undeliveried images will be lost if you stop uploading, would you like to continue?")&&(this.sharedStore.isSingleImageUploadShow=!1,!0)},handleUploadClick:function(){this.sharedStore.filesCountInQueue>=this.sharedStore.filesTotalInQueue?r("#single-files").trigger("click"):this.$dispatch("dispatchShowPopup",{type:"upload",status:-1})},handleDoUpload:function(){if(r("#single-files").val()){var e=i(36);e(this.privateStore.imageListObj,this.privateStore.uploadParams)}},handleSingleSaveAndHideUpload:function(){return this.sharedStore.filesCountInQueue>=this.sharedStore.filesTotalInQueue?(this.$dispatch("dispatchSaveProject",!0),this.hideSingleImageUpload(),t.isLostFocus=!0,void 0):!!window.confirm("Undeliveried images will be lost if you stop uploading, would you like to continue?")&&(this.sharedStore.filesTotalInQueue=0,this.sharedStore.filesCountInQueue=0,this.hideSingleImageUpload(),this.$dispatch("dispatchSaveProject",!0),!0)},initImageUploadDom:function(e,t){var i=t.filename;if(i=i.substr(0,i.length-4),i.length>10&&(i=i.substr(0,7)+"..."+i.substr(i.length-3)),e<5){r("#single-upload-row-item-"+e+" .upload-status-head").text(i).attr("title",t);var a='<span style="display: inline-block;position:relative; top: 13px; left: 10px;width: 300px;height: 10px; border-radius: 5px; background-color: white;"><span id="single-progress-'+e+'" style="display: inline-block;width: 1px; height: 10px; border-radius: 5px; background-color: #ccc;">&nbsp;</span></span><span id="single-status-'+e+'" style="position: relative; left: 15px;">0%</span>';r("#single-upload-row-item-"+e+" .upload-status-sub").html(a)}else{var o='<div class="upload-row-item" id="single-upload-row-item-'+e+'"><span class="upload-status-head" title="'+t+'">'+i+'</span><span class="upload-status-sub"><span style="display: inline-block;position:relative; top: 13px; left: 10px;width: 300px;height: 10px; border-radius: 5px; background-color: white;"><span id="single-progress-'+e+'" style="display: inline-block;width: 1px; height: 10px; border-radius: 5px; background-color: #ccc;">&nbsp;</span></span><span id="single-status-'+e+'" style="position: relative; left: 15px;">0%</span></span></div>';r("#box-single-upload-list").append(o)}},resetImageUploadDom:function(){for(var e="",t=0;t<5;t++)e+='<div class="upload-row-item" id="single-upload-row-item-'+t+'"><span class="upload-status-head">&nbsp</span><span class="upload-status-sub">&nbsp</span></div>';r("#box-single-upload-list").html(e),r("#single-files").val(""),this.sharedStore.filesTotalInQueue=0,this.sharedStore.filesCountInQueue=0},updateSingleUploadProgress:function(){for(var e=0;e<this.sharedStore.uploadProgress.length;e++)"Done"===this.sharedStore.uploadProgress[e].percent?(r("#single-status-"+e).text("Done"),r("#single-progress-"+e).css("width",300).css("background-color","#393939").attr("title","")):"Error"===this.sharedStore.uploadProgress[e].percent?(r("#single-status-"+e).text("Error"),r("#single-progress-"+e).css("width",300).css("background-color","#de3418").attr("title",this.sharedStore.uploadProgress[e].info)):(r("#single-status-"+e).text(this.sharedStore.uploadProgress[e].percent+"%"),r("#single-progress-"+e).css("width",3*this.sharedStore.uploadProgress[e].percent).css("background-color","#ccc"))},isWindowOpen:function(){return t.isSingleImageUploadShow}},events:{notifyShowSingleImageUpload:function(e){this.privateStore.imageListObj=e,this.sharedStore.filesCountInQueue>=this.sharedStore.filesTotalInQueue&&(t.oriImageIds=[],t.uploadProgress=[],r("#single-files").val("")),this.handleUploadClick()}},created:function(){}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={template:'<div class="style-select-modal shadow-bg" v-show="sharedStore.isStyleSelectModalShow" style="z-index:9999;"><div class="style-select-content position-center bbox" style="width:500px;background-color:white;box-shadow:0 6px 12px 5px rgba(0,0,0,0.08); padding: 40px;" ><p class="font-light" style="height=24px;font-size:24px;color:#3a3a3a;">Select Style</p><ul class="style-list" style="margin:25px 0;" ><li class="style-item bbox" v-for="item in privateStore.styleList" @click="changeLSCPageNum(item.value)" style="height:48px;margin-bottom:3px;background-color:#f6f6f6;line-height:48px;padding: 0 20px;cursor:pointer;"><input name="style" value="{{item.value}}" type="radio" :checked="item.value === privateStore.selectedStyle" style="width:16px;height:16px;vertical-align:middle;" /><span class="font-medium bbox" style="display:inline-block;vertical-align:middle;width:90px;margin-left:12px;font-size:15px;color:#3a3a3a;">{{item.styleName}}</span><span class="font-light bbox" style="vertical-align:middle;font-size:13px;color:#3a3a3a;">{{item.describtion}}</span><img v-if="item.value === privateStore.selectedStyle" src="./assets/img/selectedIcon.svg" style="float: right;width:15px;height:13px;margin-top:17px;" /></li></ul><div class="button" @click="submitStyle" style="width:200px;height:30px;font-size:13px;text-align:center;line-height:30px;margin:0 auto;">Continue</div></div></div>',data:function(){return{privateStore:{styleList:[{value:1,styleName:"1 Photo",describtion:"10 cards for each photo"},{value:2,styleName:"2 Photos",describtion:"5 cards for each photo"},{value:5,styleName:"5 Photos",describtion:"2 cards for each photo"},{value:10,styleName:"10 Photos",describtion:"1 card for each photo"}],selectedStyle:1},sharedStore:t}},methods:{changeLSCPageNum:function(e){this.privateStore.selectedStyle=e},submitStyle:function(){this.sharedStore.LSCPageNum=this.privateStore.selectedStyle,this.sharedStore.isStyleSelectModalShow=!1,this.sharedStore.isReadyToLoadProject=!0}}}}).call(t,i(2))},function(e,t,i){(function(t){var r=i(15),a=i(22);e.exports={template:'<div style="width:380px;overflow-x:hidden;overflow-y:auto;background-color:rgb(246,246,247)" v-bind:style="{ height: privateStore.minHeight + \'px\' }"><template-item v-for="item in numTemplatelist" v-bind:imagenum="item.key" v-bind:templatelist="item.list"></template-item></div>',data:function(){return{privateStore:{minHeight:500},sharedStore:t}},computed:{numTemplatelist:function(){var e,i=[],r=0,a=t.projectSettings[t.currentSelectProjectIndex];e=a.rotated?a.size.split("X")[1]+"X"+a.size.split("X")[0]:a.size;for(var o in this.sharedStore.templateList)parseInt(this.sharedStore.templateList[o].imageNum)>r&&(r=parseInt(this.sharedStore.templateList[o].imageNum));for(var n=1;n<=r;n++){var s=[],d=n;for(var l in this.sharedStore.templateList)if(this.sharedStore.templateList[l].imageNum==n){var c=new Object;c.imageNum=this.sharedStore.templateList[l].imageNum,c.guid=this.sharedStore.templateList[l].guid,c.suitId=this.sharedStore.templateList[l].suitId,c.url=this.sharedStore.templateList[l].url,c.rotateTemplateGuid=this.sharedStore.templateList[l].rotateTemplateGuid,c.designSize=this.sharedStore.templateList[l].designSize,this.sharedStore.templateList[l].designSize===e&&s.push(c)}i.push({key:d,list:s})}return i}},methods:{resetImageCrop:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.selectedIdx;if(90===Math.abs(e.params[i].imageRotate))var r=e.params[i].imageHeight,o=e.params[i].imageWidth;else var r=e.params[i].imageWidth,o=e.params[i].imageHeight;var n=a.getDefaultCrop(r,o,e.params[i].width,e.params[i].height),s=n.px,d=n.py,l=n.pw,c=n.ph;e.params[i].width*e.ratio/l,e.params[i].height*e.ratio/c;e.params[i].cropX=r*s,e.params[i].cropY=o*d,e.params[i].cropW=r*l,e.params[i].cropH=o*c,e.params[i].cropPX=s,e.params[i].cropPY=d,e.params[i].cropPW=l,e.params[i].cropPH=c}},events:{notifyImageList:function(){this.privateStore.minHeight=i(14).getOptionHeight()}},created:function(){},ready:function(){var e=this;this.privateStore.minHeight=i(14).getOptionHeight(),e.$watch("sharedStore.watches.isApplyLayout",function(){if(e.sharedStore.watches.isApplyLayout){var a=t.pages[t.selectedPageIdx].canvas;i(15).autoLayout();var o=t.projectSettings[t.currentSelectProjectIndex].canvasBorder;if("categoryCanvas"===t.projectSettings[t.currentSelectProjectIndex].category&&("mirror"===o?r.changeBorderToMirror():"image"===o?r.changeBorderToMirror(!0):"color"===o&&r.changeBorderToMirror()),"categoryTableTop"===t.projectSettings[t.currentSelectProjectIndex].category){var a=t.pages[t.selectedPageIdx].canvas,n=a.selectedIdx;this.elementData=a.params[n],this.elementData.width=a.width/a.ratio,this.elementData.height=a.height/a.ratio,e.resetImageCrop()}e.$dispatch("dispatchRepaintProject"),e.$dispatch("dispatchRefreshScreenshot"),e.sharedStore.watches.isApplyLayout=!1}})}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={template:'<div style="display:table;margin: 37px 0 -16px 40px;"><div style="font-size:14px;font-weight:600;">{{imagenum}} {{imageTitle}}</div><div style="width:340px;display:table;margin:0;"><div v-for="item in templatelist" style="float: left;margin:0 14px 14px 0;"><img :src="item.url" id="{{item.guid}}" v-bind:width="imageWidth" v-bind:class="{ \'template-selected\': (selected===item.guid), \'template-no-selected\': (selected!==item.guid) }" v-on:click="optionChange"></div></div></div>',props:["imagenum","templatelist"],data:function(){return{privateStore:{},sharedStore:t}},computed:{imageTitle:function(){return 1==this.imagenum?"Photo":"Photos"},selected:function(){var e=t.projectSettings[t.currentSelectProjectIndex];return e.tplGuid},imageWidth:function(){var e,i,r=t.projectSettings[t.currentSelectProjectIndex];return r.rotated?(e=parseInt(r.size.split("X")[1]),i=parseInt(r.size.split("X")[0])):(e=parseInt(r.size.split("X")[0]),i=parseInt(r.size.split("X")[1])),e/i>=1.5?"140px":e/i<=1/1.5?"60px":"87px"}},methods:{optionChange:function(e){var t,i,r=e.target.id;for(var a in this.templatelist)this.templatelist[a].guid===r&&(t=this.templatelist[a].designSize,i=this.templatelist[a].suitId);this.$dispatch("dispatchApplyTemplate",r,i,t)}},events:{},created:function(){},ready:function(){}}}).call(t,i(2))},function(e,t,i){(function(t,r){var a=(i(34),i(14)),o=i(5),n=(i(10),i(32));e.exports={template:'<div v-show="sharedStore.isTextEditorShow"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div class="box-text-editor" style="overflow:hidden" v-bind:style="{ zIndex: windowZindex}"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="handleHideTextEditorView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 22px; margin-left: 33px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Text Editor</div></div><div style="margin: 50px 0 0 40px; width: 604px;"><div class="box-textarea"><textarea class="font-textarea" id="textArea" placeholder="Enter text here" style="height: 80px; width: 578px; line-height: 35px; background-color: #f5f5f5;" v-model="privateStore.inputTextEditorTxt"></textarea></div><div style="margin-top: 30px;"><span style="position: relative;display: inline-block; width: 300px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;">Font Family:</label><select class="input font-select" v-model="privateStore.selectFontFamily" style="width: 200px;border-width:2px;border-color:rgb(161,195,250);"></select><label class="options-label font-label" v-on:click="handleFontFamilyClick"  type="text" style="position: absolute; width: 177px;height: 35px; line-height: 35px;right:10px;top:0;">{{displayFontFamily}}</label><div v-show="privateStore.isShowFontFamilySelect" style="position:absolute;width: 200px;height:403px;border: 1px solid rgb(161,195,250);left: 100px;z-index: 200;background-color: rgb(245,245,245);bottom: -145px;"><div class="fontFamilySelect" v-on:click="handleSelectFontFamily(item.id)" style="height:20px" v-for="item in sharedStore.fontList"><img v-bind:src="item.imageUrl" style="padding-left: 10px;" height="16"/></div></div></span><span style="display: inline-block; width: 300px;margin-left: 4px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;margin-left:4px;width:90px;">Font Style:</label><select class="input font-select" id="fontStyleSelect" v-model="privateStore.selectFontStyle" style="width: 202px;"><option v-for="item in privateStore.fontStyleList" value="{{item.fontFamily}}">{{item.displayName}}</option></select></span></div><div style="margin-top: 20px;"><span style="position: relative; display: inline-block; width: 304px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;">Font Size:</label><!-- pop-out fake select button --><select class="input font-select" style="position: absolute; display: inline-block; width: 200px; right: 10px; top: 0;"></select><input class="input font-input" id="fontSizeText" type="text" v-on:blur="handleTextBlur()" v-on:focus="handleTextFocus()"  style="position: absolute; width: 177px; height: 33px; right: 10px; top: 0; background-color: rgba(245, 245, 245, 0);" value="{{displayFontSize}}"/><input class="input font-input" type="text" style="width: 181px; height: 33px;"><div v-show="privateStore.isFontsizeSliderShow" style="position: absolute; display: inline-block; width: 140px; left: 100px; top: 37px; padding: 0 8px; border-radius: 4px; background-color: #e6e6e6; box-shadow: 0 2px 3px 1px #cbcbcb;"><input type="text" id="as-slide-fontsize" data-slider-id="asFontsizeSlider" data-slider-min="0.3" data-slider-max="16" data-slider-step="0.1" data-slider-value="{{ privateStore.selectedInchFontSize }}" data-slider-handle="custom" data-slider-tooltip="hide" v-model="privateStore.selectedInchFontSize" /></div></span><span style="display: inline-block; width: 300px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;margin-left:4px;width:90px;">Font Color:</label><select class="input font-select" id="fontColorSelect" v-model="privateStore.selectFontColor" style="width: 202px;"><option value="0">Black</option><option value="6712688">Gray</option><option value="13289166">Light Gray</option><option value="16711422">White</option><option value="10497843">Cardinal</option><option value="16711680">Red</option><option value="16042184">Pink</option><option value="15690240">Orange</option><option value="14202129">Gold</option><option value="16776960">Yellow</option><option value="5679643">Green</option><option value="13158">Navy</option></select></span></div></div><div class="texteditor-button"><div id="texteditor-submitButton" class="button t-center" v-on:click="handleText()" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; margin-left: 258px;font-size: 14px;">{{ privateStore.submitButtonLabel }}</div></div><div v-show="privateStore.isShowFontFamilySelect" style="width:100%;height:100%;position: absolute;top: 50px;" v-on:click="handleNoSelectFontFamily"></div></div></div>',data:function(){return{privateStore:{fontStyleList:[],selectFontFamily:"font_arial",selectFontStyle:"Arial Narrow",selectFontColor:0,selectedInchFontSize:2,submitButtonLabel:"Done",isFontsizeSliderShow:!1,isEdit:!1,isRemoveButtonShow:!1,textWindowParams:{width:680,height:420,selector:".box-text-editor"},isShowFontFamilySelect:!1},sharedStore:t}},computed:{selectedPxFontSize:function(){var e=this.privateStore.selectedInchFontSize,t=o.getPxByInch(e);return Math.round(t)},displayFontSize:function(){return this.privateStore.selectedInchFontSize+" in."},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)},displayFontFamily:function(){for(var e=0;e<this.sharedStore.fontList.length;e++)if(this.sharedStore.fontList[e].id===this.privateStore.selectFontFamily)return this.sharedStore.fontList[e].displayName;return""}},methods:{handleShowTextEditor:function(){a.setPopWindowPosition(this.privateStore.textWindowParams),this.sharedStore.isTextEditorShow=!0,this.resetSumbitButton()},handleShowFontsizeSlider:function(){this.privateStore.isFontsizeSliderShow=!0},handleTextBlur:function(){var e=parseFloat(r("#fontSizeText").val().replace(" in.",""));isNaN(e)&&(e=this.privateStore.selectedInchFontSize),e<.3?e=.3:e>16&&(e=16),r("#fontSizeText").val(e+" in."),this.privateStore.selectedInchFontSize=e,r("#as-slide-fontsize").slider("setValue",e),this.privateStore.isFontsizeSliderShow=!1},handleTextFocus:function(){r("#fontSizeText").val(r("#fontSizeText").val().replace(" in.","")),this.privateStore.isFontsizeSliderShow=!0},handleHideTextEditorView:function(){this.sharedStore.isTextEditorShow=!1,this.resetView()},handleFontFamilyChange:function(){this.resetFontStyle()},handleText:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas,t=0,i=""+this.privateStore.selectFontColor,a=this.selectedPxFontSize;if(this.privateStore.isEdit){var o=e.params[e.selectedIdx],s={id:o.id,elType:"text",text:r("#textArea").val(),x:o.x,y:o.y,width:o.width,height:o.height,rotate:o.rotate,dep:o.dep,fontFamily:this.privateStore.selectFontStyle,fontSize:a,fontWeight:"normal",textAlign:"left",fontColor:i,isRefresh:!1};t=e.selectedIdx,n.editText(s,t)}else{var d=0,l=e.params.length;l&&(d=e.params[l-1].id+1);var s={id:d,elType:"text",text:r("#textArea").val(),x:500,y:500,width:2e3,height:500,rotate:0,dep:t,fontFamily:this.privateStore.selectFontStyle,fontSize:a,fontWeight:"normal",textAlign:"left",fontColor:i,isRefresh:!1};n.createText(s)}this.sharedStore.isTextEditorShow=!1,this.resetView()},handleRemoveText:function(){var e=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;n.deleteText(e.selectedIdx),this.sharedStore.isTextEditorShow=!1,this.resetView()},resetFontStyle:function(){for(var e,t=this.privateStore.selectFontFamily,i=0;i<this.sharedStore.fontList.length;i++)if(this.sharedStore.fontList[i].id==t){e=this.sharedStore.fontList[i];break}this.privateStore.fontStyleList=e.fonts,this.privateStore.selectFontStyle=this.privateStore.fontStyleList[0].fontFamily},initView:function(e){var t=this.sharedStore.pages[this.sharedStore.selectedPageIdx].canvas;void 0!=e&&null!=e||(e=t.selectedIdx),this.privateStore.isEdit=!0,this.privateStore.isRemoveButtonShow=!0;for(var i=t.params[e],a=i.fontFamily,n=i.fontSize,s=i.fontColor,d=i.text,l="",c="",p=0;p<this.sharedStore.fontList.length;p++)for(var h=this.sharedStore.fontList[p],g=h.id,u=(h.name,h.displayName,0);u<h.fonts.length;u++){var m=h.fonts[u],f=m.fontFamily;m.displayName;a==f&&(l=g,c=f)}l&&(this.privateStore.selectFontFamily=l),this.resetFontStyle(),this.privateStore.selectFontStyle=c,r("#textArea").val(d);var v=parseFloat(o.getInchByPx(n).toFixed(1));r("#fontSizeText").val(v+" in."),this.privateStore.selectedInchFontSize=v,
r("#as-slide-fontsize").slider("setValue",v),this.privateStore.selectFontColor=s,this.handleShowTextEditor()},resetView:function(){r("#textArea").val(""),this.privateStore.selectFontFamily="font_arial",this.privateStore.selectFontStyle="Arial Narrow",this.privateStore.selectFontColor=0,r("#fontSizeText").val("2 in."),this.privateStore.selectedInchFontSize=2,r("#as-slide-fontsize").slider("setValue",2),this.resetFontStyle()},getTextFamily:function(){var e=this;r.ajax({url:"./assets/data/fonts.xml",type:"get",dataType:"xml"}).done(function(i){if(i){for(var a=0;a<r(i).find("fontFamily").length;a++){var o={},n=r(i).find("fontFamily").eq(a),s=n.attr("id"),d=n.attr("name"),l=n.attr("displayName");o.id=s,o.name=d,o.displayName=l,o.fonts=[],o.imageUrl="assets/img/fonts/"+s+".png";for(var c=0;c<n.find("font").length;c++){var p=n.find("font").eq(c),h=(p.attr("id"),p.attr("displayName")),g=p.attr("fontFamily");p.attr("fontFace"),p.attr("weight"),p.attr("isDefault");o.fonts[c]={fontFamily:g,displayName:h}}t.fontList.push(o)}e.privateStore.fontStyleList=t.fontList[0].fonts}})},handleFontFamilyClick:function(){this.privateStore.isShowFontFamilySelect=!0},handleNoSelectFontFamily:function(){this.privateStore.isShowFontFamilySelect=!1},handleSelectFontFamily:function(e){this.privateStore.isShowFontFamilySelect=!1,this.privateStore.selectFontFamily=e,this.resetFontStyle()},resetSumbitButton:function(){r("#textArea").val().length>0?(r("#texteditor-submitButton").css("pointer-events","auto"),r("#texteditor-submitButton").css("opacity",1)):(r("#texteditor-submitButton").css("pointer-events","none"),r("#texteditor-submitButton").css("opacity",.4))}},ready:function(){this.getTextFamily(),r("#as-slide-fontsize").slider({})},events:{notifyModifyText:function(e){this.initView(e)},notifyShowAddText:function(){this.handleShowTextEditor(),this.privateStore.isEdit=!1,this.privateStore.isRemoveButtonShow=!1,this.resetView(),this.resetSumbitButton()}},created:function(){var e=this;e.$watch("sharedStore.watches.isChangeThisText",function(){e.sharedStore.watches.isChangeThisText&&(e.sharedStore.watches.isChangeThisText=!1,e.initView())}),e.$watch("privateStore.inputTextEditorTxt",function(){e.resetSumbitButton()})}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){var r=i(5);e.exports={mixins:[i(39)],template:"<div style=\"position:absolute;cursor:move;\" v-bind:style=\"{left:elementData.x*ratio + 'px',zIndex: ( elementData.dep + 1 ) * 100, top:elementData.y*ratio + 'px',width: elementData.width*ratio + 'px',height:elementData.height*ratio + 'px'}\">"+'<canvas id="textElementCanvas{{id}}" width="{{elementData.width*ratio}}px" height="{{elementData.height*ratio}}px" style="position:absolute;top:0;left:0;"></canvas><img v-bind:src="textSrc" style="position:absolute;left:0;top:0;"v-bind:style="{width: elementData.width*ratio + \'px\',height:elementData.height*ratio + \'px\'}" v-show="backImgShow" /><handle v-if="!sharedStore.isPreview" v-bind:id="id" v-bind:is-Show-Handles="isShowHandle" v-bind:is-Corner-Handles="isCornerHandles" v-bind:is-Side-Handles="isSideHandles"></handle></div>',data:function(){return{privateStore:{},sharedStore:t,elementData:Object,ratio:0,lastSize:0,fontRatio:0,textSrc:"",limitHeight:[],limitSize:[],allow:!0,backImgShow:!1,isCornerHandles:!0,isSideHandles:!1,imageRatio:0,type:"text",id:0}},computed:{isShowHandle:function(){var e=t.pages[t.selectedPageIdx].canvas;return e.selectedIdx===i(10).getIndexById(this.id)&&!t.isLostFocus}},methods:{init:function(e){var i=t.pages[t.selectedPageIdx].canvas;this.elementData=i.params[e],this.ratio=i.ratio,this.id=this.elementData.id,this.lastSize=Math.round(r.getTextViewFontSize(i.params[e].fontSize))},destroy:function(){},refreshText:function(){var e=new Image,a=this,o=a.getTextImageUrl();currentCanvas=t.pages[t.selectedPageIdx].canvas,e.src=o,e.onload=function(){a.elementData.width=this.width,a.elementData.height=this.height,a.imageRatio=this.width/this.height,currentCanvas.params[i(10).getIndexById(a.id)].width=this.width/a.ratio,currentCanvas.params[i(10).getIndexById(a.id)].height=this.height/a.ratio,a.fontRatio||(a.fontRatio=currentCanvas.params[i(10).getIndexById(a.id)].height/Math.round(r.getTextViewFontSize(currentCanvas.params[i(10).getIndexById(a.id)].fontSize))),a.limitHeight.length||(a.limitHeight.push(a.limitSize[0]*a.fontRatio),a.limitHeight.push(a.limitSize[1]*a.fontRatio)),i(20).drawImage("textElementCanvas"+a.id,o,0,0,null,this.width,this.height)},a.textSrc=o},getTextImageUrl:function(){var e=i(10).getIndexById(this.id),r=t.pages[t.selectedPageIdx].canvas,a="../../static/img/blank.png",o=0,n=0;return n=Math.round(i(5).getTextViewFontSize(r.params[e].fontSize)),this.fontRatio&&this.lastSize===n&&this.allow?(r.params[e].fontSize=this.elementData.height/this.fontRatio/this.ratio,o=Math.round(i(5).getTextViewFontSize(r.params[e].fontSize))):(o=n,this.allow=!0),this.lastSize=o,o>0&&(a=""===r.params[e].text?t.isPreview?"../../static/img/blank.png":t.domains.productBaseUrl+"/product/text/textImage?text="+encodeURIComponent("Enter text here")+"&font="+encodeURIComponent(r.params[e].fontFamily)+"&fontSize="+o+"&color="+r.params[e].fontColor+"&align=left":t.domains.productBaseUrl+"/product/text/textImage?text="+encodeURIComponent(r.params[e].text)+"&font="+encodeURIComponent(r.params[e].fontFamily)+"&fontSize="+o+"&color="+r.params[e].fontColor+"&align=left"),a},onDoubleClick:function(e){},onDragOver:function(){},setIndex:function(){var e=t.pages[t.selectedPageIdx].canvas;e.selectedIdx=i(10).getIndexById(this.id),t.isLostFocus=!1,t.watchData.changeDepthIdx=i(10).getIndexById(this.id),t.watches.isChangeDepthFront=!0},getlimitHeight:function(){},setLimitSize:function(){var e=r.getTextViewFontSize(r.getPxByInch(.3)),t=r.getTextViewFontSize(r.getPxByInch(16));this.limitSize.push(e),this.limitSize.push(t)}},events:{dispatchRefresh:function(){this.refreshText()},dispatchScaleEnd:function(e){var t=this.elementData.width+e.width/this.ratio,i=this.elementData.height+e.height/this.ratio;i<=this.limitHeight[0]?(this.elementData.width=this.limitHeight[0]*this.imageRatio,this.elementData.height=this.limitHeight[0]):i>=this.limitHeight[1]?(this.elementData.width=this.limitHeight[1]*this.imageRatio,this.elementData.height=this.limitHeight[1]):(this.elementData.width=t,this.elementData.height=i),this.refreshText(),this.backImgShow=!1},dispatchScaleStart:function(){this.setIndex(),i(20).clear("textElementCanvas"+this.id),this.backImgShow=!0},dispatchClick:function(){this.setIndex()},dispatchMove:function(e){this.setIndex(),t.vm.$broadcast("notifyRefreshScreenshot")},dispatchDblClick:function(){this.sharedStore.watches.isChangeThisText=!0},dispatchScale:function(e){var t=this.elementData.width+e.width/this.ratio,i=this.elementData.height+e.height/this.ratio;i<=this.limitHeight[0]?(this.elementData.width=this.limitHeight[0]*this.imageRatio,this.elementData.height=this.limitHeight[0]):i>=this.limitHeight[1]?(this.elementData.width=this.limitHeight[1]*this.imageRatio,this.elementData.height=this.limitHeight[1]):(this.elementData.width=t,this.elementData.height=i)}},created:function(){},ready:function(){this.setLimitSize(),this.refreshText()}}}).call(t,i(2))},function(e,t,i){(function(t,r){e.exports={template:'<div class="bed-title"><div v-show="!privateStore.isEditingTitle"><p class="box-title" style="float: left;color:#fff">{{ sharedStore.title }}</p><img v-show="!sharedStore.projectInfo.isInCart && !sharedStore.projectInfo.isOrdered" class="title-edit-icon" title="Click to edit title" v-on:click="handleShowEdit" src="assets/img/title-edit.svg" /></div><div v-show="privateStore.isEditingTitle"><div class="box-title-edit"><input class="title-edit" type="text" maxlength="50" v-model="privateStore.title" v-on:keyUp="handleInputKeyEvent"/><img class="icon-done" v-on:click="handleTitleEditDone" src="assets/img/title-done.svg" /><img class="icon-delete" v-on:click="handleTitleDelete" src="assets/img/title-delete.svg" /></div><span v-show="privateStore.isTitleInvalid" class="title-warn">{{privateStore.InvalidText}}</span></div></div>',data:function(){return{privateStore:{isEditingTitle:!1,isTitleInvalid:!1,InvalidText:"",title:""},sharedStore:t}},methods:{handleInputKeyEvent:function(e){switch(e.keyCode){case 27:this.privateStore.isEditingTitle=!1,this.privateStore.isTitleInvalid=!1;break;case 13:this.handleTitleEditDone()}},handleShowEdit:function(){this.privateStore.title=this.sharedStore.title,this.privateStore.isEditingTitle=!0,setTimeout(function(){r(".title-edit").focus()},0)},handleTitleEditDone:function(){var e=this.privateStore.title;e.trim()?/^[a-zA-Z 0-9\d_\s\-]+$/.test(e)?e!==this.sharedStore.title?i(13).changeProjectTitle(this.privateStore.title,this,"dispatchUpdateAlbumResponse"):e===this.sharedStore.title&&(this.privateStore.isEditingTitle=!1):(this.privateStore.isTitleInvalid=!0,this.privateStore.InvalidText="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title"):(this.privateStore.isTitleInvalid=!0,this.privateStore.InvalidText="Title is required")},handleTitleDelete:function(){this.privateStore.isEditingTitle=!1,this.privateStore.isTitleInvalid=!1}},events:{notifyUpdateAlbumResponse:function(e,t){this.privateStore.isTitleInvalid=e,this.privateStore.isTitleInvalid?this.privateStore.InvalidText="Please use a name you haven't used before":(this.privateStore.isEditingTitle=!1,this.sharedStore.title=this.privateStore.title,i(13).handledSaveOldProject(this))}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){var a=i(10),o=i(18);e.exports={template:'<div id="warnTipElement-{{pagedd}}{{ id }}{{main}}" v-show="scale > warnTipLimit && main" v-bind:style="{ height:  (privateStore.height) + \'px\', bottom: bottom + \'px\', left: left + \'px\', zIndex: windowZindex }" style="position: absolute;"><img src="../../static/img/warn_big_icon.svg" width="{{ privateStore.width }}px" height="{{ privateStore.height }}px" alt="" title="{{ warnTipMsg }}" /> {{ privateStore.warnTipContent }}</div>',props:["id","pagedd","ratio","main","width","height","x","y"],data:function(){return{privateStore:{width:18,height:18,warnTipContent:"",margin:t.warnTipMargin||90,scale:1},sharedStore:t,pagedd:0,main:"",ratio:1}},computed:{warnTipLimit:function(){return this.sharedStore.warnTipLimit||200},scale:function(){var e=this.sharedStore.pages[this.pagedd].canvas,t=a.getIndexById(this.id),i=e.params[t],r=o.getImageDetail(i.imageId),n=r.width*e.params[t].cropPW,s=this.width/this.ratio;if(n<s)var d=(s-n)/n*100;else var d=0;return Math.round(d)},bottom:function(){var e=this.sharedStore.pages[this.pagedd].canvas,t=this.privateStore.margin*this.ratio;if(this.sharedStore.warnTipBottom)return this.sharedStore.warnTipBottom;if(this.sharedStore.isCanvas){var i=(e.photoLayer.height-Math.abs(e.photoLayer.y)-e.canvasBordeThickness.top)*this.ratio;return this.y+this.height>i&&(t+=this.y+this.height-i),t}switch(this.sharedStore.projectSettings[this.pagedd].product){case"frameCanvas":case"acrylicPrint":case"metalPrint":case"woodPrint":case"LRB":case"LSC":case"mountPrint":var i=(e.photoLayer.height-Math.abs(e.photoLayer.y))*this.ratio;return this.y+this.height>i&&(t+=this.y+this.height-i),t}},left:function(){var e=this.sharedStore.pages[this.pagedd].canvas,t=this.privateStore.margin*this.ratio;if(this.sharedStore.warnTipLeft)return this.sharedStore.warnTipLeft;if(this.sharedStore.isCanvas){var i=(Math.abs(e.photoLayer.x)+e.canvasBordeThickness.left)*this.ratio;return this.x<i&&(t+=i-this.x),t}switch(this.sharedStore.projectSettings[this.pagedd].product){case"frameCanvas":case"flushMountCanvas":case"acrylicPrint":case"metalPrint":case"woodPrint":case"LRB":case"LSC":case"mountPrint":var i=Math.abs(e.photoLayer.x)*this.ratio;return this.x<i&&(t+=i-this.x),t}},mirrorLength:function(){var e=this.sharedStore.pages[this.pagedd].canvas;return e.ratio*this.sharedStore.mirrorLength},windowZindex:function(){var e=this.sharedStore.pages[this.pagedd].canvas,t=a.getIndexById(this.id),i=e.params[t];return 100*(i.dep+1)+80},warnTipMsg:function(){return"Photo has low resolution and may look poor in print."}},methods:{hideWarnTip:function(e){r("#warnTipElement-"+e).hide()},showWarnTip:function(e){r("#warnTipElement-"+e).show()}},events:{notifyShowWarnTip:function(){var e=a.getIndexById(this.id);this.showWarnTip(e)},notifyHideWarnTip:function(){var e=a.getIndexById(this.id);this.hideWarnTip(e)}}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={template:'<div><div class="shadow-bg" v-show="privateStore.isShowCartReturn" v-bind:style="{zIndex: windowZindex-1}"></div><div id="cartReturnWindow" v-show="privateStore.isShowCartReturn" class="box-popup" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }" ><div style="font-size: 24px;margin: 40px 45px 54px 45px;color: #3a3a3a;">What would you like to do?</div><div style="margin: 40px 45px 54px 45px;"><div><input id="currentItem" name="cartRerutnItem" type="radio" value="current" v-model="privateStore.selected" :checked="privateStore.selected === \'current\'"><label for="currentItem" style="font-size:18px;color: #3a3a3a;">Edit current project</label><div style="font-size:14px;color: #7b7b7b;margin: 10px 0 0 22px;height: 50px;"></div></div><div><input id="cloneItem" name="cartRerutnItem" type="radio" value="clone" v-model="privateStore.selected" :checked="privateStore.selected === \'clone\'"><label for="cloneItem" style="font-size:18px;color: #3a3a3a;">Clone current project</label><div style="font-size:14px;color: #7b7b7b;margin: 10px 0 0 22px;height: 50px;">Create a copy of the current project to edit.</div></div><div><input id="newItem"  name="cartRerutnItem" type="radio" value="new" v-model="privateStore.selected" :checked="privateStore.selected === \'new\'"><label for="newItem" style="font-size:18px;color: #3a3a3a;">Create a new blank project</label></div></div><div class="popup-button" style="margin-top:35px;text-align:center;"><div class="button t-center" v-on:click="optionChange()" style="display:inline-block;width: 160px;height: 40px;line-height: 40px;font-size: 14px;">Continue</div></div></div></div>',data:function(){return{privateStore:{width:580,height:450,selector:"#cartReturnWindow",selected:"current",isShowCartReturn:!1},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{optionChange:function(){switch(this.privateStore.selected){case"current":return void(this.privateStore.isShowCartReturn=!1);case"clone":return t.fromCart=!1,this.privateStore.isShowCartReturn=!1,void this.$dispatch("dispatchShowCloneWindow");case"new":return t.fromCart=!1,t.watches.isProjectLoaded=!1,this.privateStore.isShowCartReturn=!1,void this.$dispatch("dispatchShowNewProjectWindow")}}},events:{notifyShowCartReturnWindow:function(){var e=i(14);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.privateStore.isShowCartReturn=!0}},created:function(){},ready:function(){}}}).call(t,i(2))},function(e,t,i){(function(t){e.exports={template:'<div v-show="sharedStore.isShowClone"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div id="cloneWindow" class="box-order" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" draggable="false" width="16" height="16" v-on:click="handleHideView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Clone Project</div></div><div style="margin: 40px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Please input new project name</label><div class="box-textarea"><input id="clone_title" type="text" v-model="privateStore.title" class="font-textarea"  style="width: 533px;height:35px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[0]}}" v-on:blur="handleTitleInputBlur()" v-on:focus="handleTitleInputFocus()" maxlength="50"></textarea></div></div><div class="texteditor-button" style="margin-top: 0px;"><div id="emptyInfo" v-show="privateStore.isProjectNameInvalid" style="width: auto;text-align: center;height: 30px;line-height: 30px;font-size: 14px;color:red;margin-left:auto;margin-right:auto;">{{privateStore.invalidateTitle}}</div><div style="text-align: center; margin-top:25px;"><div class="button t-center button-white" v-on:click="cancel" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; font-size: 14px; margin-right: 26px;border: 1px solid #ccc;color: #393939;">Cancel</div><div class="button t-center" v-on:click="submit" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; font-size: 14px;">Clone</div></div></div></div>',data:function(){return{privateStore:{width:655,height:318,title:"",selector:"#cloneWindow",marks:["input new name here"],invalidateTitle:"Please input new project name. ",isProjectNameInvalid:!1},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideView:function(){this.sharedStore.isShowClone=!1,this.privateStore.title=""},submit:function(){this.privateStore.title&&""!==this.privateStore.title.trim()?i(6).checkInvalid(this.privateStore.title)?(this.privateStore.isProjectNameInvalid=!1,i(13).cloneProject(this,this.privateStore.title),this.privateStore.title=""):(this.privateStore.invalidateTitle="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.",this.privateStore.isProjectNameInvalid=!0):(this.privateStore.invalidateTitle="Please input new project name",this.privateStore.isProjectNameInvalid=!0)},cancel:function(){this.sharedStore.isShowClone=!1,this.privateStore.title=""},handleTitleInputBlur:function(){return this.privateStore.title=this.replaceInvalidString(this.privateStore.title),this.privateStore.title&&""!==this.privateStore.title.trim()?void(i(6).checkInvalid(this.privateStore.title)?this.privateStore.isProjectNameInvalid=!1:(this.privateStore.invalidateTitle="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.",this.privateStore.isProjectNameInvalid=!0)):(this.privateStore.invalidateTitle="Please input new project name",void(this.privateStore.isProjectNameInvalid=!0))},handleTitleInputFocus:function(){this.privateStore.invalidateTitle=""},replaceInvalidString:function(e){var t=/<\/?[^>]*>/g,i=/[ | ]*\n/g,r=/&nbsp;/gi;return e.replace(t,"").replace(i,"").replace(r,"").replace(/(^\s+)|(\s+$)/g,"")}},ready:function(){},events:{notifyShowCloneWindow:function(){var e=i(14);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.sharedStore.isShowClone=!0,this.privateStore.isProjectNameInvalid=!1},notifyHideCloneWindow:function(){this.sharedStore.isShowClone=!1},notifyShowInvalidTitle:function(e){this.privateStore.invalidateTitle=e,this.privateStore.isProjectNameInvalid=!0}},created:function(){}}}).call(t,i(2))},function(e,t,i){(function(t,r){e.exports={template:'<div class="bed-image-upload" v-show="sharedStore.isImageUploadShow"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div class="box-image-upload" v-bind:style="{ zIndex: windowZindex }" style="width:655px;height:480px;"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 600px;font-size: 20px;"><img src="../../static/img/close-normal.svg" width="16" height="16" v-on:click="hideImageUpload(true)" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 14px; cursor: pointer;" /></div></div><div style="margin: 0 40px;position:relative;"><div class="font-title t-left">Upload Images</div><div v-show="isWarnMessageShow && !(sharedStore.maxPageNum && !sharedStore.isUploading)" class="font-light" style="position:absolute;top: 33px;font-size:12px;color:#de3418;">{{warnMessage}}</div></div><div style="margin: 30px 40px 0;"><div class="upload-row-title"><span class="upload-status-head">File</span><span class="upload-status-sub">File Progress</span></div></div><div id="box-upload-list" style="margin: 0 20px 0 40px;height: 230px; overflow: auto;position:relative;"></div><div style="margin: 24px 40px;height:40px;position:relative;"><div style="float:left;line-height:38px;"><span class="font-normal" style="font-size:12px;color:#7B7B7B;">{{sharedStore.successfullyUploaded}} Complete</span><span style="margin-left: 15px;color:#de3418;font-size:12px;" v-show="sharedStore.errorUploaded">{{sharedStore.errorUploaded}} Failed</span></div><div v-show="sharedStore.maxPageNum && !sharedStore.isUploading && sharedStore.maxPageNum > sharedStore.pages.length" style="position:absolute;right:1px;top:-30px;background-color:#3a3a3a;color:#fff;font-size:12px;padding:4px 10px;box-shadow:0 2px 4px 0 rgba(0,0,0,.13);">{{remainTip}}<div style="position:absolute;width:0;height:0;border-left:6px solid transparent;border-right:6px solid transparent;border-top:5px solid #3a3a3a;left:78%;bottom:-5px;transform:translateX(-50%);"></div></div><div style="float:right;"><div class="button-white t-center" :style="addMoreStyle" v-on:click="handleUploadClick(true)" style="width: 160px;height: 40px;line-height: 40px;display: inline-block;font-size: 14px;">Add More Photos</div></div><input type="file" name="" id="multi-files" multiple accept="{{sharedStore.uploadAcceptType}}" v-on:change="handleDoUpload()" style="display: none;" /><input type="file" name="" id="single-files"  accept="image/*" v-on:change="handleDoUpload()" style="display: none;" /></div></div></div>',data:function(){return{privateStore:{els:"",uploadWindowParams:{width:655,height:480,selector:".box-image-upload"},uploadParams:{fileSelector:"#multi-files"},firstUpload:!1,single:null},sharedStore:t,isWarnMessageShow:!1}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)},warnMessage:function(){return"You can only upload "+t.maxPageNum+" images per pack in total."},remainTip:function(){return"Still need to upload "+(t.maxPageNum-t.pages.length)+" photo(s), click here to continue"},addMoreStyle:function(){var e=this.sharedStore.maxPageNum&&(this.sharedStore.isUploading||this.sharedStore.maxPageNum<=this.sharedStore.pages.length);return{color:e?"#ccc":"#000",borderColor:e?"#ccc":"rgba(203, 203, 203, 1)",cursor:e?"not-allowed":"pointer"}}},methods:{showImageUpload:function(){var e=i(14);e.setPopWindowPosition(this.privateStore.uploadWindowParams),this.sharedStore.isImageUploadShow=!0},hideImageUpload:function(e,a){e||(t.cancelByX=!0),this.sharedStore.filesCountInQueue+this.sharedStore.errorExt>=this.sharedStore.filesTotalInQueue?(r(this.privateStore.uploadParams.fileSelector).val(""),this.sharedStore.isImageUploadShow=!1,t.isUploading=!1,e&&i(8)({ev:i(9).CloseMonitor,auto:!!a})):this.$dispatch("dispatchShowPopup",{type:"cancelUpload",status:-1}),this.isWarnMessageShow=!1},handleUploadClick:function(e,a){this.sharedStore.maxPageNum&&(this.sharedStore.isUploading||this.sharedStore.maxPageNum<=this.sharedStore.pages.length&&"number"!=typeof t.watchData.replacePageId)||(e?i(8)({ev:i(9).AddMorePhotos}):(this.resetImageUploadDom(),t.uploadProgress.length=0,t.successfullyUploaded=0,t.errorUploaded=0,t.cancelledUpload.length=0,t.oriImageIds=[],t.oriImageNames=[],t.currentUploadCount=0,t.filesTotal=0,t.prevFilesTotal=[],t.prevFilesTotal=0,t.filesTotalInQueue=0,t.filesCountInQueue=0),t.currentSuccessUpload=0,t.currentErrorUpload=0,t.errorExt=0,r(this.privateStore.uploadParams.fileSelector).val(""),a||this.privateStore.single?(this.privateStore.uploadParams.fileSelector="#single-files",r("#single-files").trigger("click")):(this.privateStore.uploadParams.fileSelector="#multi-files",r("#multi-files").trigger("click")))},handleDoUpload:function(){var e=i(45),r=document.querySelector(this.privateStore.uploadParams.fileSelector).files;r.length&&(t.maxPageNum&&t.pages.length+r.length>t.maxPageNum&&"number"!=typeof t.watchData.replacePageId&&(this.isWarnMessageShow=!0),i(8)({ev:i(9).FinishPhotoSelect,chooseTimes:++t.chooseTimes,chooseCount:r.length}),this.privateStore.firstUpload?(e(this,this.privateStore.uploadParams,!0),this.privatedStore.firstUpload=!1):e(this,this.privateStore.uploadParams),this.sharedStore.startUploadTime=new Date,i(8)({ev:i(9).StartUpload,uploadCount:r.length}),this.sharedStore.isUploading=!0),this.showImageUpload()},handleSaveAndHideUpload:function(e){if(this.sharedStore.filesCountInQueue>=this.sharedStore.filesTotalInQueue){if(this.$dispatch("dispatchSaveProject",!0),this.sharedStore.maxPageNum&&this.sharedStore.pages.length<this.sharedStore.maxPageNum)return;this.hideImageUpload(!0,e),t.cancelByX=!1,t.isLostFocus=!0,setTimeout(function(){t.watchData.replacePageId=null})}else t.vm.$broadcast("notifyShowPopup",{type:"cancelUpload",status:-1})},refreshImageUploadDom:function(){r("#box-upload-list").find(".new-add-upload-row").remove();for(var e=0;e<this.sharedStore.uploadProgress.length;e++)this.sharedStore.uploadProgress[e]&&this.sharedStore.uploadProgress[e].percent&&(this.initImageUploadDom(e,this.getImageName(this.sharedStore.uploadProgress[e].imgId)),"Done"===this.sharedStore.uploadProgress[e].percent&&r("#delete-"+e).hide(),(this.sharedStore.uploadProgress[e].percent.toString().indexOf("Only")>=0||this.sharedStore.uploadProgress[e].info&&this.sharedStore.uploadProgress[e].info.toString().indexOf("Failed")>=0)&&(r("#retry-"+e).show(),r("#progress-c-"+e).hide(),r("#delete-"+e).hide(),r("#status-"+e).css("width","310")))},getImageName:function(e){for(var i=0;i<t.oriImageNames.length;i++){var r=t.oriImageNames[i];if(r.imgId===e)return r.filename}},initImageUploadDom:function(e,t){var i=t;if(i.length>15&&(i=i.substr(0,12)+"..."+i.substr(i.length-3)),e<5){r("#upload-row-item-"+e+" .upload-status-head").text(i).attr("title",t);var a='<span id="progress-c-'+e+'" style="display: inline-block;position:relative;vertical-align:middle; top: 0; left: 10px;width: 341px;height: 10px; border-radius: 5px; background-color: white;"><span id="progress-'+e+'" style="display: inline-block;width: 1px; height: 10px; border-radius: 5px; background-color: #ccc;">&nbsp;</span></span><span id="status-'+e+'" style="position: relative;vertical-align: middle; left: 26px;display:inline-block;;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">0%</span><span id="error-tip-'+e+'"></span><div style="display:none;position:absolute;right:7px;top:0;text-decoration:none;color:#de3418;" class="upload-retry" id="retry-'+e+'">Failed</div>';r("#upload-row-item-"+e+" .upload-status-sub").html(a)}else{var o='<div class="upload-row-item new-add-upload-row" style="overflow:hidden;" id="upload-row-item-'+e+'"><span class="upload-status-head" style="float:left;display:inherit;" title="'+t+'">'+i+'</span><span class="upload-status-sub" style="position:relative;"><span id="progress-c-'+e+'" style="display: inline-block;vertical-align:middle;position:relative; top: 0; left: 10px;width: 341px;height: 10px; border-radius: 5px; background-color: white;"><span id="progress-'+e+'" style="display: inline-block;width: 1px; height: 10px; border-radius: 5px; background-color: #ccc;">&nbsp;</span></span><span id="status-'+e+'" style="position: relative;vertical-align: middle; left: 26px;display:inline-block;;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">0%</span><span id="error-tip-'+e+'"></span><div style="display:none;position:absolute;right:7px;top:0;text-decoration:none;color:#de3418;" class="upload-retry" id="retry-'+e+'">Failed</div></span></div>';r("#box-upload-list").append(o)}},resetImageUploadDom:function(){for(var e="",t=0;t<5;t++)e+='<div class="upload-row-item" style="overflow:hidden;" id="upload-row-item-'+t+'"><span class="upload-status-head" style="float:left;display:inherit;">&nbsp</span><span class="upload-status-sub" style="position:relative;">&nbsp</span></div>';r("#box-upload-list").html(e),r("#multi-files").val(""),this.sharedStore.filesTotalInQueue=0,this.sharedStore.filesCountInQueue=0},updateUploadProgress:function(){for(var e=0;e<this.sharedStore.uploadProgress.length;e++)if(this.sharedStore.uploadProgress[e]&&"Done"===this.sharedStore.uploadProgress[e].percent){if(r("#status-"+e).text("Done").css("color","#7a7a7a"),r("#progress-"+e).css("width",341).css("background-color","#393939").attr("title",""),["PR","CLO","flushMountPrint","LSC"].indexOf(t.projectType)<0&&t.pages&&t.pages[t.selectedPageIdx].canvas){var i=t.pages[t.selectedPageIdx].canvas;if(i.params.length&&i.params[i.selectedIdx]&&"image"===i.params[i.selectedIdx].elType&&""===i.params[i.selectedIdx].imageId&&this.$dispatch("dispatchSingleImageUploadComplete",t.oriImageIds[e]),"CR"===t.projectType){for(var a=0,o="",n=0,s=0;s<i.params.length;s++)"image"===i.params[s].elType&&(a++,o=i.params[s].imageId,n=i.params[s].id);1!==a||o||(i.selectedIdx=n,this.$dispatch("dispatchSingleImageUploadComplete",t.oriImageIds[e]))}}0===this.sharedStore.uploadProgress[e].successUploadAt&&(this.sharedStore.uploadProgress[e].successUploadAt=(new Date).getTime(),this.trackPhotoFinishUpload(this.sharedStore.uploadProgress[e]))}else this.sharedStore.uploadProgress[e]&&"Error"===this.sharedStore.uploadProgress[e].percent?(r("#status-"+e).text("Error").css("color","#7a7a7a"),r("#progress-"+e).css("width",341).css("background-color","#de3418").attr("title",this.sharedStore.uploadProgress[e].info)):this.sharedStore.uploadProgress[e]&&(this.sharedStore.uploadProgress[e].percent.toString().indexOf("Only")>=0||this.sharedStore.uploadProgress[e].info&&this.sharedStore.uploadProgress[e].info.toString().indexOf("Failed")>=0?r("#status-"+e).text(this.sharedStore.uploadProgress[e].percent).css("color","#de3418").css("width","310").css("left","10px").css("font-size","12px").css("font-style","italic").attr("title",this.sharedStore.uploadProgress[e].info):(0===this.sharedStore.uploadProgress[e].startUploadAt&&(this.sharedStore.uploadProgress[e].startUploadAt=(new Date).getTime(),this.trackPhotoStartUpload(this.sharedStore.uploadProgress[e])),r("#status-"+e).text(this.sharedStore.uploadProgress[e].percent+"%").css("color","#7a7a7a"),r("#progress-"+e).css("width",3.41*this.sharedStore.uploadProgress[e].percent).css("background-color","#ccc")))},trackPhotoStartUpload:function(e){var r=e.file.name,a=e.file.size,o=e.startUploadAt,n="";n=t.projectSettings.length?t.projectSettings[0].product:t.baseProject&&t.baseProject.product,i(8)({ev:i(9).StartUploadEachPhoto,product:n,startUploadAt:o,photoName:r,photoSize:a})},trackPhotoFinishUpload:function(e){var r=e.file.name,a=e.file.size,o=e.startUploadAt,n=e.successUploadAt,s="";s=t.projectSettings.length?t.projectSettings[0].product:t.baseProject&&t.baseProject.product,i(8)({ev:i(9).CompleteUploadEachPhoto,product:s,successUploadAt:n,photoName:r,photoSize:a,uploadSpend:n-o})},isWindowOpen:function(){return t.isImageUploadShow},cancelItem:function(e){t.cancelledImgIds.indexOf(t.oriImageIds[e])<0&&(t.cancelledUpload.push(e),t.cancelledImgIds.push(t.oriImageIds[e])),r("#upload-row-item-"+e).hide(),this.sharedStore.uploadProgress[e].xhr&&this.sharedStore.uploadProgress[e].xhr.abort(),this.sharedStore.filesCountInQueue++,t.cancelledUpload.length===t.filesTotal&&(this.sharedStore.uploadProgress.length=0,this.handleSaveAndHideUpload(),this.sharedStore.isUploading=!1,
t.vm.$broadcast("notifyHidePopup"))}},events:{notifyShowImageUpload:function(e){this.handleUploadClick(null,e)},notifyCancelItem:function(e){this.cancelItem(e)}},created:function(){var e=this;e.$watch("sharedStore.uploadProgress",e.updateUploadProgress,{deep:!0})},ready:function(){t.cancelledImgIds=[]}}}).call(t,i(2),i(4))},function(e,t,i){(function(t,r){i(11);e.exports={template:'<div v-show="privateStore.isShowCreateProject"><div class="shadow-bg" v-bind:style="{zIndex: windowZindex-1}"></div><div id="newProjectWindow" class="box-order" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }"><div style="height: 40px:line-height: 40px;"><div style="width: 40px;height: 40px;margin-left: 610px;font-size: 20px;"><img src="../../static/img/close-normal.svg" draggable="false" width="16" height="16" v-on:click="handleHideView()" onmouseover="this.src = \'../../static/img/close-hover.svg\'" onmouseout="this.src = \'../../static/img/close-normal.svg\'" alt="close" title="close" style="margin-top: 24px; margin-left: 4px; cursor: pointer;" /></div></div><div style="margin: 0 40px;"><div class="font-title t-left">Create a new project</div></div><div style="margin: 40px 40px 0; width: 570px;"><label class="options-label font-label" style="height: 35px; line-height: 35px;width: 100%;">Please input new project name</label><div class="box-textarea"><input id="new_project_title" type="text" v-model="privateStore.title" class="font-textarea"  style="width: 533px;height:35px; line-height: 35px; background-color: #f5f5f5;" placeholder="{{privateStore.marks[0]}}" v-on:blur="handleTitleInputBlur()" maxlength="50"></textarea></div></div><div class="texteditor-button" style="margin-top: 0px;"><div id="new_project_emptyInfo" style="width: auto;text-align: center;height: 30px;line-height: 30px;font-size: 14px;color:red;margin-left:auto;margin-right:auto;visibility:hidden;">{{privateStore.invalidateTitle}}</div><div style="text-align: center;margin-top:25px;"><div class="button t-center button-white" v-on:click="cancel" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; font-size: 14px; margin-right: 26px;border: 1px solid #ccc;color: #393939;">Cancel</div><div class="button t-center" v-on:click="submit" style="width: 160px;height: 40px;line-height: 40px;display: inline-block; font-size: 14px;">Done</div></div></div></div>',data:function(){return{privateStore:{width:655,height:318,title:"",selector:"#newProjectWindow",marks:["input new name here"],invalidateTitle:"Please input new project name. ",isShowCreateProject:!1},sharedStore:t}},computed:{windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+10)}},methods:{handleHideView:function(){this.privateStore.isShowCreateProject=!1,this.privateStore.title=""},submit:function(){var e=this;if(this.privateStore.title&&""!==this.privateStore.title.trim())if(this.privateStore.title===t.title){var a="Title existed, please pick another one.";t.vm.$broadcast("notifyShowNewProjectInvalidTitle",a)}else i(6).checkInvalid(this.privateStore.title)?i(11).createProjectAddOrUpdateAlbum(e.privateStore.title,t.title,function(t){r("#new_project_emptyInfo").css("visibility","hidden"),i(13).createProject(e,t),e.privateStore.title=""},function(){}):(this.privateStore.invalidateTitle="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.",r("#new_project_emptyInfo").css("visibility","visible"));else this.privateStore.invalidateTitle="Please input new project name",r("#new_project_emptyInfo").css("visibility","visible")},cancel:function(){this.privateStore.isShowCreateProject=!1},handleTitleInputBlur:function(){return this.privateStore.title=this.replaceInvalidString(this.privateStore.title),this.privateStore.title&&""!==this.privateStore.title.trim()?void(i(6).checkInvalid(this.privateStore.title)?r("#new_project_emptyInfo").css("visibility","hidden"):(this.privateStore.invalidateTitle="Only letters, numbers, blank space, - (hyphen) and _ (underscore) are allowed in the title.",r("#new_project_emptyInfo").css("visibility","visible"))):(this.privateStore.invalidateTitle="Please input new project name",void r("#new_project_emptyInfo").css("visibility","visible"))},replaceInvalidString:function(e){var t=/<\/?[^>]*>/g,i=/[ | ]*\n/g,r=/&nbsp;/gi;return e.replace(t,"").replace(i,"").replace(r,"").replace(/(^\s+)|(\s+$)/g,"")}},ready:function(){},events:{notifyShowNewProjectWindow:function(){var e=i(14);e.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector}),this.privateStore.isShowCreateProject=!0,r("#new_project_emptyInfo").css("visibility","hidden")},notifyHideNewProjectWindow:function(){this.privateStore.isShowCreateProject=!1},notifyShowNewProjectInvalidTitle:function(e){this.privateStore.invalidateTitle=e,r("#new_project_emptyInfo").css("visibility","visible")}},created:function(){}}}).call(t,i(2),i(4))},function(e,t,i){(function(t){e.exports={template:'<div><div class="shadow-bg" v-show="privateStore.showCenter" v-bind:style="{zIndex: windowZindex-1}" style="z-index:9999999999"></div><div id="popup-window" v-show="privateStore.showCenter"  style="z-index:9999999999" class="box-popup" v-bind:style="{width: privateStore.width + \'px\',height: privateStore.height + \'px\', zIndex: windowZindex }" ><div v-show="privateStore.showcloseButton" style="height: 50px;line-height: 50px;"><div style="width: 40px;height: 40px;float: right;font-size: 20px;"><img v-if="!privateStore.isHoverClose" src="../../static/img/close-normal.svg" width="16" height="16" @click="handleHidePopup" @mouseover="hoverCloseIcon(true)" alt="close" title="close" style=" cursor: pointer;" /><img v-if="privateStore.isHoverClose" src="../../static/img/close-hover.svg" width="16" height="16" @click="handleHidePopup" @mouseout="hoverCloseIcon(false)" alt="close" title="close" style=" cursor: pointer;" /></div></div><div style="line-height: 25px;padding:10px 10px 0;text-align:center;color: #3a3a3a;font-size:16px;">{{{ privateStore.msg }}}</div><div class="popup-button" style="margin-top:35px;text-align:center;"><div v-if="privateStore.confirm" class="button t-center" v-on:click="handleOkPopup" style="width: 160px;height: 40px;line-height: 40px;margin:0 auto;font-size: 14px;">{{ privateStore.texts[0] }}</div><template v-else><div class="button t-center" v-on:click="handleNowPopup" style="display:inline-block;width: 160px;height: 40px;line-height: 40px;font-size: 14px;">{{ privateStore.b2 }}</div><div class="button t-center button-white" v-if="privateStore.b1" v-on:click="handleLaterPopup" style="display:inline-block;width: 160px;height: 40px;line-height: 40px;margin-left: 20px;font-size: 14px;border:1px solid #7b7b7b;color: #393939">{{ privateStore.b1 }}</div></template></div></div></div><div class="PopWindowTop" id="pop-window-top" v-bind:class="{show: privateStore.isTopPopShow, leave: privateStore.isTopPopLeave}" v-bind:style="{left: privateStore.isTopPopOut ? \'-1000px\' : null}"><div v-show="privateStore.showcloseButton" class="PopWindowTop__close" v-on:click="handleHideTopPopup">×</div><div style="height:100%;"><img :src="privateStore.image" v-if="sharedStore.saveImage" style="height:83%;padding: 15px;float: left;"><span class="PopWindowTop__message" v-bind:style="{color: topPopColor}">{{ privateStore.topMsg }}</span></div></div></div>',data:function(){return{privateStore:{params:"",width:470,height:206,tWidth:358,tHeight:130,confirm:!0,showCenter:!1,showTop:!1,isTopPopAnimate:!1,isTopPopShow:!1,isTopPopLeave:!1,isTopPopOut:!0,image:null,texts:["OK","Try Later","Try Now","Continue","Save","Replace","Place on top","Sure","Cancel","Don't Save","Save as","Add"],b1:"Try Later",b2:"Try Now",showcloseButton:!0,msg:"",topMsg:"",selector:"#popup-window",addparams:"",isConfirmOnlyOnce:!1,isConfirmButtonClicked:!1,isColorRed:!1,nowPopupHandler:new Function,isHoverClose:!1},sharedStore:t}},computed:{topPopColor:function(){return this.privateStore.isColorRed?"#ff0000":"#000000"},windowZindex:function(){var e=t.pages[t.selectedPageIdx].canvas,i=e.params.length||0;return 100*(i+12)},popWindowLeft:function(){return t.isShowPostToSale?"43%":"64%"},showTop:{get:function(){return this.privateStore.showTop},set:function(e){var t=this;this.privateStore.showTop=e,this.privateStore.isTopPopAnimate||(e?(this.privateStore.isTopPopLeave=!1,this.privateStore.isTopPopShow=!0,this.privateStore.isTopPopAnimate=!0,this.privateStore.isTopPopOut=!1,setTimeout(function(){t.privateStore.isTopPopAnimate=!1},300)):(this.privateStore.isTopPopShow=!1,this.privateStore.isTopPopLeave=!0,this.privateStore.isTopPopAnimate=!0,setTimeout(function(){t.privateStore.isTopPopLeave=!1,t.privateStore.isTopPopAnimate=!1,t.privateStore.isTopPopOut=!0},300)))}}},methods:{hoverCloseIcon:function(e){this.privateStore.isHoverClose=e},handleNowPopup:function(){var e=this.privateStore.type,r=this.privateStore.isConfirmOnlyOnce;if(!r||!this.privateStore.isConfirmButtonClicked){if("order"===e)this.$dispatch("dispatchReorder");else if("logo"===e)if(t.isPopSave=!1,i(6).getIsShowProjectInfoView())this.$dispatch("dispatchShowCloneWindow");else{this.$dispatch("dispatchModifyFrameTracker"),this.$dispatch("dispatchRemoveFrameTracker");var a=this;i(11).deleteImageList(function(){i(13).handledSaveOldProject(a,"dispatchRedirectHome")})}else if("replace"===e){var o=this.sharedStore,n=o.pages[o.selectedPageIdx].canvas.elements.length;o.dragData.imageId;o.shouldNewImage=!0,this.$dispatch("dispatchAddImage",this.privateStore.addparams)}else if("delete"===e){var n=this.privateStore.addparams.idx,e=this.privateStore.addparams.type;this.sharedStore.watchData.removeElementIdx=n,this.sharedStore.watchData.removeElementType=e,this.sharedStore.watches.isRemoveElement=!0}else if("saveAs"===e)this.$dispatch("dispatchShowCloneWindow");else if("cancelUpload"===e){for(var s=0;s<this.sharedStore.uploadProgress.length;s++)t.vm.$broadcast("notifyCancelItem",s);t.isUploading=!1,this.sharedStore.uploadProgress.length=0,t.cancelByX?i(8)({ev:i(9).CancelAllFilesByXClicked}):i(8)({ev:i(9).CancelAllFilesClicked}),this.sharedStore.isImageUploadShow=!1}else if("login"===e)window.open("/sign-in.html","_blank");else if("orderBlankProductToCart"===e)this.$dispatch("dispatchOrderToCart");else if("printPageLimitTip"===e)t.vm.$broadcast("notifyShowImageUpload");else if("changeOptionWarning"===e)this.privateStore.nowPopupHandler();else if("reset"===e)i(8)({ev:i(9).ClickResetConfirm,type:1}),this.$dispatch("dispatchResetPages");else if("exit"===e)if(t.isPopSave=!1,i(6).getIsShowProjectInfoView())this.$dispatch("dispatchShowCloneWindow");else{var a=this;this.$dispatch("dispatchModifyFrameTracker"),this.$dispatch("dispatchRemoveFrameTracker"),i(11).deleteImageList(function(){i(13).handledSaveOldProject(a,"dispatchRedirectCardList")})}this.privateStore.isConfirmButtonClicked=!0,r||(this.handleHidePopup(),this.initOptions()),"textFormIncomplete"===e&&(this.$dispatch("dispatchModifyFrameTracker"),this.$dispatch("dispatchRemoveFrameTracker"),i(11).deleteImageList(),this.$dispatch("dispatchOrderToCart"),i(8)({ev:i(9).CheckIncompleteFieldsContinue}))}},handleLaterPopup:function(){var e=this,r=this.privateStore.type;if("order"===r);else if("logo"===r)t.isPopSave=!1,this.redirectHome();else if("replace"===r){var a=this.sharedStore.dropData.idx,o=this.sharedStore.dragData.imageId,n=t.pages[t.selectedPageIdx].canvas;n.elements[a].refreshImageById(o)}else"textFormIncomplete"===r?(t.isOrderClicked=!0,t.vm.$broadcast("notifyTextFormRemindIncomplete"),i(8)({ev:i(9).CheckIncompleteFieldsCancel})):"emptyLRBBlock"===r?i(13).saveOldProject(e,function(){t.isPrjSaved=!0,t.isPopSave=!1,window.location="/"+t.orderType+"/addShoppingCart.html?projectGUID="+t.projectId+"&quantity=1"}):"deleteProject"===r?this.sharedStore.vm.$broadcast("notifyDeleteProject",this.privateStore.params.pageIdx):"orderConfirm"===r?t.vm.$broadcast("notifyOrderContinue"):"exit"===r?(t.isPopSave=!1,this.redirectCardList()):"reset"===r&&i(8)({ev:i(9).ClickResetConfirm,type:0});this.handleHidePopup(),this.initOptions()},handleOkPopup:function(){this.privateStore.type;this.handleHidePopup(),this.initOptions()},handleHidePopup:function(e){var t=this.privateStore.type;e&&"reset"===t&&i(8)({ev:i(9).ClickResetConfirm,type:-1}),this.privateStore.showCenter=!1},handleHideTopPopup:function(){this.showTop=!1},initOptions:function(){this.sharedStore.isPopupShow=!1,this.privateStore.confirm=!0,this.privateStore.msg="",this.privateStore.showcloseButton=!0,this.privateStore.showCenter=!1,this.showTop=!1,this.privateStore.b1=this.privateStore.texts[1],this.privateStore.b2=this.privateStore.texts[2]},redirectHome:function(){location.href="/"},redirectCardList:function(){location.href="/card-list.html"},strategies:function(){var e=this,t=e.privateStore.height;return e.privateStore.height=206,{order:function(t){t==-1&&(e.privateStore.confirm=!1,e.privateStore.b1=e.privateStore.texts[1],e.privateStore.b2=e.privateStore.texts[2],e.setMsg("Unable to add to cart, please try again."))},save:function(i){if(0==i)return e.privateStore.height=t,e.privateStore.isColorRed=!1,e.setTopMsg("Saved successfully!"),e.showTop=!0,e.privateStore.image=e.getImageSelected(),!0;if(1==i)return e.privateStore.height=t,e.privateStore.isColorRed=!1,e.setTopMsg("Submit successfully!"),e.showTop=!0,e.privateStore.image=e.getImageSelected(),!0;if(i==-1)e.privateStore.msg="Unable to save, please try again.";else if(i==-2)e.privateStore.msg="Project Title already Exists";else if(i==-3)e.privateStore.height=246,e.privateStore.msg="This item was already ordered, you can't modify it anymore. Please create a new project if you want to modify.";else if(i==-4)e.privateStore.height=246,e.privateStore.msg="This item was already ordered or added to cart. You need to save your additional changes into a new project.";else if(i==-5)e.privateStore.height=206,e.privateStore.msg="Project is already published!";else if(i==-6)return e.privateStore.height=t,e.setTopMsg("No interenet connection, please check your network and try again."),e.privateStore.isColorRed=!0,e.showTop=!0,e.privateStore.image=e.getImageSelected(),!0},preview:function(t){t==-1&&(e.privateStore.confirm=!0,e.setMsg("Preview failed, please try again."))},upload:function(t){t==-1&&(e.privateStore.confirm=!0,e.setMsg("Please wait for the upload to finish."))},contact:function(t){0==t?(e.privateStore.confirm=!0,e.setMsg("Submit successfully.\nMany thanks for your feedback.")):(e.privateStore.confirm=!0,e.setMsg("Send failed, you may try again later"))},spec:function(t){t==-1&&(e.privateStore.confirm=!0,e.setMsg("Request api service failed"))},logo:function(t){t==-1&&(e.privateStore.height=232,e.privateStore.width=510,e.privateStore.b1=e.privateStore.texts[9],e.privateStore.b2=e.privateStore.texts[4],e.privateStore.confirm=!1,e.setMsg("This will take you to home page.<br/>Please select an option before continuing."))},replace:function(t){t==-1&&(e.privateStore.b1=e.privateStore.texts[5],e.privateStore.b2=e.privateStore.texts[6],e.privateStore.confirm=!1,e.setMsg("How do you want to handle this image? "))},isOrder:function(t){t==-1&&(e.privateStore.height=250,e.privateStore.confirm=!0,e.setMsg("This item was already ordered, you can not modify it anymore.Please create a new project if you want to modify."))},"delete":function(t){t==-1&&(e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2=e.privateStore.texts[7],e.privateStore.confirm=!1,e.setMsg("Current element will  be removed from workbench, please confirm? "))},clone:function(t){e.privateStore.confirm=!0,e.setMsg(e.privateStore.params.info)},saveAs:function(t){e.privateStore.height=236,e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2=e.privateStore.texts[10],e.privateStore.confirm=!1,e.setMsg(e.privateStore.params.info)},printSaveAs:function(t){t==-1?e.privateStore.height=200:e.privateStore.height=236,e.privateStore.confirm=!0,e.setMsg(e.privateStore.params.info)},checkFailed:function(t){e.privateStore.height=250,e.privateStore.confirm=!0,e.setMsg(e.privateStore.params.info)},imageNotExist:function(t){e.privateStore.confirm=!0,e.setMsg("Please drag and drop your photo onto the canvas before placing your order.")},cancelUpload:function(){e.privateStore.height=250,e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2=e.privateStore.texts[3],e.privateStore.confirm=!1,e.setMsg('Your image has not been uploaded.<br />Click "Continue" to cancel upload or "Cancel" to continue uploading.')},login:function(){e.privateStore.height=260,e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2="Log In",e.setMsg("Your session has timed out. You must log in again to continue. Clicking Log In will open a new window. Once successfully logged in, you may return to this window to continue editing."),e.privateStore.confirm=!1},notify:function(t){t==-1&&(e.privateStore.height=206,e.privateStore.msg="Please Fill All Layouts First!")},woodPrintAlert:function(t){0==t&&(e.privateStore.height=240,e.privateStore.confirm=!0,e.privateStore.msg="The available options for print surface have changed. The print surface of your project has been upgraded to the nearest available option.")},orderBlankProductToCart:function(t){e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2=e.privateStore.texts[3],e.privateStore.confirm=!1,e.privateStore.isConfirmOnlyOnce=!0,e.setMsg("Do you really want to add a blank product to your cart?")},textFormIncomplete:function(t){var i=Object.keys(t).reduce(function(e,i){return t[i]?e:e+1},0),r='<div style="position:relative;top:-20px;text-align:left;padding:0 30px;height:'+(55+25*i)+'px;line-height:24px;font-size:14px;"><h3 style="font-size:24px;color:#3A3A3A;margin-bottom:11px;margin-top:0;">Review</h3><div>Please review the following before ordering:'+(t.isAllEdited?"":"<br>- One or more expected fields have not been filled out.")+(t.isAllSizeSuitable?"":"<br>- One or more text is too big and will be cut off.")+'<div style="margin-bottom: 7px;"></div>Do you wish to continue anyway?</div></div>';e.privateStore.height=241+25*i,e.privateStore.width=500,e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2=e.privateStore.texts[3],e.privateStore.confirm=!1,e.setMsg(r)},printPageLimitTip:function(){var t=e.sharedStore.pages.length,i=e.sharedStore.maxPageNum-t,r=i>1?" photos":" photo";e.privateStore.height=240,e.privateStore.b2=e.privateStore.texts[11],e.privateStore.b1="",e.privateStore.confirm=!1,e.setMsg("The Little Prints Pack you are ordering can contain up to "+e.sharedStore.maxPageNum+" photos. Currently it contains only "+t+(t<=1?" photo. ":" photos. ")+"Please add "+i+r)},disableInfo:function(t){e.privateStore.height=250,e.privateStore.confirm=!0,e.setMsg("The option of this product is no longer offered by manufacturer.Please create a new project and experience the latest version.")},emptyLRBBlock:function(){var t=e.privateStore.params.pageNum,i=e.privateStore.params.emptyPageNum;e.privateStore.b2=e.privateStore.texts[8],e.privateStore.b1=e.privateStore.texts[3],e.privateStore.confirm=!1,e.setMsg(" You added "+t+(t>1?" blocks":" block")+", but "+i+(i<=1?" block has ":" blocks have ")+"no image. Would you like to continue?")},deleteProject:function(){var t=e.privateStore.params.message;e.privateStore.b2=e.privateStore.texts[8],e.privateStore.b1=e.privateStore.texts[3],e.privateStore.confirm=!1,t?e.setMsg(t):e.setMsg("This operation will delete this block, would you like to continue?")},alertMessage:function(){e.privateStore.b2=e.privateStore.texts[0],e.privateStore.b1="",e.privateStore.height=e.privateStore.params.height,e.setMsg(e.privateStore.params.message)},orderConfirm:function(){var t=e.privateStore.params.message;e.privateStore.height=e.privateStore.params.height?e.privateStore.params.height:206,e.privateStore.b2=e.privateStore.texts[0],e.privateStore.b1="",e.privateStore.confirm=!1,e.setMsg(t)},changeOptionWarning:function(t){var i='<div style="text-align:left;padding:0 30px;line-height:24px;font-size:14px;margin-top:-20px;margin-bottom:-15px;"><h3 style="font-size:24px;color:#3A3A3A;font-weight:300;margin-bottom:20px;margin-top:0;line-height:1;">WARNING</h3><div style="line-height:25px;font-size:16px;color:#3a3a3a;">This operation will clear current design, would you like to continue?</div></div>';e.privateStore.height=235,e.privateStore.b1=e.privateStore.texts[8],e.privateStore.b2=e.privateStore.texts[3],e.privateStore.confirm=!1,e.privateStore.nowPopupHandler=t.handler,e.setMsg(i)},exit:function(){var t='<div style="text-align:left;padding:0 30px;line-height:24px;font-size:14px;margin-top:-20px;margin-bottom:-15px;"><h3 style="font-size:24px;color:#3A3A3A;margin-bottom:11px;margin-top:0;">Notice</h3><div>This will take you to card list page. Please select an option before continuing.</div></div>';e.privateStore.height=220,e.privateStore.b1=e.privateStore.texts[9],e.privateStore.b2=e.privateStore.texts[4],e.privateStore.confirm=!1,e.setMsg(t)},noInterenet:function(){var t='<div style="text-align:left;padding:0 30px;line-height:24px;font-size:14px;margin-top:-20px;margin-bottom:-15px;"><h3 style="font-size:24px;color:#3A3A3A;margin-bottom:11px;margin-top:0;">Warning</h3><div>No interenet connection, please check your network and try again.</div></div>';e.privateStore.height=220,e.privateStore.confirm=!0,e.setMsg(t)},checkBackCover:function(){var t='<div style="text-align:left;padding:0 30px;line-height:24px;font-size:14px;margin-top:-20px;margin-bottom:-15px;"><h3 style="font-size:24px;color:#3A3A3A;margin-bottom:11px;margin-top:0;">Warning</h3><div>Please change to back cover and submit again.</div></div>';e.privateStore.height=200,e.privateStore.confirm=!0,e.setMsg(t)},reset:function(){var t='<div style="text-align: center;padding: 0 14px;">Use of the Reset function will restore photo frames and text frames to the original, but keep any images and text you have added.<br/>Do you wish to continue?</div>';e.privateStore.height=e.privateStore.params.height?e.privateStore.params.height:206,e.privateStore.b2=e.privateStore.texts[3],e.privateStore.b1=e.privateStore.texts[8],e.privateStore.height=273,e.privateStore.confirm=!1,e.setMsg(t)}}},showPopup:function(e){if(this.privateStore.params=e,"save"!==e.type&&(this.privateStore.type=e.type),this.checkType(e),this.privateStore.showCenter){var t=i(14);t.setPopWindowPosition({width:this.privateStore.width,height:this.privateStore.height,selector:this.privateStore.selector})}this.sharedStore.isPopupShow=!0,this.privateStore.isConfirmButtonClicked=!1},checkType:function(e){this.strategies()[e.type](e.status)?this.showTop=!0:this.privateStore.showCenter=!0},getImageSelected:function(){if(this.sharedStore.projectSettings[this.sharedStore.currentSelectProjectIndex]&&this.sharedStore.projectSettings[this.sharedStore.currentSelectProjectIndex].color&&null!=this.sharedStore.selectedPageIdx)return"./assets/img/"+this.sharedStore.projectSettings[this.sharedStore.currentSelectProjectIndex].color+"-"+this.sharedStore.selectedPageIdx+".png"},setMsg:function(e){this.privateStore.msg=e},setTopMsg:function(e){this.privateStore.topMsg=e}},events:{notifyShowPopup:function(e){var t=this;this.showPopup(e),t.showTop&&setTimeout(function(){t.handleHideTopPopup()},2e3)},notifyHidePopup:function(){this.handleHidePopup(),this.handleHideTopPopup()},notifyRedirectHome:function(){this.redirectHome()},notifyRedirectCardList:function(){this.redirectCardList()},notifyAddOrReplaceImage:function(e){this.showPopup({type:"replace",status:-1}),this.privateStore.addparams=e},notifyDeleteElement:function(e){this.showPopup({type:"delete",status:-1}),this.privateStore.addparams=e}},ready:function(){}}}).call(t,i(2))}]);